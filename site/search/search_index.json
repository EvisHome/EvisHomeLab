{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Home","text":"Articles <p>Collection of articles and guides.</p> Home Lab <p>Networking, Server Infrastructure, VMs, and containers.</p> Smart Home <p>Home Assistant configuration, automations, and dashboards.</p> Tags <p>Browse the content by tags.</p>"},{"location":"#documentation-workflow","title":"Documentation Workflow","text":"<p>Site Architecture &amp; Maintenance</p> <p>Some parts of this documentation site is managed via an Agentic Documentation Workflow. Meaning that it is automatically generated from the live Home Assistant configuration using Google Antigravity.</p> <ul> <li>Strategy: Detached Docs (Private Config \u2192 Public Site)</li> <li>Tools: Home Assistant OS, Gemini AI (Architect AI), Antigravity IDE (AI Agent), Git, MkDocs Material</li> </ul> <p>Documentation Workflow</p>"},{"location":"#the-lab","title":"The Lab","text":""},{"location":"#about-me","title":"About Me","text":"<p>I've had a passion for home automation, DIY, self-hosting for a while now. I'm a big fan of Home Assistant and have been using it for since 2019-2020. I have documented my journey on various platforms, but I've always wanted to have a single place to keep everything in one place. Now with the help of Google Antigravity and the MkDocs Material theme, I've been able to create a single place to keep everything in one place. And the speed of creating everything into this site has been just amazing. Withing just few weekends I was able to create this site automate the documentation process convert some of my older articles and make them into markdown files and add them to the site.</p> <p>My Smart Home journey started along time ago I think somewhere around 2005with having too many remote controllers for my home theater system. I started with a basic setup using a Raspberry Pi and a few scripts to control the system. Over time, I added more and more features, such as voice control, scene management, and more.</p> <p>Before I moved to Home Assistant I used SmartThings with Webcore, SmartApps and Device Handlers (DTHs), which ran in the Groovy IDE. For some years I was using this setup, with a lot of custom code and a lot of time spent on debugging and just maintaining the system.</p> <p>Ever since I fully moved to Home Assistant things have been much easier and I've been able to focus on actual home automation, and making things smarter.</p>"},{"location":"tags/","title":"Tags","text":""},{"location":"tags/#tags","title":"Tags","text":""},{"location":"tags/#tag:3d-printing","title":"3D Printing","text":"<ul> <li>            TinkerCad Project Box Creator          </li> </ul>"},{"location":"tags/#tag:ai","title":"AI","text":"<ul> <li>            AI Log Summary          </li> </ul>"},{"location":"tags/#tag:ble","title":"BLE","text":"<ul> <li>            Area Occupancy Sensor          </li> </ul>"},{"location":"tags/#tag:diy","title":"DIY","text":"<ul> <li>            Area Occupancy Sensor          </li> <li>            Bed Occupancy Sensor          </li> <li>            Motorized Horizontal Blinds - Tilt Action          </li> <li>            TinkerCad Project Box Creator          </li> <li>            Virtual Fireplace          </li> </ul>"},{"location":"tags/#tag:esp32","title":"ESP32","text":"<ul> <li>            Area Occupancy Sensor          </li> <li>            Virtual Fireplace          </li> </ul>"},{"location":"tags/#tag:esphome","title":"ESPHome","text":"<ul> <li>            Area Occupancy Sensor          </li> <li>            Bed Occupancy Sensor          </li> <li>            Motorized Horizontal Blinds - Tilt Action          </li> </ul>"},{"location":"tags/#tag:home-assistant","title":"Home Assistant","text":"<ul> <li>            Bed Occupancy Sensor          </li> <li>            Motorized Horizontal Blinds - Tilt Action          </li> </ul>"},{"location":"tags/#tag:nodered","title":"NodeRED","text":"<ul> <li>            Bed Occupancy Sensor          </li> <li>            Motorized Horizontal Blinds - Tilt Action          </li> <li>            Virtual Fireplace          </li> </ul>"},{"location":"tags/#tag:project-box","title":"Project Box","text":"<ul> <li>            TinkerCad Project Box Creator          </li> </ul>"},{"location":"tags/#tag:proxmox","title":"Proxmox","text":"<ul> <li>            Home Assistant OS VM          </li> </ul>"},{"location":"tags/#tag:self-hosted","title":"Self-Hosted","text":"<ul> <li>            Home Assistant OS VM          </li> </ul>"},{"location":"tags/#tag:tinkercad","title":"TinkerCad","text":"<ul> <li>            TinkerCad Project Box Creator          </li> </ul>"},{"location":"tags/#tag:vm","title":"VM","text":"<ul> <li>            Home Assistant OS VM          </li> </ul>"},{"location":"tags/#tag:wled","title":"WLED","text":"<ul> <li>            Virtual Fireplace          </li> </ul>"},{"location":"tags/#tag:addons","title":"addons","text":"<ul> <li>            Add-ons          </li> </ul>"},{"location":"tags/#tag:adguard","title":"adguard","text":"<ul> <li>            DNS AdGuard Home &amp; Unbound          </li> </ul>"},{"location":"tags/#tag:ai","title":"ai","text":"<ul> <li>            Integration: AI Log Reporter          </li> </ul>"},{"location":"tags/#tag:architecture","title":"architecture","text":"<ul> <li>            Documentation System Architecture          </li> <li>            Home Assistant Documentation Workflow          </li> </ul>"},{"location":"tags/#tag:automated","title":"automated","text":"<ul> <li>            Backyard          </li> <li>            Bathroom          </li> <li>            Bedroom          </li> <li>            CAR          </li> <li>            Configuration &amp; Structure          </li> <li>            Daughter          </li> <li>            Electricity          </li> <li>            Electricity Dev          </li> <li>            Evis          </li> <li>            Front Door          </li> <li>            Guest-1          </li> <li>            Guest-2          </li> <li>            Guest-3          </li> <li>            Hallway          </li> <li>            Home          </li> <li>            Home Access Center          </li> <li>            Kitchen          </li> <li>            Living Room          </li> <li>            Lobby          </li> <li>            Mud Room          </li> <li>            Notifications Management          </li> <li>            Office          </li> <li>            Package Catalog          </li> <li>            Package: Ai Summary          </li> <li>            Package: Airthings          </li> <li>            Package: Aqara W500          </li> <li>            Package: Area Manager          </li> <li>            Package: Car          </li> <li>            Package: Debug Script          </li> <li>            Package: Dishwasher          </li> <li>            Package: Dna Tv Hub          </li> <li>            Package: Garmin          </li> <li>            Package: Home Time Modes          </li> <li>            Package: Nordpool Prices          </li> <li>            Package: Office Pc          </li> <li>            Package: Philips Air Purifier          </li> <li>            Package: Room Manager          </li> <li>            Package: Scenes          </li> <li>            Package: Shelly 3Em          </li> <li>            Package: Smart Notifications          </li> <li>            Package: Smart Speakers          </li> <li>            Package: Tailscale Monitoring          </li> <li>            Package: Unifi Access          </li> <li>            Package: Washing Machine          </li> <li>            Room Management          </li> <li>            Sauna          </li> <li>            Settings          </li> <li>            Smart Home Overview          </li> <li>            Stairs          </li> <li>            Storage          </li> <li>            System          </li> <li>            Toilet          </li> <li>            UI Automations          </li> </ul>"},{"location":"tags/#tag:automations","title":"automations","text":"<ul> <li>            UI Automations          </li> </ul>"},{"location":"tags/#tag:car","title":"car","text":"<ul> <li>            Package: Car          </li> </ul>"},{"location":"tags/#tag:configuration","title":"configuration","text":"<ul> <li>            Configuration &amp; Structure          </li> </ul>"},{"location":"tags/#tag:dashboard","title":"dashboard","text":"<ul> <li>            Backyard          </li> <li>            Bathroom          </li> <li>            Bedroom          </li> <li>            CAR          </li> <li>            Dashboard Catalog          </li> <li>            Daughter          </li> <li>            Electricity          </li> <li>            Electricity Dev          </li> <li>            Evis          </li> <li>            Front Door          </li> <li>            Guest-1          </li> <li>            Guest-2          </li> <li>            Guest-3          </li> <li>            Hallway          </li> <li>            Home          </li> <li>            Home Access Center          </li> <li>            Kitchen          </li> <li>            Living Room          </li> <li>            Lobby          </li> <li>            Mud Room          </li> <li>            Notifications Management          </li> <li>            Office          </li> <li>            Room Management          </li> <li>            Sauna          </li> <li>            Settings          </li> <li>            Stairs          </li> <li>            Storage          </li> <li>            System          </li> <li>            Toilet          </li> </ul>"},{"location":"tags/#tag:dns","title":"dns","text":"<ul> <li>            DNS AdGuard Home &amp; Unbound          </li> </ul>"},{"location":"tags/#tag:docker","title":"docker","text":"<ul> <li>            Integration: AI Log Reporter          </li> </ul>"},{"location":"tags/#tag:frigate","title":"frigate","text":"<ul> <li>            Frigate NVR          </li> </ul>"},{"location":"tags/#tag:guide","title":"guide","text":"<ul> <li>            Home Assistant Documentation Workflow          </li> </ul>"},{"location":"tags/#tag:home-assistant","title":"home assistant","text":"<ul> <li>            AI Log Summary          </li> <li>            Home Assistant OS VM          </li> </ul>"},{"location":"tags/#tag:index","title":"index","text":"<ul> <li>            Add-ons          </li> <li>            Dashboard Catalog          </li> <li>            External Integrations          </li> <li>            Package Catalog          </li> <li>            Smart Home Overview          </li> </ul>"},{"location":"tags/#tag:infrastructure","title":"infrastructure","text":"<ul> <li>            Frigate NVR          </li> </ul>"},{"location":"tags/#tag:integration","title":"integration","text":"<ul> <li>            Integration: AI Log Reporter          </li> </ul>"},{"location":"tags/#tag:integrations","title":"integrations","text":"<ul> <li>            External Integrations          </li> </ul>"},{"location":"tags/#tag:logs","title":"logs","text":"<ul> <li>            AI Log Summary          </li> </ul>"},{"location":"tags/#tag:manual","title":"manual","text":"<ul> <li>            Documentation System Architecture          </li> <li>            Frigate NVR          </li> <li>            Integration: AI Log Reporter          </li> <li>            Tools Reference          </li> </ul>"},{"location":"tags/#tag:meta","title":"meta","text":"<ul> <li>            Documentation System Architecture          </li> <li>            Home Assistant Documentation Workflow          </li> </ul>"},{"location":"tags/#tag:mmwave","title":"mmWave","text":"<ul> <li>            Area Occupancy Sensor          </li> </ul>"},{"location":"tags/#tag:monitoring","title":"monitoring","text":"<ul> <li>            Integration: AI Log Reporter          </li> </ul>"},{"location":"tags/#tag:network","title":"network","text":"<ul> <li>            Frigate NVR          </li> </ul>"},{"location":"tags/#tag:operations","title":"operations","text":"<ul> <li>            Tools Reference          </li> </ul>"},{"location":"tags/#tag:package","title":"package","text":"<ul> <li>            Package Catalog          </li> <li>            Package: Ai Summary          </li> <li>            Package: Airthings          </li> <li>            Package: Aqara W500          </li> <li>            Package: Area Manager          </li> <li>            Package: Car          </li> <li>            Package: Debug Script          </li> <li>            Package: Dishwasher          </li> <li>            Package: Dna Tv Hub          </li> <li>            Package: Garmin          </li> <li>            Package: Home Time Modes          </li> <li>            Package: Nordpool Prices          </li> <li>            Package: Office Pc          </li> <li>            Package: Philips Air Purifier          </li> <li>            Package: Room Manager          </li> <li>            Package: Scenes          </li> <li>            Package: Shelly 3Em          </li> <li>            Package: Smart Notifications          </li> <li>            Package: Smart Speakers          </li> <li>            Package: Tailscale Monitoring          </li> <li>            Package: Unifi Access          </li> <li>            Package: Washing Machine          </li> </ul>"},{"location":"tags/#tag:python","title":"python","text":"<ul> <li>            AI Log Summary          </li> </ul>"},{"location":"tags/#tag:reference","title":"reference","text":"<ul> <li>            Tools Reference          </li> </ul>"},{"location":"tags/#tag:security","title":"security","text":"<ul> <li>            Frigate NVR          </li> </ul>"},{"location":"tags/#tag:self-hosted","title":"self-hosted","text":"<ul> <li>            AI Log Summary          </li> <li>            DNS AdGuard Home &amp; Unbound          </li> </ul>"},{"location":"tags/#tag:structure","title":"structure","text":"<ul> <li>            Configuration &amp; Structure          </li> </ul>"},{"location":"tags/#tag:ui","title":"ui","text":"<ul> <li>            UI Automations          </li> </ul>"},{"location":"tags/#tag:unbound","title":"unbound","text":"<ul> <li>            DNS AdGuard Home &amp; Unbound          </li> </ul>"},{"location":"tags/#tag:unifi-protect","title":"unifi protect","text":"<ul> <li>            Frigate NVR          </li> </ul>"},{"location":"tags/#tag:unifi-network","title":"unifi-network","text":"<ul> <li>            DNS AdGuard Home &amp; Unbound          </li> </ul>"},{"location":"tags/#tag:view","title":"view","text":"<ul> <li>            Backyard          </li> <li>            Bathroom          </li> <li>            Bedroom          </li> <li>            CAR          </li> <li>            Daughter          </li> <li>            Electricity          </li> <li>            Electricity Dev          </li> <li>            Evis          </li> <li>            Front Door          </li> <li>            Guest-1          </li> <li>            Guest-2          </li> <li>            Guest-3          </li> <li>            Hallway          </li> <li>            Home          </li> <li>            Home Access Center          </li> <li>            Kitchen          </li> <li>            Living Room          </li> <li>            Lobby          </li> <li>            Mud Room          </li> <li>            Notifications Management          </li> <li>            Office          </li> <li>            Room Management          </li> <li>            Sauna          </li> <li>            Settings          </li> <li>            Stairs          </li> <li>            Storage          </li> <li>            System          </li> <li>            Toilet          </li> </ul>"},{"location":"articles/","title":"articles","text":""},{"location":"articles/#home-lab-articles-and-guides","title":"Home Lab Articles and Guides","text":""},{"location":"articles/#highlights","title":"Highlights","text":"DNS AdGuard Home &amp; Unbound <p>Eliminating reliance on third parties. Coupling AdGuard Home with Unbound.</p> dnsadguardunboundself-hostedunifi-network AI Log Summary <p>Turning log noise into actionable insights using AI.</p> home assistantlogspythonAIself-hosted TinkerCad Project Box Creator <p>Parametric 3D printable project box creator using TinkerCad Codeblocks.</p> 3D PrintingTinkerCadProject BoxDIY"},{"location":"articles/#articles","title":"Articles","text":""},{"location":"articles/#filter-articles-by-tags","title":"Filter articles by tags","text":"All3D PrintingadguardAIBLEDIYdnsESP32ESPHomeHome AssistantlogsmmWaveNodeREDProject Boxpythonself-hostedTinkerCadunboundunifi-networkWLED Match All Selected DNS AdGuard Home &amp; Unbound <p>2025-12-28</p> <p>Eliminating reliance on third parties. Coupling AdGuard Home with Unbound.</p> dnsadguardunboundself-hostedunifi-network AI Log Summary <p>2025-12-20</p> <p>Turning log noise into actionable insights using AI.</p> home assistantlogspythonAIself-hosted Bed Occupancy Sensor <p>2024-12-03</p> <p>Double bed occupancy monitoring, using two pressure sensitive stripes under the bed mattresses.</p> DIYESPHomeHome AssistantNodeRED Virtual Fireplace <p>2023-12-02</p> <p>Virtual Fireplace that fires up based on room occupancy and TV state.</p> ESP32WLEDNodeREDDIY TinkerCad Project Box Creator <p>2022-09-01</p> <p>Parametric 3D printable project box creator using TinkerCad Codeblocks.</p> 3D PrintingTinkerCadProject BoxDIY Area Occupancy Sensor <p>2022-08-27</p> <p>Presence detection with PIR, mmWave radar and BLE Tracking.</p> ESPHomeESP32mmWaveBLEDIY Motorized Horizontal Blinds - Tilt Action <p>2022-08-26</p> <p>Automating horizontal window blinds tilt with a stepper motor and ESP board using ESPHome.</p> ESPHomeHome AssistantNodeREDDIY"},{"location":"articles/articles/ai-log-summary/","title":"AI Log Summary","text":"","tags":["home assistant","logs","python","AI","self-hosted"]},{"location":"articles/articles/ai-log-summary/#ai-log-summary-turning-noise-into-insights","title":"AI Log Summary: Turning Noise into Insights","text":"<p>Project Status: \u2705 Operational Components: Grafana, Loki, Promtail, Google Gemini 2.0 Flash, Home Assistant, Unraid, Python</p>","tags":["home assistant","logs","python","AI","self-hosted"]},{"location":"articles/articles/ai-log-summary/#1-the-problem-log-fatigue","title":"1. The Problem: Log Fatigue","text":"<p>In a distributed homelab (Unraid, Proxmox VE, Edge Servers, DNS, Traefik, UniFi Network), logs are scattered everywhere.</p> <ul> <li>Volume: My servers generate ~1GB of text logs daily.</li> <li>Visibility: I only looked at logs after I noticed something was broken.</li> <li>Noise: 99% of logs are \"Info\", masking the 1% \"Critical\" errors.</li> </ul> <p>I needed a system that wouldn't just store logs, but actively analyze them and tap me on the shoulder only when it found something I actually needed to see.</p>","tags":["home assistant","logs","python","AI","self-hosted"]},{"location":"articles/articles/ai-log-summary/#2-the-solution","title":"2. The Solution","text":"<p>I built a centralized logging pipeline using Grafana and Loki (for storage) and a custom Python + Gemini script (for analysis).</p> <p>Instead of feeding raw logs to an LLM (which is slow and \"expensive\"), I implemented a \"Pre-processing Engine\" that:</p> <ol> <li>Fetches the last 24 hours of history, in 6 hour patches.</li> <li>Deduplicates repetitive errors (e.g., compressing 5,000 \"Connection Refused\" lines into 1 line).</li> <li>Summarizes the context using Google Gemini 2.0 Flash.</li> <li>Reports actionable findings to my Home Assistant.</li> </ol> <p> </p>","tags":["home assistant","logs","python","AI","self-hosted"]},{"location":"articles/articles/ai-log-summary/#3-architecture-diagram","title":"3. Architecture Diagram","text":"<pre><code>graph TD\n    subgraph Sources [\"Distributed Sources (10Gbps Backbone)\"]\n        direction TB\n        Edge[Edge Nodes] --&gt;|Promtail| Loki\n        Unifi[Unifi UDM Pro] --&gt;|Syslog 5514| Loki\n        Unraid[Unraid Docker] --&gt;|Local Socket| Loki\n    end\n\n    subgraph Hub [\"Unraid Central Hub\"]\n        direction TB\n        Loki[Loki DB] --&gt;|Fetch| Script[Python Script]\n        Loki --&gt;|Visualise| Grafana[Grafana UI]\n        Script &lt;--&gt;|Analyze| Gemini[Gemini 2.0 Flash]\n    end\n\n    subgraph HA [\"Home Assistant\"]\n        direction TB\n        Script --&gt;|Webhook| Core[Home Assistant]\n        Core --&gt; Wall[Dashboard]\n        Core --&gt; Phone[Mobile Alert]\n    end\n\n       %% --- THE FIX: INVISIBLE STRUT ---\n    %% Forces HA to stay at the bottom\n    Gemini ~~~ Core\n\n    style Loki fill:#f9f,stroke:#333,stroke-width:2px\n    style Script fill:#ff9,stroke:#333,stroke-width:2px</code></pre> <p>Logs are aggregated from distributed collectors via Promtail and centralized in a Loki instance on Unraid. This data feeds two parallel consumers: Grafana for visualization and a Python-based automation loop. The Python script queries Loki, processes logs through Google Gemini for anomaly detection, and forwards actionable insights to Home Assistant via Webhooks.</p> <p></p>","tags":["home assistant","logs","python","AI","self-hosted"]},{"location":"articles/articles/ai-log-summary/#4-key-features","title":"4. Key Features","text":"<ul> <li>Cost Efficient: Uses client-side deduplication to reduce token usage by ~95%.</li> <li>Massive Context: Can analyze up to 50,000 log lines per run.</li> <li>Self-Healing: If the report fails, Home Assistant retains the last known state.</li> <li>Privacy: Only anonymized/filtered error logs are sent to the AI; raw logs stay local.</li> </ul>","tags":["home assistant","logs","python","AI","self-hosted"]},{"location":"articles/articles/ai-log-summary/#implementation-guide","title":"Implementation Guide","text":"<p>This guide details how to reproduce the \"AI Log SRE\" stack.</p>","tags":["home assistant","logs","python","AI","self-hosted"]},{"location":"articles/articles/ai-log-summary/#prerequisites","title":"Prerequisites","text":"<ul> <li>Unraid Server (or any Docker host).</li> <li>Google Gemini API Key (Free tier is sufficient, Paid recommended for high limits).</li> <li>Home Assistant (for notifications).</li> </ul>","tags":["home assistant","logs","python","AI","self-hosted"]},{"location":"articles/articles/ai-log-summary/#step-1-central-server-unraid","title":"Step 1: Central Server (Unraid)","text":"<p>We run the <code>loki</code> database, <code>Promtail</code>, <code>Grafana</code>, and the <code>ai-reporter</code> script in a single stack. Using Unraid Compose Manager plugin. </p>","tags":["home assistant","logs","python","AI","self-hosted"]},{"location":"articles/articles/ai-log-summary/#docker-compose","title":"Docker Compose","text":"<p>monitoring-stack.yml</p> <pre><code>services:\n\n  loki:\n    image: grafana/loki:3.1.0\n    container_name: loki\n    user: \"0:0\"  # This runs Loki as root to bypass permission issues on Unraid\n    volumes:\n      - /mnt/docker/appdata/loki:/loki\n      - /etc/localtime:/etc/localtime:ro\n    command: -config.file=/loki/local-config.yaml\n    environment:\n      - TZ=Europe/Helsinki\n    network_mode: host\n    restart: unless-stopped\n\n\n  promtail:\n    image: grafana/promtail:latest\n    container_name: promtail\n    volumes:\n      - /mnt/docker/appdata/promtail/config.yaml:/etc/promtail/config.yaml\n      - /var/log:/var/log:ro            # Reads Unraid OS logs\n      - /var/run/docker.sock:/var/run/docker.sock # Reads Docker names\n      - /etc/localtime:/etc/localtime:ro\n    command: -config.file=/etc/promtail/config.yaml\n    environment:\n      - TZ=Europe/Helsinki\n    network_mode: host  # Must be host mode for UDP 5514 listener\n    restart: unless-stopped\n\n\n  grafana:\n    image: grafana/grafana:latest\n    container_name: grafana\n    restart: unless-stopped\n    environment:\n      - TZ=Europe/Helsinki\n    ports:\n      - \"3000:3000\"\n    volumes:\n      - /mnt/docker/appdata/grafana:/var/lib/grafana\n      - /etc/localtime:/etc/localtime:ro\n\n\n  ai-log-reporter:\n    image: python:3.11-slim\n    container_name: ai-log-reporter\n    volumes:\n      - /mnt/docker/appdata/ai-reporter:/app\n      - /etc/localtime:/etc/localtime:ro\n    environment:\n      - TZ=Europe/Helsinki\n      - LOKI_URL=http://localhost:3100\n      - GEMINI_API_KEY=[GEMINI-API-KEY]\n      - HA_URL=http://[HA-IP]:8123\n      - HA_TOKEN=[HA-LONG-LIVED-TOKEN]\n    command: &gt;\n      sh -c \"pip install requests google-genai &amp;&amp; \n      python /app/reporter.py &amp;&amp; \n      tail -f /dev/null\"\n    restart: unless-stopped\n    network_mode: host\n</code></pre> <p></p>","tags":["home assistant","logs","python","AI","self-hosted"]},{"location":"articles/articles/ai-log-summary/#loki-configuration-local-configyaml","title":"Loki Configuration (local-config.yaml)","text":"<p>Critical: The <code>max_entries_limit_per_query</code> must be increased to allow the AI to see full history.</p> <p>Adding this in Unraid terminal:</p> <pre><code>nano /mnt/docker/appdata/loki/local-config.yaml\n</code></pre> <pre><code>auth_enabled: false\n\nserver:\n  http_listen_port: 3100\n\ncommon:\n  instance_addr: 0.0.0.0\n  path_prefix: /loki\n  storage:\n    filesystem:\n      chunks_directory: /loki/chunks\n      rules_directory: /loki/rules\n  replication_factor: 1\n  ring:\n    kvstore:\n      store: inmemory\n\nschema_config:\n  configs:\n    - from: 2024-04-01\n      store: tsdb\n      object_store: filesystem\n      schema: v13\n      index:\n        prefix: index_\n        period: 24h\n\n# SECTION 1: ENABLE THE CLEANER (COMPACTOR)\ncompactor:\n  working_directory: /loki/boltdb-shipper-compactor\n  retention_enabled: true\n  delete_request_store: filesystem\n\nlimits_config:\n  retention_period: 720h # 30days | 720h\n  allow_structured_metadata: true\n\n  max_global_streams_per_user: 10000    # Increase from default 5000\n  ingestion_rate_strategy: global       # Treat limits across the whole cluster\n  max_streams_per_user: 10000           # Increase per-tenant limit\n\n  # --- Rate Limiting (The Fix) ---\n  reject_old_samples: true\n  reject_old_samples_max_age: 168h\n  ingestion_rate_mb: 20\n  ingestion_burst_size_mb: 40\n  per_stream_rate_limit: 20MB\n  per_stream_rate_limit_burst: 40MB\n\n# --- Query Limiting (The Unlock) ---\n  max_entries_limit_per_query: 50000  # ALLOWS YOUR SCRIPT TO READ MORE\n\nanalytics:\n  reporting_enabled: false\n</code></pre>","tags":["home assistant","logs","python","AI","self-hosted"]},{"location":"articles/articles/ai-log-summary/#promtail-config-on-unraid","title":"Promtail config on Unraid","text":"<p>The Promtail instance on Unraid has more roles than on the edge nodes, so the config is a bit different. It doesn't just watch local files; it acts as a network gateway for hardware that can't run its own agent (like your UDM-Pro and Proxmox hosts).</p> <ul> <li>Docker Socket: Directly scrapes all Unraid container logs.</li> <li>Syslog Server: Listens on port 5514 for incoming UDP/TCP syslog traffic from UniFi and Proxmox.</li> <li>System Logs: Monitors the Unraid OS kernel and array logs.</li> </ul> <p>In Unraid terminal:</p> <pre><code>nano /mnt/docker/appdata/promtail/config.yaml\n</code></pre> <pre><code>server:\n  http_listen_port: 9080\n  grpc_listen_port: 0\n\npositions:\n  filename: /tmp/positions.yaml\n\nclients:\n  - url: http://localhost:3100/loki/api/v1/push\n\nscrape_configs:\n# -----------------------------------------------------------\n# 1. LOCAL DOCKER (Unraid) -&gt; job=\"docker\"\n# -----------------------------------------------------------\n  - job_name: docker\n    docker_sd_configs:\n      - host: unix:///var/run/docker.sock\n        refresh_interval: 5s\n    relabel_configs:\n      - source_labels: ['__meta_docker_container_name']\n        regex: '/(.*)'\n        target_label: 'container_name'\n      - target_label: 'host'\n        replacement: 'unraid'\n\n# -----------------------------------------------------------\n# 2. LOCAL SYSLOG (Unraid OS) -&gt; job=\"syslog\"\n# -----------------------------------------------------------\n  - job_name: system\n    static_configs:\n      - targets:\n          - localhost\n        labels:\n          job: syslog\n          host: unraid\n          __path__: /var/log/syslog\n\n# -----------------------------------------------------------\n# 3. NETWORK SYSLOG (UniFi &amp; Proxmox) -&gt; job=\"unifi\" / \"proxmox\"\n# -----------------------------------------------------------\n  - job_name: syslog-network\n    syslog:\n      listen_address: 0.0.0.0:5514\n      listen_protocol: udp\n      idle_timeout: 60s\n      label_structured_data: yes\n      labels:\n        job: syslog_network\n    relabel_configs:\n      # Map hostname\n      - source_labels: ['__syslog_message_hostname']\n        target_label: 'host'\n\n      # Role-Based Tagging: UniFi\n      - source_labels: ['host']\n        regex: '(UDM-Pro|U6-Lite|USW-Flex|Unifi-Dream-Machine)'\n        target_label: 'job'\n        replacement: 'unifi'\n\n      # Role-Based Tagging: Proxmox\n      - source_labels: ['host']\n        regex: '(halo|edge)'\n        target_label: 'job'\n        replacement: 'proxmox'\n</code></pre>","tags":["home assistant","logs","python","AI","self-hosted"]},{"location":"articles/articles/ai-log-summary/#step-2-log-collection-on-edge-nodes","title":"Step 2: Log Collection on Edge Nodes","text":"<p>On every other server (Proxmox VM Edge, Pi), we run Promtail to ship logs to Unraid.</p>","tags":["home assistant","logs","python","AI","self-hosted"]},{"location":"articles/articles/ai-log-summary/#docker-compose_1","title":"Docker Compose","text":"<pre><code>networks:\n  socket-proxy:\n    external: true\n\nservices:\n  promtail:\n    image: grafana/promtail:latest\n    container_name: promtail_log_shipper\n    command: -config.file=/etc/promtail/config.yml\n    volumes:\n      - /docker/promtail/config.yml:/etc/promtail/config.yml\n      - /var/log:/var/log:ro\n    networks:\n      - socket-proxy\n    restart: unless-stopped\n</code></pre>","tags":["home assistant","logs","python","AI","self-hosted"]},{"location":"articles/articles/ai-log-summary/#promtail-config","title":"Promtail Config","text":"<pre><code>nano /docker/promtail/config.yaml\n</code></pre> <p>Promtail Config (config.yml) </p><pre><code>server:\n  http_listen_port: 9080\n  grpc_listen_port: 0\n\npositions:\n  filename: /tmp/positions.yaml\n\nclients:\n  - url: http://10.0.0.23:3100/loki/api/v1/push\n\nscrape_configs:\n  # --- SYSTEM LOGS (Aligned with Unraid) ---\n  - job_name: system\n    static_configs:\n    - targets:\n        - localhost\n      labels:\n        host: [YOUR-HOSTNAME]\n        job: syslog\n        __path__: /var/log/*.log\n\n  # --- DOCKER LOGS ---\n  - job_name: docker\n    docker_sd_configs:\n      - host: tcp://docker-socket-proxy:2375\n        refresh_interval: 5s\n\n    relabel_configs:\n      - source_labels: ['__meta_docker_container_name']\n        regex: '/(.*)'\n        target_label: 'container_name'\n\n      - target_label: 'host'\n        replacement: '[YOUR-HOSTNAME]'\n\n      - target_label: 'job'\n        replacement: 'docker'\n\n    pipeline_stages:\n      - docker: {}\n      # ... Keep your existing Socket Proxy and Level Detection stages below ...\n      - match:\n          selector: '{container_name=\"docker-socket-proxy\"}'\n          stages:\n            - regex:\n                expression: '\\s\\d+/\\d+/\\d+/\\d+/\\d+\\s+(?P&lt;status_code&gt;\\d{3})\\s'\n            - template:\n                source: level\n                template: '{% raw %}{{ if hasPrefix \"2\" .status_code }}info{{ else if hasPrefix \"3\" .status_code }}info{{ else if hasPrefix \"4\" .status_code }}warn{{ else if hasPrefix \"5\" .status_code }}error{{ else }}unknown{{ end }}{% endraw %}'\n            - labels:\n                level:\n      - regex:\n          expression: '(?i)(?:level|lvl|severity)=(?P&lt;level&gt;\\w+)|\\[(?P&lt;level&gt;\\w+)\\]'\n      - labels:\n          level:\n</code></pre><p></p>","tags":["home assistant","logs","python","AI","self-hosted"]},{"location":"articles/articles/ai-log-summary/#step-3-the-intelligence-python-script","title":"Step 3: The Intelligence (Python Script)","text":"<p>This script runs inside the <code>ai-log-reporter</code> container.</p> <p>Key Logic:</p> <ol> <li>Fetches last 24h of logs (level=error or warn).</li> <li>Uses a defaultdict to count duplicates.</li> <li>Truncates output if &gt; 90k chars.</li> </ol> <p>(See repository for full reporter.py source code)</p> <p>Step 4: Home Assistant Package The automation that triggers the report and displays it.</p> <pre><code>shell_command:\n  generate_ai_log_summary: &gt;\n    ssh -i /config/.ssh/id_rsa -o StrictHostKeyChecking=no root@[UNRAID-IP] 'docker exec ai-log-reporter python /app/reporter.py'\n\nautomation:\n  - alias: \"Daily AI System Summary\"\n    trigger:\n      - platform: time\n        at: \"07:00:00\"\n      - platform: homeassistant\n        event: start\n    action:\n      - delay: \"00:01:00\"\n      - action: script.run_ai_summary_now\n</code></pre> <p> </p>","tags":["home assistant","logs","python","AI","self-hosted"]},{"location":"articles/articles/ai-log-summary/#user-manual-operations","title":"User Manual &amp; Operations","text":"","tags":["home assistant","logs","python","AI","self-hosted"]},{"location":"articles/articles/ai-log-summary/#how-to-read-the-daily-report","title":"How to Read the Daily Report","text":"<p>The AI Summary appears in Home Assistant every morning at 07:00.</p>","tags":["home assistant","logs","python","AI","self-hosted"]},{"location":"articles/articles/ai-log-summary/#the-iconography","title":"The Iconography","text":"<ul> <li>\ud83d\udd34 CRITICAL: Immediate action required.<ul> <li>Examples: Database corruption, Disk failure (SMART), Service boot loops.</li> <li>Action: Check Grafana immediately.</li> </ul> </li> <li>\ud83d\udee1\ufe0f SECURITY: Passive protection info.<ul> <li>Examples: \"CrowdSec blocked 50 IPs\", \"Brute force attempt on SSH\".</li> <li>Action: None (System is doing its job).</li> </ul> </li> <li>\ud83d\udfe1 WARNING: Non-critical noise.<ul> <li>Examples: Timeouts, configuration deprecation warnings.</li> <li>Action: Add to \"Technical Debt\" to-do list.</li> </ul> </li> </ul>","tags":["home assistant","logs","python","AI","self-hosted"]},{"location":"articles/articles/ai-log-summary/#troubleshooting","title":"Troubleshooting","text":"<p>\"Report says: No critical errors found.\" * Good News: Your system is healthy! * Verification: Check the <code>ai-log-reporter</code> container logs to ensure it actually ran and didn't just fail to fetch data.</p> <p>\"Report is Empty or Unknown\" * Check Home Assistant logs for <code>Shell Command</code> errors. * Ensure the SSH key in Home Assistant allows connection to Unraid without a password.</p>","tags":["home assistant","logs","python","AI","self-hosted"]},{"location":"articles/articles/ai-log-summary/#grafana-deep-dive","title":"Grafana Deep Dive","text":"<p>When the AI reports a \"Critical\" error, use Grafana to investigate.</p> <p>Recommended LogQL Query: To see the raw data the AI analyzed: </p><pre><code>{job=~\".+\"} != \"docker-socket-proxy\" |= \"error\"\n</code></pre> shows all logs from the edge host but removes the noisy traefik and crowdsec logs so you can see system issues<p></p> <p></p><pre><code>{host=\"edge\"} != \"traefik\" != \"crowdsec\"\n</code></pre> shows all logs from the edge host but removes the noisy traefik and crowdsec logs so you can see system issues<p></p> <p></p><pre><code>sum by (container_name) (count_over_time({job=\"docker\"} |= \"error\" [1m]))\n</code></pre> counts the number of errors per container over the last minute<p></p> Source Goal Query Docker See Raw AI Data <code>{job=~\".+\"} != \"docker-socket-proxy\"</code> Docker Filter Noise <code>{host=\"edge\"} != \"traefik\" != \"crowdsec\"</code> Hardware Search Unifi Logs <code>{job=\"syslog\"}</code> Metrics Live Error Count <code>sum(count_over_time({job=\"docker\"}))</code>","tags":["home assistant","logs","python","AI","self-hosted"]},{"location":"articles/articles/area-occupancy-sensor/","title":"Area Occupancy Sensor","text":"","tags":["ESPHome","ESP32","mmWave","BLE","DIY"]},{"location":"articles/articles/area-occupancy-sensor/#area-occupancy-sensor","title":"Area Occupancy Sensor","text":"","tags":["ESPHome","ESP32","mmWave","BLE","DIY"]},{"location":"articles/articles/area-occupancy-sensor/#overview","title":"Overview","text":"<p>Presence detection with PIR, mmWave radar and BLE Tracking. To make the enclosure as small as possible, I removed all headers from the PIR and from the ESP32.</p>","tags":["ESPHome","ESP32","mmWave","BLE","DIY"]},{"location":"articles/articles/area-occupancy-sensor/#parts","title":"Parts","text":"<p>Parts which I used for this project * ESP32 * AM312 IR sensor * DFrobot SEN0395 mmWave Radar (2.4GHz) * MicroUSB Power + Cable * Custom 3D Printed enclosure * Wires to connect the parts * Header rim for the mmWAve Radar</p>","tags":["ESPHome","ESP32","mmWave","BLE","DIY"]},{"location":"articles/articles/area-occupancy-sensor/#wiring-diagram","title":"Wiring Diagram","text":"","tags":["ESPHome","ESP32","mmWave","BLE","DIY"]},{"location":"articles/articles/area-occupancy-sensor/#usb-power","title":"USB Power","text":"<p>When powering the ESP from USB, you get 5V out from the VIN pin, which I used to power the mmWave radar sensor. </p>","tags":["ESPHome","ESP32","mmWave","BLE","DIY"]},{"location":"articles/articles/area-occupancy-sensor/#build","title":"Build","text":"","tags":["ESPHome","ESP32","mmWave","BLE","DIY"]},{"location":"articles/articles/area-occupancy-sensor/#enclosure","title":"Enclosure","text":"","tags":["ESPHome","ESP32","mmWave","BLE","DIY"]},{"location":"articles/articles/area-occupancy-sensor/#esphome","title":"ESPHome","text":"<pre><code>esphome:\n  name: kitchen-presence\n\nesp32:\n  board: esp32dev\n  framework:\n    type: arduino\n\n# Enable logging\nlogger:\n\n# Enable Home Assistant API\napi:\n\n# Over The Air updates\nota:\n  password: !secret ota_password\n\n# Connection to WiFi\nwifi:\n  ssid: !secret wifi_ssid\n  password: !secret wifi_password\n\n  # Enable fallback hotspot (captive portal) in case wifi connection fails\n  ap:\n    ssid: \"kitchen-Presence\"\n    password: !secret ap_password\n\n# MQTT client component\nmqtt:\n  broker: !secret mqtt_ip\n  username: !secret mqtt_username\n  password: !secret mqtt_password\n  discovery: False # Only if you use the HA API usually\n  id: mqtt_client\n\nsubstitutions:\n  room_name: bedroom\n\nglobals:\n  - id: room_topic\n    type: std::string\n    initial_value: '\"room_presence/${room_name}\"'\n\n# Enable BLE tracker\nesp32_ble_tracker:\n  on_ble_advertise:\n    - then:\n      - mqtt.publish_json:\n          topic: 'room_presence/${room_name}'\n          payload: |-\n            root[\"id\"]=x.address_str();\n            root[\"name\"]=x.get_name();\n            root[\"rssi\"]=x.get_rssi();\n            # adjusted TX Power for Oura\n            root[\"distance\"]=pow(10, (float)(-81 - x.get_rssi()) / (10 * 2));\n\n# fallback if WiFi fails\ncaptive_portal:\n\nweb_server:\n  port: 80\n  version: 2\n  include_internal: true\n  auth:\n    username: !secret web_user\n    password: !secret web_pass\n\n# Enable HTTP/HTTPS requests\nhttp_request:\n  # default ESPHome\n  useragent: esphome/$device_name\n  # request time out / default 5s\n  timeout: 2s\n\n# UART communication settings for mmWave sensor | Remember to set pins\nuart:\n  id: uart_bus\n  # pin to send data from ESP\n  tx_pin: GPIO25\n  # pin to receive data to ESP\n  rx_pin: GPIO26\n  # baud rate for UART bus (required)\n  baud_rate: 115200\n  debug:\n    # debug communication to both directions\n    direction: BOTH\n    # useful to debug all incoming communication\n    dummy_receiver: true\n    after:\n      delimiter: \"\\n\"\n    sequence:\n      - lambda: UARTDebug::log_string(direction, bytes);\n\n\nswitch:\n\n    # Switch for Safe Mode\n  - platform: safe_mode\n    internal: true\n    name: use_safe_mode\n\n\nbinary_sensor:\n\n  # mmWave Sensor | remember to set the pin\n- platform: gpio\n  name: kitchen_mmwave\n  pin:\n    number: GPIO27\n    mode: INPUT_PULLDOWN\n\n  # PIR Sensor | remember to set the pin\n- platform: gpio\n  name: kitchen_pir\n  id: kitchen_pir\n  pin:\n    number: GPIO18\n    mode: INPUT_PULLDOWN\n  # delay detection off by 3s\n  filters:\n    - delayed_off: 3s\n\n  # Jukka Oura Gen3 BLE sensor\n- platform: ble_presence\n  mac_address: 'xx:xx:xx:xx:xx:xx'\n  name: \"Jukka Oura Kitchen\"\n\n  # Piia Oura Gen2 BLE sensor\n- platform: ble_presence\n  mac_address: 'xx:xx:xx:xx:xx:xx'\n  name: \"Piia Oura\"\n\n\nsensor:\n\n  # Jukka Oura Gen3 RSSI sensor value\n- platform: ble_rssi\n  mac_address: 'xx:xx:xx:xx:xx:xx'\n  name: \"Jukka Oura RSSI kitchen\"\n\n  # Piia Oura Gen2 RSSI sensor value\n- platform: ble_rssi\n  mac_address: 'xx:xx:xx:xx:xx:xx'\n  name: \"Piia Oura RSSI kitchen\"\n\n  # Anton FitBit RSSI sensor value\n- platform: ble_rssi\n  mac_address: 'xx:xx:xx:xx:xx:xx'\n  name: \"Anton FitBit RSSI kitchen\"\n\n\nnumber:\n\n    ## SENSING DISTANCE value for mmWave Radar\n  - platform: template\n    # name for the number (required)\n    name: kitchen_distance\n    # ID for code generation (optional)\n    id: kitchen_distance\n    # Min &amp; Max values for the distance slider (required)\n    min_value: 0 # Default, if initial_value is not set\n    max_value: 1350\n    # default number (sensing distance) value in cm\n    initial_value: 315\n    # When TRUE any command sent to the template number will immediately update the reported state.\n    optimistic: true\n    # Slider changes the number (sensing distance) value in steps of 15cm\n    step: 15\n    # Saves and loads the state to RTC/Flash\n    restore_value: true\n    # Unit\n    unit_of_measurement: cm\n    # Action to be performed when requested from frontend\n    set_action:\n    # STOP the sensor first\n      - uart.write: \"sensorStop\"\n      # Wait for 1 sec for the sensor to stop\n      - delay: 1s\n      # Write the new sensing distance value to the sensor detRangeCfg\n      - uart.write: !lambda\n                      int cm = (int)ceil(x / 15.0);\n                      std::string cms = \"detRangeCfg -1 0 \" + to_string(cm);\n                      return std::vector&lt;unsigned char&gt;(cms.begin(), cms.end());\n      # Wait for 1 sec for the write\n      - delay: 1s\n      # When parameters are reconfigured through UART and not saved, this command (Fixed values) saves the new configuration parameters to the sensor Flash\n      # saveCfg par1 par2 par3 par4\n      - uart.write: \"saveCfg 0x45670123 0xCDEF89AB 0x956128C6 0xDF54AC89\"\n      # Wait for 1 sec for the write\n      - delay: 1s\n      # START the sensor again\n      - uart.write: \"sensorStart\"\n\n    ## LATENCY FOR TURNING mmWave OFF when no movement detected.\n  - platform: template\n    name: kitchen_latency\n    id: kitchen_latency\n    # Min &amp; Max values for the latency slider (required) in ms\n    min_value: 0\n    max_value: 65000\n    # default number (latency) value in ms\n    initial_value: 12500\n    # When TRUE any command sent to the template number will immediately update the reported state.\n    optimistic: true\n    step: 25\n    # Saves and loads the state to RTC/Flash\n    restore_value: true\n    unit_of_measurement: ms\n    set_action:\n    # STOP the sensor first\n      - uart.write: \"sensorStop\"\n      - delay: 1s\n      - uart.write: !lambda\n                      int ms = (int)ceil(x / 25.0);\n                      std::string mss = \"outputLatency -1 0 \" + to_string(ms);\n                      return std::vector&lt;unsigned char&gt;(mss.begin(), mss.end());\n      - delay: 1s\n      # When parameters are reconfigured through UART and not saved, this command (Fixed values) saves the new configuration parameters to the sensor Flash\n      # saveCfg par1 par2 par3 par4\n      - uart.write: \"saveCfg 0x45670123 0xCDEF89AB 0x956128C6 0xDF54AC89\"\n      - delay: 1s\n      # START the sensor again\n      - uart.write: \"sensorStart\"   \n\nbutton:\n    # Restart the device\n  - platform: restart\n    name: restart_kitchen_radar\n\n    # Reset mmWave sensor configuration parameters to Factory defaults\n  - platform: template\n    name: \"factory_reset_kitchen_dfrobot\"\n    id: \"factory_reset_kitchen_dfrobot\"\n    on_press:\n    # STOP the sensor first\n      - uart.write: \"sensorStop\"\n      - delay: 1s\n      # reset command (fixed values)\n      - uart.write: \"factoryReset 0x45670123 0xCDEF89AB 0x956128C6 0xDF54AC89\"\n      - delay: 3s\n      # START the sensor again\n      - uart.write: \"sensorStart\"\n</code></pre>","tags":["ESPHome","ESP32","mmWave","BLE","DIY"]},{"location":"articles/articles/bed-occupancy-sensor/","title":"Bed Occupancy Sensor","text":"","tags":["DIY","ESPHome","Home Assistant","NodeRED"]},{"location":"articles/articles/bed-occupancy-sensor/#bed-occupancy-sensor","title":"Bed Occupancy Sensor","text":"","tags":["DIY","ESPHome","Home Assistant","NodeRED"]},{"location":"articles/articles/bed-occupancy-sensor/#description","title":"Description","text":"<p>Double bed occupancy monitoring, using two pressure sensitive stripes under the bed mattresses. Including a BLE Proxy</p> <p>I started testing with multiple different resistors, but my I have first a a really thick and heavy memory foam mattress and on top of that I have an 8 cm memory foam mattress topper. Tried 5,6KOhm, 47KOhm, 100KOhm, 3x 100KOhm, until I ended to 1MOhm resistor which worked perfectly for my mattress setup.</p> <p>I also enabled the BLE Proxy on the ESP32.</p>","tags":["DIY","ESPHome","Home Assistant","NodeRED"]},{"location":"articles/articles/bed-occupancy-sensor/#background","title":"Background","text":"<p>I have mmWave sensors in each rooms, from which some can detect also different areas within the room, but detecting bed occupancy has been tricky, after a while I fall a sleep, I'm not getting detected to be in bed. Not sure if I teleport to somewhere else, just sleep very very very still, or if my 11kg weighted blanked (filled with tiny glass balls) has something to do with that.</p> <p>I tried a pressure mattress under my mattress topper, but that was so annoying I ended up taking it away. It didn't stay in place, but the most annoying thing was the noise it made, when you turn from side to side.</p>","tags":["DIY","ESPHome","Home Assistant","NodeRED"]},{"location":"articles/articles/bed-occupancy-sensor/#parts","title":"Parts","text":"<ul> <li>ESP Wroom 32 (ESP32 DevKit v1)</li> <li>Resistors 2 x 1 MOhm</li> <li>SF15-600 10 kg - Flexible Thin Film Pressure Sensor</li> <li>Wires and connectors</li> </ul>","tags":["DIY","ESPHome","Home Assistant","NodeRED"]},{"location":"articles/articles/bed-occupancy-sensor/#diagram","title":"Diagram","text":"","tags":["DIY","ESPHome","Home Assistant","NodeRED"]},{"location":"articles/articles/bed-occupancy-sensor/#esphome-code","title":"ESPHome Code","text":"<pre><code>substitutions:\n  name: master\n  sensor1: right\n  sensor2: left\n\nesphome:\n  name: ${name}-bed-sensor\n  friendly_name: ${name}-bed-sensor\n\nesp32:\n  board: esp32dev\n  framework:\n    type: arduino\n\n# Enable logging\nlogger:\n\n# Enable Home Assistant API\napi:\n  encryption:\n    key: !secret api_key\n\n# Over The Air Updates\nota:\n  platform: esphome\n  password: !secret ota_password\n\n# Connect to Wi-Fi\nwifi:\n  ssid: !secret wifi_ssid\n  password: !secret wifi_password\n  fast_connect: true\n\n  # Enable fallback hotspot (captive portal) in case wifi connection fails\n  ap:\n    ssid: \"bed-sensor-${name}\"\n    password: !secret ap_password\n\ncaptive_portal:\n\n# BLUETOOTH PROXY\nbluetooth_proxy:\n  active: true\n\nesp32_ble_tracker:\n\n\nbinary_sensor:\n  # Binary sensor for status of device\n  - platform: status\n    name: ${name} Bed occupancy Status\n  # Binary sensor for left side\n  - platform: analog_threshold\n    name: ${name} Bed occupancy - ${sensor1}\n    sensor_id: ${name}_bed_occupancy_${sensor1}_value\n    icon: mdi:bed\n    threshold: 1 #the voltage treshold when considered occupied\n    filters:\n      - invert:\n  - platform: analog_threshold\n    name: ${name} Bed occupancy - ${sensor2}\n    sensor_id: ${name}_bed_occupancy_${sensor2}_value\n    icon: mdi:bed\n    threshold: 1 #the voltage treshold when considered occupied\n    filters:\n      - invert:\n\n\nsensor:\n  # ADC sensor for left TFP sensor\n  - platform: adc\n    pin: 32\n    attenuation: 0db\n    name: ${name} bed occupancy - ${sensor1} value\n    id: ${name}_bed_occupancy_${sensor1}_value\n    unit_of_measurement: \"V\"\n    update_interval: 5s\n    internal: false # Default not exposed to front-end\n    raw: true\n    filters:\n      - multiply: 0.00026862 # 1.1/4095, for attenuation 0db\n  # ADC sensor for left TFP sensor\n  - platform: adc\n    pin: 33\n    attenuation: 0db\n    name: ${name} bed occupancy - ${sensor2} value\n    id: ${name}_bed_occupancy_${sensor2}_value\n    unit_of_measurement: \"V\"\n    update_interval: 5s\n    internal: false # Default not exposed to front-end\n    raw: true\n    filters:\n      - multiply: 0.00026862 # 1.1/4095, for attenuation 0db\n</code></pre>","tags":["DIY","ESPHome","Home Assistant","NodeRED"]},{"location":"articles/articles/bed-occupancy-sensor/#bed-install","title":"Bed Install","text":"<p>I taped the the SF15-600 sensors to the beams on about chest/shoulder level under the mattresses.</p> <p> </p>","tags":["DIY","ESPHome","Home Assistant","NodeRED"]},{"location":"articles/articles/bed-occupancy-sensor/#home-assistant","title":"Home Assistant","text":"<p>)</p>","tags":["DIY","ESPHome","Home Assistant","NodeRED"]},{"location":"articles/articles/dns-adguard-unbound/","title":"DNS AdGuard Home & Unbound","text":"","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/dns-adguard-unbound/#dns-the-adguard-home-unbound-stack","title":"DNS: The AdGuard Home &amp; Unbound Stack","text":"<p>In this section, we break down the DNS architecture of the Homelab.</p> <p>The goal is simple: Eliminate reliance on third parties. By coupling AdGuard Home (The Network Shield) with Unbound (The Recursive Resolver), we stop \"asking\" Google or our ISP for website addresses and start finding them ourselves directly from the global Root Servers.</p> <p></p> <p>Key Takeaways</p> <ul> <li> <p>What this HIDES: Your full DNS query log from Google, Cloudflare, and your ISP's DNS Server. (Unless Unbound fails to respond for 10 seconds, it will use the Emergency Fallback)</p> </li> <li> <p>What this DOES NOT HIDE: Your IP traffic from your ISP. (You would need a VPN for that).</p> </li> <li> <p>What this PROTECTS: You are protected from DNS Censorship, DNS Spoofing, and \"Typo-Squatting\" ads often injected by ISPs.</p> </li> </ul> <p></p> <p></p>","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/dns-adguard-unbound/#1-architecture-overview","title":"1. Architecture Overview","text":"","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/dns-adguard-unbound/#the-split-brain-dns-model","title":"The \"Split-Brain\" DNS Model","text":"<p>This system relies on a Decoupled Architecture:</p> <ol> <li> <p>The Shield (AdGuard Home): Handles request filtering, blocklists, and client management. It acts as the \"doorman.\"</p> </li> <li> <p>The Resolver (Unbound): Handles the actual \"phone book\" lookup. It talks directly to the global Root Servers, avoiding the use of Google (8.8.8.8) or your ISP's DNS servers for resolution.</p> </li> </ol>","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/dns-adguard-unbound/#visual-diagram","title":"Visual Diagram","text":"<pre><code>flowchart TD\n    %% -- Subgraph: The Network Clients --\n    subgraph LAN [\"\ud83c\udfe0 Home Network (VLANs)\"]\n        Client1[(\"\ud83d\udcf1 Phone / PC\")]\n        Client2[(\"\ud83d\udcfa IoT / TV\")]\n    end\n\n    %% -- Subgraph: The Router --\n    subgraph Router [\"UniFi Dream Machine (UDM Pro)\"]\n        DHCP[(\" DHCP Server \")]\n    end\n\n    %% -- Subgraph: High Availability Cluster --\n    subgraph DNS_Cluster [\"\u26a1 DNS High Availability Cluster\"]\n        direction TB\n\n        subgraph Node1 [\"Raspberry Pi 63 (Primary)\"]\n            AGH1[\"\ud83d\udee1\ufe0f AdGuard Home (:53)\"]\n            Unbound1[\"\ud83e\udde0 Unbound (:5335)\"]\n            AGH1 --&gt;|Recursive Query| Unbound1\n        end\n\n        subgraph Node2 [\"Raspberry Pi 62 (Secondary)\"]\n            AGH2[\"\ud83d\udee1\ufe0f AdGuard Home (:53)\"]\n            Unbound2[\"\ud83e\udde0 Unbound (:5335)\"]\n            AGH2 --&gt;|Recursive Query| Unbound2\n        end\n    end\n\n    %% -- Subgraph: The Internet --\n    subgraph Internet [\"\ud83c\udf0d The Internet\"]\n        RootServers[\"ROOT Servers &lt;br&gt; (ICANN / Verisign)\"]\n        Quad9[\"\ud83d\ude91 Public Servers &lt;br&gt; (Emergency Fallback)\"]\n    end\n\n    %% -- Connections --\n    %% 1. DHCP Assignment\n    DHCP -- \"Assigns DNS 1: Pi 63 &lt;br&gt; Assigns DNS 2: Pi 62\" --&gt; LAN\n\n    %% 2. Client Requests (Load Balanced by Client OS)\n    LAN -- \"DNS Query (Primary)\" --&gt; AGH1\n    LAN -- \"DNS Query (Backup)\" --&gt; AGH2\n\n    %% 3. Unbound Recursive Lookup (Privacy Path)\n    Unbound1 -- \"Direct Recursive Lookup &lt;br&gt; (No Middleman)\" --&gt; RootServers\n    Unbound2 -- \"Direct Recursive Lookup &lt;br&gt; (No Middleman)\" --&gt; RootServers\n\n    %% 4. The Safety Net (Fail-Safe) - FIXED QUOTES BELOW\n    AGH1 -.-&gt;|\"Timeout &gt; Safety Net\"| Quad9\n    AGH2 -.-&gt;|\"Timeout &gt; Safety Net\"| Quad9\n\n    %% Styling\n\n    style DNS_Cluster fill:#2deb49,stroke:#01579b,stroke-width:2px\n    style Node1 fill:#111111,stroke:#01579b,stroke-width:2px\n    style Node2 fill:#111111,stroke:#01579b,stroke-width:2px\n    style Quad9 fill:#610c06,stroke:#b71c1c,stroke-dasharray: 5 5\n    style RootServers fill:#066114,stroke:#2e7d32</code></pre>","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/dns-adguard-unbound/#2-component-breakdown","title":"2. Component Breakdown","text":"","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/dns-adguard-unbound/#a-the-hardware-level-high-availability","title":"A. The Hardware Level (High Availability)","text":"<p>We utilize two physical Raspberry Pis (10.0.0.63 and 10.0.0.62).</p> <ul> <li> <p>Why: If one Pi crashes, updates, or needs a reboot, the internet does not stop.</p> </li> <li> <p>Distribution: The UniFi UDM Pro is configured via DHCP to hand out both IP addresses to every device on the network.</p> </li> <li> <p>Client Logic: Modern devices automatically failover to the second IP if the first one doesn't answer (~1000ms), ensuring seamless uptime.</p> </li> </ul>","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/dns-adguard-unbound/#b-the-software-stack","title":"B. The Software Stack","text":"<p>Each Pi runs an identical Docker stack:</p> <p>1. AdGuard Home (The Frontend)</p> <ul> <li> <p>Role: Blocks Ads, Trackers, and Malware.</p> </li> <li> <p>Load Balancing: Functionally sends 100% of traffic to the local Unbound container (via \"Load Balance\" mode).</p> </li> <li> <p>Safety Net: Configured with an Emergency Fallback (9.9.9.9) that activates only if Unbound fails to respond for 10 seconds.</p> </li> </ul> <p>2. Unbound (The Backend)</p> <ul> <li> <p>Role: Recursive Resolver.</p> </li> <li> <p>Privacy: It bypasses Centralized DNS Loggers (like Google or Cloudflare). No single company creates a profile of your DNS history.</p> </li> <li> <p>Nuance: Your ISP can still see the destination IPs and SNI (Server Name Indication) of sites you visit, but they cannot manipulate or spoof your DNS results.</p> </li> <li> <p>Security: Handles DNSSEC validation locally. If a site signature is fake, Unbound returns SERVFAIL before AdGuard even sees the IP.</p> </li> </ul>","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/dns-adguard-unbound/#c-the-boot-loop-protection-ntp","title":"C. The \"Boot-Loop\" Protection (NTP)","text":"<ul> <li> <p>Problem: Pis lack an RTC battery. If they reboot without internet, they revert to 1970, breaking DNSSEC validation (deadlock).</p> </li> <li> <p>Solution: Chrony is configured to use Raw IP Addresses (Google/Cloudflare NTP) instead of hostnames. This ensures the Pi gets the correct time immediately at boot, allowing Unbound to start securely.</p> </li> </ul> <p> </p>","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/dns-adguard-unbound/#preparing-the-ubuntu-server","title":"Preparing the Ubuntu Server","text":"<p>If you just try to start the Adguard docker container you will probably run in to few problems:</p> <p>Warning</p> <p>Failed to bind port 0.0.0.0:53/tcp: Error starting userland proxy: listen tcp4 0.0.0.0:53: bind: address already in use</p> <p>Danger</p> <p>DNS Port 53 being already in use. This is because the operating system has it reserved.</p> <p>Edit etc/systemd/resolved.conf </p><pre><code>sudo nano /etc/systemd/resolved.conf\n\n# Uncomment DNSStubListener and set it to no\nDNSStubListener=no\n</code></pre> Press CTRL + x and then press y to save the changes<p></p> <pre><code>sudo ln -sf /run/systemd/resolve/stub-resolv.conf /etc/resolv.conf\nsudo systemctl restart systemd-resolved\n</code></pre>","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/dns-adguard-unbound/#prepare-docker-directories","title":"Prepare Docker Directories","text":"<p>Warning</p> <p>Make sure the directory mapped to /opt/adguardhome/work\\ has rights 0700 | Otherwise your settings are not stored, and when restarted you need to reconfigure.</p> <pre><code>cd ..\ncd docker\nsudo mkdir adguard\n\nsudo mkdir adguard/conf\nsudo mkdir adguard/work\n\n#sudo touch adguard/confdir/AdGuardHome.yaml\nsudo chmod -R 0700 adguard/work\nsudo chmod -R 0700 adguard/conf\n\nsudo chown -R evis:docker adguard/work\nsudo chown -R evis:docker adguard/conf\n</code></pre> <p> </p>","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/dns-adguard-unbound/#prepare-docker-networks-in-portainer","title":"Prepare Docker Networks (in Portainer)","text":"<p>Create the Networks in Portainer</p> <ul> <li>dns_net | will used to put Adguard Home and Unbound DNS server to same network so they can connect. When Adguard is using Unbound as the DNS server.</li> <li>proxy | this can be used with Traefik Reverse Proxy (if using Traefik)</li> </ul> <p>dns_net Network</p> <p></p> <p> </p>","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/dns-adguard-unbound/#prepare-unbound-configuration","title":"Prepare Unbound Configuration","text":"<pre><code>sudo nano /docker/unbound/unbound.conf\n</code></pre> <pre><code>server:\n    ###########################################################################\n    # BASIC SETTINGS\n    ###########################################################################\n    # Standard Port 53 (Mapped to 5053 via Docker Compose)\n    interface: 0.0.0.0@53\n    port: 53\n\n    # Protocol Support\n    do-ip4: yes\n    do-ip6: yes\n    do-tcp: yes\n    do-udp: yes\n    prefer-ip6: no\n\n    # Optimization\n    edns-buffer-size: 1232\n    rrset-roundrobin: yes\n    username: \"_unbound\"\n\n    # Directory\n    directory: \"/opt/unbound/etc/unbound\"\n    cache-max-ttl: 86400\n    cache-min-ttl: 300\n\n    ###########################################################################\n    # LOGGING (Promtail Ready)\n    ###########################################################################\n    # Disable internal file logging -&gt; Send to Stdout for Docker/Promtail\n    log-local-actions: no\n    log-queries: no\n    log-replies: no\n    log-servfail: no\n\n    logfile: \"\"        # Force stdout\n    use-syslog: no\n    verbosity: 2       # Level 2 gives us the stats we need for Grafana\n\n    ###########################################################################\n    # PERFORMANCE (Tuned for 8GB Raspberry Pi)\n    ###########################################################################\n    # Use all 4 cores\n    num-threads: 4\n\n    # Slabs (Must be power of 2)\n    infra-cache-slabs: 4\n    key-cache-slabs: 4\n    msg-cache-slabs: 4\n    rrset-cache-slabs: 4\n\n    # Cache Sizes (High Performance - Uses ~2GB RAM total)\n    msg-cache-size: 256m\n    rrset-cache-size: 512m\n\n    # TCP &amp; Queries\n    outgoing-range: 8192\n    num-queries-per-thread: 4096\n    incoming-num-tcp: 10\n\n    # Speed Tweaks\n    minimal-responses: yes\n    prefetch: yes\n    prefetch-key: yes\n    serve-expired: yes\n    so-reuseport: yes\n\n    ###########################################################################\n    # SECURITY &amp; PRIVACY\n    ###########################################################################\n    # Access Control (Allow Local Network)\n    access-control: 127.0.0.1/32 allow\n    access-control: 192.168.0.0/16 allow\n    access-control: 172.16.0.0/12 allow\n    access-control: 10.0.0.0/8 allow\n    access-control: fc00::/7 allow\n    access-control: ::1/128 allow\n\n    # Privacy\n    hide-identity: yes\n    hide-version: yes\n    identity: \"DNS\"\n    http-user-agent: \"DNS\"\n    qname-minimisation: yes\n    aggressive-nsec: yes\n\n    # Hardening\n    harden-algo-downgrade: yes\n    harden-below-nxdomain: yes\n    harden-dnssec-stripped: yes\n    harden-glue: yes\n    harden-large-queries: yes\n    harden-short-bufsize: yes\n    use-caps-for-id: yes\n\n    # Private Addresses (Rebinding Protection)\n    private-address: 10.0.0.0/8\n    private-address: 172.16.0.0/12\n    private-address: 192.168.0.0/16\n    private-address: 169.254.0.0/16\n    private-address: fd00::/8\n    private-address: fe80::/10\n\n    # Certificates\n    tls-cert-bundle: /etc/ssl/certs/ca-certificates.crt\n\n    ###########################################################################\n    # INCLUDES\n    ###########################################################################\n    # Only include custom conf files if you create them manually\n    #include: \"*.conf\"\n\n    domain-insecure: \"valoo.fi\"\n\nremote-control:\n    control-enable: no\n\n\n# Forward Zone for Valoo (Bypass local validation)\nforward-zone:\n    name: \"valoo.fi\"\n    forward-dnssec: no\n    forward-addr: 9.9.9.9\n    forward-addr: 1.1.1.1\n</code></pre>","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/dns-adguard-unbound/#unbound-portainer-stack","title":"Unbound Portainer Stack","text":"<pre><code>## NETWORKS ##\nnetworks:\n  ## dns_net network between Adguard Home and Unbound\n  dns_net:\n    external:\n      name: dns_net\n    driver: bridge # Using bridge driver for possible VPN solution\n    ipam:\n      config:\n        - subnet: 172.23.0.0/16\n\n\n## SERVICES ##\nservices:\n\n  unbound:\n    container_name: unbound\n    image: mvance/unbound-rpi:latest # Raspberry Pi version\n    #image: mvance/unbound:latest # Non ARM version\n    networks:\n      dns_net:\n        ipv4_address: 172.23.0.8\n    environment:\n      - TZ=Europe/Helsinki\n    volumes:\n      - /docker/unbound:/opt/unbound/etc/unbound\n    ports:\n      - 5053:53/tcp\n      - 5053:53/udp\n    healthcheck:\n      test: [\"NONE\"]\n    restart: unless-stopped\n</code></pre>","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/dns-adguard-unbound/#adguard-portainer-stack","title":"Adguard Portainer Stack","text":"<pre><code>networks:\n  dns_net:\n    name: dns_net\n    external: true\n    driver: bridge\n    ipam:\n        config:\n        - subnet: 172.23.0.0/16\n  proxy:\n    external: true\n\n\nservices:\n\n  adguardhome:\n    image: adguard/adguardhome\n    container_name: adguard-home\n    security_opt:\n      - no-new-privileges:true\n    networks:\n      dns_net:\n        ipv4_address: 172.23.0.7\n      proxy:\n    ports:\n      # DNScrypt:\n      - 5443:5443/udp\n      - 5443:5443/tcp\n      # DNS-over-QUIC:\n      - 8853:8853/udp\n      - 853:853/udp\n      - 784:784/udp\n      # DNS-over-TLS\n      - 853:853/tcp\n      # Home Admin Panel &amp; HTTPS/DNS-over-HTTPS:\n      - 3000:3000/tcp\n      - 443:443/udp\n      #- 443:443/tcp\n      - 8080:8080/tcp\n      # DHCP server:\n      #- 68:68/udp\n      #- 67:67/udp\n      # Plain DNS:\n      - 53:53/udp\n      - 53:53/tcp\n    environment:\n      - TZ=Europe/Helsinki\n    restart: always\n    volumes:\n      - /docker/adguard/conf:/opt/adguardhome/conf\n      - /docker/adguard/work:/opt/adguardhome/work\n</code></pre>","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/dns-adguard-unbound/#adguard-home-settings","title":"AdGuard Home settings","text":"","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/dns-adguard-unbound/#dns-settings","title":"DNS Settings","text":"Feature Setting Status / Comment Upstream DNS Servers Upstream DNS Servers [/10.in-addr.arpa/]10.0.0.1 unbound:53 Rule: force local names to Router.  Everything else to Unbound. Upstream Mode Load Balancing Using Load-balancing instead of \"Parallel requests.\" Parallel requests would be useless with a single Unbound instance. Functionally is zero right now. Fallback DNS servers https://dns.quad9.net/dns-query  https://dns.google/dns-query Encrypted (DoH) safety net. If Unbound dies, these keep internet alive if Unbound crashes. Unbound times out, AdGuard immediately routes traffic to public DNS servers Bootstrap DNS 127.0.0.11  9.9.9.9  1.1.1.1  8.8.8.8 Configuration Safety. Essential for startup connectivity. With current setup only 127.0.0.11 is used for local Docker container lookups Private DNS Servers 10.0.0.1 Pointing to Router (UDM Pro). AdGuard explicitly asks the UDM Pro for local lookups Use Private DNS Resolvers \u2705 Checked Crucial. Tells AdGuard to actually use the Router (UDM Pro) IP above for the lookups. Enable Reverse Resolving of clients' IP addresses \u2705 Checked Allows you to see names in logs (from UDM Pro). Upstream timeout 10 Crucial for Unbound. Recursive lookups take longer (walking the chain from Root servers). 10s prevents AdGuard from giving up prematurely on \"cold\" queries. DNS Sserver configuration Rate Limit 0 Crucial. Unchecks the \u201climit\u201d to prevent lag on heavy sites. Enable DNSSEC \u274c Unchecked DNSSEC is handled by Unbound. Prevents packet fragmentation errors. EDNS Client Subnet \u274c Unchecked Prevents \u201cbuffer size\u201d errors. Disable resolving of IPv6 addresses \u2705 Check this box (Missed in Screenshot) Forces IPv4 for snappier browsing. Blocking Mode Null IP Returns 0.0.0.0 for ads (Safest method). DNS cache configuration Enable Cache \u2705 Enabled Enabled for speed. Cache size 10000000 Set size to 10MB for speed. Override minimum TTL 300 Tells AdGuard: \"If a site says 'Ask me again in 30 seconds', ignore it and remember the answer for 5 minutes.\" This drastically quiets down your network traffic. Override maximum TTL 86400 (86400s = 1 day) Refreshes data every day. Optimistic Cache \u274c Disabled Ensures data freshness.","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/dns-adguard-unbound/#unifi-network-dns-configurations","title":"Unifi Network DNS Configurations","text":"<p>Info</p> <p>When changing DNS servers remember to check the following settings from Unifi Network Settings</p> <p>Success</p> <p>Network DHCP clients should use the router (UDM) as the DNS server and then the below settings are applied in all cases.</p>","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/dns-adguard-unbound/#differences-between-the-dns-settings","title":"Differences between the DNS settings","text":"<ul> <li>Internet - DNS server(s) that UDM or other gateway reaches out to for DNS results</li> <li>Network - DNS server(s) that the DHCP server hands out to the clients on that network</li> <li>IP Group - DNS server(s) used in the firewall rules</li> </ul>","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/dns-adguard-unbound/#unifi-internet-dns","title":"Unifi Internet DNS","text":"<p>Info</p> <p>Internet DNS is used for all outbound traffic</p> <p></p>","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/dns-adguard-unbound/#unifi-network-dns","title":"Unifi Network DNS","text":"<p>Info</p> <p>Network DNS is used for all DHCP clients on the network</p> <p>Warning</p> <p>Only LAN network is using the Local DNS server, other networks like IoT and Company network are using public networks to avoid any blocking. Using AdGuard with some IoT devices like TV has created outage on some streaming applications e.g. Viaplay.</p> <p></p>","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/dns-adguard-unbound/#unifi-ip-group-dns","title":"Unifi IP Group DNS","text":"<p>Info</p> <p>IP Group DNS is used for all firewall rules</p> <p>Warning</p> <p>IP Group DNS is not used for DHCP clients on the network</p> <p> </p> <p> </p>","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/dns-adguard-unbound/#performance","title":"Performance","text":"<p>Because Unbound does the heavy lifting of traversing the DNS tree itself (instead of offloading it to a giant like Google), the performance metrics look different than a standard ISP setup.</p> Metric Target Value Comment Average Processing Time ~40\u201360 ms This is the \"Privacy Tax.\" It is slightly higher than using Cloudflare directly (20ms), but it means you own the data. Cache Hit Speed &lt; 1 ms Once a site is visited, AdGuard/Unbound serves it instantly from RAM. Cold Lookup (New Site) 100\u2013200 ms The first time you visit a rare site, Unbound must query the Root Servers. This happens once, then it is cached. <p> </p>","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/dns-adguard-unbound/#troubleshooting-testing","title":"Troubleshooting &amp; Testing","text":"","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/dns-adguard-unbound/#the-client-name-test","title":"The \"Client Name\" Test","text":"<p>We ran this command to confirm the UDM Pro was correctly resolving local names:</p> <pre><code>dig -x 10.0.0.189 @10.0.0.63\n</code></pre>","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/dns-adguard-unbound/#domain-fails","title":"Domain fails","text":"<p>Check that the domain actually exists:</p> <pre><code>nslookup oma.valoo.fi 8.8.8.8\n</code></pre> <p>If it does exist, you can add it to the unbound.conf on all DNS servers.</p> <p>Edit unbound.conf on all DNS servers </p><pre><code>sudo nano /docker/unbound/unbound.conf\n</code></pre><p></p> <p>add to the bottom of the server: block</p> <pre><code>server:\n    # ... other settings ...\n    domain-insecure: \"valoo.fi\"\n\n\n# add to the bottom of the file\nforward-zone:\n    name: \"valoo.fi.\"\n    forward-addr: 8.8.8.8\n    forward-addr: 1.1.1.1\n</code></pre> <p>Restart Unbound: </p><pre><code>docker restart unbound\n</code></pre><p></p> <p>Test with: </p><pre><code>docker exec -it adguard-home nslookup oma.valoo.fi 127.0.0.1\n</code></pre><p></p>","tags":["dns","adguard","unbound","self-hosted","unifi-network"]},{"location":"articles/articles/home-assistant-os-vm/","title":"Home Assistant OS VM","text":"","tags":["home assistant","Proxmox","VM","Self-Hosted"]},{"location":"articles/articles/home-assistant-os-vm/#proxmox-home-assistant-os","title":"Proxmox | Home Assistant OS","text":"<p>Installing Home Assistant OS on Proxmox VE 7.2-3 as a Virtual Machine, using the QCOW2 image file and migrating my existing setup.</p> <p>[IMAGE]</p> <p>Installing Home Assistant OS on Proxmox VE 7.2-3 as a Virtual Machine and migrating my previous installation from VMware ESXi.</p>","tags":["home assistant","Proxmox","VM","Self-Hosted"]},{"location":"articles/articles/home-assistant-os-vm/#create-a-vm-in-proxmox","title":"Create a VM in Proxmox","text":"<p>Click create VM</p>","tags":["home assistant","Proxmox","VM","Self-Hosted"]},{"location":"articles/articles/home-assistant-os-vm/#general","title":"General","text":"<ul> <li>Setting the VM ID (150)</li> <li>Set the name (HomeAssistantOS)</li> <li>Check start at boot</li> </ul> <p>VM ID is needed later when the image disk is imported and attached to the VM.</p> <p>[IMAGE]</p>","tags":["home assistant","Proxmox","VM","Self-Hosted"]},{"location":"articles/articles/home-assistant-os-vm/#os","title":"OS","text":"<p>[IMAGE]</p>","tags":["home assistant","Proxmox","VM","Self-Hosted"]},{"location":"articles/articles/home-assistant-os-vm/#system","title":"System","text":"<p>[IMAGE]</p>","tags":["home assistant","Proxmox","VM","Self-Hosted"]},{"location":"articles/articles/home-assistant-os-vm/#disks","title":"Disks","text":"<p>[IMAGE]</p>","tags":["home assistant","Proxmox","VM","Self-Hosted"]},{"location":"articles/articles/home-assistant-os-vm/#cpu","title":"CPU","text":"<p>Add the number of CPU cores that you need (I had 6 in ESXi)</p> <p>[image]</p>","tags":["home assistant","Proxmox","VM","Self-Hosted"]},{"location":"articles/articles/home-assistant-os-vm/#memory","title":"Memory","text":"","tags":["home assistant","Proxmox","VM","Self-Hosted"]},{"location":"articles/articles/home-assistant-os-vm/#network","title":"Network","text":"","tags":["home assistant","Proxmox","VM","Self-Hosted"]},{"location":"articles/articles/home-assistant-os-vm/#confirm","title":"Confirm","text":"<p>Uncheck Start after created (Do not start the VM), Click Finish. The disk image needs to be added before the VM is started.</p>","tags":["home assistant","Proxmox","VM","Self-Hosted"]},{"location":"articles/articles/motorized-blinds/","title":"Motorized Horizontal Blinds - Tilt Action","text":"","tags":["ESPHome","Home Assistant","NodeRED","DIY"]},{"location":"articles/articles/motorized-blinds/#motorized-horizontal-blinds-tilt-action","title":"Motorized Horizontal Blinds - Tilt Action","text":"","tags":["ESPHome","Home Assistant","NodeRED","DIY"]},{"location":"articles/articles/motorized-blinds/#overview","title":"Overview","text":"<p>Motorizing and automating horizontal window blinds tilt with a stepper motor and ESP board using ESPHome, to be controlled from Home Assistant, NodeRED, and with Philips Hue Dimmer switches. 3D printed parts are needed to at least mount the motor to the blinds, additionally, you can print enclosures for the parts.</p>    Your browser does not support the video tag.","tags":["ESPHome","Home Assistant","NodeRED","DIY"]},{"location":"articles/articles/motorized-blinds/#parts","title":"Parts","text":"<ul> <li>ESP8266 (D1 Mini, or NodeMCU)</li> <li>Stepper driver A4899 or DRV8825 (Note: pin layouts are slightly different)</li> <li>28BYJ-45 stepper motor (5V) - converted to bipolar stepper</li> <li>MP1584EN Buck Converter</li> <li>12V Power Supply</li> <li>3D Printed parts: enclosure for the ESP and buck converter, adapter to attach the blind's axel to the motor. Mounting to attach the motor to the window frame and enclosure for the stepper driver.</li> <li>For wiring, I used an old cat6 ethernet cable</li> </ul>","tags":["ESPHome","Home Assistant","NodeRED","DIY"]},{"location":"articles/articles/motorized-blinds/#build","title":"Build","text":"<p>Before wiring everything up, the 28BYJ - 48 - Stepper Motor needs to be converted to bipolar</p>","tags":["ESPHome","Home Assistant","NodeRED","DIY"]},{"location":"articles/articles/motorized-blinds/#converting-28byj-stepper-motor-to-bipolar","title":"Converting 28BYJ Stepper Motor to Bipolar","text":"<p>The 28BYJ is a 5-wire unipolar stepper motor and it comes with a ULN2003 driver. To get the most torque out of this motor, you can momentarily supply more voltage for it than designed, without burning it. But to use more than the 5V, a different driver than the ULN2003 is needed.</p> <p>To use the DRV8825 or A4988, the motor needs to be converted to a bipolar motor. To convert the 28BYJ to bipolar you only need to cut the common voltage connection between the coils.</p> <p>To do so carefully remove the blue cover from the motor and just scrape (cut) the center trace with a small screwdriver. </p> <p></p>","tags":["ESPHome","Home Assistant","NodeRED","DIY"]},{"location":"articles/articles/motorized-blinds/#wiring-diagrams","title":"Wiring Diagrams","text":"<p>Wiring for DRV8825 Stepper Driver </p> <p>Wiring for A4988 Stepper Driver </p> <p>Example of using two motors with two DRV8825 drivers </p>","tags":["ESPHome","Home Assistant","NodeRED","DIY"]},{"location":"articles/articles/motorized-blinds/#esphome-code","title":"ESPHome Code","text":"","tags":["ESPHome","Home Assistant","NodeRED","DIY"]},{"location":"articles/articles/motorized-blinds/#3d-printed-parts","title":"3D Printed Parts","text":"<ul> <li>Motor Mount and the Adapter</li> <li>Motor Driver Enclosure</li> <li>D1 Mini Enclosure</li> <li>NodeMCU Enclosure</li> </ul>","tags":["ESPHome","Home Assistant","NodeRED","DIY"]},{"location":"articles/articles/ntp-servers/","title":"NTP Servers","text":""},{"location":"articles/articles/ntp-servers/#1-install-chrony-stop-the-old-time-service","title":"1. Install Chrony &amp; Stop the old time service","text":"<p>sudo apt-get update sudo apt-get install chrony -y sudo systemctl stop systemd-timesyncd sudo systemctl disable systemd-timesyncd sudo systemctl enable chrony</p>"},{"location":"articles/articles/ntp-servers/#2-write-the-boot-proof-config","title":"2. Write the \"Boot Proof\" Config","text":"<p>sudo bash -c 'cat &gt; /etc/chrony/chrony.conf &lt;&lt;EOF</p>"},{"location":"articles/articles/ntp-servers/#-boot-proof-ntp-servers-ips-","title":"--- BOOT PROOF NTP SERVERS (IPs) ---","text":""},{"location":"articles/articles/ntp-servers/#google-public-ntp-ips-solve-the-1970-boot-loop","title":"Google Public NTP (IPs solve the \"1970\" boot loop)","text":"<p>server 216.239.35.0 iburst server 216.239.35.4 iburst</p>"},{"location":"articles/articles/ntp-servers/#cloudflare-public-ntp","title":"Cloudflare Public NTP","text":"<p>server 162.159.200.1 iburst server 162.159.200.123 iburst</p>"},{"location":"articles/articles/ntp-servers/#-official-finnish-authorities-","title":"--- OFFICIAL FINNISH AUTHORITIES ---","text":""},{"location":"articles/articles/ntp-servers/#vtt-mikes","title":"VTT MIKES","text":"<p>server time.mikes.fi iburst server time1.mikes.fi iburst server time2.mikes.fi iburst</p>"},{"location":"articles/articles/ntp-servers/#dna-funet","title":"DNA &amp; FUNET","text":"<p>server ntp.dnainternet.fi iburst server ntp.funet.fi iburst</p>"},{"location":"articles/articles/ntp-servers/#-core-settings-","title":"--- CORE SETTINGS ---","text":"<p>driftfile /var/lib/chrony/chrony.drift makestep 1.0 3 rtcsync</p>"},{"location":"articles/articles/ntp-servers/#-access-control-","title":"--- ACCESS CONTROL ---","text":""},{"location":"articles/articles/ntp-servers/#allow-local-network-to-sync-from-this-server","title":"Allow local network to sync from this server","text":"<p>allow 10.0.0.0/8</p>"},{"location":"articles/articles/ntp-servers/#listen-on-all-interfaces","title":"Listen on all interfaces","text":"<p>bindcmdaddress 0.0.0.0</p>"},{"location":"articles/articles/ntp-servers/#-logging-","title":"--- LOGGING ---","text":"<p>logdir /var/log/chrony EOF'</p>"},{"location":"articles/articles/ntp-servers/#3-restart-chrony-to-apply","title":"3. Restart Chrony to apply","text":"<p>sudo systemctl restart chrony</p>"},{"location":"articles/articles/ntp-servers/#verify-the-sources","title":"verify the sources","text":"<p>chronyc sources -v</p>"},{"location":"articles/articles/tinkercad-project-box-creator/","title":"TinkerCad Project Box Creator","text":"","tags":["3D Printing","TinkerCad","Project Box","DIY"]},{"location":"articles/articles/tinkercad-project-box-creator/#project-box-creator","title":"Project Box Creator","text":"<ul> <li>Project Box Creator (TinkerCad)</li> <li>Mount Kit (TinkerCad) | Mount Kit (Printables)</li> </ul> <p>Some generated examples (some are post modified in TinkerCad)</p> <p></p> <p>The separate Box base and Lid codeblocks are still available here, but I won't be updating those anymore.</p> <ul> <li>Project Box Lid Creator</li> <li>Projects Box Base Creator</li> </ul>","tags":["3D Printing","TinkerCad","Project Box","DIY"]},{"location":"articles/articles/tinkercad-project-box-creator/#overview","title":"Overview","text":"<p>I wanted to make it as easy as possible to start experimenting with new 3D printable project boxes. I thought I'd parametrize my previous designs with TinkerCad Codeblocks, and for my needs it works really well.</p> <p>My wall mount kit works also pretty well with the boxes, naturally depends on your box dimensions in the end how well it fits.</p>","tags":["3D Printing","TinkerCad","Project Box","DIY"]},{"location":"articles/articles/tinkercad-project-box-creator/#box-creation-options","title":"Box Creation Options","text":"<p>NOTE 1: Before you do anything else you want to set the TinkerCad Codeblocks speed setting to Max (on the top/right corner side) or else you will be waiting FOREVER the box to generate.</p> <p>NOTE 2: When you open the TinkerCad Codeblocks, you may need to scroll to the top to actually see the correct variables that you can changes. Although I have tried to set comment boxes around the \"canvas\" so that it centers the variables when first opened.</p> <p></p>","tags":["3D Printing","TinkerCad","Project Box","DIY"]},{"location":"articles/articles/tinkercad-project-box-creator/#box-dimensions","title":"Box Dimensions","text":"<p>The box dimensions are the external dimensions, if you need to specifically fit something inside, calculate the internal volume you need. Reduce the wall width from both sides, both ends, and from top and bottom to get the internal volume, measure accordingly.</p> <p>All dimensions are in millimeters (mm)</p> <ul> <li>Box Width (external width)</li> <li>Box Length (external length)</li> <li>Box Height (external height)</li> <li>Wall Width</li> <li>Corner Radius</li> <li>Snap Length (snap-in mechanism length on the sides)</li> </ul>","tags":["3D Printing","TinkerCad","Project Box","DIY"]},{"location":"articles/articles/tinkercad-project-box-creator/#board-mount-settings","title":"Board Mount Settings","text":"<p>Optional settings for mounting a boards like ESP32s, Raspberry Pis etc. If you don't need the board mounting just leave leave the \"board mount variables\" to 0 (disabled) * Enable Board Mount Feet * Enable Lid Mount Feet</p> <p></p> <p>Note: If your Lid Mount Feet appear to be outside of the Lid inner wall, then you won't be able close the lid (small overlapping with the wall is probably is still fine), and need to make the box a bit bigger.</p>","tags":["3D Printing","TinkerCad","Project Box","DIY"]},{"location":"articles/articles/tinkercad-project-box-creator/#usb-cord-hole","title":"USB Cord Hole","text":"<p>(For ESP devices)</p> <p>In most cases you will want to add the cord hole(s) separately, modifying the shape. I anyway included this more for my own convinience, having tested it only with ESP32 DevKit V1 and ESP8266 NodeMCU V3, so use with care, or atleast check/test with shapes before printing.</p> <p>Ideally when you have the board mount feet enabled, you want the USB cord hole to power your board. Depending how you are placing you board you might want to \"inverted the hole placement\".</p> <p>There is currently a problem with the inverted USB hole, not being placed correctly in all cases .. working to fixing it.</p> <p></p>","tags":["3D Printing","TinkerCad","Project Box","DIY"]},{"location":"articles/articles/tinkercad-project-box-creator/#air-vent-settings","title":"Air Vent Settings","text":"<p>Optional settings for having air vents on the sides of the box. If you don't want any holes in the box side walls, just leave this setting to 0 (disabled) * Enable Side Vents</p> <p>Leaving the Side Vent Margin and Side Vent Angle both to 0 at the same time, will overlap with the snap-in mechanism, and probably end up affecting it, so check that you have enough margin from the edges of the box.</p> <p>Depending on the Box Length, Side Vent Spacing and the Side Vent Angle the box sides will automatically be fitted with as many vents as possible (\"within safety margins\") :).</p> <p>The Vents are centered to the box height with the Lid on, so they may look offcenter with just the base.</p> <p> </p>","tags":["3D Printing","TinkerCad","Project Box","DIY"]},{"location":"articles/articles/tinkercad-project-box-creator/#box-mount-kit-settings","title":"Box Mount Kit Settings","text":"<p>There are 3 different positions for the mount kit, you can enable each individually, all, or none. Depending on the box placement, you may get a better ranges with some of the options.</p> <p></p> <p>To use the mount kit you need an M3 screw or a #6-32 screw (standard computer case screw), and what ever wall screws you may need.</p>","tags":["3D Printing","TinkerCad","Project Box","DIY"]},{"location":"articles/articles/tinkercad-project-box-creator/#mount-kit","title":"Mount Kit","text":"","tags":["3D Printing","TinkerCad","Project Box","DIY"]},{"location":"articles/articles/tinkercad-project-box-creator/#wall-mount-options","title":"Wall Mount Options","text":"","tags":["3D Printing","TinkerCad","Project Box","DIY"]},{"location":"articles/articles/tinkercad-project-box-creator/#wall-mount-instructions","title":"Wall Mount Instructions","text":"","tags":["3D Printing","TinkerCad","Project Box","DIY"]},{"location":"articles/articles/virtual-fireplace/","title":"Virtual Fireplace","text":"","tags":["ESP32","WLED","NodeRED","DIY"]},{"location":"articles/articles/virtual-fireplace/#virtual-fireplace","title":"Virtual Fireplace","text":"","tags":["ESP32","WLED","NodeRED","DIY"]},{"location":"articles/articles/virtual-fireplace/#wled","title":"WLED","text":"<p>check these * WLED * WLED install</p>","tags":["ESP32","WLED","NodeRED","DIY"]},{"location":"articles/articles/virtual-fireplace/#components","title":"Components","text":"<p>For this project I used White PCB with IP65 and 5m 150leds .. pick what suites your needs. (also got 5m 300leds which I'll use elsewhere) and punch of SK6812 leds which have separate white pixel aswell.</p> <p>Calculate your power need based on the amount of leds you are going to use example with strip of 2 meters which has 30leds/m each led max power is 0.3W. 2x30 = 60 leds. 60*0.3W = 18W .. pick something higher than that to be on thesafe side.</p> <ul> <li>WS2812B Eco All LED - White PCB with IP65 and 5m 150leds</li> <li>Power Supply - 25W version is more than enough for my 170cm cut.</li> <li>D1 Mini NodeMCU but you can go with ESP32 as well, should be more powerful if you use more leds.</li> </ul>","tags":["ESP32","WLED","NodeRED","DIY"]},{"location":"articles/articles/virtual-fireplace/#wled-fireplace-preset","title":"WLED Fireplace Preset","text":"<p>Used the ColorTwinkles as the base and tuned speeds and colors</p> <p>API Command </p><pre><code>{\"on\":true,\"bri\":255,\"transition\":7,\"mainseg\":0,\"seg\":[{\"id\":0,\"start\":0,\"stop\":52,\"grp\":1,\"spc\":0,\"of\":0,\"on\":true,\"frz\":false,\"bri\":255,\"cct\":127,\"set\":0,\"col\":[[255,160,0],[0,0,0],[0,0,0]],\"fx\":74,\"sx\":56,\"ix\":139,\"pal\":3,\"c1\":128,\"c2\":128,\"c3\":16,\"sel\":true,\"rev\":false,\"mi\":false,\"o1\":false,\"o2\":false,\"o3\":false,\"si\":0,\"m12\":0},{\"stop\":0},{\"stop\":0},{\"stop\":0},{\"stop\":0},{\"stop\":0},{\"stop\":0},{\"stop\":0},{\"stop\":0},{\"stop\":0},{\"stop\":0},{\"stop\":0},{\"stop\":0},{\"stop\":0},{\"stop\":0},{\"stop\":0}]}\n</code></pre><p></p>","tags":["ESP32","WLED","NodeRED","DIY"]},{"location":"articles/articles/virtual-fireplace/#nodered-automation","title":"NodeRED Automation","text":"<p>Fireplace is turning on and off only automatically based on room occupancy, TV state, and room brightness and ceiling light brigtness.</p> <p>\"Timeout\" helper - Fireplace Fade Timeout - delays the turn off, controls how long the fireplace is still on, when turn off is called. Delay is reset if turn on is called.</p> <ul> <li>Room Occupancy - someone has to be in the room for it to turn on.</li> <li>TV state - if TV is ON, it will be off. Doesn't then mess with the TV ambilight.</li> <li>Room Brightness - if room brightness is above certain level it won't turn on (and if ceiling light brightness is above certain level)</li> </ul> <p></p>","tags":["ESP32","WLED","NodeRED","DIY"]},{"location":"articles/articles/virtual-fireplace/#node-red-json-flow","title":"Node-Red JSON Flow","text":"<pre><code>[\n  {\n    \"id\": \"0813a117fe43e434\",\n    \"type\": \"server-state-changed\",\n    \"z\": \"68c7aeaac5528913\",\n    \"name\": \"TV Power\",\n    \"server\": \"dba636d5.d235b8\",\n    \"version\": 5,\n    \"outputs\": 2,\n    \"exposeAsEntityConfig\": \"\",\n    \"entityId\": \"media_player.70pus9005_12_2\",\n    \"entityIdType\": \"exact\",\n    \"outputInitially\": true,\n    \"stateType\": \"str\",\n    \"ifState\": \"on\",\n    \"ifStateType\": \"str\",\n    \"ifStateOperator\": \"is\",\n    \"outputOnlyOnStateChange\": true,\n    \"for\": 0,\n    \"forType\": \"num\",\n    \"forUnits\": \"minutes\",\n    \"ignorePrevStateNull\": false,\n    \"ignorePrevStateUnknown\": false,\n    \"ignorePrevStateUnavailable\": false,\n    \"ignoreCurrentStateUnknown\": false,\n    \"ignoreCurrentStateUnavailable\": false,\n    \"outputProperties\": [\n      {\n        \"property\": \"payload\",\n        \"propertyType\": \"msg\",\n        \"value\": \"\",\n        \"valueType\": \"entityState\"\n      },\n      {\n        \"property\": \"data\",\n        \"propertyType\": \"msg\",\n        \"value\": \"\",\n        \"valueType\": \"eventData\"\n      },\n      {\n        \"property\": \"topic\",\n        \"propertyType\": \"msg\",\n        \"value\": \"\",\n        \"valueType\": \"triggerId\"\n      }\n    ],\n    \"x\": 200,\n    \"y\": 5760,\n    \"wires\": [\n      [\n        \"989ef02789918122\"\n      ],\n      [\n        \"6ec51bd42b29d14f\"\n      ]\n    ]\n  },\n  {\n    \"id\": \"989ef02789918122\",\n    \"type\": \"change\",\n    \"z\": \"68c7aeaac5528913\",\n    \"name\": \"off\",\n    \"rules\": [\n      {\n        \"t\": \"set\",\n        \"p\": \"payload\",\n        \"pt\": \"msg\",\n        \"to\": \"off\",\n        \"tot\": \"str\"\n      }\n    ],\n    \"action\": \"\",\n    \"property\": \"\",\n    \"from\": \"\",\n    \"to\": \"\",\n    \"reg\": false,\n    \"x\": 730,\n    \"y\": 5820,\n    \"wires\": [\n      [\n        \"f83f049b86ed3afd\"\n      ]\n    ]\n  },\n  {\n    \"id\": \"6ec51bd42b29d14f\",\n    \"type\": \"api-current-state\",\n    \"z\": \"68c7aeaac5528913\",\n    \"name\": \"Ceiling Light\",\n    \"server\": \"dba636d5.d235b8\",\n    \"version\": 3,\n    \"outputs\": 2,\n    \"halt_if\": \"on\",\n    \"halt_if_type\": \"str\",\n    \"halt_if_compare\": \"is\",\n    \"entity_id\": \"light.living_room_ceiling_light\",\n    \"state_type\": \"str\",\n    \"blockInputOverrides\": false,\n    \"outputProperties\": [\n      {\n        \"property\": \"payload\",\n        \"propertyType\": \"msg\",\n        \"value\": \"\",\n        \"valueType\": \"entityState\"\n      },\n      {\n        \"property\": \"data\",\n        \"propertyType\": \"msg\",\n        \"value\": \"\",\n        \"valueType\": \"entity\"\n      }\n    ],\n    \"for\": \"0\",\n    \"forType\": \"num\",\n    \"forUnits\": \"minutes\",\n    \"override_topic\": false,\n    \"state_location\": \"payload\",\n    \"override_payload\": \"msg\",\n    \"entity_location\": \"data\",\n    \"override_data\": \"msg\",\n    \"x\": 390,\n    \"y\": 5840,\n    \"wires\": [\n      [\n        \"9b37b53aa6b7e0f9\"\n      ],\n      [\n        \"2686e4fe3b0aef18\"\n      ]\n    ]\n  },\n  {\n    \"id\": \"8878a1d202d3df7b\",\n    \"type\": \"switch\",\n    \"z\": \"68c7aeaac5528913\",\n    \"name\": \"Brightness\",\n    \"property\": \"payload\",\n    \"propertyType\": \"msg\",\n    \"rules\": [\n      {\n        \"t\": \"lt\",\n        \"v\": \"145\",\n        \"vt\": \"num\"\n      },\n      {\n        \"t\": \"gte\",\n        \"v\": \"145\",\n        \"vt\": \"num\"\n      }\n    ],\n    \"checkall\": \"false\",\n    \"repair\": false,\n    \"outputs\": 2,\n    \"x\": 530,\n    \"y\": 5680,\n    \"wires\": [\n      [\n        \"2686e4fe3b0aef18\"\n      ],\n      [\n        \"989ef02789918122\"\n      ]\n    ]\n  },\n  {\n    \"id\": \"f83f049b86ed3afd\",\n    \"type\": \"api-current-state\",\n    \"z\": \"68c7aeaac5528913\",\n    \"name\": \"TV Desk WLED On\",\n    \"server\": \"dba636d5.d235b8\",\n    \"version\": 3,\n    \"outputs\": 2,\n    \"halt_if\": \"on\",\n    \"halt_if_type\": \"str\",\n    \"halt_if_compare\": \"is\",\n    \"entity_id\": \"light.wled_2\",\n    \"state_type\": \"str\",\n    \"blockInputOverrides\": false,\n    \"outputProperties\": [],\n    \"for\": \"0\",\n    \"forType\": \"num\",\n    \"forUnits\": \"minutes\",\n    \"override_topic\": false,\n    \"state_location\": \"payload\",\n    \"override_payload\": \"msg\",\n    \"entity_location\": \"data\",\n    \"override_data\": \"msg\",\n    \"x\": 790,\n    \"y\": 5920,\n    \"wires\": [\n      [\n        \"a3b16db60ddd4e9d\"\n      ],\n      []\n    ]\n  },\n  {\n    \"id\": \"d9538bf7d521e8b1\",\n    \"type\": \"server-state-changed\",\n    \"z\": \"68c7aeaac5528913\",\n    \"name\": \"Ceiling Light\",\n    \"server\": \"dba636d5.d235b8\",\n    \"version\": 5,\n    \"outputs\": 1,\n    \"exposeAsEntityConfig\": \"\",\n    \"entityId\": \"light.living_room_ceiling_light\",\n    \"entityIdType\": \"exact\",\n    \"outputInitially\": true,\n    \"stateType\": \"str\",\n    \"ifState\": \"\",\n    \"ifStateType\": \"str\",\n    \"ifStateOperator\": \"is\",\n    \"outputOnlyOnStateChange\": false,\n    \"for\": \"0\",\n    \"forType\": \"num\",\n    \"forUnits\": \"minutes\",\n    \"ignorePrevStateNull\": false,\n    \"ignorePrevStateUnknown\": false,\n    \"ignorePrevStateUnavailable\": false,\n    \"ignoreCurrentStateUnknown\": false,\n    \"ignoreCurrentStateUnavailable\": false,\n    \"outputProperties\": [\n      {\n        \"property\": \"payload\",\n        \"propertyType\": \"msg\",\n        \"value\": \"\",\n        \"valueType\": \"entityState\"\n      },\n      {\n        \"property\": \"data\",\n        \"propertyType\": \"msg\",\n        \"value\": \"\",\n        \"valueType\": \"eventData\"\n      },\n      {\n        \"property\": \"topic\",\n        \"propertyType\": \"msg\",\n        \"value\": \"\",\n        \"valueType\": \"triggerId\"\n      }\n    ],\n    \"x\": 170,\n    \"y\": 5840,\n    \"wires\": [\n      [\n        \"6ec51bd42b29d14f\"\n      ]\n    ]\n  },\n  {\n    \"id\": \"43056a7be9a531a8\",\n    \"type\": \"server-state-changed\",\n    \"z\": \"68c7aeaac5528913\",\n    \"name\": \"FP2 Occupancy\",\n    \"server\": \"dba636d5.d235b8\",\n    \"version\": 5,\n    \"outputs\": 2,\n    \"exposeAsEntityConfig\": \"\",\n    \"entityId\": \"binary_sensor.living_room_fp2_sensor\",\n    \"entityIdType\": \"exact\",\n    \"outputInitially\": true,\n    \"stateType\": \"str\",\n    \"ifState\": \"on\",\n    \"ifStateType\": \"str\",\n    \"ifStateOperator\": \"is\",\n    \"outputOnlyOnStateChange\": true,\n    \"for\": 0,\n    \"forType\": \"num\",\n    \"forUnits\": \"minutes\",\n    \"ignorePrevStateNull\": false,\n    \"ignorePrevStateUnknown\": false,\n    \"ignorePrevStateUnavailable\": false,\n    \"ignoreCurrentStateUnknown\": false,\n    \"ignoreCurrentStateUnavailable\": false,\n    \"outputProperties\": [\n      {\n        \"property\": \"payload\",\n        \"propertyType\": \"msg\",\n        \"value\": \"\",\n        \"valueType\": \"entityState\"\n      },\n      {\n        \"property\": \"data\",\n        \"propertyType\": \"msg\",\n        \"value\": \"\",\n        \"valueType\": \"eventData\"\n      },\n      {\n        \"property\": \"topic\",\n        \"propertyType\": \"msg\",\n        \"value\": \"\",\n        \"valueType\": \"triggerId\"\n      }\n    ],\n    \"x\": 200,\n    \"y\": 5920,\n    \"wires\": [\n      [\n        \"6ec51bd42b29d14f\",\n        \"a3b16db60ddd4e9d\"\n      ],\n      [\n        \"f83f049b86ed3afd\"\n      ]\n    ]\n  },\n  {\n    \"id\": \"9b37b53aa6b7e0f9\",\n    \"type\": \"function\",\n    \"z\": \"68c7aeaac5528913\",\n    \"name\": \"get brightness\",\n    \"func\": \"\\n//var newbrightness = msg.data.new_state.attributes.brightness\\nvar brightness = msg.data.attributes.brightness\\n\\n//msg.payload = change\\nmsg.payload = parseInt(brightness);\\nreturn msg;\\n\",\n    \"outputs\": 1,\n    \"timeout\": 0,\n    \"noerr\": 0,\n    \"initialize\": \"\",\n    \"finalize\": \"\",\n    \"libs\": [],\n    \"x\": 500,\n    \"y\": 5740,\n    \"wires\": [\n      [\n        \"8878a1d202d3df7b\"\n      ]\n    ]\n  },\n  {\n    \"id\": \"2686e4fe3b0aef18\",\n    \"type\": \"change\",\n    \"z\": \"68c7aeaac5528913\",\n    \"name\": \"on\",\n    \"rules\": [\n      {\n        \"t\": \"set\",\n        \"p\": \"payload\",\n        \"pt\": \"msg\",\n        \"to\": \"on\",\n        \"tot\": \"str\"\n      }\n    ],\n    \"action\": \"\",\n    \"property\": \"\",\n    \"from\": \"\",\n    \"to\": \"\",\n    \"reg\": false,\n    \"x\": 730,\n    \"y\": 5760,\n    \"wires\": [\n      [\n        \"7ea6364f03ea3cca\",\n        \"a3b16db60ddd4e9d\"\n      ]\n    ]\n  },\n  {\n    \"id\": \"a3b16db60ddd4e9d\",\n    \"type\": \"api-current-state\",\n    \"z\": \"68c7aeaac5528913\",\n    \"name\": \"Timeout\",\n    \"server\": \"dba636d5.d235b8\",\n    \"version\": 3,\n    \"outputs\": 1,\n    \"halt_if\": \"\",\n    \"halt_if_type\": \"str\",\n    \"halt_if_compare\": \"is\",\n    \"entity_id\": \"number.fireplace_fade_timeout\",\n    \"state_type\": \"num\",\n    \"blockInputOverrides\": false,\n    \"outputProperties\": [\n      {\n        \"property\": \"delay\",\n        \"propertyType\": \"msg\",\n        \"value\": \"\",\n        \"valueType\": \"entityState\"\n      },\n      {\n        \"property\": \"data\",\n        \"propertyType\": \"msg\",\n        \"value\": \"\",\n        \"valueType\": \"entity\"\n      }\n    ],\n    \"for\": 0,\n    \"forType\": \"num\",\n    \"forUnits\": \"minutes\",\n    \"x\": 1100,\n    \"y\": 5840,\n    \"wires\": [\n      [\n        \"c901b56f113bc16d\"\n      ]\n    ]\n  },\n  {\n    \"id\": \"7ea6364f03ea3cca\",\n    \"type\": \"api-current-state\",\n    \"z\": \"68c7aeaac5528913\",\n    \"name\": \"Occupancy\",\n    \"server\": \"dba636d5.d235b8\",\n    \"version\": 3,\n    \"outputs\": 2,\n    \"halt_if\": \"on\",\n    \"halt_if_type\": \"str\",\n    \"halt_if_compare\": \"is\",\n    \"entity_id\": \"binary_sensor.living_room_fp2_sensor\",\n    \"state_type\": \"str\",\n    \"blockInputOverrides\": false,\n    \"outputProperties\": [],\n    \"for\": \"0\",\n    \"forType\": \"num\",\n    \"forUnits\": \"minutes\",\n    \"override_topic\": false,\n    \"state_location\": \"payload\",\n    \"override_payload\": \"msg\",\n    \"entity_location\": \"data\",\n    \"override_data\": \"msg\",\n    \"x\": 910,\n    \"y\": 5700,\n    \"wires\": [\n      [\n        \"877b067d92a834a7\"\n      ],\n      []\n    ]\n  },\n  {\n    \"id\": \"c901b56f113bc16d\",\n    \"type\": \"trigger\",\n    \"z\": \"68c7aeaac5528913\",\n    \"name\": \"Delay\",\n    \"op1\": \"\",\n    \"op2\": \"0\",\n    \"op1type\": \"nul\",\n    \"op2type\": \"str\",\n    \"duration\": \"1\",\n    \"extend\": true,\n    \"overrideDelay\": true,\n    \"units\": \"s\",\n    \"reset\": \"on\",\n    \"bytopic\": \"all\",\n    \"topic\": \"topic\",\n    \"outputs\": 1,\n    \"x\": 1270,\n    \"y\": 5840,\n    \"wires\": [\n      [\n        \"f1b688970bc54fe9\"\n      ]\n    ]\n  },\n  {\n    \"id\": \"877b067d92a834a7\",\n    \"type\": \"api-current-state\",\n    \"z\": \"68c7aeaac5528913\",\n    \"name\": \"Illuminance &lt;30\",\n    \"server\": \"dba636d5.d235b8\",\n    \"version\": 3,\n    \"outputs\": 2,\n    \"halt_if\": \"30\",\n    \"halt_if_type\": \"num\",\n    \"halt_if_compare\": \"lt\",\n    \"entity_id\": \"sensor.living_room_fp2_occupancy_light_sensor_light_level\",\n    \"state_type\": \"str\",\n    \"blockInputOverrides\": false,\n    \"outputProperties\": [],\n    \"for\": \"0\",\n    \"forType\": \"num\",\n    \"forUnits\": \"minutes\",\n    \"override_topic\": false,\n    \"state_location\": \"payload\",\n    \"override_payload\": \"msg\",\n    \"entity_location\": \"data\",\n    \"override_data\": \"msg\",\n    \"x\": 1000,\n    \"y\": 5640,\n    \"wires\": [\n      [\n        \"d87bc673a80f05a4\"\n      ],\n      []\n    ]\n  },\n  {\n    \"id\": \"f1b688970bc54fe9\",\n    \"type\": \"api-call-service\",\n    \"z\": \"68c7aeaac5528913\",\n    \"name\": \"TV desk WLED OFF\",\n    \"server\": \"dba636d5.d235b8\",\n    \"version\": 5,\n    \"debugenabled\": false,\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    \"areaId\": [],\n    \"deviceId\": [],\n    \"entityId\": [\n      \"light.wled_2\"\n    ],\n    \"data\": \"\",\n    \"dataType\": \"jsonata\",\n    \"mergeContext\": \"\",\n    \"mustacheAltTags\": false,\n    \"outputProperties\": [],\n    \"queue\": \"none\",\n    \"x\": 1480,\n    \"y\": 5840,\n    \"wires\": [\n      []\n    ]\n  },\n  {\n    \"id\": \"d87bc673a80f05a4\",\n    \"type\": \"api-current-state\",\n    \"z\": \"68c7aeaac5528913\",\n    \"name\": \"TV is On?\",\n    \"server\": \"dba636d5.d235b8\",\n    \"version\": 3,\n    \"outputs\": 2,\n    \"halt_if\": \"on\",\n    \"halt_if_type\": \"str\",\n    \"halt_if_compare\": \"is\",\n    \"entity_id\": \"media_player.70pus9005_12_2\",\n    \"state_type\": \"str\",\n    \"blockInputOverrides\": false,\n    \"outputProperties\": [],\n    \"for\": \"0\",\n    \"forType\": \"num\",\n    \"forUnits\": \"minutes\",\n    \"override_topic\": false,\n    \"state_location\": \"payload\",\n    \"override_payload\": \"msg\",\n    \"entity_location\": \"data\",\n    \"override_data\": \"msg\",\n    \"x\": 1120,\n    \"y\": 5700,\n    \"wires\": [\n      [],\n      [\n        \"f3bb6b675138258e\"\n      ]\n    ]\n  },\n  {\n    \"id\": \"f3bb6b675138258e\",\n    \"type\": \"function\",\n    \"z\": \"68c7aeaac5528913\",\n    \"name\": \"Fireplace\",\n    \"func\": \"var preset\\n\\npreset = env.get(\\\"NR_NODE_NAME\\\");\\n\\nmsg.payload = \\n{\\n  \\\"data\\\": {\\n    \\\"option\\\": \\\"\\\" + preset + \\\"\\\",\\n  }\\n}\\nreturn msg;\",\n    \"outputs\": 1,\n    \"timeout\": 0,\n    \"noerr\": 0,\n    \"initialize\": \"\",\n    \"finalize\": \"\",\n    \"libs\": [],\n    \"x\": 1280,\n    \"y\": 5760,\n    \"wires\": [\n      [\n        \"fdc1b1ef84221ca9\"\n      ]\n    ]\n  },\n  {\n    \"id\": \"fdc1b1ef84221ca9\",\n    \"type\": \"api-call-service\",\n    \"z\": \"68c7aeaac5528913\",\n    \"name\": \"TV desk WLED Preset\",\n    \"server\": \"dba636d5.d235b8\",\n    \"version\": 5,\n    \"debugenabled\": false,\n    \"domain\": \"select\",\n    \"service\": \"select_option\",\n    \"areaId\": [],\n    \"deviceId\": [],\n    \"entityId\": [\n      \"select.wled_preset_2\"\n    ],\n    \"data\": \"\",\n    \"dataType\": \"jsonata\",\n    \"mergeContext\": \"\",\n    \"mustacheAltTags\": false,\n    \"outputProperties\": [],\n    \"queue\": \"none\",\n    \"x\": 1480,\n    \"y\": 5760,\n    \"wires\": [\n      []\n    ]\n  },\n  {\n    \"id\": \"dba636d5.d235b8\",\n    \"type\": \"server\",\n    \"name\": \"Home Assistant\",\n    \"version\": 5,\n    \"addon\": true,\n    \"rejectUnauthorizedCerts\": true,\n    \"ha_boolean\": \"y|yes|true|on|home|open\",\n    \"connectionDelay\": true,\n    \"cacheJson\": true,\n    \"heartbeat\": true,\n    \"heartbeatInterval\": \"30\",\n    \"areaSelector\": \"friendlyName\",\n    \"deviceSelector\": \"friendlyName\",\n    \"entitySelector\": \"friendlyName\",\n    \"statusSeparator\": \"at: \",\n    \"statusYear\": \"hidden\",\n    \"statusMonth\": \"short\",\n    \"statusDay\": \"numeric\",\n    \"statusHourCycle\": \"h23\",\n    \"statusTimeFormat\": \"h:m\",\n    \"enableGlobalContextStore\": true\n  }\n]\n</code></pre>","tags":["ESP32","WLED","NodeRED","DIY"]},{"location":"articles/articles/ai-log-summary/home-lab-logs/","title":"Home lab logs","text":""},{"location":"articles/articles/ai-log-summary/unraid-syslog-server/","title":"Unraid syslog server","text":"<p>Unraid &gt; Settings &gt; Syslog Server</p> Setting Value / Options Shown Local syslog server Enabled (UDP, port 514) Local syslog folder appdata System identifier for logfile name IP Address Local syslog rotation Enabled Local syslog maximum file size 50 MB Local syslog number of files 1 Remote syslog server name or IP address (UDP 514) Mirror syslog to flash No Copy syslog to flash on shutdown Yes <p>Unraid Syslog Server Configuration</p>"},{"location":"home-lab/","title":"Network Topology","text":""},{"location":"home-lab/#network-topology","title":"Network Topology","text":"<p>Placeholder for Network documentation.</p>"},{"location":"home-lab/#overview","title":"Overview","text":"<ul> <li>Router: (To be documented)</li> <li>Switches: (To be documented)</li> <li>VLANs: (To be documented)</li> </ul>"},{"location":"smart-home/","title":"Smart Home Overview","text":"","tags":["index","automated"]},{"location":"smart-home/#smart-home-overview","title":"Smart Home Overview","text":"<p>This section contains all architectural documentation for the Home Assistant setup, including automations, dashboards, and integrations.</p> Architecture <p>System structure, file tree, and configuration logic.</p> Dashboards <p>Visual overview of all Lovelace dashboards and views.</p> Packages <p>Feature-based configuration bundles (Automations, Scripts).</p> Automations <p>Detailed breakdown of UI-managed automations.</p> Integrations <p>Index of external systems and hardware integrations.</p> Add-ons <p>Additional services like Frigate NVR and others.</p>","tags":["index","automated"]},{"location":"smart-home/automations/","title":"UI Automations","text":"","tags":["automations","ui","automated"]},{"location":"smart-home/automations/#ui-automations","title":"UI Automations","text":"<p>This page documents automations that are managed directly via the Home Assistant UI (<code>automations.yaml</code>). </p> <p>Package Automations</p> <p>Automations that are part of a specific feature bundle (e.g., Car, Heating) are documented in the Package Catalog.</p>","tags":["automations","ui","automated"]},{"location":"smart-home/automations/#active-ui-automations","title":"Active UI Automations","text":"Alias Description Trigger Types Mode Turn off Coffee Machine Outlet, when schedule is turned on No description. state <code>single</code>","tags":["automations","ui","automated"]},{"location":"smart-home/structure/","title":"Configuration &amp; Structure","text":"","tags":["structure","configuration","automated"]},{"location":"smart-home/structure/#configuration-structure","title":"Configuration &amp; Structure","text":"","tags":["structure","configuration","automated"]},{"location":"smart-home/structure/#directory-structure","title":"Directory Structure","text":"<p>An overview of the key directories and files in the Home Assistant root folder.</p> Directory / File Purpose <code>.ag_scripts/</code> Python tooling for automated docs generation (Packages, Dashboards, Indexing). <code>.storage/</code> Internal Home Assistant storage for registries (devices, entities, etc.). Do not edit manually. <code>AI_CONTEXT.md</code> System prompt and context file for the creation of this AI Agent. <code>ag_v2_agent.py</code> <code>ag_v2_dashboard.py</code> <code>ag_v2_package.py</code> <code>ag_v2_update.py</code> <code>automations.yaml</code> The main file for storing automations, commonly managed via the UI. <code>blueprints/</code> Stores automation blueprints downloaded or created for reusability. <code>button_card_templates/</code> Custom templates for <code>custom:button-card</code> Lovelace cards. <code>configuration.yaml</code> The main configuration file for Home Assistant. <code>custom_components/</code> Custom integrations installed manually or via HACS. <code>custom_templates/</code> Global Jinja2 templates (macros) available throughout Home Assistant. <code>debug_regex.py</code> <code>deps/</code> Python dependencies installed by Home Assistant or integrations. <code>docs_site/</code> This documentation repository and MkDocs site structure. <code>esphome/</code> ESPHome configuration YAML files and compilation artifacts (binaries). <code>home-assistant-wakewords-collection-main/</code> Directory. <code>home-assistant.log.fault</code> <code>home-assistant_v2.db</code> <code>home-assistant_v2.db-shm</code> <code>home-assistant_v2.db-wal</code> <code>image/</code> Directory. <code>include/</code> Split configuration files referenced from <code>configuration.yaml</code> to keep it clean. <code>model_cache/</code> Cache for local AI models (Wake words, assist pipelines). <code>node-red/</code> Storage for Node-RED flows and settings (if the add-on is used). <code>packages/</code> Configuration split into logical \"packages\" (bundling automations, scripts, configuration by feature). <code>pyscript/</code> Python scripts and apps for the <code>pyscript</code> integration. <code>scenes.yaml</code> Configuration file for defining scenes. <code>scripts.yaml</code> Configuration file for scripts (sequences of actions). <code>secrets.yaml</code> Stores sensitive data (passwords, tokens) referenced via <code>!secret</code>. <code>themes/</code> Frontend themes definition files. <code>tts/</code> Text-to-Speech cache or configuration. <code>www/</code> Publicly accessible folder mapped to <code>/local/</code> for hosting custom cards, images, and resources. <code>zigbee2mqtt/</code> Zigbee2MQTT data directory containing configuration and database. <code>zigbee2mqtt-2/</code> Secondary Zigbee2MQTT instance data directory.","tags":["structure","configuration","automated"]},{"location":"smart-home/structure/#configurationyaml","title":"Configuration.yaml","text":"<p>Below is the current content of <code>configuration.yaml</code> with explanations for each section.</p> <pre><code>homeassistant:\n  unit_system: metric\n  time_zone: Europe/Helsinki\n  ## Packages ##\n  packages: !include_dir_named packages\n\n# Loads default set of integrations. Do not remove.\ndefault_config:\n\n## NEEDED FOR TRAEFIK\nhttp:\n  use_x_forwarded_for: true\n  trusted_proxies:\n    - 172.16.0.0/12\n    - 10.0.0.0/8\n    - 127.0.0.1\n\n## THEMES ##\nfrontend:\n  #themes: !include_dir_merge_named themes\n\n## TEXT TO SPEECH ##\ntts:\n  - platform: google_translate\n\nrecorder:\n#  exclude:\n#    entities:\n\n## HACS - PYSCRIPT ##\npyscript: !include include/pyscript.yaml\n\n## PowerCal\npowercalc: !include include/powercalc.yaml\n\n## CUSTOM/HACS - PHILIPS AIR PURIFIER ##\nfan: !include include/philips_air_purifier.yaml\n\n## FILES ##\nautomation: !include automations.yaml ## UI-managed\nscript: !include scripts.yaml ## UI-managed\n</code></pre>","tags":["structure","configuration","automated"]},{"location":"smart-home/addons/","title":"Add-ons","text":"","tags":["index","addons"]},{"location":"smart-home/addons/#add-ons","title":"Add-ons","text":"<p>Documentation for Home Assistant Add-ons and external services running in the Home Lab.</p>","tags":["index","addons"]},{"location":"smart-home/addons/#available-add-ons","title":"Available Add-ons","text":"<ul> <li>Frigate NVR: AI-powered NVR for real-time object detection.</li> </ul>","tags":["index","addons"]},{"location":"smart-home/addons/frigate_nvr/","title":"Frigate NVR","text":"","tags":["security","network","frigate","infrastructure","manual","unifi protect"]},{"location":"smart-home/addons/frigate_nvr/#frigate-nvr","title":"Frigate NVR","text":"","tags":["security","network","frigate","infrastructure","manual","unifi protect"]},{"location":"smart-home/addons/frigate_nvr/#system-documentation","title":"System Documentation","text":"<p>Version: 1.0.4 (Unifi Source and Device Details Added) Source: External <code>config.yml</code> running on Unraid. Description: Documentation of the external Frigate NVR instance (running on Unraid/Docker) and its connection to Home Assistant for critical notifications.</p> <p></p>","tags":["security","network","frigate","infrastructure","manual","unifi protect"]},{"location":"smart-home/addons/frigate_nvr/#executive-summary","title":"Executive Summary","text":"<p>Frigate is the critical component responsible for local object detection and event management for all security cameras. It runs externally on the Unraid VM within the HALO Proxmox server stack.</p> <p>Source NVR: All camera feeds originate from the Unifi Protect NVR (Dream Machine Pro). The specific camera models and locations are:</p> <ul> <li>Backyard: G5 Turret Ultra</li> <li>Front Door: G4 Doorbell Pro PoE</li> <li>Front Porch: G5 Turret Ultra</li> <li>Storage Cam: G3 Instant</li> </ul> <p>Management Note: Accessing the Frigate WebUI and API is facilitated by the Frigate Proxy Add-on within Home Assistant, which simplifies network configuration and authentication.</p> <p>This configuration is optimized for high-performance detection using two Coral Edge TPUs and NVIDIA hardware acceleration (H.264) for video decoding. Video streams are managed centrally by Go2RTC and then sent internally to Frigate for detection/recording roles.</p> <p>Detection Focus: Tracking is focused solely on person objects (min score 0.7).</p> <p>Recording: Clips and recordings are enabled for all cameras.</p> <p>Retention Policy: Clips/Detections are kept for 10 days, general recordings for 4 days.</p>","tags":["security","network","frigate","infrastructure","manual","unifi protect"]},{"location":"smart-home/addons/frigate_nvr/#architecture-data-flow","title":"Architecture &amp; Data Flow","text":"<p>This diagram illustrates how the infrastructure layers feed data to Home Assistant. The health check sensor monitors if the final MQTT output is running.</p> <pre><code>graph TD\n    subgraph \"Infrastructure Stack\"\n        HALO[Host: Proxmox Server] --&gt; UNRAID[VM: Unraid OS]\n        UNRAID --&gt; FRIGATE[Docker: Frigate NVR System - 2x Coral TPU / NVIDIA]\n    end\n\n    subgraph \"Camera Streams (UDM Pro NVR)\"\n        B[Backyard Cam]\n        FDP[Front Door Porch Cam]\n        FDD[Front Door Doorbell]\n        S[Storage Cam]\n    end\n\n    B --&gt; GO2RTC[Go2RTC Restreamer]\n    FDP --&gt; GO2RTC\n    FDD --&gt; GO2RTC\n    S --&gt; GO2RTC\n\n    GO2RTC --&gt; FRIGATE\n\n    FRIGATE --&gt; MQTT[MQTT Broker - Topic: frigate/#]\n    MQTT --&gt; HA[Home Assistant OS]\n    HA --&gt; NOTIFY[Master Notifications]\n\n    style FRIGATE fill:#03A9F4,stroke:#333,stroke-width:2px\n    style HA fill:#4CAF50,stroke:#333,stroke-width:2px</code></pre>","tags":["security","network","frigate","infrastructure","manual","unifi protect"]},{"location":"smart-home/addons/frigate_nvr/#configuration","title":"Configuration","text":"<p>The configuration is managed via the external <code>config.yml</code> file running on Unraid. The configuration is detailed in the Frigate documentation.</p> <pre><code># ------------------------------------------------------------------------------\n# 2. EXTERNAL CONFIGURATION DOCUMENTATION\n# ------------------------------------------------------------------------------\nmqtt:\n  host: [IP REDACTED] # Central MQTT Broker IP\n  user: !secret mqtt_user # MQTT Login (Secret in HA secrets.yaml)\n  password: !secret mqtt_password\n\ndetectors:\n  # Using two Coral devices assigned via PCI passthrough (pci:0 and pci:1)\n  # This provides high throughput for simultaneous detection across multiple cameras.\n  coral1:\n    type: edgetpu\n    device: pci:0\n  coral2:\n    type: edgetpu\n    device: pci:1\n\nffmpeg:\n  # Uses the preset for NVIDIA hardware acceleration to decode H.264 streams.\n  # This significantly reduces CPU load, offloading heavy processing to the GPU.\n  hwaccel_args: preset-nvidia-h264\n\n# GLOBAL DETECT SETTINGS\ndetect:\n  # Detection frame rate set to 5 FPS to reduce load while maintaining accuracy.\n  fps: 5\n  enabled: true\n\nobjects:\n  # Only tracking humans to minimize false positives from animals/vehicles.\n  track:\n    - person\n  filters:\n    person:\n      min_area: 5000 # Minimum size of object in image to trigger detection.\n      min_score: 0.5 # Minimum score to begin tracking an object.\n      threshold: 0.7 # Minimum score to declare a true positive detection (for alerts).\n\n\nrecord:\n  enabled: true\n  expire_interval: 60 # Check for old files every 60 minutes.\n  retain:\n    days: 4 # General recording retention period.\n    mode: all\n  alerts:\n    retain:\n      days: 10 # Clips from alerts (events) are kept longer.\n      mode: active_objects\n    pre_capture: 5 # Record 5 seconds BEFORE event trigger.\n    post_capture: 5 # Record 5 seconds AFTER event ends.\n  detections:\n    retain:\n      days: 10\n      mode: active_objects\n    pre_capture: 5\n    post_capture: 5\n\n\nsnapshots:\n  enabled: true\n  timestamp: true # Adds date/time to the image.\n  bounding_box: true # Draws a box around the detected object.\n  crop: false\n  retain:\n    default: 10 # Snapshots kept for 10 days.\n\n\n# ---------------------------------------------------\n# GO2RTC - THE HUB (Central Stream Management)\n# ---------------------------------------------------\ngo2rtc:\n  streams:\n    # All streams are routed via go2rtc (rtsp://127.0.0.1:8554/...) \n    # This prevents Frigate from directly hitting the Unifi NVR, improving stability.\n\n    # --- Front Doorbell ---\n    frontdoor_doorbell_unifi_high: # High Res stream used for recording\n      - rtsp://[IP REDACTED]:7447/[TOKEN REDACTED] # Input stream token\n      - ffmpeg:frontdoor_doorbell_frigate#audio=opus # Output restream options\n    frontdoor_doorbell_unifi_med: # Medium Res stream used for detection\n      - rtsp://[IP REDACTED]:7447/[TOKEN REDACTED]\n\n    # --- Front Porch ---\n    front_porch_unifi_high: # High Res stream\n      - rtsp://[IP REDACTED]:7447/[TOKEN REDACTED]\n      - ffmpeg:front_porch_frigate#audio=opus\n    front_porch_unifi_med: # Medium Res stream\n      - rtsp://[IP REDACTED]:7447/[TOKEN REDACTED]\n\n    # --- Backyard ---\n    backyard_unifi_high: # High Res stream\n      - rtsp://[IP REDACTED]:7447/[TOKEN REDACTED]\n      - ffmpeg:backyard_high#audio=opus\n    backyard_unifi_med: # Medium Res stream\n      - rtsp://[IP REDACTED]:7447/[TOKEN REDACTED]\n\n    # --- Storage ---\n    storage_unifi_high: # High Res stream\n      - rtsp://[IP REDACTED]:7447/[TOKEN REDACTED]\n      - ffmpeg:storage_frigate#audio=opus\n    storage_unifi_med: # Medium Res stream\n      - rtsp://[IP REDACTED]:7447/[TOKEN REDACTED]\n    storage_unifi_low: # Low Res stream (likely detection input)\n      - rtsp://[IP REDACTED]:7447/[TOKEN REDACTED]\n\n  webrtc:\n    candidates:\n      # WebRTC candidate IP/Port, necessary for low-latency streaming in dashboards\n      - [IP REDACTED]:8555 \n      - stun:8555\n\n\ntimestamp_style:\n  position: br # Position timestamp Bottom Right\n  format: '%Y-%m-%d %H:%M:%S'\n  thickness: 2\n  effect: solid \n\n# ---------------------------------------------------\n# CAMERAS (Frigate Processing Definitions)\n# ---------------------------------------------------\ncameras:\n\n  ## FRONTDOOR DOORBELL\n  frontdoor_doorbell_frigate:\n    enabled: true\n    ffmpeg:\n      output_args:\n        record: preset-record-ubiquiti\n      inputs:\n        # Input 1: High Res stream used ONLY for recording clips (rtsp://127.0.0.1:8554/...)\n        - path: rtsp://127.0.0.1:8554/frontdoor_doorbell_unifi_high?video&amp;audio \n          roles:\n            - record\n        # Input 2: Low Res stream used ONLY for object detection (reduced processing load)\n        - path: rtsp://127.0.0.1:8554/frontdoor_doorbell_unifi_med?video\n          roles:\n            - detect\n    detect:\n      width: 960\n      height: 720\n    motion:\n      threshold: 20\n\n  ## FRONT PORCH\n  front_porch_frigate:\n    enabled: true\n    ffmpeg:\n      output_args:\n        record: preset-record-ubiquiti\n      inputs:\n        - path: rtsp://127.0.0.1:8554/front_porch_unifi_high?video&amp;audio \n          input_args: preset-rtsp-restream\n          roles:\n            - record\n        - path: rtsp://127.0.0.1:8554/front_porch_unifi_med?video\n          roles:\n            - detect\n    detect:\n      width: 1280\n      height: 720\n\n  ## BACKYARD CAMERA\n  backyard_frigate:\n    enabled: true\n    ffmpeg:\n      output_args:\n        record: preset-record-ubiquiti\n      inputs:\n        - path: rtsp://127.0.0.1:8554/backyard_unifi_high?video&amp;audio \n          input_args: preset-rtsp-restream\n          roles:\n            - record\n        - path: rtsp://127.0.0.1:8554/backyard_unifi_med?video\n          roles:\n            - detect \n    detect:\n      width: 1280\n      height: 720\n    objects:\n      filters:\n        person:\n          # Detection mask to ignore certain areas of the frame (e.g., inside the house, trees, road).\n          mask: 0.733,0.989,0.875,0.582,0.996,0.215,0.998,0.993\n\n  ## STORAGE CAMERA\n  storage_frigate:\n    enabled: true\n    ffmpeg:\n      output_args:\n        record: preset-record-ubiquiti\n      inputs:\n        - path: rtsp://127.0.0.1:8554/storage_unifi_high?video&amp;audio \n          input_args: preset-rtsp-restream\n          roles:\n            - record\n        - path: rtsp://127.0.0.1:8554/storage_unifi_low?video\n          roles:\n            - detect \n    detect:\n      width: 640\n      height: 360\n\n\nversion: 0.16-0\ncamera_groups:\n  Outdoors:\n    order: 1\n    icon: LuSprout\n    cameras:\n      - frontdoor_doorbell_frigate\n      - backyard_frigate\n      - front_porch_frigate\n      - storage_frigate\n</code></pre>","tags":["security","network","frigate","infrastructure","manual","unifi protect"]},{"location":"smart-home/addons/frigate_nvr/#health-checks","title":"Health Checks","text":"<p>The system includes health checks for the Frigate NVR system. These checks are detailed in the Frigate documentation.</p>","tags":["security","network","frigate","infrastructure","manual","unifi protect"]},{"location":"smart-home/dashboards/","title":"Dashboard Catalog","text":"","tags":["dashboard","index"]},{"location":"smart-home/dashboards/#dashboard-catalog","title":"Dashboard Catalog","text":"<p>Welcome to the Home Lab Dashboards overview. Below is a structured list of all available dashboard views, grouped by their respective dashboards.</p> <p>Auto-Generated</p> <p>This catalog is automatically maintained by the Documentation Agent.</p>","tags":["dashboard","index"]},{"location":"smart-home/dashboards/#admin-system","title":"\ud83d\udcf1 Admin System","text":"<ul> <li>System Advanced system monitoring and control for the Proxmox 'Halo' node, including resource usage, power management, and guest orchestration.</li> </ul>","tags":["dashboard","index"]},{"location":"smart-home/dashboards/#persons","title":"\ud83d\udcf1 Persons","text":"<ul> <li>CAR Control interface for the Mercedes GLC, featuring climate scheduling, lock status, and real-time fuel/battery monitoring.</li> <li>Evis Personal dashboard for Evis, managing notifications and personal settings.</li> <li>Guest-1 Personal dashboard for Guest-1, managing notifications and guest settings.</li> </ul>","tags":["dashboard","index"]},{"location":"smart-home/dashboards/#home-access","title":"\ud83d\udcf1 Home Access","text":"<ul> <li>Home Access Center Centralized management interface for Unifi Access users, credentials, and guest schedules.</li> </ul>","tags":["dashboard","index"]},{"location":"smart-home/dashboards/#main","title":"\ud83d\udcf1 Main","text":"<ul> <li>Backyard Monitoring and control for the backyard, including Frigate cameras and environmental stats.</li> <li>Bathroom Controls for bathroom lights, floor heating, and appliance monitoring.</li> <li>Bedroom Bedroom management including lighting, window blinds, and detailed sleep tracking sensors.</li> <li>Daughter Controls for the daughter's room (Guest Room) including lights and schedules.</li> <li>Electricity Comprehensive energy dashboard showing real-time prices, historical usage, and cost analysis.</li> <li>Electricity Dev Development version of the electricity dashboard for testing new charts.</li> <li>Front Door Security and access control for the front entrance.</li> <li>Guest-2 Controls for Guest-2 room (E Room) including lights and power monitoring.</li> <li>Guest-3 Controls for Guest-3 room (A Room) with environmental monitoring.</li> <li>Hallway Controls for the hallway including lights and staircase automations.</li> <li>Home Primary home overview dashboard with calendars, weather, key energy stats, and room summaries.</li> <li>Kitchen Kitchen management including appliance monitoring, detailed dishwasher stats, and zoned presence.</li> <li>Living Room Living room environment monitoring, entertainment controls, and fireplace management.</li> <li>Lobby Entry lobby controls for lights and automation modes.</li> <li>Mud Room Mud room utility simple controls and occupancy tracking.</li> <li>Office Home office workspace controls and extensive system monitoring.</li> <li>Sauna Sauna status monitoring and basic lighting control.</li> <li>Settings Global system settings for occupancy sensitivity, timeouts, and automation flags across all zones.</li> <li>Stairs Staircase lighting controls including WLED effects.</li> <li>Storage Storage room surveillance and camera configuration.</li> <li>Toilet Toilet room controls and detailed motion sensor calibration.</li> </ul>","tags":["dashboard","index"]},{"location":"smart-home/dashboards/#notification-center","title":"\ud83d\udcf1 Notification Center","text":"<ul> <li>Notifications Management Centralized management for notification users, categories, and subscriptions.</li> </ul>","tags":["dashboard","index"]},{"location":"smart-home/dashboards/#room-management","title":"\ud83d\udcf1 Room Management","text":"<ul> <li>Room Management Admin interface for creating, deleting, and managing room configurations and automation helpers.</li> </ul>","tags":["dashboard","index"]},{"location":"smart-home/dashboards/admin-system/system/","title":"System","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/admin-system/system/#system","title":"System","text":"<p>Dashboard: Admin System Path: <code>system</code></p> <p>Advanced system monitoring and control for the Proxmox 'Halo' node, including resource usage, power management, and guest orchestration.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/admin-system/system/#summary","title":"Summary","text":"<p>This view provides deep insights into the Proxmox 'Halo' virtualization node. It features real-time resource monitoring (CPU, RAM) using <code>mini-graph-card</code>, and critical power controls (Reboot, Shutdown) protected by confirmation dialogs. It also offers bulk management for guest VMs/containers and tracks system update status, ensuring the infrastructure host is healthy and up-to-date.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/admin-system/system/#configuration","title":"Configuration","text":"<pre><code>title: System\npath: system\ncards: []\ntype: sections\nmax_columns: 6\nsections:\n  - type: grid\n    cards:\n      - type: markdown\n        content: |\n          ## HALO - Hardware\n\n          #### CPU\n          * Intel Core i9-10920XE CPU @ 3.50GHz\n\n          ### RAM\n          * 6 x Corsair DDR4 16GB, PC 3200, CL16 (96GB)\n\n          ### MB\n          * ASRock Rack x299 WS/IPMI\n\n          ### GPU\n          * Asus GeForce GTX1650-O4G-LP-BRK\n\n          ### STORAGE\n\n          * Genuine LSI 6Gbps SAS HBA LSI 9201-8i\n          * 8 x Samsung 870 EVO SSD 1TB 2.5\" SATA3\n          * 2 x Seagate IronWolf 8TB NAS\n          * 2 x Seagate EXOS X18 18TB SATA 7200RPM\n          * 2 x Seagate Exos X20 18TB SATA 7200RPM\n\n          ### NETWORK\n\n          * Intel X540-T2, 2 x RJ45, PCI-E X8\n\n          ### OTHER\n\n          * 2 x Google Coral Mini PCIe\n          * 2 x Ableconn PEX-MP117 Mini PCI-E to PCI-E\n\n          ### CASE\n\n          * Inter-Tech 88887191 IPC Storage 4U-4408\n        visibility:\n          - condition: state\n            entity: input_select.rack_selected_device\n            state: server-halo\n      - type: markdown\n        content: |-\n          ## RPi5 62\n\n          ### Board\n          * Raspberry Pi5 8 GB\n\n          ### HATS &amp; Accessories\n\n          * Samsung SSD 256GB PM991 M.2 2242 PCIe 3.0 x4 NVMe\n          * Waveshare PCIe to M.2 Adapter for Raspberry Pi 5\n          * Waveshare PoE Power Over Ethernet\n        visibility:\n          - condition: state\n            entity: input_select.rack_selected_device\n            state: pi5-62\n      - type: markdown\n        content: |-\n          ## RPi5 63\n\n          ### Board\n          * Raspberry Pi5 8 GB\n\n          ### HATS &amp; Accessories\n\n          * Samsung SSD 256GB PM991 M.2 2242 PCIe 3.0 x4 NVMe\n          * Waveshare PCIe to M.2 Adapter for Raspberry Pi 5\n          * Waveshare PoE Power Over Ethernet\n        visibility:\n          - condition: state\n            entity: input_select.rack_selected_device\n            state: pi5-63\n      - type: markdown\n        content: |+\n          ## Server Edge\n\n          #### CPU\n          * Intel Core i7-10710U CPU @ 1.10GHz\n\n          ### RAM\n          * 2 x DDR4 16GB, PC 3200, CL16 (32GB)\n\n          ### MB\n          * Intel NUC10I7FNHN2 Frost Canyon\n\n          ### GPU\n          *  integrated Intel UHD graphics card\n\n          ### STORAGE\n\n\n          ### NETWORK\n\n          * 1Gbs Integrated\n          * Intel Wireless-AX MAC 802.11ax\n\n          ### OTHER\n\n        visibility:\n          - condition: state\n            entity: input_select.rack_selected_device\n            state: server-edge\n      - type: markdown\n        content: |-\n          ## APC Back-UPS BE850G2-GR\n\n          ### Features\n          * Max Time (Full Load): 2.3 minutes\n\n          * Max Power (W): 520W\n          * Max Power (VA): 850 VA\n          * Changable Battery (RBC17)\n\n          ### Outlets\n          * 6 x Schuko CEE 7 (Battery Backup)\n          * 2 x Schuko CEE 7 (Surge Protection)\n          * 1 x RJ-45\n\n          ### Weight\n\n          * 4.5 kg\n\n          ### Dimensions\n\n          * 120 x 120 x 365 mm\n        visibility:\n          - condition: state\n            entity: input_select.rack_selected_device\n            state: apc-bubs-850\n  - type: grid\n    cards:\n      - type: vertical-stack\n        cards:\n          - type: heading\n            heading: HALO NODE\n            heading_style: title\n          - type: custom:auto-entities\n            card:\n              type: grid\n              columns: 2\n              square: false\n            card_param: cards\n            filter:\n              include:\n                - options:\n                    type: custom:mini-graph-card\n                    entities:\n                      - entity: this.entity_id\n                    name: CPU Load\n                    line_width: 8\n                    font_size: 75\n                    height: 100\n                    show:\n                      fill: fade\n                      extrema: true\n                    color_thresholds:\n                      - value: 50\n                        color: '#5FE787'\n                      - value: 80\n                        color: '#FF9800'\n                      - value: 90\n                        color: '#FF535B'\n                  integration: proxmoxve\n                  entity_id: '*node_halo*cpu_used'\n                - options:\n                    type: custom:mini-graph-card\n                    entities:\n                      - entity: this.entity_id\n                    name: RAM Usage\n                    line_width: 8\n                    font_size: 75\n                    height: 100\n                    show:\n                      fill: fade\n                      extrema: true\n                    color_thresholds:\n                      - value: 60\n                        color: '#5FE787'\n                      - value: 80\n                        color: '#FF9800'\n                      - value: 90\n                        color: '#FF535B'\n                  integration: proxmoxve\n                  entity_id: '*node_halo*memory_used_percentage'\n              exclude:\n                - options: {}\n                  state: unavailable\n          - type: heading\n            heading: CONTROLS\n            heading_style: title\n          - type: grid\n            columns: 2\n            square: false\n            cards:\n              - type: custom:mushroom-entity-card\n                entity: button.node_halo_reboot\n                name: Reboot Node\n                icon: mdi:restart\n                icon_color: orange\n                layout: horizontal\n                tap_action:\n                  action: perform-action\n                  perform_action: button.press\n                  target:\n                    entity_id: button.node_halo_reboot\n                  confirmation:\n                    text: \u26a0\ufe0f Are you sure you want to REBOOT the physical Halo Node?\n              - type: custom:mushroom-entity-card\n                entity: button.node_halo_shutdown\n                name: Shutdown Node\n                icon: mdi:power\n                icon_color: red\n                layout: horizontal\n                tap_action:\n                  action: perform-action\n                  perform_action: button.press\n                  target:\n                    entity_id: button.node_halo_shutdown\n                  confirmation:\n                    text: '\u26d4 DANGER: Are you sure you want to SHUTDOWN the physical Halo Node?'\n              - type: custom:mushroom-entity-card\n                entity: button.node_halo_start_all\n                name: Start All Guests\n                icon: mdi:play-box-multiple-outline\n                icon_color: green\n                layout: horizontal\n                tap_action:\n                  action: perform-action\n                  perform_action: button.press\n                  target:\n                    entity_id: button.node_halo_start_all\n                  confirmation:\n                    text: Start all VMs and Containers on Halo?\n              - type: custom:mushroom-entity-card\n                entity: button.node_halo_stop_all\n                name: Stop All Guests\n                icon: mdi:stop-circle-outline\n                icon_color: orange\n                layout: horizontal\n                tap_action:\n                  action: perform-action\n                  perform_action: button.press\n                  target:\n                    entity_id: button.node_halo_stop_all\n                  confirmation:\n                    text: \u26a0\ufe0f Are you sure you want to STOP ALL guests on Halo?\n          - type: heading\n            heading: UPDATES\n            heading_style: title\n          - type: grid\n            columns: 2\n            square: false\n            cards:\n              - type: custom:mushroom-template-card\n                entity: sensor.node_halo_total_updates\n                primary: Total Updates\n                secondary: '{{ states(entity) }} packages'\n                icon: mdi:package-variant\n                tap_action:\n                  action: more-info\n                color: '{{ ''green'' if states(entity)|int == 0 else ''orange'' }}'\n                vertical: true\n                features_position: bottom\n              - type: custom:mushroom-template-card\n                entity: binary_sensor.node_halo_updates_packages\n                primary: System Status\n                secondary: '{{ ''Up to Date'' if is_state(entity, ''off'') else ''Updates Available'' }}'\n                icon: mdi:update\n                tap_action:\n                  action: more-info\n                color: '{{ ''green'' if is_state(entity, ''off'') else ''orange'' }}'\n                vertical: true\n                features_position: bottom\n          - type: heading\n            heading: HALO GUESTS\n            heading_style: title\n          - type: custom:auto-entities\n            card:\n              type: grid\n              columns: 1\n              square: false\n            card_param: cards\n            sort:\n              method: name\n            filter:\n              template: \"{% set NODE_NAME = 'Halo' %} \\n{% set ns = namespace(cards=[]) %}\\n\\n{% for state in states.binary_sensor %}\\n  \\n  {# 1. Strict Name Check #}\\n  {% if ('qemu' in state.entity_id or 'lxc' in state.entity_id) and state.entity_id.endswith('_status') %}\\n    \\n    {# 2. Connected Via Check #}\\n    {% set dev_id = device_id(state.entity_id) %}\\n    {% set via_id = device_attr(dev_id, 'via_device_id') if dev_id else none %}\\n    {% set via_name = device_attr(via_id, 'name') if via_id else '' %}\\n    \\n    {% if NODE_NAME | lower in via_name | lower %}\\n    \\n         {# --- 3. CALCULATE IDs --- #}\\n         {% set friendly_name = state.attributes.get('friendly_name', state.entity_id) | replace(' Status', '') %}\\n         {% set base_id = state.entity_id | replace('_status', '') %}\\n         \\n         {# Sensors #}\\n         {% set s_base = base_id | replace('binary_sensor.', 'sensor.') %}\\n         {% set s_cpu = s_base ~ '_cpu_used' %}\\n         {% set s_mem = s_base\\\n                \\ ~ '_memory_used_percentage' %}\\n         {% set s_net_in = s_base ~ '_network_in' %}\\n         {% set s_net_out = s_base ~ '_network_out' %}\\n         {# Disk Sensors #}\\n         {% set s_disk_used = s_base ~ '_disk_used' %}\\n         {% set s_disk_free = s_base ~ '_disk_free' %}\\n         \\n         {# Buttons #}\\n         {% set b_base = base_id | replace('binary_sensor.', 'button.') %}\\n         {% set b_start = b_base ~ '_start' %}\\n         {% set b_stop = b_base ~ '_shutdown' %}\\n         {% set b_reboot = b_base ~ '_reboot' %}\\n         {% set b_kill = b_base ~ '_stop' %}\\n         \\n         {# --- 4. BUILD CARD --- #}\\n         {% set card = {\\n            \\\"type\\\": \\\"custom:mushroom-template-card\\\",\\n            \\\"entity\\\": state.entity_id,\\n            \\\"layout\\\": \\\"horizontal\\\",\\n            \\\"fill_container\\\": true,\\n            \\\"primary\\\": friendly_name,\\n            \\\"secondary\\\": state.state | title,\\n            \\\"icon\\\": 'mdi:cube-outline' if 'lxc' in\\\n                \\ state.entity_id else 'mdi:server',\\n            \\\"icon_color\\\": 'green' if state.state == 'on' else 'red',\\n            \\\"tap_action\\\": {\\n               \\\"action\\\": \\\"fire-dom-event\\\",\\n               \\\"browser_mod\\\": {\\n                  \\\"service\\\": \\\"browser_mod.popup\\\",\\n                  \\\"data\\\": {\\n                     \\\"title\\\": friendly_name,\\n                     \\\"size\\\": \\\"normal\\\",\\n                     \\\"content\\\": {\\n                        \\\"type\\\": \\\"vertical-stack\\\",\\n                        \\\"cards\\\": [\\n                           {\\n                              \\\"type\\\": \\\"horizontal-stack\\\",\\n                              \\\"cards\\\": [\\n                                 {\\n                                    \\\"type\\\": \\\"custom:mini-graph-card\\\",\\n                                    \\\"entities\\\": [ {\\\"entity\\\": s_cpu, \\\"name\\\": \\\"CPU\\\"} ],\\n                                    \\\"line_width\\\": 4, \\\"font_size\\\": 60, \\\"height\\\": 80,\\n                   \\\n                \\                 \\\"show\\\": { \\\"graph\\\": \\\"line\\\", \\\"fill\\\": \\\"fade\\\" },\\n                                    \\\"color_thresholds\\\": [ {\\\"value\\\": 50, \\\"color\\\": \\\"#5FE787\\\"}, {\\\"value\\\": 80, \\\"color\\\": \\\"#FF9800\\\"}, {\\\"value\\\": 90, \\\"color\\\": \\\"#FF535B\\\"} ]\\n                                 },\\n                                 {\\n                                    \\\"type\\\": \\\"custom:mini-graph-card\\\",\\n                                    \\\"entities\\\": [ {\\\"entity\\\": s_mem, \\\"name\\\": \\\"RAM\\\"} ],\\n                                    \\\"line_width\\\": 4, \\\"font_size\\\": 60, \\\"height\\\": 80,\\n                                    \\\"show\\\": { \\\"graph\\\": \\\"line\\\", \\\"fill\\\": \\\"fade\\\" },\\n                                    \\\"color_thresholds\\\": [ {\\\"value\\\": 50, \\\"color\\\": \\\"#5FE787\\\"}, {\\\"value\\\": 80, \\\"color\\\": \\\"#FF9800\\\"}, {\\\"value\\\": 90, \\\"color\\\": \\\"#FF535B\\\"} ]\\n                                 }\\n                              ]\\n                           },\\n               \\\n                \\            {\\n                              \\\"type\\\": \\\"horizontal-stack\\\",\\n                              \\\"cards\\\": [\\n                                 {\\n                                    \\\"type\\\": \\\"custom:apexcharts-card\\\",\\n                                    \\\"chart_type\\\": \\\"donut\\\",\\n                                    \\\"header\\\": { \\\"show\\\": true, \\\"title\\\": \\\"Disk Space\\\", \\\"show_states\\\": false },\\n                                    \\\"series\\\": [\\n                                        { \\\"entity\\\": s_disk_used, \\\"name\\\": \\\"Used\\\", \\\"color\\\": \\\"#FF535B\\\" },\\n                                        { \\\"entity\\\": s_disk_free, \\\"name\\\": \\\"Free\\\", \\\"color\\\": \\\"#5FE787\\\" }\\n                                    ],\\n                                    \\\"donut\\\": { \\\"total\\\": { \\\"show\\\": true, \\\"show_always\\\": true } },\\n                                    \\\"layout\\\": \\\"minimal\\\",\\n                                    \\\"style\\\": \\\"ha-card { height: 100%; }\\\" \\n  \\\n                \\                               },\\n                                 {\\n                                    \\\"type\\\": \\\"custom:mini-graph-card\\\",\\n                                    \\\"entities\\\": [ {\\\"entity\\\": s_net_in, \\\"name\\\": \\\"Net In\\\"}, {\\\"entity\\\": s_net_out, \\\"name\\\": \\\"Net Out\\\", \\\"color\\\": \\\"#00b4f0\\\"} ],\\n                                    \\\"line_width\\\": 2, \\\"height\\\": 130,\\n                                    \\\"show\\\": { \\\"graph\\\": \\\"line\\\", \\\"fill\\\": false, \\\"legend\\\": true }\\n                                 }\\n                              ]\\n                           },\\n                           {\\n                              \\\"type\\\": \\\"grid\\\",\\n                              \\\"columns\\\": 2, \\\"square\\\": false, \\\"title\\\": \\\"Controls\\\",\\n                              \\\"cards\\\": [\\n                                 {\\n                                    \\\"type\\\": \\\"custom:mushroom-entity-card\\\", \\\"entity\\\": b_start, \\\"name\\\": \\\"Start\\\",\\n            \\\n                \\                        \\\"icon\\\": \\\"mdi:play\\\", \\\"icon_color\\\": \\\"green\\\", \\\"layout\\\": \\\"horizontal\\\", \\\"tap_action\\\": {\\\"action\\\": \\\"toggle\\\"}\\n                                 },\\n                                 {\\n                                    \\\"type\\\": \\\"custom:mushroom-entity-card\\\", \\\"entity\\\": b_stop, \\\"name\\\": \\\"Shutdown\\\",\\n                                    \\\"icon\\\": \\\"mdi:power\\\", \\\"icon_color\\\": \\\"red\\\", \\\"layout\\\": \\\"horizontal\\\", \\\"tap_action\\\": {\\\"action\\\": \\\"toggle\\\", \\\"confirmation\\\": {\\\"text\\\": \\\"Graceful Shutdown?\\\"}}\\n                                 },\\n                                 {\\n                                    \\\"type\\\": \\\"custom:mushroom-entity-card\\\", \\\"entity\\\": b_reboot, \\\"name\\\": \\\"Reboot\\\",\\n                                    \\\"icon\\\": \\\"mdi:restart\\\", \\\"icon_color\\\": \\\"orange\\\", \\\"layout\\\": \\\"horizontal\\\", \\\"tap_action\\\": {\\\"action\\\": \\\"toggle\\\", \\\"confirmation\\\": {\\\"text\\\": \\\"Reboot?\\\"}}\\n                               \\\n                \\  },\\n                                 {\\n                                    \\\"type\\\": \\\"custom:mushroom-entity-card\\\", \\\"entity\\\": b_kill, \\\"name\\\": \\\"Kill\\\",\\n                                    \\\"icon\\\": \\\"mdi:stop-circle\\\", \\\"icon_color\\\": \\\"grey\\\", \\\"layout\\\": \\\"horizontal\\\", \\\"tap_action\\\": {\\\"action\\\": \\\"toggle\\\", \\\"confirmation\\\": {\\\"text\\\": \\\"\u26a0\ufe0f Force Kill?\\\"}}\\n                                 }\\n                              ]\\n                           }\\n                        ]\\n                     }\\n                  }\\n               }\\n            }\\n         } %}\\n         {% set ns.cards = ns.cards + [card] %}\\n    {% endif %}\\n  {% endif %}\\n{% endfor %}\\n{{ ns.cards }}\\n\"\n          - type: heading\n            heading: STORAGE\n            heading_style: title\n          - type: custom:auto-entities\n            card:\n              type: custom:bar-card\n              title: Halo Disk Usage\n              height: 40px\n              columns: 1\n              decimal: 0\n              positions:\n                icon: inside\n                name: inside\n                value: inside\n              severity:\n                - color: '#4caf50'\n                  from: 0\n                  to: 75\n                - color: '#ff9800'\n                  from: 75\n                  to: 90\n                - color: '#f44336'\n                  from: 90\n                  to: 100\n            filter:\n              include:\n                - entity_id: '*halo*disk_used_percentage'\n              exclude:\n                - state: unavailable\n        visibility:\n          - condition: state\n            entity: input_select.rack_selected_device\n            state: server-halo\n        title: Proxmox VE - HALO\n      - type: vertical-stack\n        cards:\n          - type: custom:mushroom-title-card\n            title: Rack Power Topology\n          - type: picture\n            image: /local/rack/power-distribution-2.png\n            tap_action:\n              action: fire-dom-event\n              browser_mod:\n                service: browser_mod.popup\n                data:\n                  title: Power Distribution\n                  size: wide\n                  content:\n                    type: picture\n                    image: /local/rack/power-distribution-2.png\n            hold_action:\n              action: none\n        visibility:\n          - condition: state\n            entity: input_select.rack_selected_device\n            state: apc-bubs-850\n      - type: vertical-stack\n        cards:\n          - type: heading\n            heading: EDGE NODE\n            heading_style: title\n          - type: custom:auto-entities\n            card:\n              type: grid\n              columns: 2\n              square: false\n            card_param: cards\n            filter:\n              include:\n                - options:\n                    type: custom:mini-graph-card\n                    entities:\n                      - entity: this.entity_id\n                    name: CPU Load\n                    line_width: 8\n                    font_size: 75\n                    height: 100\n                    show:\n                      fill: fade\n                      extrema: true\n                    color_thresholds:\n                      - value: 50\n                        color: '#5FE787'\n                      - value: 80\n                        color: '#FF9800'\n                      - value: 90\n                        color: '#FF535B'\n                  integration: proxmoxve\n                  entity_id: '*node_edge*cpu_used'\n                - options:\n                    type: custom:mini-graph-card\n                    entities:\n                      - entity: this.entity_id\n                    name: RAM Usage\n                    line_width: 8\n                    font_size: 75\n                    height: 100\n                    show:\n                      fill: fade\n                      extrema: true\n                    color_thresholds:\n                      - value: 60\n                        color: '#5FE787'\n                      - value: 80\n                        color: '#FF9800'\n                      - value: 90\n                        color: '#FF535B'\n                  integration: proxmoxve\n                  entity_id: '*node_edge*memory_used_percentage'\n              exclude:\n                - options: {}\n                  state: unavailable\n          - type: heading\n            heading: CONTROLS\n            heading_style: title\n          - type: grid\n            columns: 2\n            square: false\n            cards:\n              - type: custom:mushroom-entity-card\n                entity: button.node_edge_reboot\n                name: Reboot Node\n                icon: mdi:restart\n                icon_color: orange\n                layout: horizontal\n                tap_action:\n                  action: perform-action\n                  perform_action: button.press\n                  target:\n                    entity_id: button.node_edge_reboot\n                  confirmation:\n                    text: \u26a0\ufe0f Are you sure you want to REBOOT the physical Edge Node?\n              - type: custom:mushroom-entity-card\n                entity: button.node_edge_shutdown\n                name: Shutdown Node\n                icon: mdi:power\n                icon_color: red\n                layout: horizontal\n                tap_action:\n                  action: perform-action\n                  perform_action: button.press\n                  target:\n                    entity_id: button.node_edge_shutdown\n                  confirmation:\n                    text: '\u26d4 DANGER: Are you sure you want to SHUTDOWN the physical Edge Node?'\n              - type: custom:mushroom-entity-card\n                entity: button.node_edge_start_all\n                name: Start All Guests\n                icon: mdi:play-box-multiple-outline\n                icon_color: green\n                layout: horizontal\n                tap_action:\n                  action: perform-action\n                  perform_action: button.press\n                  target:\n                    entity_id: button.node_edge_start_all\n                  confirmation:\n                    text: Start all VMs and Containers on Edge?\n              - type: custom:mushroom-entity-card\n                entity: button.node_edge_stop_all\n                name: Stop All Guests\n                icon: mdi:stop-circle-outline\n                icon_color: orange\n                layout: horizontal\n                tap_action:\n                  action: perform-action\n                  perform_action: button.press\n                  target:\n                    entity_id: button.node_edge_stop_all\n                  confirmation:\n                    text: \u26a0\ufe0f Are you sure you want to STOP ALL guests on Edge?\n          - type: heading\n            heading: UPDATES\n            heading_style: title\n          - type: grid\n            columns: 2\n            square: false\n            cards:\n              - type: custom:mushroom-template-card\n                entity: sensor.node_edge_total_updates\n                primary: Total Updates\n                secondary: '{{ states(entity) }} packages'\n                icon: mdi:package-variant\n                tap_action:\n                  action: more-info\n                color: '{{ ''green'' if states(entity)|int == 0 else ''orange'' }}'\n                vertical: true\n                features_position: bottom\n              - type: custom:mushroom-template-card\n                entity: binary_sensor.node_edge_updates_packages\n                primary: System Status\n                secondary: '{{ ''Up to Date'' if is_state(entity, ''off'') else ''Updates Available'' }}'\n                icon: mdi:update\n                tap_action:\n                  action: more-info\n                color: '{{ ''green'' if is_state(entity, ''off'') else ''orange'' }}'\n                vertical: true\n                features_position: bottom\n          - type: heading\n            heading: EDGE GUESTS\n            heading_style: title\n          - type: custom:auto-entities\n            card:\n              type: grid\n              columns: 1\n              square: false\n            card_param: cards\n            sort:\n              method: name\n            filter:\n              template: \"{% set NODE_NAME = 'Edge' %} \\n{% set ns = namespace(cards=[]) %}\\n\\n{% for state in states.binary_sensor %}\\n  \\n  {# 1. Strict Name Check #}\\n  {% if ('qemu' in state.entity_id or 'lxc' in state.entity_id) and state.entity_id.endswith('_status') %}\\n    \\n    {# 2. Connected Via Check #}\\n    {% set dev_id = device_id(state.entity_id) %}\\n    {% set via_id = device_attr(dev_id, 'via_device_id') if dev_id else none %}\\n    {% set via_name = device_attr(via_id, 'name') if via_id else '' %}\\n    \\n    {% if NODE_NAME | lower in via_name | lower %}\\n    \\n         {# --- 3. CALCULATE IDs --- #}\\n         {% set friendly_name = state.attributes.get('friendly_name', state.entity_id) | replace(' Status', '') %}\\n         {% set base_id = state.entity_id | replace('_status', '') %}\\n         \\n         {# Sensors #}\\n         {% set s_base = base_id | replace('binary_sensor.', 'sensor.') %}\\n         {% set s_cpu = s_base ~ '_cpu_used' %}\\n         {% set s_mem = s_base\\\n                \\ ~ '_memory_used_percentage' %}\\n         {% set s_net_in = s_base ~ '_network_in' %}\\n         {% set s_net_out = s_base ~ '_network_out' %}\\n         {# Disk Sensors #}\\n         {% set s_disk_used = s_base ~ '_disk_used' %}\\n         {% set s_disk_free = s_base ~ '_disk_free' %}\\n         \\n         {# Buttons #}\\n         {% set b_base = base_id | replace('binary_sensor.', 'button.') %}\\n         {% set b_start = b_base ~ '_start' %}\\n         {% set b_stop = b_base ~ '_shutdown' %}\\n         {% set b_reboot = b_base ~ '_reboot' %}\\n         {% set b_kill = b_base ~ '_stop' %}\\n         \\n         {# --- 4. BUILD CARD --- #}\\n         {% set card = {\\n            \\\"type\\\": \\\"custom:mushroom-template-card\\\",\\n            \\\"entity\\\": state.entity_id,\\n            \\\"layout\\\": \\\"horizontal\\\",\\n            \\\"fill_container\\\": true,\\n            \\\"primary\\\": friendly_name,\\n            \\\"secondary\\\": state.state | title,\\n            \\\"icon\\\": 'mdi:cube-outline' if 'lxc' in\\\n                \\ state.entity_id else 'mdi:server',\\n            \\\"icon_color\\\": 'green' if state.state == 'on' else 'red',\\n            \\\"tap_action\\\": {\\n               \\\"action\\\": \\\"fire-dom-event\\\",\\n               \\\"browser_mod\\\": {\\n                  \\\"service\\\": \\\"browser_mod.popup\\\",\\n                  \\\"data\\\": {\\n                     \\\"title\\\": friendly_name,\\n                     \\\"size\\\": \\\"normal\\\",\\n                     \\\"content\\\": {\\n                        \\\"type\\\": \\\"vertical-stack\\\",\\n                        \\\"cards\\\": [\\n                           {\\n                              \\\"type\\\": \\\"horizontal-stack\\\",\\n                              \\\"cards\\\": [\\n                                 {\\n                                    \\\"type\\\": \\\"custom:mini-graph-card\\\",\\n                                    \\\"entities\\\": [ {\\\"entity\\\": s_cpu, \\\"name\\\": \\\"CPU\\\"} ],\\n                                    \\\"line_width\\\": 4, \\\"font_size\\\": 60, \\\"height\\\": 80,\\n                   \\\n                \\                 \\\"show\\\": { \\\"graph\\\": \\\"line\\\", \\\"fill\\\": \\\"fade\\\" },\\n                                    \\\"color_thresholds\\\": [ {\\\"value\\\": 50, \\\"color\\\": \\\"#5FE787\\\"}, {\\\"value\\\": 80, \\\"color\\\": \\\"#FF9800\\\"}, {\\\"value\\\": 90, \\\"color\\\": \\\"#FF535B\\\"} ]\\n                                 },\\n                                 {\\n                                    \\\"type\\\": \\\"custom:mini-graph-card\\\",\\n                                    \\\"entities\\\": [ {\\\"entity\\\": s_mem, \\\"name\\\": \\\"RAM\\\"} ],\\n                                    \\\"line_width\\\": 4, \\\"font_size\\\": 60, \\\"height\\\": 80,\\n                                    \\\"show\\\": { \\\"graph\\\": \\\"line\\\", \\\"fill\\\": \\\"fade\\\" },\\n                                    \\\"color_thresholds\\\": [ {\\\"value\\\": 50, \\\"color\\\": \\\"#5FE787\\\"}, {\\\"value\\\": 80, \\\"color\\\": \\\"#FF9800\\\"}, {\\\"value\\\": 90, \\\"color\\\": \\\"#FF535B\\\"} ]\\n                                 }\\n                              ]\\n                           },\\n               \\\n                \\            {\\n                              \\\"type\\\": \\\"horizontal-stack\\\",\\n                              \\\"cards\\\": [\\n                                 {\\n                                    \\\"type\\\": \\\"custom:apexcharts-card\\\",\\n                                    \\\"chart_type\\\": \\\"donut\\\",\\n                                    \\\"header\\\": { \\\"show\\\": true, \\\"title\\\": \\\"Disk Space\\\", \\\"show_states\\\": false },\\n                                    \\\"series\\\": [\\n                                        { \\\"entity\\\": s_disk_used, \\\"name\\\": \\\"Used\\\", \\\"color\\\": \\\"#FF535B\\\" },\\n                                        { \\\"entity\\\": s_disk_free, \\\"name\\\": \\\"Free\\\", \\\"color\\\": \\\"#5FE787\\\" }\\n                                    ],\\n                                    \\\"donut\\\": { \\\"total\\\": { \\\"show\\\": true, \\\"show_always\\\": true } },\\n                                    \\\"layout\\\": \\\"minimal\\\",\\n                                    \\\"style\\\": \\\"ha-card { height: 100%; }\\\" \\n  \\\n                \\                               },\\n                                 {\\n                                    \\\"type\\\": \\\"custom:mini-graph-card\\\",\\n                                    \\\"entities\\\": [ {\\\"entity\\\": s_net_in, \\\"name\\\": \\\"Net In\\\"}, {\\\"entity\\\": s_net_out, \\\"name\\\": \\\"Net Out\\\", \\\"color\\\": \\\"#00b4f0\\\"} ],\\n                                    \\\"line_width\\\": 2, \\\"height\\\": 130,\\n                                    \\\"show\\\": { \\\"graph\\\": \\\"line\\\", \\\"fill\\\": false, \\\"legend\\\": true }\\n                                 }\\n                              ]\\n                           },\\n                           {\\n                              \\\"type\\\": \\\"grid\\\",\\n                              \\\"columns\\\": 2, \\\"square\\\": false, \\\"title\\\": \\\"Controls\\\",\\n                              \\\"cards\\\": [\\n                                 {\\n                                    \\\"type\\\": \\\"custom:mushroom-entity-card\\\", \\\"entity\\\": b_start, \\\"name\\\": \\\"Start\\\",\\n            \\\n                \\                        \\\"icon\\\": \\\"mdi:play\\\", \\\"icon_color\\\": \\\"green\\\", \\\"layout\\\": \\\"horizontal\\\", \\\"tap_action\\\": {\\\"action\\\": \\\"toggle\\\"}\\n                                 },\\n                                 {\\n                                    \\\"type\\\": \\\"custom:mushroom-entity-card\\\", \\\"entity\\\": b_stop, \\\"name\\\": \\\"Shutdown\\\",\\n                                    \\\"icon\\\": \\\"mdi:power\\\", \\\"icon_color\\\": \\\"red\\\", \\\"layout\\\": \\\"horizontal\\\", \\\"tap_action\\\": {\\\"action\\\": \\\"toggle\\\", \\\"confirmation\\\": {\\\"text\\\": \\\"Graceful Shutdown?\\\"}}\\n                                 },\\n                                 {\\n                                    \\\"type\\\": \\\"custom:mushroom-entity-card\\\", \\\"entity\\\": b_reboot, \\\"name\\\": \\\"Reboot\\\",\\n                                    \\\"icon\\\": \\\"mdi:restart\\\", \\\"icon_color\\\": \\\"orange\\\", \\\"layout\\\": \\\"horizontal\\\", \\\"tap_action\\\": {\\\"action\\\": \\\"toggle\\\", \\\"confirmation\\\": {\\\"text\\\": \\\"Reboot?\\\"}}\\n                               \\\n                \\  },\\n                                 {\\n                                    \\\"type\\\": \\\"custom:mushroom-entity-card\\\", \\\"entity\\\": b_kill, \\\"name\\\": \\\"Kill\\\",\\n                                    \\\"icon\\\": \\\"mdi:stop-circle\\\", \\\"icon_color\\\": \\\"grey\\\", \\\"layout\\\": \\\"horizontal\\\", \\\"tap_action\\\": {\\\"action\\\": \\\"toggle\\\", \\\"confirmation\\\": {\\\"text\\\": \\\"\u26a0\ufe0f Force Kill?\\\"}}\\n                                 }\\n                              ]\\n                           }\\n                        ]\\n                     }\\n                  }\\n               }\\n            }\\n         } %}\\n         {% set ns.cards = ns.cards + [card] %}\\n    {% endif %}\\n  {% endif %}\\n{% endfor %}\\n{{ ns.cards }}\\n\"\n          - type: heading\n            heading: STORAGE\n            heading_style: title\n          - type: custom:auto-entities\n            card:\n              type: custom:bar-card\n              title: Edge Disk Usage\n              height: 40px\n              columns: 1\n              decimal: 0\n              positions:\n                icon: inside\n                name: inside\n                value: inside\n              severity:\n                - color: '#4caf50'\n                  from: 0\n                  to: 75\n                - color: '#ff9800'\n                  from: 75\n                  to: 90\n                - color: '#f44336'\n                  from: 90\n                  to: 100\n            filter:\n              include:\n                - entity_id: '*edge*disk_used_percentage'\n              exclude:\n                - state: unavailable\n        visibility:\n          - condition: state\n            entity: input_select.rack_selected_device\n            state: server-edge\n        title: Proxmox VE - EDGE\n  - type: grid\n    cards:\n      - type: heading\n        heading: UDM Pro\n        heading_style: subtitle\n      - type: picture\n        image: /local/rack/udm_pro2.png\n        tap_action:\n          action: perform-action\n          perform_action: input_select.select_option\n          target:\n            entity_id: input_select.rack_selected_device\n          data:\n            option: udm-pro\n        card_mod:\n          style: \"ha-card {\\n  background: none !important;\\n  box-shadow: none !important;\\n  border-radius: 0px !important;\\n  transition: transform 0.3s ease-in-out, filter 0.3s ease-in-out, border-color 0.3s ease-in-out;\\n  border: 2px solid transparent !important;\\n\\n  /* --- STATE LOGIC --- */\\n  {% if is_state('input_select.rack_selected_device', 'udm-pro') %}\\n    /* SELECTED: Full Size, Bright, Cyan Glow */\\n    transform: scale(1.0);\\n    filter: brightness(1.0) drop-shadow(0 0 8px white);\\n    border-color: white !important;\\n    z-index: 2;\\n  {% else %}\\n    /* NOT SELECTED: Shrunk, Darker */\\n    transform: scale(0.92);\\n    filter: brightness(0.5);\\n    z-index: 1;\\n  {% endif %}\\n}\\n\\n/* --- HOVER LOGIC --- */\\nha-card:hover {\\n  transform: scale(1.0); /* Always pop to full size on hover */\\n  \\n  /* If unselected, brighten slightly on hover so it feels interactive,\\n     but don't make it fully bright (reserved for selection) */\\n  {% if not is_state('input_select.rack_selected_device',\\\n            \\ 'udm-pro') %}\\n    filter: brightness(0.8);\\n  {% endif %}\\n}\\n\"\n      - type: heading\n        heading: USW Aggregation\n        heading_style: subtitle\n      - type: picture\n        image: /local/rack/usw_aggregate.png\n        tap_action:\n          action: perform-action\n          perform_action: input_select.select_option\n          target:\n            entity_id: input_select.rack_selected_device\n          data:\n            option: usw-aggregate\n        card_mod:\n          style: \"ha-card {\\n  background: none !important;\\n  box-shadow: none !important;\\n  border-radius: 0px !important;\\n  transition: transform 0.3s ease-in-out, filter 0.3s ease-in-out, border-color 0.3s ease-in-out;\\n  border: 2px solid transparent !important;\\n\\n  /* --- STATE LOGIC --- */\\n  {% if is_state('input_select.rack_selected_device', 'usw-aggregate') %}\\n    /* SELECTED: Full Size, Bright, Cyan Glow */\\n    transform: scale(1.0);\\n    filter: brightness(1.0) drop-shadow(0 0 8px white);\\n    border-color: white !important;\\n    z-index: 2;\\n  {% else %}\\n    /* NOT SELECTED: Shrunk, Darker */\\n    transform: scale(0.92);\\n    filter: brightness(0.5);\\n    z-index: 1;\\n  {% endif %}\\n}\\n\\n/* --- HOVER LOGIC --- */\\nha-card:hover {\\n  transform: scale(1.0); /* Always pop to full size on hover */\\n  \\n  /* If unselected, brighten slightly on hover so it feels interactive,\\n     but don't make it fully bright (reserved for selection) */\\n  {% if not is_state('input_select.rack_selected_device',\\\n            \\ 'usw-aggregate') %}\\n    filter: brightness(0.8);\\n  {% endif %}\\n}\\n\"\n      - type: heading\n        heading: USW Enterprise 24 PoE\n        heading_style: subtitle\n      - type: picture\n        image: /local/rack/usw_enterprise_24_poe.png\n        tap_action:\n          action: perform-action\n          perform_action: input_select.select_option\n          target:\n            entity_id: input_select.rack_selected_device\n          data:\n            option: usw-enterprise-24-poe\n        card_mod:\n          style: \"ha-card {\\n  background: none !important;\\n  box-shadow: none !important;\\n  border-radius: 0px !important;\\n  transition: transform 0.3s ease-in-out, filter 0.3s ease-in-out, border-color 0.3s ease-in-out;\\n  border: 2px solid transparent !important;\\n\\n  /* --- STATE LOGIC --- */\\n  {% if is_state('input_select.rack_selected_device', 'usw-enterprise-24-poe') %}\\n    /* SELECTED: Full Size, Bright, Cyan Glow */\\n    transform: scale(1.0);\\n    filter: brightness(1.0) drop-shadow(0 0 8px white);\\n    border-color: white !important;\\n    z-index: 2;\\n  {% else %}\\n    /* NOT SELECTED: Shrunk, Darker */\\n    transform: scale(0.92);\\n    filter: brightness(0.5);\\n    z-index: 1;\\n  {% endif %}\\n}\\n\\n/* --- HOVER LOGIC --- */\\nha-card:hover {\\n  transform: scale(1.0); /* Always pop to full size on hover */\\n  \\n  /* If unselected, brighten slightly on hover so it feels interactive,\\n     but don't make it fully bright (reserved for selection) */\\n  {% if not is_state('input_select.rack_selected_device',\\\n            \\ 'usw-enterprise-24-poe') %}\\n    filter: brightness(0.8);\\n  {% endif %}\\n}\\n\"\n      - type: heading\n        heading: Server REACH\n        heading_style: subtitle\n      - type: picture\n        image: /local/rack/server_reach.png\n        tap_action:\n          action: perform-action\n          perform_action: input_select.select_option\n          target:\n            entity_id: input_select.rack_selected_device\n          data:\n            option: server-reach\n        card_mod:\n          style: \"ha-card {\\n  background: none !important;\\n  box-shadow: none !important;\\n  border-radius: 0px !important;\\n  transition: transform 0.3s ease-in-out, filter 0.3s ease-in-out, border-color 0.3s ease-in-out;\\n  border: 2px solid transparent !important;\\n\\n  /* --- STATE LOGIC --- */\\n  {% if is_state('input_select.rack_selected_device', 'server-reach') %}\\n    /* SELECTED: Full Size, Bright, Cyan Glow */\\n    transform: scale(1.0);\\n    filter: brightness(1.0) drop-shadow(0 0 8px white);\\n    border-color: white !important;\\n    z-index: 2;\\n  {% else %}\\n    /* NOT SELECTED: Shrunk, Darker */\\n    transform: scale(0.92);\\n    filter: brightness(0.5);\\n    z-index: 1;\\n  {% endif %}\\n}\\n\\n/* --- HOVER LOGIC --- */\\nha-card:hover {\\n  transform: scale(1.0); /* Always pop to full size on hover */\\n  \\n  /* If unselected, brighten slightly on hover so it feels interactive,\\n     but don't make it fully bright (reserved for selection) */\\n  {% if not is_state('input_select.rack_selected_device',\\\n            \\ 'server-reach') %}\\n    filter: brightness(0.8);\\n  {% endif %}\\n}\\n\"\n      - type: heading\n        heading: Server HALO\n        heading_style: subtitle\n      - type: picture\n        image: /local/rack/server_halo.png?new=1\n        tap_action:\n          action: perform-action\n          perform_action: input_select.select_option\n          target:\n            entity_id: input_select.rack_selected_device\n          data:\n            option: server-halo\n        card_mod:\n          style: \"ha-card {\\n  background: none !important;\\n  box-shadow: none !important;\\n  border-radius: 0px !important;\\n  transition: transform 0.3s ease-in-out, filter 0.3s ease-in-out, border-color 0.3s ease-in-out;\\n  border: 2px solid transparent !important;\\n\\n  /* --- STATE LOGIC --- */\\n  {% if is_state('input_select.rack_selected_device', 'server-halo') %}\\n    /* SELECTED: Full Size, Bright, Cyan Glow */\\n    transform: scale(1.0);\\n    filter: brightness(1.0) drop-shadow(0 0 8px white);\\n    border-color: white !important;\\n    z-index: 2;\\n  {% else %}\\n    /* NOT SELECTED: Shrunk, Darker */\\n    transform: scale(0.90);\\n    filter: brightness(0.5);\\n    z-index: 1;\\n  {% endif %}\\n}\\n\\n/* --- HOVER LOGIC --- */\\nha-card:hover {\\n  transform: scale(1.0); /* Always pop to full size on hover */\\n  \\n  /* If unselected, brighten slightly on hover so it feels interactive,\\n     but don't make it fully bright (reserved for selection) */\\n  {% if not is_state('input_select.rack_selected_device',\\\n            \\ 'server-halo') %}\\n    filter: brightness(0.8);\\n  {% endif %}\\n}\\n\"\n      - type: heading\n        heading: Server EDGE\n        heading_style: subtitle\n        grid_options:\n          columns: 6\n      - type: heading\n        heading: Pi 62\n        heading_style: subtitle\n        grid_options:\n          columns: 3\n      - type: heading\n        heading: Pi 63\n        heading_style: subtitle\n        grid_options:\n          columns: 3\n      - type: picture\n        image: /local/rack/server_edge.png?new=1\n        tap_action:\n          action: perform-action\n          perform_action: input_select.select_option\n          target:\n            entity_id: input_select.rack_selected_device\n          data:\n            option: server-edge\n        card_mod:\n          style: \"ha-card {\\n  background: none !important;\\n  box-shadow: none !important;\\n  border-radius: 0px !important;\\n  transition: transform 0.3s ease-in-out, filter 0.3s ease-in-out, border-color 0.3s ease-in-out;\\n  border: 2px solid transparent !important;\\n\\n  /* --- STATE LOGIC --- */\\n  {% if is_state('input_select.rack_selected_device', 'server-edge') %}\\n    /* SELECTED: Full Size, Bright, Cyan Glow */\\n    transform: scale(1.0);\\n    filter: brightness(1.0) drop-shadow(0 0 8px white);\\n    border-color: white !important;\\n    z-index: 2;\\n  {% else %}\\n    /* NOT SELECTED: Shrunk, Darker */\\n    transform: scale(0.90);\\n    filter: brightness(0.5);\\n    z-index: 1;\\n  {% endif %}\\n}\\n\\n/* --- HOVER LOGIC --- */\\nha-card:hover {\\n  transform: scale(1.0); /* Always pop to full size on hover */\\n  \\n  /* If unselected, brighten slightly on hover so it feels interactive,\\n     but don't make it fully bright (reserved for selection) */\\n  {% if not is_state('input_select.rack_selected_device',\\\n            \\ 'server-edge') %}\\n    filter: brightness(0.8);\\n  {% endif %}\\n}\\n\"\n        grid_options:\n          columns: 6\n      - type: picture\n        image: /local/rack/pi5-side.png?\n        tap_action:\n          action: perform-action\n          perform_action: input_select.select_option\n          target:\n            entity_id: input_select.rack_selected_device\n          data:\n            option: pi5-62\n        card_mod:\n          style: \"ha-card {\\n  background: none !important;\\n  box-shadow: none !important;\\n  border-radius: 0px !important;\\n  transition: transform 0.3s ease-in-out, filter 0.3s ease-in-out, border-color 0.3s ease-in-out;\\n  border: 2px solid transparent !important;\\n  \\n  /* 1. Force the card container to fill the grid cell height */\\n  height: 100% !important;\\n\\n  /* --- STATE LOGIC --- */\\n  {% if is_state('input_select.rack_selected_device', 'pi5-62') %}\\n    transform: scale(1.0);\\n    filter: brightness(1.0) drop-shadow(0 0 8px white);\\n    border-color: white !important;\\n    z-index: 2;\\n  {% else %}\\n    transform: scale(0.90);\\n    filter: brightness(0.5);\\n    z-index: 1;\\n  {% endif %}\\n}\\n\\n/* --- HOVER LOGIC --- */\\nha-card:hover {\\n  transform: scale(1.0);\\n  {% if not is_state('input_select.rack_selected_device', 'pi5-62') %}\\n    filter: brightness(0.8);\\n  {% endif %}\\n}\\n\\n/* 2. FORCE IMAGE TO FILL &amp; CLIP */\\n/* This targets the &lt;img&gt; tag inside the card */\\nimg {\\n\\\n            \\  object-fit: cover !important;\\n  object-position: right center !important;  /* &lt;--- CHANGED HERE */\\n  height: 100% !important;\\n  width: 100% !important;\\n}\\n\"\n        grid_options:\n          columns: 3\n      - type: picture\n        image: /local/rack/pi5-side.png?\n        tap_action:\n          action: perform-action\n          perform_action: input_select.select_option\n          target:\n            entity_id: input_select.rack_selected_device\n          data:\n            option: pi5-63\n        card_mod:\n          style: \"ha-card {\\n  background: none !important;\\n  box-shadow: none !important;\\n  border-radius: 0px !important;\\n  transition: transform 0.3s ease-in-out, filter 0.3s ease-in-out, border-color 0.3s ease-in-out;\\n  border: 2px solid transparent !important;\\n  \\n  /* 1. Force the card container to fill the grid cell height */\\n  height: 100% !important;\\n\\n  /* --- STATE LOGIC --- */\\n  {% if is_state('input_select.rack_selected_device', 'pi5-63') %}\\n    transform: scale(1.0);\\n    filter: brightness(1.0) drop-shadow(0 0 8px white);\\n    border-color: white !important;\\n    z-index: 2;\\n  {% else %}\\n    transform: scale(0.90);\\n    filter: brightness(0.5);\\n    z-index: 1;\\n  {% endif %}\\n}\\n\\n/* --- HOVER LOGIC --- */\\nha-card:hover {\\n  transform: scale(1.0);\\n  {% if not is_state('input_select.rack_selected_device', 'pi5-63') %}\\n    filter: brightness(0.8);\\n  {% endif %}\\n}\\n\\n/* 2. FORCE IMAGE TO FILL &amp; CLIP */\\n/* This targets the &lt;img&gt; tag inside the card */\\nimg {\\n\\\n            \\  object-fit: cover !important;\\n  object-position: right center !important;  /* &lt;--- CHANGED HERE */\\n  height: 100% !important;\\n  width: 100% !important;\\n}\\n\"\n        grid_options:\n          columns: 3\n      - type: heading\n        heading: APC 850\n        heading_style: subtitle\n      - type: picture\n        image: /local/rack/apc_bubs_850.png\n        tap_action:\n          action: perform-action\n          perform_action: input_select.select_option\n          target:\n            entity_id: input_select.rack_selected_device\n          data:\n            option: apc-bubs-850\n        card_mod:\n          style: \"ha-card {\\n  background: none !important;\\n  box-shadow: none !important;\\n  border-radius: 0px !important;\\n  transition: transform 0.3s ease-in-out, filter 0.3s ease-in-out, border-color 0.3s ease-in-out;\\n  border: 2px solid transparent !important;\\n\\n  /* --- STATE LOGIC --- */\\n  {% if is_state('input_select.rack_selected_device', 'apc-bubs-850') %}\\n    /* SELECTED: Full Size, Bright, Cyan Glow */\\n    transform: scale(1.0);\\n    filter: brightness(1.0) drop-shadow(0 0 8px white);\\n    border-color: white !important;\\n    z-index: 2;\\n  {% else %}\\n    /* NOT SELECTED: Shrunk, Darker */\\n    transform: scale(0.90);\\n    filter: brightness(0.5);\\n    z-index: 1;\\n  {% endif %}\\n}\\n\\n/* --- HOVER LOGIC --- */\\nha-card:hover {\\n  transform: scale(1.0); /* Always pop to full size on hover */\\n  \\n  /* If unselected, brighten slightly on hover so it feels interactive,\\n     but don't make it fully bright (reserved for selection) */\\n  {% if not is_state('input_select.rack_selected_device',\\\n            \\ 'apc-bubs-850') %}\\n    filter: brightness(0.8);\\n  {% endif %}\\n}\\n\"\n  - type: grid\n    cards:\n      - type: vertical-stack\n        title: UNIFI DREAM MACHINE PRO\n        cards:\n          - type: heading\n            heading: SYSTEM\n            heading_style: title\n          - type: grid\n            cards:\n              - type: custom:mini-graph-card\n                entities:\n                  - entity: sensor.unifi_dream_machine_pro_cpu_temperature\n                    name: Temp\n                font_size_header: 12\n                font_size: 75\n                line_width: 8\n                height: 200\n                animate: true\n                hours_to_show: 24\n                show:\n                  points: false\n                color_thresholds:\n                  - value: 45\n                    color: '#5FE787'\n                  - value: 55\n                    color: '#FF9800'\n                  - value: 65\n                    color: '#FF535B'\n                card_mod:\n                  style: |\n                    .header.flex .icon {\n                    {% set sensor = states('sensor.unifi_dream_machine_pro_cpu_temperature')|float %}\n                      {% if sensor &gt; 65 %}\n                        color: red;\n                      {% elif sensor &gt; 55  %}\n                        color: orange;\n                      {% else  %}\n                        color: lightgreen;\n                      {% endif %} }\n                    ha-card {\n                      {% if sensor &gt; 65 %}\n                        --ha-card-background: rgba(255, 83, 91,0.05);\n                      {% elif sensor &gt; 55  %}\n                        --ha-card-background: rgba(255, 152, 0,0.05);\n                      {% else  %}\n                        --ha-card-background: rgba(95, 231, 135,0.05);\n                      {% endif %} }\n                    }\n              - type: custom:mini-graph-card\n                entities:\n                  - entity: sensor.unifi_dream_machine_pro_memory_utilization\n                    name: MEM\n                font_size_header: 12\n                font_size: 75\n                line_width: 8\n                height: 200\n                animate: true\n                hours_to_show: 24\n                decimals: 0\n                show:\n                  points: false\n                color_thresholds:\n                  - value: 70\n                    color: '#5FE787'\n                  - value: 80\n                    color: '#FF9800'\n                  - value: 90\n                    color: '#FF535B'\n                card_mod:\n                  style: |\n                    .header.flex .icon {\n                    {% set sensor = states('sensor.unifi_dream_machine_pro_memory_utilization')|float %}\n                      {% if sensor &gt; 90 %}\n                        color: red;\n                      {% elif sensor &gt; 75  %}\n                        color: orange;\n                      {% else  %}\n                        color: lightgreen;\n                      {% endif %} }\n                    ha-card {\n                      {% if sensor &gt; 90 %}\n                        --ha-card-background: rgba(255, 83, 91,0.05);\n                      {% elif sensor &gt; 75  %}\n                        --ha-card-background: rgba(255, 152, 0,0.05);\n                      {% else  %}\n                        --ha-card-background: rgba(95, 231, 135,0.05);\n                      {% endif %} }\n                    }\n              - type: custom:mini-graph-card\n                entities:\n                  - entity: sensor.unifi_dream_machine_pro_cpu_utilization\n                    name: CPU\n                font_size_header: 12\n                font_size: 75\n                line_width: 8\n                height: 200\n                animate: true\n                hours_to_show: 24\n                decimals: 0\n                show:\n                  points: false\n                color_thresholds:\n                  - value: 25\n                    color: '#5FE787'\n                  - value: 50\n                    color: '#FF9800'\n                  - value: 75\n                    color: '#FF535B'\n                card_mod:\n                  style: |\n                    .header.flex .icon {\n                    {% set sensor = states('sensor.unifi_dream_machine_pro_cpu_utilization')|float %}\n                      {% if sensor &gt; 75 %}\n                        color: red;\n                      {% elif sensor &gt; 50  %}\n                        color: orange;\n                      {% else  %}\n                        color: lightgreen;\n                      {% endif %} }\n                    ha-card {\n                      {% if sensor &gt; 75 %}\n                        --ha-card-background: rgba(255, 83, 91,0.05);\n                      {% elif sensor &gt; 50  %}\n                        --ha-card-background: rgba(255, 152, 0,0.05);\n                      {% else  %}\n                        --ha-card-background: rgba(95, 231, 135,0.05);\n                      {% endif %} }\n                    }\n          - square: false\n            type: grid\n            cards:\n              - type: heading\n                heading: HARD DRIVE\n                heading_style: title\n              - type: heading\n                heading: UPDATES\n                heading_style: title\n              - type: custom:mushroom-template-card\n                entity: binary_sensor.unifi_dream_machine_pro_hdd_1\n                primary: HDD\n                secondary: '{{ ''OK'' if is_state(entity, ''off'') else ''Problem Detected'' }}'\n                icon: mdi:harddisk\n                color: '{{ ''red'' if is_state(entity, ''on'') else ''green'' }}'\n                features_position: bottom\n                vertical: true\n              - type: custom:mushroom-update-card\n                entity: update.unifi_dream_machine_pro\n                fill_container: true\n                layout: vertical\n                name: Updates\n            columns: 2\n          - type: heading\n            heading: WAN\n            heading_style: title\n          - type: entities\n            entities:\n              - entity: binary_sensor.unifi_dream_machine_wan_status\n                icon: mdi:wan\n                card_mod:\n                  style: |\n                    :host {\n                      --card-mod-icon-color: {{ 'lightgreen' if states(config.entity) == 'on' else 'red' }};\n                    }\n              - entity: sensor.unifi_dream_machine_external_ip\n                icon: mdi:ip-outline\n                card_mod:\n                  style: \":host {\\n  --card-mod-icon-color:lightgreen; \\n}\\n\"\n              - entity: sensor.unifi_google_wan_latency\n                name: UDM Pro - WAN 1\n                icon: mdi:pulse\n                card_mod:\n                  style: \":host {\\n  --card-mod-icon-color: \\n    {% set latency = states(config.entity)|float(0) %}\\n    {% if latency == 0 %} \\n      red\\n    {% elif latency &lt;= 15 %} \\n      lightgreen\\n    {% else %} \\n      orange\\n    {% endif %};\\n}\\n\"\n              - entity: sensor.unifi_google_wan2_latency\n                name: UDM Pro - WAN 2\n                icon: mdi:pulse\n                card_mod:\n                  style: \":host {\\n  --card-mod-icon-color: \\n    {% set latency = states(config.entity)|float(0) %}\\n    {% if latency == 0 %} \\n      red\\n    {% elif latency &lt;= 15 %} \\n      lightgreen\\n    {% else %} \\n      orange\\n    {% endif %};\\n}\\n\"\n          - type: custom:mini-graph-card\n            icon: mdi:web\n            height: 30\n            hours_to_show: 24\n            points_per_hour: 5\n            line_width: 2\n            font_size_header: 10\n            font_size: 75\n            decimals: 0\n            show:\n              fill: fade\n              extrema: false\n              name: true\n              icon: true\n              points: false\n            entities:\n              - entity: sensor.unifi_google_wan2_latency\n                name: WAN Latency\n                label: test\n                show_state: true\n                unit: ms\n            color_thresholds:\n              - value: 10\n                color: '#5FE787'\n              - value: 15\n                color: '#FF9800'\n              - value: 20\n                color: '#FF535B'\n            card_mod:\n              style: |\n                .header.flex .icon { {% set sensor = states('sensor.unifi_google_wan2_latency')|float %}\n                  {% if sensor &gt; 65 %}\n                    color: red;\n                  {% elif sensor &gt; 55  %}\n                    color: orange;\n                  {% else  %}\n                    color: lightgreen;\n                  {% endif %} }\n                ha-card {\n                  {% if sensor &gt; 20 %}\n                    --ha-card-background: rgba(255, 83, 91,0.05);\n                  {% elif sensor &gt; 15  %}\n                    --ha-card-background: rgba(255, 152, 0,0.05);\n                  {% else  %}\n                    --ha-card-background: rgba(95, 231, 135,0.05);\n                  {% endif %} }\n                }\n          - type: heading\n            heading: NETWORKS\n            heading_style: title\n          - type: custom:auto-entities\n            card:\n              type: grid\n              columns: 3\n              square: false\n            card_param: cards\n            sort:\n              method: name\n            filter:\n              include:\n                - options:\n                    type: custom:mushroom-template-card\n                    primary: \"{% set name = state_attr(config.entity, \\\"friendly_name\\\") %}\\n\\n{{ name }} \"\n                    secondary: |-\n                      {% set client_sensor_id = config.entity.replace(\"switch.\", \"sensor.\") %} {% set clients = states(client_sensor_id) %}\n                      {% set clients = clients | replace(\"unavailable\", \"No\") %}\n                      {% set clients = clients | replace(\"unknown\", \"No\") %}\n                      {{ clients }} clients\n                    icon: mdi:qrcode-scan\n                    icon_color: |-\n                      {% set state = states(config.entity) %}\n                      {% if state == \"on\" %}\n                        green\n                      {% else %}\n                        red\n                      {% endif %}\n                    layout: vertical\n                    multiline_secondary: false\n                    tap_action:\n                      action: fire-dom-event\n                      browser_mod:\n                        service: browser_mod.popup\n                        data:\n                          title: ' '\n                          content:\n                            type: vertical-stack\n                            cards:\n                              - type: custom:hui-element\n                                card_type: markdown\n                                card_mod:\n                                  style: |\n                                    ha-card {\n                                      background: none !important;\n                                      border: none !important;\n                                      box-shadow: none !important;\n                                      padding: 0px !important;\n                                    }\n                                content: |-\n                                  {# 1. Auto-entities replaces 'this.entity_id' with the actual switch ID #} {% set switch_id = 'this.entity_id' %}\n                                  {# 2. Calculate the QR Image ID #} {% set qr_id = switch_id | replace('switch.', 'image.') + '_qr_code' %}\n                                  ### &lt;center&gt;Scan Network QR&lt;/center&gt;\n                                  {# 3. Check if image exists and show it #} {% set img_url = state_attr(qr_id, 'entity_picture') %}\n                                  {% if img_url %}\n                                    &lt;center&gt;\n                                      &lt;img src=\"{{ img_url }}\" style=\"width: 100%; border-radius: 12px;\"&gt;\n                                    &lt;/center&gt;\n                                  {% else %}\n                                    &lt;center&gt;\n                                      &lt;font color=\"orange\"&gt;\n                                        &lt;ha-icon icon=\"mdi:image-broken\"&gt;&lt;/ha-icon&gt;&lt;br&gt;\n                                        &lt;b&gt;No QR image available&lt;/b&gt;\n                                      &lt;/font&gt;&lt;br&gt;\n                                      &lt;small&gt;`{{ qr_id }}`&lt;/small&gt;\n                                    &lt;/center&gt;\n                                  {% endif %}\n                              - type: entities\n                                entities:\n                                  - entity: this.entity_id\n                                    icon: mdi:wifi\n                  integration: unifi\n                  area: Home\n                  domain: switch\n              exclude:\n                - options: {}\n                  state: unavailable\n        visibility:\n          - condition: state\n            entity: input_select.rack_selected_device\n            state: udm-pro\n      - type: vertical-stack\n        title: USW AGGREGATION\n        cards:\n          - type: heading\n            heading: SYSTEM\n            heading_style: title\n          - square: false\n            type: grid\n            cards:\n              - type: custom:mini-graph-card\n                entities:\n                  - entity: sensor.usw_aggregation_memory_utilization\n                    name: MEM\n                font_size_header: 12\n                font_size: 75\n                line_width: 8\n                height: 200\n                animate: true\n                hours_to_show: 24\n                decimals: 0\n                show:\n                  points: false\n                color_thresholds:\n                  - value: 70\n                    color: '#5FE787'\n                  - value: 80\n                    color: '#FF9800'\n                  - value: 90\n                    color: '#FF535B'\n                card_mod:\n                  style: |\n                    .header.flex .icon {\n                    {% set sensor = states('sensor.unifi_dream_machine_pro_memory_utilization')|float %}\n                      {% if sensor &gt; 90 %}\n                        color: red;\n                      {% elif sensor &gt; 75  %}\n                        color: orange;\n                      {% else  %}\n                        color: lightgreen;\n                      {% endif %} }\n                    ha-card {\n                      {% if sensor &gt; 90 %}\n                        --ha-card-background: rgba(255, 83, 91,0.05);\n                      {% elif sensor &gt; 75  %}\n                        --ha-card-background: rgba(255, 152, 0,0.05);\n                      {% else  %}\n                        --ha-card-background: rgba(95, 231, 135,0.05);\n                      {% endif %} }\n                    }\n              - type: custom:mini-graph-card\n                entities:\n                  - entity: sensor.usw_aggregation_cpu_utilization\n                    name: CPU\n                font_size_header: 12\n                font_size: 75\n                line_width: 8\n                height: 200\n                animate: true\n                hours_to_show: 24\n                decimals: 0\n                show:\n                  points: false\n                color_thresholds:\n                  - value: 25\n                    color: '#5FE787'\n                  - value: 50\n                    color: '#FF9800'\n                  - value: 75\n                    color: '#FF535B'\n                card_mod:\n                  style: |\n                    .header.flex .icon {\n                    {% set sensor = states('sensor.unifi_dream_machine_pro_cpu_utilization')|float %}\n                      {% if sensor &gt; 75 %}\n                        color: red;\n                      {% elif sensor &gt; 50  %}\n                        color: orange;\n                      {% else  %}\n                        color: lightgreen;\n                      {% endif %} }\n                    ha-card {\n                      {% if sensor &gt; 75 %}\n                        --ha-card-background: rgba(255, 83, 91,0.05);\n                      {% elif sensor &gt; 50  %}\n                        --ha-card-background: rgba(255, 152, 0,0.05);\n                      {% else  %}\n                        --ha-card-background: rgba(95, 231, 135,0.05);\n                      {% endif %} }\n                    }\n            columns: 2\n          - type: heading\n            heading: UPDATES\n            heading_style: title\n          - type: custom:mushroom-update-card\n            entity: update.usw_aggregation\n            fill_container: true\n            layout: vertical\n            name: Updates\n          - type: heading\n            heading: PORTS\n            heading_style: title\n          - type: custom:auto-entities\n            card:\n              type: grid\n              columns: 4\n              square: false\n            card_param: cards\n            sort:\n              method: name\n            filter:\n              include:\n                - entity_id: switch.usw_aggregation*\n                  options:\n                    type: custom:mushroom-template-card\n                    entity: this.entity_id\n                    layout: vertical\n                    fill_container: true\n                    primary: |-\n                      {% set name = state_attr(config.entity, \"friendly_name\") %}\n                      {% set name = name | replace(\"USW Aggregation \", \"\") %}\n                      {{ name[:6] }}\n                    secondary: '{{ states(config.entity) | title }}'\n                    icon: mdi:ethernet\n                    icon_color: |-\n                      {% if states(config.entity) == 'on' %}\n                        green\n                      {% else %}\n                        red\n                      {% endif %}\n        visibility:\n          - condition: state\n            entity: input_select.rack_selected_device\n            state: usw-aggregate\n      - type: vertical-stack\n        cards:\n          - type: heading\n            heading: USW Enterprise 24 PoE\n            heading_style: title\n          - type: grid\n            cards:\n              - type: custom:mini-graph-card\n                entities:\n                  - entity: sensor.unifi_switch_enterprise_memory_utilization\n                    name: MEM\n                font_size_header: 12\n                font_size: 75\n                line_width: 8\n                height: 200\n                animate: true\n                hours_to_show: 24\n                decimals: 0\n                show:\n                  points: false\n                color_thresholds:\n                  - value: 70\n                    color: '#5FE787'\n                  - value: 80\n                    color: '#FF9800'\n                  - value: 90\n                    color: '#FF535B'\n                card_mod:\n                  style: |\n                    .header.flex .icon {\n                    {% set sensor = states('sensor.unifi_dream_machine_pro_memory_utilization')|float %}\n                      {% if sensor &gt; 90 %}\n                        color: red;\n                      {% elif sensor &gt; 75  %}\n                        color: orange;\n                      {% else  %}\n                        color: lightgreen;\n                      {% endif %} }\n                    ha-card {\n                      {% if sensor &gt; 90 %}\n                        --ha-card-background: rgba(255, 83, 91,0.05);\n                      {% elif sensor &gt; 75  %}\n                        --ha-card-background: rgba(255, 152, 0,0.05);\n                      {% else  %}\n                        --ha-card-background: rgba(95, 231, 135,0.05);\n                      {% endif %} }\n                    }\n              - type: custom:mini-graph-card\n                entities:\n                  - entity: sensor.unifi_switch_enterprise_cpu_utilization\n                    name: CPU\n                font_size_header: 12\n                font_size: 75\n                line_width: 8\n                height: 200\n                animate: true\n                hours_to_show: 24\n                decimals: 0\n                show:\n                  points: false\n                color_thresholds:\n                  - value: 25\n                    color: '#5FE787'\n                  - value: 50\n                    color: '#FF9800'\n                  - value: 75\n                    color: '#FF535B'\n                card_mod:\n                  style: |\n                    .header.flex .icon {\n                    {% set sensor = states('sensor.unifi_dream_machine_pro_cpu_utilization')|float %}\n                      {% if sensor &gt; 75 %}\n                        color: red;\n                      {% elif sensor &gt; 50  %}\n                        color: orange;\n                      {% else  %}\n                        color: lightgreen;\n                      {% endif %} }\n                    ha-card {\n                      {% if sensor &gt; 75 %}\n                        --ha-card-background: rgba(255, 83, 91,0.05);\n                      {% elif sensor &gt; 50  %}\n                        --ha-card-background: rgba(255, 152, 0,0.05);\n                      {% else  %}\n                        --ha-card-background: rgba(95, 231, 135,0.05);\n                      {% endif %} }\n                    }\n              - type: custom:mini-graph-card\n                entities:\n                  - entity: sensor.unifi_switch_enterprise_temperature\n                    name: Temp\n                font_size_header: 12\n                font_size: 75\n                line_width: 8\n                height: 200\n                animate: true\n                hours_to_show: 24\n                show:\n                  points: false\n                color_thresholds:\n                  - value: 45\n                    color: '#5FE787'\n                  - value: 55\n                    color: '#FF9800'\n                  - value: 65\n                    color: '#FF535B'\n                card_mod:\n                  style: |\n                    .header.flex .icon {\n                    {% set sensor = states('sensor.unifi_dream_machine_pro_cpu_temperature')|float %}\n                      {% if sensor &gt; 65 %}\n                        color: red;\n                      {% elif sensor &gt; 55  %}\n                        color: orange;\n                      {% else  %}\n                        color: lightgreen;\n                      {% endif %} }\n                    ha-card {\n                      {% if sensor &gt; 65 %}\n                        --ha-card-background: rgba(255, 83, 91,0.05);\n                      {% elif sensor &gt; 55  %}\n                        --ha-card-background: rgba(255, 152, 0,0.05);\n                      {% else  %}\n                        --ha-card-background: rgba(95, 231, 135,0.05);\n                      {% endif %} }\n                    }\n          - type: heading\n            heading: UPDATES\n            heading_style: title\n          - type: custom:mushroom-update-card\n            entity: update.usw_aggregation\n            fill_container: true\n            layout: vertical\n            name: Updates\n          - type: heading\n            heading: PORTS\n            heading_style: subtitle\n          - type: custom:auto-entities\n            card:\n              type: grid\n              columns: 6\n              square: false\n            card_param: cards\n            sort:\n              method: name\n            filter:\n              include:\n                - entity_id: sensor.unifi_switch_enterprise*poe*\n                  options:\n                    type: custom:mushroom-template-card\n                    primary: |-\n                      {% set name = state_attr(config.entity, \"friendly_name\") %}\n                      {% set name = name | replace(\"UniFi Switch Enterprise \", \"\") %}\n                      {% set port = name[:2] %}\n                      {{ port }}\n                    secondary: |-\n                      {% set name = state_attr(config.entity, \"friendly_name\") %}\n                      {% set name = name | replace(\"UniFi Switch Enterprise \", \"\") %}\n                      {% set name = name | replace(\"PoE\", \"\") %}\n                      {% set name = name | replace(\"Power\", \"\") %}\n                      {% set name = name[5:100] %}\n                      {% if name != \"\" %}\n                        {{ name }}\n                      {% else %}\n                        Port\n                      {% endif %}\n                    icon: mdi:ethernet\n                    icon_color: |-\n                      {% set poe_id = config.entity.replace(\"sensor.\", \"switch.\") %}\n                      {% set poe_id = poe_id | replace(\"_power\", \"\") %}\n                      {% set poe = states(poe_id) %}\n                      {% if poe == \"on\" %}\n                        green\n                      {% else %}\n                        red\n                      {% endif %}\n                    layout: vertical\n                    multiline_secondary: false\n                    fill_container: true\n                    card_mod:\n                      style: |\n                        ha-card {\n                          {% set power = states(config.entity)|float(0) %}\n                          {% if power &gt; 10 %}\n                            background-color: rgba(153, 255, 102, 0.3);\n                          {% elif power &gt; 5 %}\n                            background-color: rgba(153, 255, 102, 0.2);\n                          {% elif power &gt; 0 %}\n                            background-color: rgba(153, 255, 102, 0.1);\n                          {% endif %}\n                    tap_action:\n                      action: fire-dom-event\n                      browser_mod:\n                        service: browser_mod.popup\n                        data:\n                          title: Port\n                          content:\n                            type: vertical-stack\n                            cards:\n                              - type: history-graph\n                                entities:\n                                  - entity: this.entity_id\n                              - type: entities\n                                entities:\n                                  - entity: this.entity_id\n                                    name: Current Power Usage\n                              - type: custom:button-card\n                                entity: |\n                                  [[[\n                                    var new_id = 'this.entity_id'.replace(\"sensor.\", \"switch.\");\n                                    new_id = new_id.replace(\"_power\", \"\")\n                                    return new_id\n                                  ]]]\n                                name: Port PoE Switch\n                                layout: icon_name\n                                show_state: true\n                                tap_action:\n                                  action: toggle\n                                  confirmation:\n                                    text: Switching Port PoE Power will take a short time to take an effect\n                                state:\n                                  - value: 'on'\n                                    styles:\n                                      icon:\n                                        - color: lightgreen\n                                  - value: 'off'\n                                    styles:\n                                      icon:\n                                        - color: red\n                                styles:\n                                  name:\n                                    - position: absolute\n                                    - left: 74px\n                                    - margin: 0px\n                                    - padding: 0px\n                                    - font-size: 14px\n                                  state:\n                                    - position: absolute\n                                    - right: 20px\n                                    - margin: 0px\n                                    - padding: 0px\n                                    - font-size: 14px\n                                  icon:\n                                    - position: absolute\n                                    - left: 15px\n                                    - margin: 0px\n                                    - padding: 0px\n                                    - width: 40px\n                                    - height: 25px\n                                  card:\n                                    - height: 60px\n                                    - margin: 0px\n                                    - padding: 0px\n        visibility:\n          - condition: state\n            entity: input_select.rack_selected_device\n            state: usw-enterprise-24-poe\n      - type: vertical-stack\n        title: IPMI - SERVER HALO\n        cards:\n          - type: heading\n            heading: SYSTEM TEMPERATURES\n            heading_style: title\n          - type: grid\n            cards:\n              - type: custom:mini-graph-card\n                entities:\n                  - entity: sensor.halo_server_cpu1_temp\n                    name: CPU Temp\n                font_size_header: 12\n                font_size: 75\n                line_width: 8\n                height: 200\n                animate: true\n                hours_to_show: 24\n                show:\n                  points: false\n                color_thresholds:\n                  - value: 45\n                    color: '#5FE787'\n                  - value: 55\n                    color: '#FF9800'\n                  - value: 65\n                    color: '#FF535B'\n                card_mod:\n                  style: |\n                    .header.flex .icon {\n                    {% set sensor = states('sensor.unifi_dream_machine_pro_cpu_temperature')|float %}\n                      {% if sensor &gt; 65 %}\n                        color: red;\n                      {% elif sensor &gt; 55  %}\n                        color: orange;\n                      {% else  %}\n                        color: lightgreen;\n                      {% endif %} }\n                    ha-card {\n                      {% if sensor &gt; 65 %}\n                        --ha-card-background: rgba(255, 83, 91,0.05);\n                      {% elif sensor &gt; 55  %}\n                        --ha-card-background: rgba(255, 152, 0,0.05);\n                      {% else  %}\n                        --ha-card-background: rgba(95, 231, 135,0.05);\n                      {% endif %} }\n                    }\n              - type: custom:mini-graph-card\n                entities:\n                  - entity: sensor.halo_server_mb_temp\n                    name: MB\n                font_size_header: 12\n                font_size: 75\n                line_width: 8\n                height: 200\n                animate: true\n                hours_to_show: 24\n                decimals: 0\n                show:\n                  points: false\n                color_thresholds:\n                  - value: 70\n                    color: '#5FE787'\n                  - value: 80\n                    color: '#FF9800'\n                  - value: 90\n                    color: '#FF535B'\n                card_mod:\n                  style: |\n                    .header.flex .icon {\n                    {% set sensor = states('sensor.unifi_dream_machine_pro_memory_utilization')|float %}\n                      {% if sensor &gt; 90 %}\n                        color: red;\n                      {% elif sensor &gt; 75  %}\n                        color: orange;\n                      {% else  %}\n                        color: lightgreen;\n                      {% endif %} }\n                    ha-card {\n                      {% if sensor &gt; 90 %}\n                        --ha-card-background: rgba(255, 83, 91,0.05);\n                      {% elif sensor &gt; 75  %}\n                        --ha-card-background: rgba(255, 152, 0,0.05);\n                      {% else  %}\n                        --ha-card-background: rgba(95, 231, 135,0.05);\n                      {% endif %} }\n                    }\n              - type: custom:mini-graph-card\n                entities:\n                  - entity: sensor.halo_server_card_side_temp\n                    name: Cards\n                font_size_header: 12\n                font_size: 75\n                line_width: 8\n                height: 200\n                animate: true\n                hours_to_show: 24\n                decimals: 0\n                show:\n                  points: false\n                color_thresholds:\n                  - value: 25\n                    color: '#5FE787'\n                  - value: 50\n                    color: '#FF9800'\n                  - value: 75\n                    color: '#FF535B'\n                card_mod:\n                  style: |\n                    .header.flex .icon {\n                    {% set sensor = states('sensor.unifi_dream_machine_pro_cpu_utilization')|float %}\n                      {% if sensor &gt; 75 %}\n                        color: red;\n                      {% elif sensor &gt; 50  %}\n                        color: orange;\n                      {% else  %}\n                        color: lightgreen;\n                      {% endif %} }\n                    ha-card {\n                      {% if sensor &gt; 75 %}\n                        --ha-card-background: rgba(255, 83, 91,0.05);\n                      {% elif sensor &gt; 50  %}\n                        --ha-card-background: rgba(255, 152, 0,0.05);\n                      {% else  %}\n                        --ha-card-background: rgba(95, 231, 135,0.05);\n                      {% endif %} }\n                    }\n          - square: false\n            type: grid\n            cards:\n              - type: heading\n                heading: IPMI SERVER CONTROLS\n                heading_style: title\n              - type: custom:mushroom-entity-card\n                entity: switch.halo_server_chassis\n                layout: vertical\n                fill_container: false\n            columns: 1\n          - type: heading\n            heading: SYSTEM FANS\n            heading_style: title\n          - type: grid\n            cards:\n              - type: custom:mini-graph-card\n                entities:\n                  - entity: sensor.halo_server_cpu1_fan1\n                    name: CPU\n                font_size_header: 12\n                font_size: 75\n                line_width: 8\n                height: 200\n                animate: true\n                hours_to_show: 24\n                decimals: 0\n                show:\n                  points: false\n                color_thresholds:\n                  - value: 25\n                    color: '#5FE787'\n                  - value: 50\n                    color: '#FF9800'\n                  - value: 75\n                    color: '#FF535B'\n                card_mod:\n                  style: |\n                    .header.flex .icon {\n                    {% set sensor = states('sensor.unifi_dream_machine_pro_cpu_utilization')|float %}\n                      {% if sensor &gt; 75 %}\n                        color: red;\n                      {% elif sensor &gt; 50  %}\n                        color: orange;\n                      {% else  %}\n                        color: lightgreen;\n                      {% endif %} }\n                    ha-card {\n                      {% if sensor &gt; 75 %}\n                        --ha-card-background: rgba(255, 83, 91,0.05);\n                      {% elif sensor &gt; 50  %}\n                        --ha-card-background: rgba(255, 152, 0,0.05);\n                      {% else  %}\n                        --ha-card-background: rgba(95, 231, 135,0.05);\n                      {% endif %} }\n                    }\n              - type: custom:mini-graph-card\n                entities:\n                  - entity: sensor.halo_server_frnt_fan1\n                    name: FAN-1\n                font_size_header: 12\n                font_size: 75\n                line_width: 8\n                height: 200\n                animate: true\n                hours_to_show: 24\n                decimals: 0\n                show:\n                  points: false\n                color_thresholds:\n                  - value: 25\n                    color: '#5FE787'\n                  - value: 50\n                    color: '#FF9800'\n                  - value: 75\n                    color: '#FF535B'\n                card_mod:\n                  style: |\n                    .header.flex .icon {\n                    {% set sensor = states('sensor.unifi_dream_machine_pro_cpu_utilization')|float %}\n                      {% if sensor &gt; 75 %}\n                        color: red;\n                      {% elif sensor &gt; 50  %}\n                        color: orange;\n                      {% else  %}\n                        color: lightgreen;\n                      {% endif %} }\n                    ha-card {\n                      {% if sensor &gt; 75 %}\n                        --ha-card-background: rgba(255, 83, 91,0.05);\n                      {% elif sensor &gt; 50  %}\n                        --ha-card-background: rgba(255, 152, 0,0.05);\n                      {% else  %}\n                        --ha-card-background: rgba(95, 231, 135,0.05);\n                      {% endif %} }\n                    }\n              - type: custom:mini-graph-card\n                entities:\n                  - entity: sensor.halo_server_frnt_fan2\n                    name: FAN-2\n                font_size_header: 12\n                font_size: 75\n                line_width: 8\n                height: 200\n                animate: true\n                hours_to_show: 24\n                decimals: 0\n                show:\n                  points: false\n                color_thresholds:\n                  - value: 25\n                    color: '#5FE787'\n                  - value: 50\n                    color: '#FF9800'\n                  - value: 75\n                    color: '#FF535B'\n                card_mod:\n                  style: |\n                    .header.flex .icon {\n                    {% set sensor = states('sensor.unifi_dream_machine_pro_cpu_utilization')|float %}\n                      {% if sensor &gt; 75 %}\n                        color: red;\n                      {% elif sensor &gt; 50  %}\n                        color: orange;\n                      {% else  %}\n                        color: lightgreen;\n                      {% endif %} }\n                    ha-card {\n                      {% if sensor &gt; 75 %}\n                        --ha-card-background: rgba(255, 83, 91,0.05);\n                      {% elif sensor &gt; 50  %}\n                        --ha-card-background: rgba(255, 152, 0,0.05);\n                      {% else  %}\n                        --ha-card-background: rgba(95, 231, 135,0.05);\n                      {% endif %} }\n                    }\n              - type: custom:mini-graph-card\n                entities:\n                  - entity: sensor.halo_server_frnt_fan4\n                    name: FAN-4\n                font_size_header: 12\n                font_size: 75\n                line_width: 8\n                height: 200\n                animate: true\n                hours_to_show: 24\n                decimals: 0\n                show:\n                  points: false\n                color_thresholds:\n                  - value: 25\n                    color: '#5FE787'\n                  - value: 50\n                    color: '#FF9800'\n                  - value: 75\n                    color: '#FF535B'\n                card_mod:\n                  style: |\n                    .header.flex .icon {\n                    {% set sensor = states('sensor.unifi_dream_machine_pro_cpu_utilization')|float %}\n                      {% if sensor &gt; 75 %}\n                        color: red;\n                      {% elif sensor &gt; 50  %}\n                        color: orange;\n                      {% else  %}\n                        color: lightgreen;\n                      {% endif %} }\n                    ha-card {\n                      {% if sensor &gt; 75 %}\n                        --ha-card-background: rgba(255, 83, 91,0.05);\n                      {% elif sensor &gt; 50  %}\n                        --ha-card-background: rgba(255, 152, 0,0.05);\n                      {% else  %}\n                        --ha-card-background: rgba(95, 231, 135,0.05);\n                      {% endif %} }\n                    }\n              - type: custom:mini-graph-card\n                entities:\n                  - entity: sensor.halo_server_frnt_fan5\n                    name: FAN-5\n                font_size_header: 12\n                font_size: 75\n                line_width: 8\n                height: 200\n                animate: true\n                hours_to_show: 24\n                decimals: 0\n                show:\n                  points: false\n                color_thresholds:\n                  - value: 25\n                    color: '#5FE787'\n                  - value: 50\n                    color: '#FF9800'\n                  - value: 75\n                    color: '#FF535B'\n                card_mod:\n                  style: |\n                    .header.flex .icon {\n                    {% set sensor = states('sensor.unifi_dream_machine_pro_cpu_utilization')|float %}\n                      {% if sensor &gt; 75 %}\n                        color: red;\n                      {% elif sensor &gt; 50  %}\n                        color: orange;\n                      {% else  %}\n                        color: lightgreen;\n                      {% endif %} }\n                    ha-card {\n                      {% if sensor &gt; 75 %}\n                        --ha-card-background: rgba(255, 83, 91,0.05);\n                      {% elif sensor &gt; 50  %}\n                        --ha-card-background: rgba(255, 152, 0,0.05);\n                      {% else  %}\n                        --ha-card-background: rgba(95, 231, 135,0.05);\n                      {% endif %} }\n                    }\n        visibility:\n          - condition: state\n            entity: input_select.rack_selected_device\n            state: server-halo\n  - type: grid\n    cards:\n      - show_name: true\n        show_icon: true\n        type: button\n        name: Refresh AI Log Summary\n        icon: mdi:cloud-refresh-variant-outline\n        tap_action:\n          action: perform-action\n          perform_action: script.run_ai_summary_now\n        grid_options:\n          columns: 12\n          rows: 2\n      - type: markdown\n        title: \ud83e\udd16 Daily AI Lab Digest\n        content: |\n          ### Last Update: {{ states('sensor.daily_system_summary') }}\n          ---\n          {{ state_attr('sensor.daily_system_summary', 'summary') }}\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/dashboard-persons/car/","title":"CAR","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/dashboard-persons/car/#car","title":"CAR","text":"<p>Dashboard: Persons Path: <code>car</code></p> <p>Control interface for the Mercedes GLC, featuring climate scheduling, lock status, and real-time fuel/battery monitoring.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/dashboard-persons/car/#summary","title":"Summary","text":"<p>This view provides a comprehensive interface for the Mercedes GLC (\"The Car\"). It features a visual representation of the car's state (Home/Away, Engine On) using dynamic picture elements. Key controls include pre-entry climate scheduling via a scheduler card and door/window management. The dashboard also monitors critical telemetry such as fuel level, EV battery charge, tire pressure, and lock status, visualizing them with color-coded indicators and Mushroom cards.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/dashboard-persons/car/#related-packages","title":"Related Packages","text":"<p>This view contains entities managed by:</p> <ul> <li>Car</li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/dashboard-persons/car/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:button-card</code></li> <li><code>custom:card-mod</code></li> <li><code>custom:mushroom-template-card</code></li> <li><code>custom:scheduler-card</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/dashboard-persons/car/#configuration","title":"Configuration","text":"<pre><code>title: CAR\nbadges: []\ncards: []\ntype: sections\nsections:\n- type: grid\n  cards:\n  - type: picture-elements\n    image: local/car/Car-BG.png\n    elements:\n    - type: custom:button-card\n      template:\n      - area_base_overlay\n      entity: switch.[LICENSE_PLATE]_pre_entry_climate_control\n      tap_action:\n        action: navigate\n        navigation_path: /dashboard-persons/car\n      hold_action:\n        action: toggle\n      double_tap_action:\n        action: fire-dom-event\n        browser_mod:\n          service: browser_mod.popup\n          data:\n            title: CAR\n            content:\n              type: vertical-stack\n              cards:\n              - type: horizontal-stack\n                cards:\n                - type: custom:mushroom-template-card\n                  entity: sensor.fuel_level\n                  primary: Fuel Level\n                  secondary: '{{ states(''sensor.[LICENSE_PLATE]_fuel_level'') }}%\n                    | {{ states(''sensor.[LICENSE_PLATE]_range_liquid'') }} km range'\n                  icon: mdi:gas-station\n                  features_position: bottom\n                  color: \"{% set fuel = states('sensor.[LICENSE_PLATE]_fuel_level')\\\n                    \\ | int %} {% if fuel &lt; 20 %}\\n  darkred\\n{% elif fuel &lt; 50 %}\\n\\\n                    \\  yellow\\n{% else %}\\n  darkgreen\\n{% endif %}\\n\"\n                  card_mod:\n                    style: \"ha-card {\\n  background: linear-gradient(\\n    to right,\\n\\\n                      \\    orange {{ states('sensor.[LICENSE_PLATE]_fuel_level') }}%,\\n\\\n                      \\    var(--card-background-color) {{ states('sensor.[LICENSE_PLATE]_fuel_level')\\\n                      \\ }}%\\n  );\\n  );\\n  background-size: 100% 100%;\\n  background-repeat:\\\n                      \\ no-repeat;\\n  border-radius: 12px;\\n}\\n\"\n                - type: custom:mushroom-template-card\n                  entity: sensor.ev_battery_level\n                  primary: EV Charge\n                  secondary: '{{ states(''sensor.[LICENSE_PLATE]_state_of_charge'')\n                    }}% | {{ states(''sensor.[LICENSE_PLATE]_range_electric'') }}\n                    km range\n\n                    '\n                  icon: mdi:car-electric\n                  tap_action:\n                    action: more-info\n                  hold_action:\n                    action: more-info\n                  color: \"{% set charge = states('sensor.[LICENSE_PLATE]_state_of_charge')\\\n                    \\ | int %} {% if charge &lt; 20 %}\\n  red\\n{% elif charge &lt; 50 %}\\n\\\n                    \\  yellow\\n{% else %}\\n  lightgreen\\n{% endif %}\\n\"\n                  features_position: bottom\n                  card_mod:\n                    style: \"ha-card {\\n  --charge: {{ states('sensor.[LICENSE_PLATE]_state_of_charge')\\\n                      \\ }}%;\\n  background: linear-gradient(\\n    to right,\\n    green\\\n                      \\ var(--charge),\\n    var(--card-background-color) var(--charge)\\n\\\n                      \\  );\\n  background-size: 100% 100%;\\n  background-repeat: no-repeat;\\n\\\n                      \\  border-radius: 12px;\\n}\\n\"\n              - type: custom:scheduler-card\n                include:\n                - switch.[LICENSE_PLATE]_pre_entry_climate_control\n                exclude: []\n                discover_existing: false\n                title: true\n                show_header_toggle: false\n                time_step: 5\n                default_editor: single\n                display_options:\n                  primary_info: default\n                  secondary_info:\n                  - time\n                  icon: action\n                sort_by:\n                - state\n                - relative-time\n                customize: {}\n                tags:\n                - Car\n                exclude_tags: []\n                card_mod:\n                  style: \"ha-card {\\n  border-radius: 12px;\\n  box-shadow: var(--ha-card-box-shadow);\\n\\\n                    \\  background-color: var(--card-background-color);\\n  font-family:\\\n                    \\ var(--mush-font-family, \\\"Roboto\\\", sans-serif);\\n}\\n.card-header\\\n                    \\ {\\n  font-size: 1.2em;\\n  font-weight: 500;\\n  padding-bottom:\\\n                    \\ 8px;\\n}\\n.schedule-row {\\n  border-bottom: 1px solid var(--divider-color);\\n\\\n                    }\\n\"\n              - type: map\n                entities:\n                - entity: person.car\n                hours_to_show: 48\n                aspect_ratio: '1.5'\n                default_zoom: 15\n                theme_mode: auto\n      card_mod:\n        style: \"ha-card {\\n  /* Moves border logic here from original for border display\\\n          \\ */\\n  {% if is_state('sensor.[LICENSE_PLATE]_ignition_state','4') %}\\n\\\n          \\    border: 3px solid rgba(36, 255, 0, 0.8);\\n  {% elif is_state('sensor.[LICENSE_PLATE]_ignition_state','2')\\\n          \\ %}\\n    border: 3px solid rgba(255, 163, 0, 0.8);\\n  {% else %}\\n    border:\\\n          \\ 0px solid rgba(0, 0, 0, 0);\\n  {% endif %}\\n}\\n\"\n      style:\n        top: 50%\n        left: 50%\n        width: 100%\n        height: 100%\n        z-index: 4\n    - type: conditional\n      conditions:\n      - entity: device_tracker.[LICENSE_PLATE]_device_tracker\n        state: home\n      elements:\n      - type: image\n        image: local/car/GLC-home.png\n        style:\n          left: 50%\n          top: 30%\n          width: 80%\n          opacity: 100%\n          z-index: 2\n    - type: conditional\n      conditions:\n      - entity: device_tracker.[LICENSE_PLATE]_device_tracker\n        state: not_home\n      elements:\n      - type: image\n        image: local/car/GLC-back.png\n        style:\n          left: 50%\n          top: 50%\n          width: 65%\n          opacity: 100%\n          z-index: 2\n    - type: conditional\n      conditions:\n      - entity: binary_sensor.car_engine\n        state: 'on'\n      elements:\n      - type: image\n        image: local/car/road.png\n        style:\n          left: 50%\n          top: 65%\n          width: 100%\n          opacity: 100%\n          z-index: 2\n    - type: custom:button-card\n      template:\n      - area_text_element\n      name: Car\n      style:\n        top: 0%\n        left: 50%\n        width: 100%\n        height: 100%\n        z-index: 2\n        container-type: inline-size\n    - type: custom:button-card\n      template: area_text_element\n      entity: sensor.[LICENSE_PLATE]_state_of_charge\n      show_name: false\n      show_icon: false\n      show_state: true\n      style:\n        top: 0%\n        left: 50%\n        width: 100%\n        height: 100%\n        z-index: 2\n        container-type: inline-size\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: binary_sensor.car_charge_plug\n      icon: mdi:ev-plug-type2\n      layout: vertical\n      style:\n        top: 44%\n        left: 90%\n        width: 12%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: 'on'\n        styles:\n          icon:\n          - color: '#088CF8'\n          - animation: \"[[[\\n  if (states['binary_sensor.[LICENSE_PLATE]_charging_active'].state\\\n              \\ == 'on') {\\n    return 'blink 1s ease infinite';\\n  } else {\\n   \\\n              \\ return 'none';\\n  }\\n]]]\\n\"\n      - operator: ==\n        value: 'off'\n        styles:\n          card:\n          - display: none\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: binary_sensor.[LICENSE_PLATE]_park_brake_status\n      layout: vertical\n      style:\n        top: 75%\n        left: 10%\n        width: 14%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: 'on'\n        styles:\n          icon:\n          - color: orange\n      - operator: ==\n        value: 'off'\n        styles:\n          card:\n          - display: none\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: lock.[LICENSE_PLATE]_lock\n      icon: mdi:lock-open-variant\n      layout: vertical\n      style:\n        top: 75%\n        left: 26%\n        width: 14%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: unlocked\n        styles:\n          icon:\n          - animation: blink 0.5s linear infinite\n            color: rgba(253,89,89,1)\n      - operator: ==\n        value: locked\n        styles:\n          card:\n          - display: none\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: binary_sensor.[LICENSE_PLATE]_windows_closed\n      layout: vertical\n      style:\n        top: 75%\n        left: 42%\n        width: 14%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: 'off'\n        styles:\n          icon:\n          - animation: blink 0.5s ease infinite\n            color: rgba(253,89,89,1)\n      - operator: ==\n        value: 'on'\n        styles:\n          card:\n          - display: none\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: binary_sensor.[LICENSE_PLATE]_low_wash_water_warning\n      layout: vertical\n      style:\n        top: 75%\n        left: 58%\n        width: 14%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: 'on'\n        styles:\n          icon:\n          - animation: blink 1s ease infinite\n            color: '#088CF8'\n      - operator: ==\n        value: 'off'\n        styles:\n          card:\n          - display: none\n      card_mod:\n        style: \":host {\\n  {% if '[[entity]]' == '' %}\\n    display: none;\\n  {% endif\\\n          \\ %}\\n}\\n\"\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: binary_sensor.[LICENSE_PLATE]_tire_warning\n      icon: mdi:tire\n      layout: vertical\n      style:\n        top: 75%\n        left: 74%\n        width: 14%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: 'on'\n        styles:\n          icon:\n          - color: rgba(253,89,89,1)\n            animation: blink 1s ease infinite\n      - operator: ==\n        value: 'off'\n        styles:\n          card:\n          - display: none\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: switch.[LICENSE_PLATE]_pre_entry_climate_control\n      icon: mdi:fan\n      layout: vertical\n      style:\n        top: 75%\n        left: 90%\n        width: 14%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: 'on'\n        styles:\n          icon:\n          - animation: rotating 1s linear infinite\n            color: '#21ff21'\n      - operator: ==\n        value: 'off'\n        styles:\n          card:\n          - display: none\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: switch.schedule_car_pre_entry_climate_control\n      icon: mdi:clock-outline\n      layout: vertical\n      style:\n        top: 85%\n        left: 94%\n        width: 6%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: 'on'\n        styles:\n          icon:\n          - color: orange\n      - operator: ==\n        value: 'off'\n        styles:\n          card:\n          - display: none\n  - type: custom:mushroom-template-card\n    entity: sensor.fuel_level\n    primary: Fuel Level\n    secondary: '{{ states(''sensor.[LICENSE_PLATE]_fuel_level'') }}% | {{ states(''sensor.[LICENSE_PLATE]_range_liquid'')\n      }} km range'\n    icon: mdi:gas-station\n    features_position: bottom\n    color: \"{% set fuel = states('sensor.[LICENSE_PLATE]_fuel_level') | int %} {%\\\n      \\ if fuel &lt; 20 %}\\n  darkred\\n{% elif fuel &lt; 50 %}\\n  yellow\\n{% else %}\\n \\\n      \\ darkgreen\\n{% endif %}\\n\"\n    card_mod:\n      style: \"ha-card {\\n  background: linear-gradient(\\n    to right,\\n    orange\\\n        \\ {{ states('sensor.[LICENSE_PLATE]_fuel_level') }}%,\\n    var(--card-background-color)\\\n        \\ {{ states('sensor.[LICENSE_PLATE]_fuel_level') }}%\\n  );\\n  );\\n  background-size:\\\n        \\ 100% 100%;\\n  background-repeat: no-repeat;\\n  border-radius: 12px;\\n}\\n\"\n  - type: custom:mushroom-template-card\n    entity: sensor.ev_battery_level\n    primary: EV Charge\n    secondary: '{{ states(''sensor.[LICENSE_PLATE]_state_of_charge'') }}% | {{ states(''sensor.[LICENSE_PLATE]_range_electric'')\n      }} km range\n\n      '\n    icon: mdi:car-electric\n    tap_action:\n      action: more-info\n    hold_action:\n      action: more-info\n    color: \"{% set charge = states('sensor.[LICENSE_PLATE]_state_of_charge') | int\\\n      \\ %} {% if charge &lt; 20 %}\\n  red\\n{% elif charge &lt; 50 %}\\n  yellow\\n{% else\\\n      \\ %}\\n  lightgreen\\n{% endif %}\\n\"\n    features_position: bottom\n    card_mod:\n      style: \"ha-card {\\n  --charge: {{ states('sensor.[LICENSE_PLATE]_state_of_charge')\\\n        \\ }}%;\\n  background: linear-gradient(\\n    to right,\\n    green var(--charge),\\n\\\n        \\    var(--card-background-color) var(--charge)\\n  );\\n  background-size:\\\n        \\ 100% 100%;\\n  background-repeat: no-repeat;\\n  border-radius: 12px;\\n}\\n\"\n  - type: custom:mushroom-template-card\n    primary: Doors\n    secondary: \"{% set status = states(entity) %}\\n{% if status == 'open' %}\\n  Open\\n\\\n      {% else %}\\n  Closed\\n{% endif %}\"\n    icon: mdi:car-door\n    tap_action:\n      action: more-info\n    double_tap_action:\n      action: none\n    hold_action:\n      action: more-info\n    entity: binary_sensor.car_doors\n    badge_color: \"{% set status = states('switch.car_doors') %}\\n{% if status == 'off'\\\n      \\ %}\\n  red\\n{% else %}\\n  green\\n{% endif %}\"\n    badge_icon: \"{% set status = states('switch.car_doors') %}\\n{% if status == 'off'\\\n      \\ %}\\n  mdi:lock-off-outline\\n{% else %}\\n  mdi:lock\\n{% endif %}\"\n    color: \"{% set status = states(entity) %}\\n{% if status == 'open' %}\\n  red\\n\\\n      {% else %}\\n  disabled\\n{% endif %}\"\n    features_position: bottom\n    grid_options:\n      columns: 4\n      rows: 2\n    vertical: true\n  - type: custom:mushroom-template-card\n    primary: Windows\n    secondary: \"{% set status = states(entity) %}\\n{% if status == 'off' %}\\n  Open\\n\\\n      {% else %}\\n  Closed\\n{% endif %}\"\n    icon: mdi:car-door\n    tap_action:\n      action: more-info\n    double_tap_action:\n      action: none\n    entity: switch.car_windows\n    badge_icon: ''\n    badge_color: ''\n    hold_action:\n      action: more-info\n    color: \"{% set status = states(entity) %}\\n{% if status == 'off' %}\\n  red\\n{%\\\n      \\ else %}\\n  disabled\\n{% endif %}\"\n    features_position: bottom\n    grid_options:\n      columns: 4\n      rows: 2\n    vertical: true\n    icon_tap_action:\n      action: more-info\n  - type: custom:mushroom-template-card\n    entity: switch.[LICENSE_PLATE]_pre_entry_climate_control\n    primary: Pre AC\n    secondary: \"{% set status = states(entity) %}\\n{% if status == 'off' %}\\n  Off\\n\\\n      {% else %}\\n  On\\n{% endif %}\"\n    icon: mdi:air-conditioner\n    tap_action:\n      action: more-info\n    double_tap_action:\n      action: more-info\n    hold_action:\n      action: more-info\n    badge_icon: ''\n    badge_color: ''\n    color: \"{% set status = states(entity) %}\\n{% if status == 'off' %}\\n  disabled\\n\\\n      {% else %}\\n  green\\n{% endif %}\"\n    features_position: bottom\n    grid_options:\n      columns: 4\n      rows: 2\n    vertical: true\n    icon_tap_action:\n      action: more-info\n  - include:\n    - switch.[LICENSE_PLATE]_pre_entry_climate_control\n    exclude: []\n    discover_existing: false\n    title: true\n    show_header_toggle: false\n    time_step: 5\n    default_editor: single\n    display_options:\n      primary_info: default\n      secondary_info:\n      - time\n      icon: action\n    sort_by:\n    - state\n    - relative-time\n    customize: {}\n    tags:\n    - Car\n    exclude_tags: []\n    type: custom:scheduler-card\n    card_mod:\n      style: \"ha-card {\\n  border-radius: 12px;\\n  box-shadow: var(--ha-card-box-shadow);\\n\\\n        \\  background-color: var(--card-background-color);\\n  font-family: var(--mush-font-family,\\\n        \\ \\\"Roboto\\\", sans-serif);\\n}\\n.card-header {\\n  font-size: 1.2em;\\n  font-weight:\\\n        \\ 500;\\n  padding-bottom: 8px;\\n}\\n.schedule-row {\\n  border-bottom: 1px solid\\\n        \\ var(--divider-color);\\n}\\n\"\n  - type: map\n    entities:\n    - entity: person.car\n    hours_to_show: 48\n    aspect_ratio: '1.5'\n    default_zoom: 15\n    theme_mode: auto\n- type: grid\n  cards:\n  - type: picture-elements\n    image: local/car/Car-BG.png\n    aspect_ratio: '1:1'\n    elements:\n    - type: custom:button-card\n      template:\n      - area_base_overlay\n      entity: switch.[LICENSE_PLATE]_pre_entry_climate_control\n      tap_action:\n        action: navigate\n        navigation_path: /dashboard-persons/car\n      hold_action:\n        action: toggle\n      double_tap_action:\n        action: fire-dom-event\n        browser_mod:\n          service: browser_mod.popup\n          data:\n            title: CAR\n            content:\n              type: vertical-stack\n              cards:\n              - type: custom:scheduler-card\n                include:\n                - switch.car_pre_entry_ac\n                exclude: []\n                title: Schedules\n                discover_existing: false\n                tags:\n                - Car\n                time_step: 5\n                sort_by:\n                - state\n                - relative-time\n                display_options:\n                  primary_info: default\n                  secondary_info:\n                  - time\n                  - days\n                  - additional-tasks\n                  icon: action\n                show_header_toggle: false\n      style:\n        top: 50%\n        left: 50%\n        width: 100%\n        height: 100%\n        z-index: 4\n    - type: image\n      image: local/car/GLC-top.png\n      style:\n        left: 50.5%\n        top: 54%\n        width: 140%\n        opacity: 100%\n        z-index: 2\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: binary_sensor.[LICENSE_PLATE]_low_brake_fluid_warning\n      layout: vertical\n      style:\n        top: 9%\n        left: 30%\n        width: 8%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: 'on'\n        styles:\n          icon:\n          - color: orange\n            animation: blink 1s ease infinite\n      - operator: ==\n        value: 'off'\n        styles:\n          card:\n          - display: none\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: sensor.[LICENSE_PLATE]_starter_battery_state\n      layout: vertical\n      style:\n        top: 9%\n        left: 40%\n        width: 8%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: '&gt;'\n        value: '0'\n        styles:\n          icon:\n          - color: orange\n            animation: blink 1s ease infinite\n      - operator: ==\n        value: '0'\n        styles:\n          card:\n          - display: none\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: binary_sensor.[LICENSE_PLATE]_low_coolant_level_warning\n      layout: vertical\n      style:\n        top: 9%\n        left: 60%\n        width: 8%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: 'on'\n        styles:\n          icon:\n          - color: orange\n            animation: blink 1s ease infinite\n      - operator: ==\n        value: 'off'\n        styles:\n          card:\n          - display: none\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: binary_sensor.[LICENSE_PLATE]_low_wash_water_warning\n      layout: vertical\n      style:\n        top: 9%\n        left: 70%\n        width: 8%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: 'on'\n        styles:\n          icon:\n          - color: orange\n            animation: blink 1s ease infinite\n      - operator: ==\n        value: 'off'\n        styles:\n          card:\n          - display: none\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: sensor.[LICENSE_PLATE]_lock\n      icon: mdi:lock\n      layout: vertical\n      style:\n        top: 9%\n        left: 50%\n        width: 8%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: '2'\n        styles:\n          icon:\n          - color: lightgreen\n      - operator: '!='\n        value: '2'\n        icon: mdi:lock-open-variant\n        styles:\n          icon:\n          - color: orange\n            animation: blink 1s ease infinite\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: sensor.[LICENSE_PLATE]_tire_pressure_front_right\n      icon: mdi:tire\n      show_state: true\n      layout: vertical\n      style:\n        top: 25%\n        left: 80%\n        width: 12%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: '&gt;'\n        value: '2'\n        styles:\n          card:\n          - font-size: 24cqw\n          icon:\n          - color: lightgreen\n      - operator: &lt;=\n        value: '2'\n        styles:\n          card:\n          - font-size: 24cqw\n          icon:\n          - color: orange\n            animate: blink 1s ease infinite\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: sensor.[LICENSE_PLATE]_tire_pressure_rear_right\n      icon: mdi:tire\n      show_state: true\n      layout: vertical\n      style:\n        top: 75%\n        left: 80%\n        width: 12%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: '&gt;'\n        value: '2'\n        styles:\n          card:\n          - font-size: 24cqw\n          icon:\n          - color: lightgreen\n      - operator: &lt;=\n        value: '2'\n        styles:\n          card:\n          - font-size: 24cqw\n          icon:\n          - color: orange\n            animate: blink 1s ease infinite\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: sensor.[LICENSE_PLATE]_tire_pressure_front_left\n      icon: mdi:tire\n      show_state: true\n      layout: vertical\n      style:\n        top: 25%\n        left: 20%\n        width: 12%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: '&gt;'\n        value: '2'\n        styles:\n          card:\n          - font-size: 24cqw\n          icon:\n          - color: lightgreen\n      - operator: &lt;=\n        value: '2'\n        styles:\n          card:\n          - font-size: 24cqw\n          icon:\n          - color: orange\n            animate: blink 1s ease infinite\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: sensor.[LICENSE_PLATE]_tire_pressure_rear_left\n      icon: mdi:tire\n      show_state: true\n      layout: vertical\n      style:\n        top: 75%\n        left: 20%\n        width: 12%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: '&gt;'\n        value: '2'\n        styles:\n          card:\n          - font-size: 24cqw\n          icon:\n          - color: lightgreen\n      - operator: &lt;=\n        value: '2'\n        styles:\n          card:\n          - font-size: 24cqw\n          icon:\n          - color: orange\n            animate: blink 1s ease infinite\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: binary_sensor.car_glc_lock_front_right\n      icon: mdi:car-door\n      layout: vertical\n      style:\n        top: 45%\n        left: 25%\n        width: 8%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: 'off'\n        styles:\n          icon:\n          - color: orange\n          - transform: scaleX(1) rotate(90deg)\n          - animation: \"[[[\\n  if (states['binary_sensor.car_glc_door_front_right'].state\\\n              \\ == 'off') {\\n    return 'blink 1s ease infinite';\\n  } else {\\n  \\\n              \\  return 'none';\\n  }\\n]]]\\n\"\n      - operator: ==\n        value: 'on'\n        styles:\n          card:\n          - display: none\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: binary_sensor.car_glc_lock_rear_left\n      icon: mdi:car-door\n      layout: vertical\n      style:\n        top: 55%\n        left: 25%\n        width: 8%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: 'off'\n        styles:\n          icon:\n          - color: orange\n          - transform: scaleX(-1) rotate(-90deg)\n          - animation: \"[[[\\n  if (states['binary_sensor.car_glc_door_rear_left'].state\\\n              \\ == 'off') {\\n    return 'blink 1s ease infinite';\\n  } else {\\n  \\\n              \\  return 'none';\\n  }\\n]]]\\n\"\n      - operator: ==\n        value: 'on'\n        styles:\n          card:\n          - display: none\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: binary_sensor.car_glc_lock_front_left\n      icon: mdi:car-door\n      layout: vertical\n      style:\n        top: 45%\n        left: 75%\n        width: 8%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: 'off'\n        styles:\n          icon:\n          - color: orange\n          - transform: scaleX(-1) rotate(90deg)\n          - animation: \"[[[\\n  if (states['binary_sensor.car_glc_door_front_left'].state\\\n              \\ == 'off') {\\n    return 'blink 1s ease infinite';\\n  } else {\\n  \\\n              \\  return 'none';\\n  }\\n]]]\\n\"\n      - operator: ==\n        value: 'on'\n        styles:\n          card:\n          - display: none\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: binary_sensor.car_glc_lock_rear_right\n      icon: mdi:car-door\n      layout: vertical\n      style:\n        top: 55%\n        left: 75%\n        width: 8%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: 'off'\n        styles:\n          icon:\n          - color: orange\n          - transform: scaleX(1) rotate(-90deg)\n          - animation: \"[[[\\n  if (states['binary_sensor.car_glc_door_rear_right'].state\\\n              \\ == 'off') {\\n    return 'blink 1s ease infinite';\\n  } else {\\n  \\\n              \\  return 'none';\\n  }\\n]]]\\n\"\n      - operator: ==\n        value: 'on'\n        styles:\n          card:\n          - display: none\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: binary_sensor.car_charge_plug\n      icon: mdi:ev-plug-type2\n      layout: vertical\n      style:\n        top: 92%\n        left: 50%\n        width: 8%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: 'on'\n        styles:\n          icon:\n          - color: '#088CF8'\n          - animation: \"[[[\\n  if (states['binary_sensor.[LICENSE_PLATE]_charging_active'].state\\\n              \\ == 'on') {\\n    return 'blink 1s ease infinite';\\n  } else {\\n   \\\n              \\ return 'none';\\n  }\\n]]]\\n\"\n      - operator: ==\n        value: 'off'\n        icon: mdi:ev-plug-type2\n        styles:\n          icon:\n          - display: none\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: sensor.[LICENSE_PLATE]_charging_power\n      show_icon: false\n      show_state: true\n      layout: vertical\n      style:\n        top: 89%\n        left: 62%\n        width: 25%\n        z-index: 2\n        container-type: inline-size\n      styles:\n        state:\n        - font-size: 13cqw\n          color: '#088CF8'\n        card:\n        - display: \"[[[\\n  // Get the state of the power sensor\\n  var power = states['sensor.[LICENSE_PLATE]_charging_power'].state;\\n\\\n            \\n  // Hide if power is 0 OR if the main entity is 0\\n  if (parseFloat(power)\\\n            \\ == 0 || entity.state == '0') {\\n    return 'none';\\n  } else {\\n   \\\n            \\ return 'block'; // Show the card\\n  }\\n]]]\\n\"\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: sensor.[LICENSE_PLATE]_charging_power\n      show_icon: false\n      show_name: true\n      show_state: false\n      name: 100% @\n      layout: vertical\n      style:\n        top: 95%\n        left: 63%\n        width: 25%\n        z-index: 2\n        container-type: inline-size\n      styles:\n        state:\n        - font-size: 13cqw\n          color: '#088CF8'\n        card:\n        - display: \"[[[\\n  // Get the state of the power sensor\\n  var power = states['sensor.[LICENSE_PLATE]_charging_power'].state;\\n\\\n            \\n  // Hide if power is 0 OR if the main entity is 0\\n  if (parseFloat(power)\\\n            \\ == 0 || entity.state == '0') {\\n    return 'none';\\n  } else {\\n   \\\n            \\ return 'block'; // Show the card\\n  }\\n]]]\\n\"\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: sensor.car_charge_ready\n      show_icon: false\n      show_state: true\n      layout: vertical\n      style:\n        top: 95%\n        left: 75%\n        width: 25%\n        z-index: 2\n        container-type: inline-size\n      styles:\n        state:\n        - font-size: 13cqw\n          color: '#088CF8'\n        card:\n        - display: \"[[[\\n  // Get the state of the power sensor\\n  var power = states['sensor.[LICENSE_PLATE]_charging_power'].state;\\n\\\n            \\n  // Hide if power is 0 OR if the main entity is 0\\n  if (parseFloat(power)\\\n            \\ == 0 || entity.state == '0') {\\n    return 'none';\\n  } else {\\n   \\\n            \\ return 'block'; // Show the card\\n  }\\n]]]\\n\"\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: binary_sensor.car_charge_plug\n      icon: mdi:battery-charging-high\n      layout: vertical\n      style:\n        top: 92%\n        left: 50%\n        width: 8%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: 'off'\n        icon: \"[[[\\n  var soc = states['sensor.[LICENSE_PLATE]_state_of_charge'].state;\\n\\\n          \\  if (soc &gt; 75) {\\n    return 'mdi:battery-charging-high';\\n  } else if\\\n          \\ (soc &gt; 25) {\\n    return 'mdi:battery-charging-medium';\\n  } else {\\n\\\n          \\    return 'mdi:battery-charging-low';\\n  }\\n]]]\\n\"\n        styles:\n          icon:\n          - color: \"[[[\\n  var soc = states['sensor.[LICENSE_PLATE]_state_of_charge'].state;\\n\\\n              \\  if (soc &gt; 75) {\\n    return 'lightgreen';\\n  } else if (soc &gt; 25)\\\n              \\ {\\n    return 'orange';\\n  } else {\\n    return 'red';\\n  }\\n]]]\\n\"\n          - animation: \"[[[\\n  if (states['binary_sensor.[LICENSE_PLATE]_charging_active'].state\\\n              \\ == 'on') {\\n    return 'blink 1s ease infinite';\\n  } else {\\n   \\\n              \\ return 'none';\\n  }\\n]]]\\n\"\n      - operator: ==\n        value: 'on'\n        styles:\n          card:\n          - display: none\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: sensor.[LICENSE_PLATE]_state_of_charge\n      show_icon: false\n      show_state: true\n      layout: vertical\n      style:\n        top: 92%\n        left: 38%\n        width: 25%\n        z-index: 2\n        container-type: inline-size\n      styles:\n        card:\n        - font-size: 18cqw\n      state:\n      - operator: '&gt;'\n        value: 75\n        styles:\n          card:\n          - color: lightgreen\n      - operator: '&gt;'\n        value: 25\n        styles:\n          card:\n          - color: orange\n      - operator: default\n        styles:\n          card:\n          - color: red\n  - type: entities\n    entities:\n    - entity: sensor.[LICENSE_PLATE]_odometer\n      name: Odometer\n      secondary_info: none\n    - entity: sensor.[LICENSE_PLATE]_electric_consumption_reset\n      name: Fuel Consumption\n    - entity: sensor.[LICENSE_PLATE]_liquid_consumption_reset\n      name: Electric Consumption\nmax_columns: 4\npath: car\nsubview: true\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/dashboard-persons/evis/","title":"Evis","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/dashboard-persons/evis/#evis","title":"Evis","text":"<p>Dashboard: Persons Path: <code>evis</code></p> <p>Personal dashboard for Evis, managing notifications and personal settings.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/dashboard-persons/evis/#summary","title":"Summary","text":"<p>This view is a personal space for Evis. It features a standardized family member identity card acting as a header and a comprehensive list of notification preference switches. These switches allow Evis to granularly opt-in or out of specific notification categories (e.g., Info, Security) directly from the dashboard.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/dashboard-persons/evis/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:auto-entities</code></li> <li><code>custom:decluttering-card</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/dashboard-persons/evis/#configuration","title":"Configuration","text":"<pre><code>theme: Backend-selected\ntitle: Evis\nbadges: []\ncards: []\ntype: sections\nsections:\n- type: grid\n  cards:\n  - type: custom:decluttering-card\n    template: family_member_card\n    variables:\n    - person: Evis\n    - device: sm_f966b\n    - background: background_2\n    - color: '#dddddd'\n  - type: custom:auto-entities\n    card:\n      type: entities\n      title: My Notification Settings\n      show_header_toggle: false\n      icon: mdi:bell-cog\n    filter:\n      template: \"{% set user_slug = 'Evis' %} {# &lt;--- CHANGE THIS to the person's\\\n        \\ slug #}\\n{% set ns = namespace(switches=[]) %}\\n\\n{% for state in states.switch\\\n        \\ %}\\n  {# Find switches ending with _notification_[user_slug] #}\\n  {% if\\\n        \\ state.entity_id.endswith('_notification_' ~ user_slug) %}\\n    {# Extract\\\n        \\ category (e.g. switch.info_notification_Evis -&gt; info) #}\\n    {% set category\\\n        \\ = state.object_id.split('_notification_')[0] | capitalize %}\\n    \\n   \\\n        \\ {% set ns.switches = ns.switches + [{\\n        'entity': state.entity_id,\\n\\\n        \\        'name': category ~ \\\" Notification\\\", \\n        'secondary_info':\\\n        \\ 'last-updated'\\n    }] %}\\n  {% endif %}\\n{% endfor %}\\n\\n{{ ns.switches\\\n        \\ | to_json }}\\n\"\n    sort:\n      method: name\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/dashboard-persons/guest_1/","title":"Guest-1","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/dashboard-persons/guest_1/#guest-1","title":"Guest-1","text":"<p>Dashboard: Persons Path: <code>Guest-1</code></p> <p>Personal dashboard for Guest-1, managing notifications and guest settings.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/dashboard-persons/guest_1/#summary","title":"Summary","text":"<p>This view is dedicated to Guest-1. It provides a personal interface consisting of a family member identity card and a dynamic list of notification configuration switches. This allows the guest user to manage their own notification preferences within the home system.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/dashboard-persons/guest_1/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:auto-entities</code></li> <li><code>custom:decluttering-card</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/dashboard-persons/guest_1/#configuration","title":"Configuration","text":"<pre><code>theme: Backend-selected\ntitle: Guest-1\npath: Guest-1\nbadges: []\ncards: []\ntype: sections\nsections:\n- type: grid\n  cards:\n  - type: heading\n    heading: New section\n  - type: custom:decluttering-card\n    template: family_member_card\n    variables:\n    - person: Guest-1\n    - device: SM_S721B_Guest-1\n    - background: background_3\n    - color: '#ddd'\n  - type: custom:auto-entities\n    card:\n      type: entities\n      title: My Notification Settings\n      show_header_toggle: false\n      icon: mdi:bell-cog\n    filter:\n      template: \"{% set user_slug = 'Guest-1' %} {# &lt;--- CHANGE THIS to the person's\\\n        \\ slug #}\\n{% set ns = namespace(switches=[]) %}\\n\\n{% for state in states.switch\\\n        \\ %}\\n  {# Find switches ending with _notification_[user_slug] #}\\n  {% if\\\n        \\ state.entity_id.endswith('_notification_' ~ user_slug) %}\\n    {# Extract\\\n        \\ category (e.g. switch.info_notification_Evis -&gt; info) #}\\n    {% set category\\\n        \\ = state.object_id.split('_notification_')[0] | capitalize %}\\n    \\n   \\\n        \\ {% set ns.switches = ns.switches + [{\\n        'entity': state.entity_id,\\n\\\n        \\        'name': category ~ \\\" Notification\\\", \\n        'secondary_info':\\\n        \\ 'last-updated'\\n    }] %}\\n  {% endif %}\\n{% endfor %}\\n\\n{{ ns.switches\\\n        \\ | to_json }}\\n\"\n    sort:\n      method: name\nmax_columns: 4\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/home-access/home_access_center/","title":"Home Access Center","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/home-access/home_access_center/#home-access-center","title":"Home Access Center","text":"<p>Dashboard: Home Access Path: <code>home-access-center</code></p> <p>Centralized management interface for Unifi Access users, credentials, and guest schedules.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/home-access/home_access_center/#summary","title":"Summary","text":"<p>The Home Access Center serves as the central administrative hub for managing physical security and entry credentials. Its primary function is to maintain a unified user registry where distinct hardware identifiers\u2014such as Fingerprints and NFC tags\u2014are mapped to specific individuals. This abstraction allows homeowners to easily enroll new keys, assign them to family members or guests, and instantly revoke permissions if a credential is lost or compromised.</p> <p>In day-to-day use, this dashboard provides granular control over access logic. Administrators can toggle specific access methods on or off per user (e.g., disabling NFC while keeping Fingerprint active) and configure a strict Guest Access Schedule to limit entry to specific days and hours. Real-time audit logs provide immediate feedback on entry attempts, differentiating between successful unlocks, denied attempts due to schedule restrictions, and disabled credentials, ensuring complete visibility into the home's security status.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/home-access/home_access_center/#related-packages","title":"Related Packages","text":"<p>This view contains entities managed by:</p> <ul> <li>Unifi Access</li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/home-access/home_access_center/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:auto-entities</code></li> <li><code>custom:card-mod</code></li> <li><code>custom:fold-entity-row</code></li> <li><code>custom:hui-element</code></li> <li><code>custom:mushroom-title-card</code></li> <li><code>custom:template-entity-row</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/home-access/home_access_center/#configuration","title":"Configuration","text":"<pre><code>title: Home Access Center\nicon: mdi:key-chain\ntype: sections\nsections:\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: User Management\n    alignment: center\n    title_tap_action:\n      action: none\n    subtitle_tap_action:\n      action: none\n  - type: heading\n    heading: User Registry\n    icon: mdi:fingerprint\n    heading_style: title\n    card_mod:\n      style: \"ha-card {\\n  border: none;\\n  --primary-text-color: var(--green-color);\\n\\\n        \\  --secondary-text-color: var(--green-color);\\n  --card-mod-icon-color: var(--green-color);\\n\\\n        }\\n\"\n  - type: entities\n    title: System Instructions\n    entities:\n    - type: custom:fold-entity-row\n      head:\n        type: section\n        label: \ud83d\udd10 Unifi Unified Access\n      entities:\n      - type: custom:hui-element\n        card_type: markdown\n        content: '## UniFi Configuration\n\n          1. Create User: Ensure a local user exists in the UniFi Console (e.g., \"Guest\").\n\n\n          2. Enroll: Go to G4 Doorbell Settings &gt; NFC/Fingerprints &gt; Add New. Scan\n          your finger or card and assign it to the UniFi user.\n\n\n          3. Test: Scan the credential at the doorbell to verify it is accepted.\n\n          ---\n\n          ## Home Assistant Setup\n\n          * New Credentials: Wait for the \"New NFC ID\" notification. Open Home Access\n          Center and map the new ID to a Home Assistant user to enable permissions.\n\n\n          * Existing Credentials: No action required; the credential will immediately\n          inherit the user''s existing access rules.\n\n\n          ---\n\n\n          ### Access Status\n\n\n          * \ud83d\udfe2 Green: Access Granted (Fingerprint AND NFC enabled).\n\n          * \ud83d\udfe0 Orange: Partial Access (Fingerprint OR NFC enabled) - \"Access still\n          granted\".\n\n          * \ud83d\udd34 Red: Access Denied (Fingerprint AND NFC disabled).\n\n          ---\n\n          ### \ud83d\udc64 Guest Access\n\n          - Assign user as **Guest** (or any name containing \"Guest\").\n\n          - Guests obey the **Guest Schedule** below.\n\n          - Standard users have **24/7 Access** (unless switched OFF).\n\n\n          ---\n\n\n          *\ud83d\udca1 New IDs appear automatically as \"Unknown\" when scanned.*\n\n          '\n  - type: heading\n    heading: Registered User List\n    icon: mdi:fingerprint\n    heading_style: title\n    card_mod:\n      style: \"ha-card {\\n  border: none;\\n  --primary-text-color: var(--green-color);\\n\\\n        \\  --secondary-text-color: var(--green-color);\\n  --card-mod-icon-color: var(--green-color);\\n\\\n        }\\n\"\n  - type: custom:auto-entities\n    card:\n      type: entities\n      title: Registered Unifi Users\n      icon: mdi:badge-account-outline\n    filter:\n      include:\n      - entity_id: select.unifi_user_*\n        options:\n          type: custom:template-entity-row\n          entity: this.entity_id\n          name: '{{ state_attr(config.entity, ''friendly_name'') | regex_replace(''(?i)unifi\n            access db unifi user'', ''Unifi User:'') }}\n\n            '\n          secondary: 'Last Changed: {{ states[config.entity].last_changed.strftime(''%d-%m\n            %H:%M'') }}'\n          icon: '{% set user_slug = states(config.entity) | slugify %} {% set fp =\n            is_state(''switch.fp_access_'' ~ user_slug, ''on'') %} {% set nfc = is_state(''switch.nfc_access_''\n            ~ user_slug, ''on'') %} {{ ''mdi:check-circle'' if (fp or nfc) else ''mdi:alert-circle''\n            }}'\n          card_mod:\n            style: \":host::before {\\n  content: \\\"\\\";\\n  display: block;\\n  height:\\\n              \\ 1px;\\n  background-color: #dddddd;\\n  opacity: 0.2;\\n  margin-top:\\\n              \\ 10px;\\n  margin-bottom: 10px;\\n}\\nstate-badge {\\n  color: {% set user_slug\\\n              \\ = states(config.entity) | slugify %}\\n         {% set fp = is_state('switch.fp_access_'\\\n              \\ ~ user_slug, 'on') %}\\n         {% set nfc = is_state('switch.nfc_access_'\\\n              \\ ~ user_slug, 'on') %}\\n         {% if fp and nfc %}\\n           lightgreen\\n\\\n              \\         {% elif fp or nfc %}\\n           orange\\n         {% else\\\n              \\ %}\\n           #FB6464\\n         {% endif %} !important;\\n}\\n\"\n      exclude: []\n    sort:\n      method: name\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: Access Management\n    alignment: center\n    title_tap_action:\n      action: none\n    subtitle_tap_action:\n      action: none\n  - type: heading\n    heading: Access Methods\n    icon: mdi:key-chain\n    heading_style: title\n    card_mod:\n      style: \"ha-card {\\n  border: none;\\n  --primary-text-color: var(--orange-color);\\n\\\n        \\  --secondary-text-color: var(--orange-color);\\n  --card-mod-icon-color:\\\n        \\ var(--orange-color);\\n}\\n\"\n  - type: custom:auto-entities\n    card:\n      type: entities\n      title: NFC Access\n      show_header_toggle: false\n    filter:\n      include:\n      - options:\n          type: custom:template-entity-row\n          entity: this.entity_id\n          name: '{{ state_attr(config.entity, ''friendly_name'') | replace(''Unifi\n            Access DB '', '''') }}\n\n            '\n          secondary: '{{ relative_time(states[config.entity].last_changed) }} ago\n\n            '\n          card_mod:\n            style: \":host::before {\\n  content: \\\"\\\";\\n  display: block;\\n  height:\\\n              \\ 1px;\\n  background-color: #dddddd;\\n  opacity: 0.2;\\n  margin-top:\\\n              \\ 10px;\\n  margin-bottom: 10px;\\n}\\nstate-badge {\\n  color: {{ 'green'\\\n              \\ if is_state(config.entity, 'on') else '#fb6464' }} !important;\\n}\\n\"\n        entity_id: switch.nfc_access_*\n      exclude:\n      - options: {}\n        state: unavailable\n    sort:\n      method: name\n  - type: custom:auto-entities\n    card:\n      type: entities\n      title: Fingerprint Access\n      show_header_toggle: false\n    filter:\n      include:\n      - options:\n          type: custom:template-entity-row\n          entity: this.entity_id\n          name: '{{ state_attr(config.entity, ''friendly_name'') | replace(''Unifi\n            Access DB '', '''') }}\n\n            '\n          secondary: '{{ relative_time(states[config.entity].last_changed) }} ago\n\n            '\n          card_mod:\n            style: \":host::before {\\n  content: \\\"\\\";\\n  display: block;\\n  height:\\\n              \\ 1px;\\n  background-color: #dddddd;\\n  opacity: 0.2;\\n  margin-top:\\\n              \\ 10px;\\n  margin-bottom: 10px;\\n}\\nstate-badge {\\n  color: {{ 'lightgreen'\\\n              \\ if is_state(config.entity, 'on') else '#fb6464' }} !important;\\n}\\n\"\n        entity_id: switch.fp_access_*\n      exclude:\n      - options: {}\n        state: unavailable\n    sort:\n      method: name\n  - type: heading\n    heading: Guest Access Schedule\n    icon: mdi:clock-outline\n    heading_style: title\n    card_mod:\n      style: \"ha-card {\\n  border: none;\\n  --primary-text-color: var(--orange-color);\\n\\\n        \\  --secondary-text-color: var(--orange-color);\\n  --card-mod-icon-color:\\\n        \\ var(--orange-color);\\n}\\n\"\n  - type: entities\n    title: Guest Schedule\n    show_header_toggle: false\n    state_color: true\n    entities:\n    - entity: input_datetime.guest_access_start\n      name: Start Time\n    - entity: input_datetime.guest_access_end\n      name: End Time\n    - type: custom:fold-entity-row\n      head:\n        type: section\n        label: Allowed Days\n      entities:\n      - input_boolean.guest_access_mon\n      - input_boolean.guest_access_tue\n      - input_boolean.guest_access_wed\n      - input_boolean.guest_access_thu\n      - input_boolean.guest_access_fri\n      - input_boolean.guest_access_sat\n      - input_boolean.guest_access_sun\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: Access Logs\n    alignment: center\n    title_tap_action:\n      action: none\n    subtitle_tap_action:\n      action: none\n  - type: heading\n    heading: Combined Access Logs\n    icon: mdi:key-chain\n    heading_style: title\n    card_mod:\n      style: \"ha-card {\\n  border: none;\\n  --primary-text-color: var(--orange-color);\\n\\\n        \\  --secondary-text-color: var(--orange-color);\\n  --card-mod-icon-color:\\\n        \\ var(--orange-color);\\n}\\n\"\n  - type: logbook\n    title: Recent Access (48h)\n    hours_to_show: 48\n    entities:\n    - lock.front_door_lock_cloud\n    - sensor.front_door_lock_operator\n    grid_options:\n      columns: 12\n      rows: 10\n  - type: heading\n    heading: Registered UUIDs\n    icon: mdi:fingerprint\n    heading_style: title\n    card_mod:\n      style: \"ha-card {\\n  border: none;\\n  --primary-text-color: var(--red-color);\\n\\\n        \\  --secondary-text-color: var(--red-color);\\n  --card-mod-icon-color: var(--red-color);\\n\\\n        }\\n\"\n  - type: entities\n    title: Registered User IDs\n    icon: mdi:identifier\n    entities:\n    - type: custom:fold-entity-row\n      head:\n        type: section\n        label: User ID List\n      entities:\n      - type: custom:hui-element\n        card_type: markdown\n        content: '## &lt;ha-icon icon=\"mdi:fingerprint\"&gt;&lt;/ha-icon&gt; Registred User IDs\n\n\n\n\n          | &lt;font color=orange&gt;Assigned User&lt;/font&gt; | &lt;font color=orange&gt;Fingerprint\n          ID&lt;/font&gt; |\n\n          | :--- | :--- |\n\n          {% set fingerprints = states.select | selectattr(''entity_id'', ''search'',\n          ''^select\\.unifi_user_'') | list -%}\n\n          {% for state in fingerprints | sort(attribute=''state'') -%}\n\n          {% set assigned = state.state | default(''Unknown'') -%}\n\n          {% if assigned in [''Unknown'', ''unknown'', ''unavailable''] -%}\n\n          | **{{ assigned }}** | `{{ (state.attributes.ulp_id | default(''unknown'')).strip()\n          }}` |\n\n          {% else -%}\n\n          {% set clean = assigned.replace('' Notifications'', '''').replace('' Notification'',\n          '''') -%}\n\n          {% set parts = clean.split('' '') -%}\n\n          {% if parts | length &gt; 1 and parts[0] == parts[-1] -%}\n\n          {% set display_name = parts[0] -%}\n\n          {% else -%}\n\n          {% set display_name = clean -%}\n\n          {% endif -%}\n\n          | **{{ display_name }}** | `{{ (state.attributes.ulp_id | default(''unknown'')).strip()\n          }}` |\n\n          {% endif -%}\n\n          {% else -%}\n\n          | No fingerprints | found yet |\n\n          {% endfor %}\n\n          '\nheader:\n  card:\n    type: markdown\n    text_only: true\n    content: '# Home Access Center'\nmax_columns: 4\ncards: []\npath: home-access-center\ntop_margin: false\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/backyard/","title":"Backyard","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/backyard/#backyard","title":"Backyard","text":"<p>Dashboard: Main Dashboard Path: <code>backyard</code></p> <p>Monitoring and control for the backyard, including Frigate cameras and environmental stats.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/backyard/#summary","title":"Summary","text":"<p>The Backyard dashboard provides a comprehensive overview of the outdoor area. It centers around a live Frigate camera feed for security monitoring, complemented by controls for outdoor lighting and door sensors. Environmental data (temperature and humidity) is visualized with color-coded graphs. The view also includes detailed occupancy settings and automation schedules, allowing for fine-tuned control over when the backyard automations are active.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/backyard/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:decluttering-card</code></li> <li><code>custom:frigate-card</code></li> <li><code>custom:mini-graph-card</code></li> <li><code>custom:mushroom-entity-card</code></li> <li><code>custom:mushroom-light-card</code></li> <li><code>custom:mushroom-title-card</code></li> <li><code>custom:scheduler-card</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/backyard/#configuration","title":"Configuration","text":"<pre><code>title: Backyard\ntype: sections\nlayout:\n  max_cols: 5\nbadges: []\ncards: []\nsections:\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: BACKYARD\n    alignment: center\n    title_tap_action:\n      action: navigate\n      navigation_path: /lovelace\n    subtitle: CONTROLS\n  - type: custom:frigate-card\n    cameras:\n    - camera_entity: camera.backyard_frigate\n    menu:\n      style: outside\n      position: bottom\n      buttons:\n        cameras:\n          enabled: false\n        frigate:\n          enabled: false\n        live:\n          enabled: true\n        recordings:\n          enabled: false\n          priority: 50\n        expand:\n          enabled: false\n        play:\n          enabled: true\n        screenshot:\n          enabled: true\n        snapshots:\n          enabled: false\n        clips:\n          priority: 30\n          enabled: true\n        timeline:\n          priority: 40\n          enabled: false\n        mute:\n          enabled: false\n        microphone:\n          enabled: false\n        download:\n          priority: 35\n      alignment: left\n      button_size: 48\n    view:\n      default: live\n      timeout_seconds: 1200\n    live:\n      preload: true\n      lazy_load: true\n      zoomable: true\n      draggable: false\n      show_image_during_load: false\n    media_gallery:\n      controls:\n        thumbnails: {}\n  - type: custom:mushroom-light-card\n    entity: light.backyard_plug\n    icon: mdi:string-lights\n    layout: vertical\n    name: Backyard Light\n    tap_action:\n      action: toggle\n    hold_action:\n      action: more-info\n    double_tap_action:\n      action: none\n    grid_options:\n      columns: 3\n      rows: 2\n  - type: custom:mushroom-entity-card\n    entity: binary_sensor.inner_back_door_contact\n    fill_container: true\n    layout: vertical\n    tap_action:\n      action: none\n    hold_action:\n      action: none\n    double_tap_action:\n      action: none\n    icon: mdi:door\n    name: Inner Door\n    grid_options:\n      columns: 3\n      rows: 2\n  - type: custom:mushroom-entity-card\n    entity: binary_sensor.backyard_door_sensor_contact\n    fill_container: true\n    layout: vertical\n    tap_action:\n      action: none\n    hold_action:\n      action: none\n    double_tap_action:\n      action: none\n    icon: mdi:door\n    name: Backyard Door\n    grid_options:\n      columns: 3\n      rows: 2\n  - type: custom:mushroom-entity-card\n    entity: binary_sensor.backyard_frigate_person_occupancy\n    layout: vertical\n    icon: mdi:account\n    grid_options:\n      columns: 3\n      rows: 2\n    name: Person(s)\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: ENVIRONMENT\n    alignment: center\n  - type: custom:mini-graph-card\n    hours_to_show: 24\n    name: Temperature\n    entities:\n    - sensor.backyard_temperature\n    color_thresholds:\n    - value: 0\n      color: skyblue\n    - value: 3\n      color: white\n    - value: 10\n      color: yellow\n    - value: 20\n      color: orange\n    - value: 25\n      color: red\n    layout_options:\n      grid_columns: 2\n  - type: custom:mini-graph-card\n    name: Humidity\n    entities:\n    - sensor.backyard_humidity\n    hours_to_show: 24\n    color_thresholds:\n    - value: 20\n      color: '#FF535B'\n    - value: 30\n      color: '#5FE787'\n    - value: 60\n      color: '#03A9F4'\n    layout_options:\n      grid_columns: 2\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: SETTINGS\n    alignment: center\n    subtitle: Occupancy\n  - type: custom:mushroom-entity-card\n    entity: input_select.backyard_presence\n    layout: vertical\n  - type: custom:mushroom-entity-card\n    entity: input_boolean.backyard_occupancy\n    layout: vertical\n  - type: custom:decluttering-card\n    template: area_occupancy_settings\n    variables:\n    - area: backyard\n    - area_name: Backyard\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: SCHEDULES\n      alignment: center\n    - type: markdown\n      content: These schedules work when they are set on and _Presence Automation\n        Mode_ is set to _Schedule Mode_\n  - type: custom:scheduler-card\n    include:\n    - input_select.backyard_automation_mode\n    - light.backyard_plug\n    exclude: []\n    discover_existing: false\n    tags:\n    - Backyard\n    title: false\n    display_options:\n      primary_info: default\n      secondary_info:\n      - relative-time\n      - time\n      - additional-tasks\n      icon: action\n    sort_by:\n    - state\n    - relative-time\n    time_step: 5\n    show_header_toggle: false\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: CAMERA SETTINGS\n    alignment: center\n  - type: entities\n    entities:\n    - entity: binary_sensor.backyard_cam_motion\n    - entity: select.backyard_cam_infrared_mode\n    - entity: binary_sensor.backyard_cam_is_dark\n    - entity: switch.backyard_cam_privacy_mode\n    - entity: switch.backyard_cam_detections_motion\n    - entity: number.backyard_cam_microphone_level\n    - entity: select.backyard_cam_hdr_mode\n    - entity: switch.backyard_cam_hdr_mode\n    - entity: switch.backyard_cam_overlay_show_date\n    - entity: switch.backyard_cam_overlay_show_name\n    - entity: switch.backyard_cam_overlay_show_nerd_mode\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: FRIGATE SETTINGS\n    alignment: center\n  - type: picture\n    image_entity: image.backyard_frigate_person\n    grid_options:\n      columns: 3\n      rows: auto\n  - type: entities\n    entities:\n    - entity: sensor.backyard_frigate_all_count\n    - entity: switch.backyard_frigate_detect\n    - entity: switch.backyard_frigate_motion\n    - entity: binary_sensor.backyard_frigate_motion\n    - entity: sensor.backyard_frigate_person_count\n    - entity: binary_sensor.backyard_frigate_person_occupancy\n    - entity: switch.backyard_frigate_recordings\n    - entity: switch.backyard_frigate_snapshots\n  visibility:\n  - condition: user\n    users:\n    - 5f4dd0e939344fd6b58ed4299cdafcd6\nmax_columns: 4\nsubview: false\npath: backyard\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/bathroom/","title":"Bathroom","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/bathroom/#bathroom","title":"Bathroom","text":"<p>Dashboard: Main Dashboard Path: <code>bathroom</code></p> <p>Controls for bathroom lights, floor heating, and appliance monitoring.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/bathroom/#summary","title":"Summary","text":"<p>This view manages the bathroom environment. It features a 'Streamline' header card summarizing key states (temperature, washing machine status, occupancy). Lighting controls allow separate adjustments for the sauna, table, and ceiling. A major focus is the smart floor heating system (Aqara W500), which includes a thermostat control, historical temperature graphs, and a dedicated timer automation for overriding default heating schedules.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/bathroom/#related-packages","title":"Related Packages","text":"<p>This view contains entities managed by:</p> <ul> <li>Aqara W500</li> <li>Nordpool Prices</li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/bathroom/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:decluttering-card</code></li> <li><code>custom:mushroom-entity-card</code></li> <li><code>custom:mushroom-light-card</code></li> <li><code>custom:mushroom-number-card</code></li> <li><code>custom:mushroom-title-card</code></li> <li><code>custom:scheduler-card</code></li> <li><code>custom:streamline-card</code></li> <li><code>custom:timer-bar-card</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/bathroom/#configuration","title":"Configuration","text":"<pre><code>theme: Backend-selected\ntitle: Bathroom\npath: bathroom\ntype: sections\nlayout:\n  max_cols: 5\nsubview: true\nbadges: []\ncards: []\nsections:\n- type: grid\n  cards:\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: bathroom\n      area_title: Bathroom\n      temperature_sensor: sensor.airthings_wave_temperature\n      indicator_1_entity: sensor.washing_machine_status\n      indicator_1_icon: mdi:washing-machine\n      indicator_1_state: Running\n      indicator_1_active_color: '#088CF8'\n      indicator_1_animation_on: blink 2s ease infinite\n      indicator_2_entity: input_select.bathroom_toilet_presence\n      indicator_2_icon: mdi:toilet\n      indicator_3_icon: mdi:shower-head\n      indicator_3_active_color: '#088CF8'\n      indicator_2_active_color: orange\n      indicator_3_entity: input_select.shower_presence\n      indicator_3_state: presence\n      indicator_2_state: presence\n      temp_sensor_entity: sensor.aqara_w500_temperature_smoothed\n      indicator_6_entity: sensor.aqara_w500_bathroom_heating_hvac\n      indicator_6_icon: mdi:heating-coil\n      indicator_6_state: heating\n      indicator_6_active_color: '#FF4444'\n      indicator_6_animation_on: blink 2s ease infinite\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: LIGHTS\n    alignment: center\n  - type: custom:mushroom-light-card\n    entity: light.bathroom_wall_box_switch_right\n    name: Sauna\n    layout: vertical\n    grid_options:\n      columns: 4\n      rows: 2\n  - type: custom:mushroom-light-card\n    entity: light.bathroom_lightstrip\n    layout: vertical\n    name: Table\n    grid_options:\n      columns: 4\n      rows: 2\n  - type: custom:mushroom-light-card\n    name: Ceiling\n    layout: vertical\n    grid_options:\n      columns: 4\n      rows: 2\n    entity: light.bathroom_wall_box_switch_right\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: APPLIANCES\n    alignment: center\n  - type: custom:mushroom-entity-card\n    entity: sensor.washing_machine_status\n    grid_options:\n      columns: 12\n      rows: 1\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: HEATING\n    alignment: center\n  - type: thermostat\n    entity: climate.aqara_w500\n    name: Bathroom Floor\n    show_current_as_primary: false\n    features:\n    - type: climate-hvac-modes\n  - type: history-graph\n    show_names: true\n    entities:\n    - entity: sensor.aqara_w500_state\n      name: ' '\n    - entity: climate.aqara_w500\n    - entity: sensor.aqara_w500_temperature_smoothed\n    hours_to_show: 24\n    logarithmic_scale: false\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: SETTINGS\n    alignment: center\n    subtitle: Occupancy\n  - type: custom:decluttering-card\n    template: area_occupancy_settings\n    variables:\n    - area: bathroom\n    - area_name: Bathroom\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: SCHEDULES\n      alignment: center\n    - type: markdown\n      content: These schedules work when they are set on and _Presence Automation\n        Mode_ is set to _Schedule Mode_\n  - type: heading\n    heading: Floor Heating Automations\n    heading_style: title\n  - type: custom:scheduler-card\n    title: Floor Heating\n    discover_existing: false\n    time_step: 5\n    tags:\n    - Bathroom\n    include:\n    - climate.aqara_w500\n    - sensor.nord_pool_fi_current_price\n    display_options:\n      secondary_info:\n      - relative-time\n    default_editor: single\n    sort_by:\n    - state\n    - relative-time\n    show_header_toggle: false\n  - type: markdown\n    content: '*Default Temperature* is the heating base temperature.\n\n\n      If the thermostate is turned higher than the default, the *Heating Timer* will\n      keep this new temperature until the timer runs out.\n\n\n      The *Heating Timer* tells how long the heating will still run'\n  - type: custom:timer-bar-card\n    entity: timer.bathroom_floor_heating_timer\n  - type: custom:mushroom-number-card\n    entity: input_number.bathroom_floor_heat_default_temperature\n    name: Default Temperature\n    grid_options:\n      columns: 6\n      rows: 2\n    icon_color: accent\n  - type: custom:mushroom-number-card\n    entity: input_number.bathroom_floor_heat_target_temperature\n    name: Target Temperature\n    grid_options:\n      columns: 6\n      rows: 2\n    icon_color: red\n  - type: custom:mushroom-number-card\n    entity: input_number.bathroom_floor_heat_override_duration\n    name: Heating Timer\n    grid_options:\n      columns: 12\n      rows: 2\n    icon_color: teal\nmax_columns: 4\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/bedroom/","title":"Bedroom","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/bedroom/#bedroom","title":"Bedroom","text":"<p>Dashboard: Main Dashboard Path: <code>bedroom</code></p> <p>Bedroom management including lighting, window blinds, and detailed sleep tracking sensors.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/bedroom/#summary","title":"Summary","text":"<p>The Bedroom dashboard focuses on comfort and sleep tracking. It provides controls for the ceiling and bed lights, as well as both window blinds and roller covers. Environmental health is monitored via CO2, temperature, and humidity graphs. A specialized section covers 'Bed Occupancy', aggregating data from pressure sensors and mmWave (FP2) sensors to accurately detect presence in bed for both sides, enabling advanced sleep automations.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/bedroom/#related-packages","title":"Related Packages","text":"<p>This view contains entities managed by:</p> <ul> <li>Scenes</li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/bedroom/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:auto-entities</code></li> <li><code>custom:decluttering-card</code></li> <li><code>custom:mushroom-cover-card</code></li> <li><code>custom:mushroom-light-card</code></li> <li><code>custom:mushroom-template-card</code></li> <li><code>custom:mushroom-title-card</code></li> <li><code>custom:scheduler-card</code></li> <li><code>custom:streamline-card</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/bedroom/#configuration","title":"Configuration","text":"<pre><code>theme: Backend-selected\ntitle: Bedroom\npath: bedroom\nsubview: true\ntype: sections\nlayout:\n  max_cols: 5\nbadges: []\ncards: []\nsections:\n- type: grid\n  cards:\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: bedroom\n      area_title: Bedroom\n      temperature_sensor: sensor.airthings_wave_temperature\n      temp_sensor_entity: sensor.bedroom_temperature\n      indicator_1_entity: cover.bedroom_window_blinds\n      indicator_1_icon: mdi:window-shutter\n      indicator_1_state: open\n      indicator_1_active_color: lightgreen\n      indicator_2_entity: cover.bedroom_window_roller_cover\n      indicator_2_icon: mdi:blinds-open\n      indicator_2_state: open\n      indicator_2_active_color: lightgreen\n      indicator_3_entity: input_boolean.bed_Evis_occupancy\n      indicator_3_icon: mdi:bed\n      indicator_3_state: 'on'\n      indicator_4_entity: input_boolean.bed_Guest-1_occupancy\n      indicator_4_icon: mdi:bed\n      indicator_4_state: 'on'\n      indicator_4_active_color: '#FF44C4'\n      indicator_3_active_color: '#088CF8'\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: ENVIRONMENT\n    alignment: center\n  - type: vertical-stack\n    cards:\n    - square: false\n      type: grid\n      cards:\n      - type: custom:decluttering-card\n        template: minigraph_co2\n        variables:\n        - sensor: sensor.bedroom_carbon_dioxide\n      - type: custom:decluttering-card\n        template: minigraph_temperature\n        variables:\n        - sensor: sensor.bedroom_temperature\n      - type: custom:decluttering-card\n        template: minigraph_humidity\n        variables:\n        - sensor: sensor.bedroom_humidity\n      columns: 3\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: LIGHTS\n    alignment: center\n  - type: custom:mushroom-light-card\n    entity: light.bedroom_ceiling_light\n    name: Ceiling\n    layout: vertical\n    show_brightness_control: true\n    use_light_color: true\n    grid_options:\n      columns: 6\n      rows: 3\n  - type: custom:mushroom-light-card\n    entity: light.bedroom_bed_light\n    layout: vertical\n    show_color_control: false\n    show_brightness_control: true\n    name: Bed\n    use_light_color: true\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: WINDOW COVERS\n    alignment: center\n  - type: custom:mushroom-cover-card\n    entity: cover.bedroom_window_blinds\n    show_position_control: true\n    show_buttons_control: false\n    tap_action:\n      action: none\n    name: Blinds\n    layout: vertical\n  - type: custom:mushroom-cover-card\n    entity: cover.bedroom_window_roller_cover\n    fill_container: false\n    show_position_control: false\n    show_buttons_control: true\n    tap_action:\n      action: none\n    name: Roller Blind\n    layout: vertical\n- type: grid\n  cards:\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: SCHEDULES\n      alignment: center\n    - square: false\n      type: grid\n      cards:\n      - type: custom:scheduler-card\n        tags:\n        - Bedroom\n        title: false\n        discover_existing: false\n        show_header_toggle: false\n        display_options:\n          primary_info: default\n          secondary_info:\n          - relative-time\n          - additional-tasks\n          icon: action\n        include:\n        - cover\n        - light\n        exclude: []\n      columns: 1\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: Sensors\n      alignment: center\n    - type: entities\n      entities:\n      - entity: sensor.bedroom_noise\n        name: Bedroom Noise\n      - entity: sensor.bedroom_temperature\n        name: Bedroom Temperature\n      - entity: sensor.bedroom_carbon_dioxide\n        name: Bedroom CO2\n      - entity: sensor.bedroom_humidity\n        name: Bedroom Humidity\n      show_header_toggle: false\n      state_color: true\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: null\n      alignment: center\n      subtitle: Battery Levels\n    - type: custom:auto-entities\n      card:\n        type: entities\n      filter:\n        include:\n        - entity_id: sensor.bedroom*battery*\n        exclude: []\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: SETTINGS\n    subtitle: Occupancy Settings\n    alignment: center\n  - type: custom:decluttering-card\n    template: area_occupancy_settings\n    variables:\n    - area: bedroom\n    - area_name: Bedroom\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: Bed Occupancy\n      alignment: center\n    - type: custom:mushroom-template-card\n      primary: \"Bed {% set status = states(entity) %}\\n{% if status == 'on' %}\\n \\\n        \\ Occupied\\n{% else %}\\n  Unoccupied\\n{% endif %}\"\n      secondary: ''\n      icon: \"{% set status = states(entity) %}\\n{% if status == 'on' %}\\n  mdi:bed-king\\n\\\n        {% else %}\\n  mdi:bed-king-outline\\n{% endif %}\"\n      layout: vertical\n      entity: input_boolean.bedroom_bed_occupancy\n      icon_color: \"{% set status = states(entity) %}\\n{% if status == 'on' %}\\n green\\n\\\n        {% else %}\\n  white\\n{% endif %}\"\n      fill_container: true\n      tap_action:\n        action: none\n      hold_action:\n        action: more-info\n      double_tap_action:\n        action: none\n    - square: false\n      type: grid\n      cards:\n      - type: custom:mushroom-template-card\n        primary: \"Evis {% set status = states(entity) %}\\n{% if status == 'on' %}\\n\\\n          \\  in Bed\\n{% else %}\\n  not in Bed\\n{% endif %}\"\n        secondary: ''\n        icon: \"{% set status = states(entity) %}\\n{% if status == 'on' %}\\n  mdi:bed\\n\\\n          {% else %}\\n  mdi:bed-empty\\n{% endif %}\"\n        layout: vertical\n        entity: binary_sensor.master_bed_sensor_master_bed_occupancy_left\n        icon_color: \"{% set status = states(entity) %}\\n{% if status == 'on' %}\\n\\\n          \\  blue\\n{% else %}\\n  white\\n{% endif %}\"\n        fill_container: true\n        tap_action:\n          action: none\n        hold_action:\n          action: more-info\n        double_tap_action:\n          action: none\n      - type: custom:mushroom-template-card\n        primary: \"Guest-1 {% set status = states(entity) %}\\n{% if status == 'on'\\\n          \\ %}\\n  in Bed\\n{% else %}\\n  not in Bed\\n{% endif %}\"\n        secondary: ''\n        icon: \"{% set status = states(entity) %}\\n{% if status == 'on' %}\\n  mdi:bed\\n\\\n          {% else %}\\n  mdi:bed-empty\\n{% endif %}\"\n        layout: vertical\n        entity: binary_sensor.master_bed_sensor_master_bed_occupancy_right\n        icon_color: \"{% set status = states(entity) %}\\n{% if status == 'on' %}\\n\\\n          \\  red\\n{% else %}\\n  white\\n{% endif %}\"\n        fill_container: true\n        tap_action:\n          action: none\n        hold_action:\n          action: more-info\n        double_tap_action:\n          action: none\n      - type: entities\n        entities:\n        - entity: binary_sensor.bedroom_bed_1_pressure_sensor\n          name: Pressure\n          icon: mdi:bed-outline\n          state_color: true\n        - entity: binary_sensor.bedroom_bed_Evis_fp2_occupancy\n          name: Bed FP2\n          icon: mdi:bed\n          state_color: true\n        - entity: binary_sensor.bedroom_bedside_Evis_fp2_sensor\n          name: Bedside\n          icon: mdi:walk\n          state_color: true\n        - entity: binary_sensor.bedroom_office_fp2_occupancy\n          name: Office FP2\n          icon: mdi:desk\n          state_color: true\n        - entity: sensor.master_bed_sensor_master_bed_occupancy_left_value\n      - type: entities\n        entities:\n        - entity: binary_sensor.bedroom_bed_2_pressure_sensor\n          name: Pressure\n          icon: mdi:bed-outline\n          state_color: true\n        - entity: binary_sensor.bedroom_bed_Guest-1_fp2_occupancy\n          name: Bed FP2\n          icon: mdi:bed\n          state_color: true\n        - entity: binary_sensor.bedroom_bedside_Guest-1_fp2_sensor\n          name: Bedside\n          icon: mdi:walk\n          state_color: true\n        - entity: binary_sensor.bedroom_office_fp2_occupancy\n          name: Office FP2\n          icon: mdi:desk\n          state_color: true\n        - entity: sensor.master_bed_sensor_master_bed_occupancy_right_value\n      columns: 2\nmax_columns: 4\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/daughter/","title":"Daughter","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/daughter/#daughter","title":"Daughter","text":"<p>Dashboard: Main Dashboard Path: <code>Daughter</code></p> <p>Controls for the daughter's room (Guest Room) including lights and schedules.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/daughter/#summary","title":"Summary","text":"<p>This dashboard manages the daughter's room. It includes a header card labeled 'Guest Room' with bed presence indication. The view provides controls for the ceiling light and other lights, along with occupancy settings and a scheduler for automating lighting based on presence modes.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/daughter/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:decluttering-card</code></li> <li><code>custom:mushroom-light-card</code></li> <li><code>custom:mushroom-title-card</code></li> <li><code>custom:scheduler-card</code></li> <li><code>custom:streamline-card</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/daughter/#configuration","title":"Configuration","text":"<pre><code>theme: Backend-selected\ntitle: Daughter\npath: Daughter\ntype: sections\nlayout: max_cols:5\nsubview: true\nbadges: []\ncards: []\nmax_columns: 5\nsections:\n- type: grid\n  cards:\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: Daughter\n      area_title: Guest Room\n      temperature_sensor: sensor.airthings_wave_temperature\n      indicator_1_entity: binary_sensor.Daughter_bed_fp2_presence_sensor\n      indicator_1_icon: mdi:bed-king\n      indicator_1_state: 'on'\n      indicator_1_active_color: lightgreen\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: LIGHTS\n    alignment: center\n  - type: custom:mushroom-light-card\n    entity: light.Daughter_ceiling_light\n    use_light_color: false\n    show_brightness_control: true\n    show_color_temp_control: true\n    collapsible_controls: false\n    layout: vertical\n    fill_container: true\n    grid_options:\n      columns: 12\n      rows: 2\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: SETTINGS\n    alignment: center\n    subtitle: OCCUPANCY SETTINGS\n  - type: custom:decluttering-card\n    template: area_occupancy_settings\n    variables:\n    - area: Daughter\n    - area_name: Daughter\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: SCHEDULES\n      alignment: center\n    - type: markdown\n      content: These schedules work when they are set on and _Presence Automation\n        Mode_ is set to _Schedule Mode_\n  - type: custom:scheduler-card\n    include:\n    - input_select.Daughter_automation_mode\n    - light.Daughter_ceiling_light\n    - light.Daughter_lights\n    exclude: []\n    discover_existing: false\n    tags:\n    - Daughter\n    time_step: 1\n    show_header_toggle: false\n    title: false\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/electricity/","title":"Electricity","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/electricity/#electricity","title":"Electricity","text":"<p>Dashboard: Main Dashboard Path: <code>electricity</code></p> <p>Comprehensive energy dashboard showing real-time prices, historical usage, and cost analysis.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/electricity/#summary","title":"Summary","text":"<p>The Electricity dashboard is a detailed analytics hub for home energy. It features sophisticated charts tracking today's and tomorrow's hourly electricity prices (Nordpool), dynamically color-coded based on daily highs and lows. It also monitors daily energy consumption and real-time power usage via Shelly 3EM, providing cost estimates and historical usage trends.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/electricity/#related-packages","title":"Related Packages","text":"<p>This view contains entities managed by:</p> <ul> <li>Aqara W500</li> <li>Nordpool Prices</li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/electricity/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:apexcharts-card</code></li> <li><code>custom:config-template-card</code></li> <li><code>custom:mushroom-entity-card</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/electricity/#configuration","title":"Configuration","text":"<pre><code>type: sections\nmax_columns: 4\ntitle: Electricity\npath: electricity\nsections:\n- type: grid\n  cards:\n  - type: heading\n    heading: Today's Energy Prices Per Hour\n    heading_style: subtitle\n  - square: false\n    columns: 1\n    type: grid\n    cards:\n    - type: custom:config-template-card\n      variables:\n        PRICEHIGH: states['sensor.electricity_today_32nd_highest_price'].state\n        PRICELOW: states['sensor.electricity_today_32nd_lowest_price'].state\n      entities:\n      - sensor.electricity_prices\n      card:\n        type: custom:apexcharts-card\n        graph_span: 1d\n        span:\n          start: day\n        apex_config:\n          stroke:\n            dashArray: 4\n          chart:\n            height: 280px\n            width: 115%\n            offsetX: -30\n          title:\n            text: Energy Price Today\n            align: center\n            offsetY: 0\n            margin: 30\n            style:\n              fontSize: 13px\n              fontFamily: Verdana\n              fontWeight: normal\n          grid:\n            show: true\n            borderColor: rgba(255,255,255,0.2)\n          xaxis:\n            position: bottom\n            labels:\n              format: H\n              hideOverlappingLabels: true\n              offsetX: 0\n            axisTicks:\n              offsetX: 0\n            all_series_config:\n              show:\n                offset_in_name: true\n          legend:\n            show: true\n            position: bottom\n            horizontalAlign: left\n            fontSize: 14px\n            itemMargin:\n              vertical: 10\n              horizontal: 10\n          tooltip:\n            enabled: false\n            style:\n              fontSize: 14px\n        header:\n          title: Electricity Today\n          standard_format: false\n          show: false\n          show_states: true\n          colorize_states: true\n        show:\n          last_updated: true\n        experimental:\n          color_threshold: true\n        now:\n          show: true\n        yaxis:\n        - id: cost\n          opposite: true\n          decimals: 1\n          apex_config:\n            tickAmount: 4\n            labels:\n              show: true\n            title:\n              text: c/kWh\n              rotate: 0\n              offsetX: -25\n              offsetY: -90\n              style:\n                fontSize: 10px\n                fontFamily: verdana\n                color: orange\n        - id: energy\n          max: ~2\n          min: 0\n          decimals: 1\n          apex_config:\n            tickAmount: 4\n            labels:\n              show: true\n            title:\n              text: kWh\n              rotate: 0\n              offsetX: 25\n              offsetY: -90\n              style:\n                color: skyblue\n                fontSize: 10px\n                fontFamily: verdana\n        series:\n        - entity: sensor.electricity_prices\n          name: Price\n          yaxis_id: cost\n          type: column\n          opacity: 0.8\n          stroke_width: 0\n          show:\n            legend_value: false\n            extremas: true\n            in_header: true\n            header_color_threshold: true\n          data_generator: \"return entity.attributes.data.map(entry =&gt; {\\n  return\\\n            \\ [new Date(entry.start).getTime(), entry.price];\\n});\\n\"\n          color_threshold:\n          - value: -10\n            color: lightgreen\n          - value: ${PRICELOW * 1}\n            color: orange\n          - value: ${PRICEHIGH * 1}\n            color: darkred\n        - entity: sensor.electricity_daily_average_cents\n          name: Avg Price\n          yaxis_id: cost\n          type: line\n          color: yellow\n          stroke_width: 1\n          opacity: 0.8\n          group_by:\n            func: last\n            duration: 24h\n          show:\n            legend_value: false\n            datalabels: false\n            extremas: true\n            in_header: true\n        - entity: sensor.home_total_energy_hourly\n          name: Energy (kWh)\n          color: skyblue\n          type: line\n          opacity: 1\n          yaxis_id: energy\n          stroke_width: 2\n          float_precision: 1\n          unit: kWh\n          group_by:\n            duration: 1h\n            func: delta\n          show:\n            legend_value: false\n            datalabels: false\n            extremas: true\n            in_header: raw\n            header_color_threshold: true\n  - type: heading\n    heading: Tomorrow's Energy Prices Per 15 minutes\n    heading_style: subtitle\n  - square: false\n    columns: 1\n    type: grid\n    cards:\n    - type: custom:config-template-card\n      variables:\n        PRICEHIGH: states['sensor.nordpool_today_32nd_highest_price'].state\n        PRICELOW: states['sensor.nordpool_today_32nd_lowest_price'].state\n      entities:\n      - sensor.nordpool_kwh_fi_eur\n      card:\n        type: custom:apexcharts-card\n        graph_span: 1d\n        span:\n          start: day\n        apex_config:\n          stroke:\n            dashArray: 2\n          chart:\n            height: 180px\n            width: 115%\n            offsetX: -30\n          title:\n            text: Energy Price Today\n            align: center\n            offsetY: 10\n            style:\n              fontSize: 13px\n              fontFamily: Verdana\n              fontWeight: normal\n          grid:\n            show: true\n            borderColor: rgba(255,255,255,0.2)\n          xaxis:\n            position: bottom\n            labels:\n              format: H\n              hideOverlappingLabels: true\n              offsetX: 0\n            axisTicks:\n              offsetX: 0\n          legend:\n            show: false\n            itemMargin:\n              vertical: 10\n              horizontal: 10\n          tooltip:\n            enabled: false\n            style:\n              fontSize: 14px\n        show:\n          last_updated: true\n        experimental:\n          color_threshold: true\n        header:\n          show_states: true\n          colorize_states: true\n        now:\n          show: true\n        yaxis:\n        - id: cost\n          opposite: true\n          decimals: 1\n          apex_config:\n            tickAmount: 4\n            labels:\n              show: true\n            title:\n              text: c/kWh\n              rotate: 0\n              offsetX: -25\n              offsetY: -70\n              style:\n                fontSize: 10px\n                fontFamily: verdana\n                color: orange\n        - id: energy\n          max: ~2\n          min: 0\n          decimals: 1\n          apex_config:\n            tickAmount: 4\n            labels:\n              show: true\n            title:\n              text: kWh\n              rotate: 0\n              offsetX: 25\n              offsetY: -70\n              style:\n                color: skyblue\n                fontSize: 10px\n                fontFamily: verdana\n        series:\n        - entity: sensor.nordpool_kwh_fi_eur\n          name: Price\n          yaxis_id: cost\n          type: column\n          opacity: 0.8\n          stroke_width: 0\n          show:\n            extremas: true\n            in_header: raw\n            header_color_threshold: true\n          data_generator: \"return entity.attributes.raw_today.map((start, index) =&gt;\\\n            \\ {\\n  return [new Date(start[\\\"start\\\"]).getTime(), entity.attributes.raw_today[index][\\\"\\\n            value\\\"]];\\n});\\n\"\n          color_threshold:\n          - value: -10\n            color: lightgreen\n          - value: ${PRICELOW*1}\n            color: orange\n          - value: ${PRICEHIGH * 1}\n            color: darkred\n        - entity: sensor.home_total_energy_hourly\n          name: Energy (kWh)\n          color: skyblue\n          type: line\n          opacity: 1\n          yaxis_id: energy\n          stroke_width: 2\n          float_precision: 1\n          extend_to: false\n          unit: kWh\n          group_by:\n            duration: 15min\n            func: diff\n          show:\n            legend_value: false\n            datalabels: false\n            extremas: true\n            in_header: raw\n            header_color_threshold: true\n  - type: custom:config-template-card\n    variables:\n      PRICEHIGH: states['sensor.electricity_tomorrow_32nd_highest_price'].state\n      PRICELOW: states['sensor.electricity_tomorrow_32nd_lowest_price'].state\n    entities:\n    - sensor.electricity_prices\n    card:\n      type: custom:apexcharts-card\n      graph_span: 1d\n      span:\n        start: day\n        offset: +1d\n      apex_config:\n        stroke:\n          dashArray: 4\n        chart:\n          height: 180px\n          width: 115%\n          offsetX: -30\n        title:\n          text: Energy Price Tomorrow\n          align: center\n          offsetY: 10\n          style:\n            fontSize: 13px\n            fontFamily: Verdana\n            fontWeight: normal\n        grid:\n          show: true\n          borderColor: rgba(255,255,255,0.2)\n        xaxis:\n          position: bottom\n          labels:\n            format: H\n            hideOverlappingLabels: true\n            offsetX: 0\n          axisTicks:\n            offsetX: 0\n        legend:\n          show: false\n          itemMargin:\n            vertical: 10\n            horizontal: 10\n        tooltip:\n          enabled: false\n          style:\n            fontSize: 14px\n      show:\n        last_updated: true\n      experimental:\n        color_threshold: true\n      header:\n        show_states: true\n        colorize_states: true\n      now:\n        show: true\n      yaxis:\n      - id: cost\n        opposite: true\n        decimals: 1\n        apex_config:\n          tickAmount: 4\n          labels:\n            show: true\n          title:\n            text: c/kWh\n            rotate: 0\n            offsetX: -25\n            offsetY: -70\n            style:\n              fontSize: 10px\n              fontFamily: verdana\n              color: orange\n      - id: energy\n        max: ~2\n        min: 0\n        decimals: 1\n        apex_config:\n          tickAmount: 4\n          labels:\n            show: true\n          title:\n            text: kWh\n            rotate: 0\n            offsetX: 25\n            offsetY: -70\n            style:\n              color: skyblue\n              fontSize: 10px\n              fontFamily: verdana\n      series:\n      - entity: sensor.electricity_prices\n        name: Price\n        yaxis_id: cost\n        type: column\n        opacity: 0.8\n        stroke_width: 0\n        show:\n          extremas: true\n          in_header: raw\n          header_color_threshold: true\n        data_generator: \"const tomorrow = new Date();\\ntomorrow.setHours(0, 0, 0,\\\n          \\ 0);\\ntomorrow.setDate(tomorrow.getDate() + 1);\\n\\nreturn entity.attributes.data\\n\\\n          \\  .filter(entry =&gt; new Date(entry.start) &gt;= tomorrow)\\n  .map(entry =&gt;\\\n          \\ [new Date(entry.start).getTime(), entry.price]);\\n\"\n        color_threshold:\n        - value: -10\n          color: lightgreen\n        - value: ${PRICELOW * 1}\n          color: orange\n        - value: ${PRICEHIGH * 1}\n          color: darkred\n      - entity: sensor.home_total_energy_hourly\n        name: Energy (kWh)\n        color: skyblue\n        type: line\n        opacity: 1\n        yaxis_id: energy\n        stroke_width: 2\n        float_precision: 1\n        extend_to: false\n        unit: kWh\n        group_by:\n          duration: 1hour\n          func: max\n        show:\n          legend_value: false\n          datalabels: false\n          extremas: true\n          in_header: raw\n          header_color_threshold: true\n    visibility:\n    - condition: state\n      entity: sensor.electricity_tomorrow_valid\n      state: 'True'\n- type: grid\n  cards:\n  - type: heading\n    heading: Energy Usage\n    heading_style: subtitle\n  - type: custom:apexcharts-card\n    graph_span: 7d\n    update_interval: 15min\n    apex_config:\n      fill:\n        opacity: 0.5\n      markers:\n        size: 3\n      xaxis:\n        showDuplicates: true\n        position: bottom\n        labels:\n          format: ddd\n          hideOverlappingLabels: false\n      chart:\n        height: 180px\n      grid:\n        show: true\n        borderColor: rgba(255,255,255,0.2)\n      legend:\n        show: true\n        itemMargin:\n          vertical: 10\n          horizontal: 10\n      dataLabels:\n        enabled: true\n        position: top\n        offsetY: -8\n        background:\n          enabled: false\n      tooltip:\n        style:\n          fontSize: 14px\n      stroke:\n        dashArray: 0\n      title:\n        text: Energy Daily\n        align: center\n        offsetY: 10\n        style:\n          fontSize: 13px\n          fontFamily: Verdana\n          fontWeight: normal\n    header:\n      show: false\n    yaxis:\n    - id: cost\n      max: ~100\n      min: 0\n      decimals: 0\n      apex_config:\n        tickAmount: 4\n        labels:\n          show: true\n    - id: power\n      opposite: true\n      max: ~35\n      min: 0\n      decimals: 0\n      apex_config:\n        tickAmount: 7\n        labels:\n          show: true\n        title:\n          text: kWh\n          rotate: 0\n          offsetX: -25\n          offsetY: -70\n          style:\n            fontSize: 10px\n            fontFamily: verdana\n            color: orange\n    series:\n    - entity: sensor.home_total_energy_daily\n      name: Energy (kWh)\n      color: skyblue\n      type: column\n      yaxis_id: power\n      stroke_width: 1\n      float_precision: 1\n      unit: kWh\n      statistics:\n        type: state\n      group_by:\n        duration: 1day\n        func: max\n      show:\n        legend_value: false\n        datalabels: true\n  - square: false\n    columns: 1\n    type: grid\n    cards:\n    - type: custom:config-template-card\n      variables:\n        PRICEHIGH: states['sensor.electricity_today_32nd_highest_price'].state\n        PRICELOW: states['sensor.electricity_today_32nd_lowest_price'].state\n      entities:\n      - sensor.electricity_prices\n      card:\n        type: custom:apexcharts-card\n        graph_span: 1d\n        span:\n          start: day\n        apex_config:\n          stroke:\n            dashArray: 4\n          chart:\n            height: 180px\n            width: 115%\n            offsetX: -30\n          title:\n            text: Energy Price Today\n            align: center\n            offsetY: 10\n            style:\n              fontSize: 13px\n              fontFamily: Verdana\n              fontWeight: normal\n          grid:\n            show: true\n            borderColor: rgba(255,255,255,0.2)\n          xaxis:\n            position: bottom\n            labels:\n              format: H\n              hideOverlappingLabels: true\n              offsetX: 0\n            axisTicks:\n              offsetX: 0\n          legend:\n            show: false\n            itemMargin:\n              vertical: 10\n              horizontal: 10\n          tooltip:\n            enabled: true\n            style:\n              fontSize: 14px\n        show:\n          last_updated: true\n        experimental:\n          color_threshold: true\n        header:\n          show_states: true\n          colorize_states: true\n        now:\n          show: true\n        yaxis:\n        - id: cost\n          opposite: true\n          decimals: 1\n          apex_config:\n            tickAmount: 4\n            labels:\n              show: true\n            title:\n              text: c/kWh\n              rotate: 0\n              offsetX: -25\n              offsetY: -70\n              style:\n                fontSize: 10px\n                fontFamily: verdana\n                color: orange\n        - id: energy\n          max: ~2\n          min: 0\n          decimals: 1\n          apex_config:\n            tickAmount: 4\n            labels:\n              show: true\n            title:\n              text: kWh\n              rotate: 0\n              offsetX: 25\n              offsetY: -70\n              style:\n                color: skyblue\n                fontSize: 10px\n                fontFamily: verdana\n        series:\n        - entity: sensor.electricity_prices\n          name: Price\n          yaxis_id: cost\n          type: column\n          opacity: 0.8\n          stroke_width: 0\n          show:\n            extremas: true\n            in_header: raw\n            header_color_threshold: true\n          data_generator: \"return entity.attributes.data.map(entry =&gt; {\\n  return\\\n            \\ [new Date(entry.start).getTime(), entry.price];\\n});\\n\"\n          color_threshold:\n          - value: -10\n            color: lightgreen\n          - value: ${PRICELOW * 1}\n            color: orange\n          - value: ${PRICEHIGH * 1}\n            color: darkred\n        - entity: sensor.home_total_energy_hourly\n          name: Energy (kWh)\n          color: skyblue\n          type: line\n          opacity: 1\n          yaxis_id: energy\n          stroke_width: 2\n          float_precision: 1\n          extend_to: false\n          unit: kWh\n          group_by:\n            duration: 1hour\n            func: max\n          show:\n            legend_value: false\n            datalabels: false\n            extremas: true\n            in_header: raw\n            header_color_threshold: true\n  - type: custom:config-template-card\n    variables:\n      PRICEHIGH: states['sensor.electricity_tomorrow_32nd_highest_price'].state\n      PRICELOW: states['sensor.electricity_tomorrow_32nd_lowest_price'].state\n    entities:\n    - sensor.electricity_prices\n    card:\n      type: custom:apexcharts-card\n      graph_span: 1d\n      span:\n        start: day\n        offset: +1d\n      apex_config:\n        stroke:\n          dashArray: 4\n        chart:\n          height: 180px\n          width: 115%\n          offsetX: -30\n        title:\n          text: Energy Price Tomorrow\n          align: center\n          offsetY: 10\n          style:\n            fontSize: 13px\n            fontFamily: Verdana\n            fontWeight: normal\n        grid:\n          show: true\n          borderColor: rgba(255,255,255,0.2)\n        xaxis:\n          position: bottom\n          labels:\n            format: H\n            hideOverlappingLabels: true\n            offsetX: 0\n          axisTicks:\n            offsetX: 0\n        legend:\n          show: false\n          itemMargin:\n            vertical: 10\n            horizontal: 10\n        tooltip:\n          shared: false\n          enabled: true\n          followCursor: false\n          style:\n            fontSize: 11px\n          x:\n            show: false\n      show:\n        last_updated: true\n      experimental:\n        color_threshold: true\n      header:\n        show_states: true\n        colorize_states: true\n      now:\n        show: true\n      yaxis:\n      - id: cost\n        opposite: true\n        decimals: 1\n        apex_config:\n          tickAmount: 4\n          labels:\n            show: true\n          title:\n            text: c/kWh\n            rotate: 0\n            offsetX: -25\n            offsetY: -70\n            style:\n              fontSize: 10px\n              fontFamily: verdana\n              color: orange\n      - id: energy\n        max: ~2\n        min: 0\n        decimals: 1\n        apex_config:\n          tickAmount: 4\n          labels:\n            show: true\n          title:\n            text: kWh\n            rotate: 0\n            offsetX: 25\n            offsetY: -70\n            style:\n              color: skyblue\n              fontSize: 10px\n              fontFamily: verdana\n      series:\n      - entity: sensor.electricity_prices\n        name: Price\n        yaxis_id: cost\n        type: column\n        opacity: 0.8\n        stroke_width: 0\n        show:\n          extremas: true\n          in_header: raw\n          header_color_threshold: true\n        data_generator: \"const tomorrow = new Date();\\ntomorrow.setHours(0, 0, 0,\\\n          \\ 0);\\ntomorrow.setDate(tomorrow.getDate() + 1);\\n\\nreturn entity.attributes.data\\n\\\n          \\  .filter(entry =&gt; new Date(entry.start) &gt;= tomorrow)\\n  .map(entry =&gt;\\\n          \\ [new Date(entry.start).getTime(), entry.price]);\\n\"\n        color_threshold:\n        - value: -10\n          color: lightgreen\n        - value: ${PRICELOW * 1}\n          color: orange\n        - value: ${PRICEHIGH * 1}\n          color: darkred\n      - entity: sensor.home_total_energy_hourly\n        name: Energy (kWh)\n        color: skyblue\n        type: line\n        opacity: 1\n        yaxis_id: energy\n        stroke_width: 2\n        float_precision: 1\n        extend_to: false\n        unit: kWh\n        group_by:\n          duration: 1hour\n          func: max\n        show:\n          legend_value: false\n          datalabels: false\n          extremas: true\n          in_header: raw\n          header_color_threshold: true\n  - type: custom:apexcharts-card\n    graph_span: 1d\n    span:\n      start: day\n    header:\n      show: false\n      show_states: true\n      colorize_states: true\n    apex_config:\n      stroke:\n        dashArray: 0\n      chart:\n        height: 200px\n        width: 115%\n        offsetX: -30\n      title:\n        text: Energy Price Today\n        align: center\n        offsetY: 10\n        style:\n          fontSize: 13px\n          fontFamily: Verdana\n          fontWeight: normal\n      grid:\n        show: true\n        borderColor: rgba(255,255,255,0.2)\n      xaxis:\n        position: bottom\n        labels:\n          format: HH\n        hideOverlappingLabels: true\n      tooltip:\n        enabled: false\n        style:\n          fontSize: 14px\n    now:\n      show: true\n    experimental:\n      color_threshold: true\n    yaxis:\n    - id: price\n      opposite: true\n      decimals: 1\n      apex_config:\n        tickAmount: 4\n        labels:\n          show: true\n        title:\n          text: c/kWh\n          rotate: 0\n          offsetX: -25\n          offsetY: -70\n          style:\n            fontSize: 10px\n            fontFamily: verdana\n            color: orange\n    - id: energy\n      max: ~1\n      min: 0\n      decimals: 1\n      apex_config:\n        tickAmount: 4\n        labels:\n          show: true\n        title:\n          text: kWh\n          rotate: 0\n          offsetX: 25\n          offsetY: -70\n          style:\n            color: skyblue\n            fontSize: 10px\n            fontFamily: verdana\n    series:\n    - entity: sensor.electricity_prices\n      name: Price\n      yaxis_id: price\n      type: column\n      opacity: 0.6\n      show:\n        extremas: true\n        in_header: raw\n        header_color_threshold: true\n      data_generator: \"if (!entity.attributes.data) return [];\\nconst today = new\\\n        \\ Date();\\ntoday.setHours(0, 0, 0, 0);\\nconst tomorrow = new Date(today);\\n\\\n        tomorrow.setDate(today.getDate() + 1);\\n\\nreturn entity.attributes.data\\n\\\n        \\  .filter(entry =&gt; {\\n    const start = new Date(entry.start);\\n    return\\\n        \\ start &gt;= today &amp;&amp; start &lt; tomorrow;\\n  })\\n  .map(entry =&gt; [new Date(entry.start).getTime(),\\\n        \\ entry.price]);\\n\"\n      color_threshold:\n      - value: -10\n        color: lightgreen\n      - value: 15\n        color: orange\n      - value: 20\n        color: red\n    - entity: sensor.home_total_energy\n      name: Energy\n      yaxis_id: energy\n      type: line\n      group_by:\n        duration: 15min\n        func: diff\n      color: skyblue\n      opacity: 1\n      stroke_width: 2\n      show:\n        extremas: true\n        in_header: raw\n        header_color_threshold: true\n  - type: custom:apexcharts-card\n    header:\n      title: Shelly 3M - Energy Usage Today\n    graph_span: 1d\n    span:\n      start: day\n    update_interval: 5min\n    apex_config:\n      title:\n        text: Energy Usage Today\n        align: center\n        offsetY: 10\n        style:\n          fontSize: 13px\n          fontFamily: Verdana\n          fontWeight: normal\n      chart:\n        height: 180px\n      stroke:\n        dashArray: 4\n      grid:\n        show: true\n        borderColor: rgba(255,255,255,0.2)\n      xaxis:\n        position: bottom\n        labels:\n          format: HH\n      tooltip:\n        enabled: false\n        style:\n          fontSize: 14px\n    yaxis:\n    - decimals: 2\n      min: 0\n    series:\n    - entity: sensor.home_total_3em_energy\n      name: Energy Usage\n      type: column\n      group_by:\n        duration: 15min\n        func: diff\n      color: skyblue\n      opacity: 0.8\n      stroke_width: 0\n      show:\n        extremas: true\n        in_header: raw\n        header_color_threshold: true\n  - type: custom:apexcharts-card\n    graph_span: 1d\n    span:\n      start: day\n    header:\n      show: false\n      show_states: true\n      colorize_states: true\n    apex_config:\n      stroke:\n        dashArray: 2\n      chart:\n        height: 200px\n        width: 115%\n        offsetX: -30\n      title:\n        text: Energy Price Today\n        align: center\n        offsetY: 10\n        style:\n          fontSize: 13px\n          fontFamily: Verdana\n          fontWeight: normal\n      grid:\n        show: true\n        borderColor: rgba(255,255,255,0.2)\n      xaxis:\n        position: bottom\n        labels:\n          format: HH\n        hideOverlappingLabels: true\n      tooltip:\n        enabled: false\n        style:\n          fontSize: 14px\n    now:\n      show: true\n    experimental:\n      color_threshold: true\n    yaxis:\n    - id: price\n      opposite: true\n      decimals: 1\n      apex_config:\n        tickAmount: 4\n        labels:\n          show: true\n        title:\n          text: c/kWh\n          rotate: 0\n          offsetX: -25\n          offsetY: -70\n          style:\n            fontSize: 10px\n            fontFamily: verdana\n            color: orange\n    - id: energy\n      max: ~1\n      min: 0\n      decimals: 1\n      apex_config:\n        tickAmount: 4\n        labels:\n          show: true\n        title:\n          text: kWh\n          rotate: 0\n          offsetX: 25\n          offsetY: -70\n          style:\n            color: skyblue\n            fontSize: 10px\n            fontFamily: verdana\n    series:\n    - entity: sensor.electricity_prices\n      name: Price\n      yaxis_id: price\n      type: line\n      opacity: 0.8\n      stroke_width: 2\n      show:\n        extremas: true\n        in_header: raw\n        header_color_threshold: true\n      data_generator: \"if (!entity.attributes.data) return [];\\nconst today = new\\\n        \\ Date();\\ntoday.setHours(0, 0, 0, 0);\\nconst tomorrow = new Date(today);\\n\\\n        tomorrow.setDate(today.getDate() + 1);\\n\\nreturn entity.attributes.data\\n\\\n        \\  .filter(entry =&gt; {\\n    const start = new Date(entry.start);\\n    return\\\n        \\ start &gt;= today &amp;&amp; start &lt; tomorrow;\\n  })\\n  .map(entry =&gt; [new Date(entry.start).getTime(),\\\n        \\ entry.price]);\\n\"\n      color_threshold:\n      - value: 10\n        color: lightgreen\n      - value: 17\n        color: orange\n      - value: 25\n        color: red\n    - entity: sensor.home_total_energy\n      name: Energy\n      yaxis_id: energy\n      type: column\n      group_by:\n        duration: 15min\n        func: diff\n      color_threshold:\n      - value: 0.25\n        color: skyblue\n      - value: 1\n        color: lightblue\n      opacity: 0.5\n      stroke_width: 0\n      show:\n        extremas: true\n        in_header: raw\n        header_color_threshold: true\n  - type: custom:apexcharts-card\n    graph_span: 24h\n    span:\n      start: day\n    header:\n      title: 15-Minute Energy Cost\n      show: true\n    apex_config:\n      stroke:\n        dashArray: 2\n      chart:\n        height: 200px\n      title:\n        text: Energy Expenses\n        align: center\n        offsetY: 10\n        style:\n          fontSize: 13px\n          fontFamily: Verdana\n          fontWeight: normal\n      grid:\n        show: true\n        borderColor: rgba(255,255,255,0.2)\n      xaxis:\n        position: bottom\n        labels:\n          format: HH\n        hideOverlappingLabels: true\n      tooltip:\n        enabled: false\n        style:\n          fontSize: 14px\n    yaxis:\n    - id: cost\n      opposite: true\n      decimals: 3\n      max: 1\n      min: 0\n      apex_config:\n        tickAmount: 4\n        labels:\n          show: true\n        title:\n          text: \u20ac\n          rotate: 0\n          offsetX: -30\n          offsetY: -90\n          style:\n            fontSize: 14px\n            fontFamily: verdana\n            color: orange\n    series:\n    - entity: sensor.15_minute_energy_cost_block\n      name: Cost\n      type: column\n      group_by:\n        duration: 15min\n        func: max\n      yaxis_id: cost\n      show:\n        extremas: true\n        in_header: raw\n- type: grid\n  cards:\n  - type: heading\n    heading_style: subtitle\n    heading: Settings\n  - type: custom:mushroom-entity-card\n    entity: input_number.electricity_high_price_threshold\n    grid_options:\n      columns: 12\n      rows: 1\n  - type: markdown\n    content: Price Threshold controls devices and appliances that have high impact\n      on energy usage. These devices will be turned off or can't be used when the\n      Electoricity price is above this treshold.\n  - type: entities\n    entities:\n    - entity: input_number.energy_tax_c_kwh\n    - entity: input_number.energy_transfer_fee\n    - entity: input_number.energy_vat\n    - entity: input_number.energy_transfer_base_fee\n    - entity: input_number.energy_monthly_base_fee\n  - type: custom:apexcharts-card\n    graph_span: 24h\n    update_interval: 5min\n    header:\n      title: Energy &amp; Cost per 15min\n      show: true\n    apex_config:\n      stroke:\n        dashArray: 2\n      chart:\n        height: 200\n      tooltip:\n        shared: true\n      grid:\n        show: true\n        borderColor: rgba(255,255,255,0.2)\n    yaxis:\n    - id: energy\n      show: true\n      opposite: false\n      decimals: 2\n    - id: cost\n      show: true\n      opposite: true\n      decimals: 2\n    series:\n    - entity: sensor.shelly_home_energy_15min\n      name: Energy\n      type: column\n      opacity: 0.8\n      yaxis_id: energy\n      unit: kWh\n      group_by:\n        duration: 15min\n        func: max\n      color: '#1E90FF'\n    - entity: sensor.energy_cost_15min_c\n      name: Cost\n      type: line\n      stroke_width: 2\n      yaxis_id: cost\n      unit: c\n      group_by:\n        duration: 15min\n        func: max\n      color: '#FF6347'\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/electricity_dev/","title":"Electricity Dev","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/electricity_dev/#electricity-dev","title":"Electricity Dev","text":"<p>Dashboard: Main Dashboard Path: <code>electricity-dev</code></p> <p>Development version of the electricity dashboard for testing new charts.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/electricity_dev/#summary","title":"Summary","text":"<p>This is a development view for the main Electricity dashboard, used for testing new chart configurations and layouts (Panel mode). It replicates the core pricing and usage visualizations but may contain experimental features or alternative display styles like vertical stacks.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/electricity_dev/#related-packages","title":"Related Packages","text":"<p>This view contains entities managed by:</p> <ul> <li>Aqara W500</li> <li>Nordpool Prices</li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/electricity_dev/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:apexcharts-card</code></li> <li><code>custom:config-template-card</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/electricity_dev/#configuration","title":"Configuration","text":"<pre><code>type: panel\npath: electricity-dev\ntitle: Electricity Dev\ncards:\n- type: vertical-stack\n  cards:\n  - type: custom:config-template-card\n    variables:\n      PRICEHIGH: states['sensor.electricity_today_32nd_highest_price'].state\n      PRICELOW: states['sensor.electricity_today_32nd_lowest_price'].state\n    entities:\n    - sensor.electricity_prices\n    card:\n      type: custom:apexcharts-card\n      graph_span: 1d\n      span:\n        start: day\n      apex_config:\n        stroke:\n          dashArray: 4\n        chart:\n          height: 250%\n          width: 100%\n        title:\n          text: Energy Price Today\n          align: center\n          offsetY: 0\n          margin: 30\n          style:\n            fontSize: 13px\n            fontFamily: Verdana\n            fontWeight: normal\n        grid:\n          show: true\n          borderColor: rgba(255,255,255,0.2)\n        xaxis:\n          position: bottom\n          labels:\n            format: H\n            hideOverlappingLabels: true\n            offsetX: 0\n          axisTicks:\n            offsetX: 0\n          all_series_config:\n            show:\n              offset_in_name: true\n        legend:\n          show: true\n          position: bottom\n          horizontalAlign: left\n          fontSize: 14px\n          itemMargin:\n            vertical: 10\n            horizontal: 10\n        tooltip:\n          enabled: true\n          style:\n            fontSize: 14px\n      header:\n        title: Electricity Today\n        standard_format: false\n        show: false\n        show_states: true\n        colorize_states: true\n      show:\n        last_updated: true\n      experimental:\n        color_threshold: true\n      now:\n        show: true\n      yaxis:\n      - id: cost\n        opposite: true\n        decimals: 1\n        apex_config:\n          tickAmount: 4\n          labels:\n            show: true\n          title:\n            text: c/kWh\n            rotate: -90\n            style:\n              fontSize: 10px\n              fontFamily: verdana\n              color: orange\n      - id: energy\n        max: ~2\n        min: 0\n        decimals: 1\n        apex_config:\n          tickAmount: 4\n          labels:\n            show: true\n          title:\n            text: kWh\n            rotate: -90\n            style:\n              color: skyblue\n              fontSize: 10px\n              fontFamily: verdana\n      series:\n      - entity: sensor.electricity_prices\n        name: Price (snt/kWh)\n        yaxis_id: cost\n        type: column\n        opacity: 0.8\n        stroke_width: 0\n        show:\n          legend_value: false\n          extremas: true\n          in_header: true\n          header_color_threshold: true\n        data_generator: \"return entity.attributes.data.map(entry =&gt; {\\n  return [new\\\n          \\ Date(entry.start).getTime(), entry.price];\\n});\\n\"\n        color_threshold:\n        - value: -10\n          color: lightgreen\n        - value: ${PRICELOW * 1}\n          color: orange\n        - value: ${PRICEHIGH * 1}\n          color: darkred\n      - entity: sensor.electricity_daily_average_cents\n        name: Avg Price\n        yaxis_id: cost\n        type: line\n        color: yellow\n        stroke_width: 1\n        opacity: 0.8\n        group_by:\n          func: last\n          duration: 24h\n        show:\n          legend_value: false\n          datalabels: false\n          extremas: true\n          in_header: true\n      - entity: sensor.home_total_energy_hourly\n        name: Energy (kWh)\n        color: skyblue\n        type: line\n        opacity: 1\n        yaxis_id: energy\n        stroke_width: 2\n        float_precision: 1\n        unit: kWh\n        group_by:\n          duration: 1h\n          func: delta\n        show:\n          legend_value: false\n          datalabels: false\n          extremas: true\n          in_header: raw\n          header_color_threshold: true\n  - type: horizontal-stack\n    cards:\n    - type: custom:apexcharts-card\n      graph_span: 7d\n      update_interval: 15min\n      apex_config:\n        fill:\n          opacity: 0.5\n        markers:\n          size: 3\n        xaxis:\n          showDuplicates: true\n          position: bottom\n          labels:\n            format: ddd\n            hideOverlappingLabels: false\n        chart:\n          height: 200vh\n        grid:\n          show: true\n          borderColor: rgba(255,255,255,0.2)\n        legend:\n          show: true\n          itemMargin:\n            vertical: 10\n            horizontal: 10\n        dataLabels:\n          enabled: true\n          position: top\n          offsetY: -9\n          background:\n            enabled: false\n        tooltip:\n          style:\n            fontSize: 14px\n        stroke:\n          dashArray: 0\n        title:\n          text: Energy Daily\n          align: center\n          offsetY: 8\n          style:\n            fontSize: 13px\n            fontFamily: Verdana\n            fontWeight: normal\n      header:\n        show: false\n      yaxis:\n      - id: cost\n        max: ~100\n        min: 0\n        decimals: 0\n        apex_config:\n          tickAmount: 4\n          labels:\n            show: true\n      - id: power\n        opposite: true\n        max: ~35\n        min: 0\n        decimals: 0\n        apex_config:\n          tickAmount: 7\n          labels:\n            show: true\n          title:\n            text: kWh\n            rotate: 0\n            offsetX: 0\n            offsetY: 0\n            style:\n              fontSize: 10px\n              fontFamily: verdana\n              color: orange\n      series:\n      - entity: sensor.home_total_energy_daily\n        name: Energy (kWh)\n        color: skyblue\n        type: column\n        yaxis_id: power\n        stroke_width: 0\n        float_precision: 1\n        unit: kWh\n        statistics:\n          type: state\n        group_by:\n          duration: 1day\n          func: max\n        show:\n          legend_value: false\n          datalabels: true\n    - type: custom:apexcharts-card\n      header:\n        title: Shelly 3M - Energy Usage Today\n      graph_span: 1d\n      span:\n        start: day\n      update_interval: 5min\n      apex_config:\n        title:\n          text: Energy Usage Today\n          align: center\n          offsetY: 10\n          style:\n            fontSize: 13px\n            fontFamily: Verdana\n            fontWeight: normal\n        stroke:\n          dashArray: 4\n        chart:\n          height: 200vh\n        grid:\n          show: true\n          borderColor: rgba(255,255,255,0.2)\n        xaxis:\n          position: bottom\n          labels:\n            format: HH\n        tooltip:\n          enabled: false\n          style:\n            fontSize: 14px\n      yaxis:\n      - decimals: 2\n        min: 0\n      series:\n      - entity: sensor.home_total_3em_energy\n        name: Energy Usage\n        type: column\n        group_by:\n          duration: 15min\n          func: diff\n        color: skyblue\n        opacity: 0.8\n        stroke_width: 0\n        show:\n          extremas: true\n          in_header: raw\n          header_color_threshold: true\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/front_door/","title":"Front Door","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/front_door/#front-door","title":"Front Door","text":"<p>Dashboard: Main Dashboard Path: <code>front-door</code></p> <p>Security and access control for the front entrance.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/front_door/#summary","title":"Summary","text":"<p>This view is the central security hub for the Front Door. It features live feeds and event clips from Frigate cameras (Doorbell and Porch). Users can control the smart lock, arm/disarm the alarm system, and manage the front entry lights. It also monitors door status and presence, with settings for occupancy-based automations.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/front_door/#related-packages","title":"Related Packages","text":"<p>This view contains entities managed by:</p> <ul> <li>Unifi Access</li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/front_door/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:auto-entities</code></li> <li><code>custom:decluttering-card</code></li> <li><code>custom:frigate-card</code></li> <li><code>custom:mushroom-alarm-control-panel-card</code></li> <li><code>custom:mushroom-entity-card</code></li> <li><code>custom:mushroom-light-card</code></li> <li><code>custom:mushroom-lock-card</code></li> <li><code>custom:mushroom-title-card</code></li> <li><code>custom:scheduler-card</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/front_door/#configuration","title":"Configuration","text":"<pre><code>title: Front Door\npath: front-door\ntype: sections\nlayout:\n  max_cols: 5\nbadges: []\ncards: []\nsections:\n- type: grid\n  cards:\n  - type: vertical-stack\n    cards:\n    - type: custom:frigate-card\n      cameras:\n      - camera_entity: camera.g4_doorbell_pro_poe_high_resolution_channel\n      view:\n        default: live\n        interaction_seconds: 1200\n      live:\n        preload: true\n        controls:\n          builtin: true\n        lazy_load: true\n        show_image_during_load: false\n      performance:\n        style:\n          box_shadow: true\n          border_radius: true\n      image:\n        zoomable: true\n      menu:\n        position: bottom\n        button_size: 48\n        buttons:\n          cameras:\n            enabled: false\n          snapshots:\n            enabled: false\n          clips:\n            enabled: true\n            priority: 30\n          substreams:\n            enabled: false\n          timeline:\n            enabled: false\n          microphone:\n            enabled: false\n          frigate:\n            enabled: false\n          download:\n            priority: 35\n          screenshot:\n            enabled: true\n        style: outside\n        alignment: left\n      media_gallery:\n        controls:\n          thumbnails:\n            show_details: false\n      timeline:\n        show_recordings: true\n    - type: custom:frigate-card\n      cameras:\n      - camera_entity: camera.front_porch_frigate\n      view:\n        default: live\n        timeout_seconds: 1200\n      live:\n        preload: true\n        controls:\n          builtin: true\n        lazy_load: true\n        show_image_during_load: false\n      performance:\n        style:\n          box_shadow: true\n          border_radius: true\n      image:\n        zoomable: true\n      menu:\n        position: bottom\n        button_size: 48\n        buttons:\n          cameras:\n            enabled: false\n          snapshots:\n            enabled: false\n          clips:\n            enabled: true\n            priority: 30\n          substreams:\n            enabled: false\n          timeline:\n            enabled: false\n          microphone:\n            enabled: false\n          frigate:\n            enabled: false\n          download:\n            priority: 35\n          screenshot:\n            enabled: true\n        style: outside\n        alignment: left\n      media_gallery:\n        controls:\n          thumbnails:\n            show_details: false\n      timeline:\n        show_recordings: true\n    - square: false\n      type: grid\n      cards:\n      - type: custom:mushroom-light-card\n        entity: light.front_door_rail_light\n        icon: mdi:string-lights\n        layout: vertical\n        name: Front Door Light\n        tap_action:\n          action: more-info\n        hold_action:\n          action: more-info\n        double_tap_action:\n          action: none\n        use_light_color: false\n      - type: custom:mushroom-light-card\n        entity: light.mud_room_ceiling_light\n        icon: ''\n        layout: vertical\n        name: Mud Room Light\n        tap_action:\n          action: more-info\n        hold_action:\n          action: more-info\n        double_tap_action:\n          action: none\n        use_light_color: false\n      columns: 2\n    - square: false\n      type: grid\n      cards:\n      - type: custom:mushroom-lock-card\n        entity: lock.front_door_lock\n        layout: vertical\n        name: Lock\n      - type: custom:mushroom-entity-card\n        entity: binary_sensor.front_porch_frigate_person_occupancy\n        layout: vertical\n        name: Persons\n        icon: mdi:account\n        fill_container: true\n      - type: custom:mushroom-entity-card\n        entity: binary_sensor.front_door_lock_door\n        icon: mdi:door\n        layout: vertical\n        name: Lock Contact\n        fill_container: true\n      - type: custom:mushroom-entity-card\n        entity: binary_sensor.front_door_lock_door\n        icon: mdi:door\n        layout: vertical\n        name: Contact\n        fill_container: true\n      columns: 4\n    - square: false\n      type: grid\n      cards:\n      - type: custom:mushroom-entity-card\n        entity: input_select.home_front_door_occupancy_state\n        name: Front State\n        fill_container: true\n        layout: vertical\n      - type: custom:mushroom-alarm-control-panel-card\n        entity: alarm_control_panel.front_door\n        states:\n        - armed_home\n        - armed_away\n        - armed_night\n        - armed_custom_bypass\n        fill_container: true\n        layout: vertical\n      columns: 2\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: EVENTS\n      alignment: center\n    - type: custom:frigate-card\n      cameras:\n      - camera_entity: camera.frontdoor_doorbell\n      view:\n        default: clips\n        update_cycle_camera: false\n        dark_mode: 'on'\n        timeout_seconds: 1200\n        update_seconds: 120\n      menu:\n        buttons:\n          frigate:\n            enabled: true\n            alignment: matching\n            icon: mdi:view-grid\n          live:\n            enabled: false\n          camera_ui:\n            enabled: true\n          cameras:\n            enabled: false\n          clips:\n            enabled: false\n          timeline:\n            enabled: false\n          snapshots:\n            enabled: false\n          screenshot:\n            enabled: true\n        style: outside\n        position: bottom\n        alignment: left\n      timeline:\n        media: all\n        controls:\n          thumbnails:\n            size: 100\n      media_gallery:\n        controls:\n          thumbnails:\n            size: 125\n            show_details: false\n      dimensions:\n        aspect_ratio: '4:3'\n    - type: custom:frigate-card\n      cameras:\n      - camera_entity: camera.front_porch_frigate\n      view:\n        default: clips\n        update_cycle_camera: false\n        dark_mode: 'on'\n        timeout_seconds: 1200\n        update_seconds: 120\n      menu:\n        buttons:\n          frigate:\n            enabled: true\n            alignment: matching\n            icon: mdi:view-grid\n          live:\n            enabled: false\n          camera_ui:\n            enabled: true\n          cameras:\n            enabled: false\n          clips:\n            enabled: false\n          timeline:\n            enabled: false\n          snapshots:\n            enabled: false\n          screenshot:\n            enabled: true\n        style: outside\n        position: bottom\n        alignment: left\n      timeline:\n        media: all\n        controls:\n          thumbnails:\n            size: 100\n      media_gallery:\n        controls:\n          thumbnails:\n            size: 125\n            show_details: false\n      dimensions:\n        aspect_ratio: '4:3'\n    - type: custom:auto-entities\n      card:\n        type: entities\n      filter:\n        include:\n        - entity_id: '*front_door_battery*'\n        - entity_id: '*keypad_battery*'\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: SETTINGS\n    alignment: center\n    subtitle: Occupancy\n  - type: custom:decluttering-card\n    template: area_occupancy_settings\n    variables:\n    - area: front_door\n    - area_name: Front Door\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: SCHEDULES\n    alignment: center\n  - type: markdown\n    content: These schedules work when they are set on and _Presence Automation Mode_\n      is set to _Schedule Mode_\n  - type: custom:scheduler-card\n    include:\n    - input_select.front_door_automation_mode\n    - light.front_door_light\n    - light.front_door_rail_light\n    exclude: []\n    discover_existing: false\n    title: ''\n    time_step: 5\n    display_options:\n      primary_info: default\n      secondary_info:\n      - relative-time\n      - time\n      - additional-tasks\n      icon: action\n    tags:\n    - Front Door\nmax_columns: 4\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/guest_2/","title":"Guest-2","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/guest_2/#guest-2","title":"Guest-2","text":"<p>Dashboard: Main Dashboard Path: <code>Guest-2</code></p> <p>Controls for Guest-2 room (E Room) including lights and power monitoring.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/guest_2/#summary","title":"Summary","text":"<p>This view manages the Guest-2 room (labeled 'E Room'). It tracks detailed presence at the bed and desk using FP2 sensors. The dashboard offers lighting control and monitors power consumption from the window outlet, alongside standard occupancy automation settings.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/guest_2/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:decluttering-card</code></li> <li><code>custom:mini-graph-card</code></li> <li><code>custom:mushroom-light-card</code></li> <li><code>custom:mushroom-title-card</code></li> <li><code>custom:streamline-card</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/guest_2/#configuration","title":"Configuration","text":"<pre><code>theme: Backend-selected\ntitle: Guest-2\npath: Guest-2\ntype: sections\nlayout:\n  max_cols: 5\nsubview: true\nbadges: []\ncards: []\nsections:\n- type: grid\n  cards:\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: Guest-2\n      area_title: E Room\n      temperature_sensor: sensor.airthings_wave_temperature\n      indicator_3_entity: binary_sensor.Guest-2_bed_fp2_presence_sensor\n      indicator_3_icon: mdi:bed\n      indicator_3_state: 'on'\n      indicator_3_active_color: lightgreen\n      indicator_4_entity: binary_sensor.Guest-2_desk_fp2_presence_sensor\n      indicator_4_icon: mdi:chair-rolling\n      indicator_4_state: 'on'\n      indicator_4_active_color: '#088CF8'\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: LIGHTS\n      alignment: center\n    - type: custom:mushroom-light-card\n      entity: light.Guest-2_ceiling_light\n      use_light_color: false\n      show_brightness_control: true\n      show_color_temp_control: true\n      collapsible_controls: false\n      layout: horizontal\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: POWER\n      alignment: center\n    - square: false\n      type: grid\n      cards:\n      - type: custom:mini-graph-card\n        entities:\n        - entity: sensor.Guest-2_window_outlet_power\n          name: Energy\n      columns: 2\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: SETTINGS\n    subtitle: Occupancy Settings\n    alignment: center\n  - type: custom:decluttering-card\n    template: area_occupancy_settings\n    variables:\n    - area: Guest-2\n    - area_name: Guest-2\nmax_columns: 4\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/guest_3/","title":"Guest-3","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/guest_3/#guest-3","title":"Guest-3","text":"<p>Dashboard: Main Dashboard Path: <code>Guest-3</code></p> <p>Controls for Guest-3 room (A Room) with environmental monitoring.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/guest_3/#summary","title":"Summary","text":"<p>This view manages the Guest-3 room (labeled 'A Room'). It provides comprehensive environmental monitoring (Temperature, Humidity, CO2). Presence is tracked at the bed and desk. The view also includes controls for ceiling and window lights, plus occupancy automation configuration.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/guest_3/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:decluttering-card</code></li> <li><code>custom:mushroom-light-card</code></li> <li><code>custom:mushroom-title-card</code></li> <li><code>custom:streamline-card</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/guest_3/#configuration","title":"Configuration","text":"<pre><code>theme: Backend-selected\ntitle: Guest-3\npath: Guest-3\ntype: sections\nlayout:\n  max_cols: 4\nsubview: true\nbadges: []\ncards: []\nsections:\n- type: grid\n  cards:\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: Guest-3\n      area_title: A Room\n      temperature_sensor: sensor.airthings_wave_temperature\n      temp_sensor_entity: sensor.Guest-3_temperature\n      indicator_3_entity: binary_sensor.Guest-3_bed_fp2_presence_sensor\n      indicator_3_icon: mdi:bed\n      indicator_3_state: 'on'\n      indicator_3_active_color: lightgreen\n      indicator_4_entity: binary_sensor.Guest-3_desk_fp2_presence_sensor\n      indicator_4_icon: mdi:chair-rolling\n      indicator_4_state: 'on'\n      indicator_4_active_color: '#088CF8'\n  - type: vertical-stack\n    cards:\n    - square: false\n      type: grid\n      cards:\n      - type: custom:decluttering-card\n        template: minigraph_co2\n        variables:\n        - sensor: sensor.Guest-3_carbon_dioxide\n      - type: custom:decluttering-card\n        template: minigraph_temperature\n        variables:\n        - sensor: sensor.Guest-3_temperature\n      - type: custom:decluttering-card\n        template: minigraph_humidity\n        variables:\n        - sensor: sensor.Guest-3_humidity\n      columns: 3\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: LIGHTS\n      alignment: center\n    - square: false\n      columns: 2\n      type: grid\n      cards:\n      - type: custom:mushroom-light-card\n        entity: light.Guest-3_ceiling_light\n        show_brightness_control: true\n        show_color_temp_control: false\n      - type: custom:mushroom-light-card\n        entity: light.Guest-3_window_light\n        fill_container: true\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: SETTINGS\n    subtitle: Occupancy Settings\n    alignment: center\n  - type: custom:decluttering-card\n    template: area_occupancy_settings\n    variables:\n    - area: Guest-3\n    - area_name: Guest-3\nmax_columns: 4\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/hallway/","title":"Hallway","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/hallway/#hallway","title":"Hallway","text":"<p>Dashboard: Main Dashboard Path: <code>hallway</code></p> <p>Controls for the hallway including lights and staircase automations.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/hallway/#summary","title":"Summary","text":"<p>This view manages the Hallway area. It provides simple controls for the ceiling and stair lights. The dashboard also visualizes presence data from multiple FP2 sensors (Hallway and Downstairs) and includes standard occupancy and scheduling settings.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/hallway/#related-packages","title":"Related Packages","text":"<p>This view contains entities managed by:</p> <ul> <li>Scenes</li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/hallway/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:decluttering-card</code></li> <li><code>custom:mushroom-light-card</code></li> <li><code>custom:mushroom-title-card</code></li> <li><code>custom:streamline-card</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/hallway/#configuration","title":"Configuration","text":"<pre><code>theme: Backend-selected\ntitle: Hallway\npath: hallway\ntype: sections\nlayout:\n  max_cols: 5\nsubview: true\nbadges: []\ncards: []\nsections:\n- type: grid\n  cards:\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: hallway\n      area_title: Hallway\n      temperature_sensor: sensor.airthings_wave_temperature\n      temp_sensor_entity: sensor.airthings_wave_temperature\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: LIGHTS\n      alignment: center\n    - type: vertical-stack\n      cards:\n      - square: false\n        type: grid\n        cards:\n        - type: custom:mushroom-light-card\n          entity: light.hallway_ceiling_light\n          show_brightness_control: true\n          name: Ceiling\n          collapsible_controls: false\n          layout: vertical\n          show_color_temp_control: true\n        - type: custom:mushroom-light-card\n          entity: light.stairs_lights\n          show_brightness_control: true\n          show_color_control: true\n          show_color_temp_control: true\n          layout: vertical\n        columns: 2\n- type: grid\n  cards:\n  - type: entities\n    entities:\n    - entity: binary_sensor.hallway_fp2_presence_sensor\n    - entity: binary_sensor.downstairs_hallway_fp2_presence_sensor\n  - type: custom:mushroom-title-card\n    title: SETTINGS\n    alignment: center\n    subtitle: Occupancy\n  - type: custom:decluttering-card\n    template: area_occupancy_settings\n    variables:\n    - area: hallway\n    - area_name: Hallway\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: SCHEDULES\n      alignment: center\n    - type: markdown\n      content: These schedules work when they are set on and _Presence Automation\n        Mode_ is set to _Schedule Mode_\nmax_columns: 4\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/home/","title":"Home","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/home/#home","title":"Home","text":"<p>Dashboard: Main Dashboard Path: <code>home</code></p> <p>Primary home overview dashboard with calendars, weather, key energy stats, and room summaries.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/home/#summary","title":"Summary","text":"<p>The Home dashboard serves as the central information hub. It features a large clock and family calendars, alongside detailed weather forecasts. Key home stats are highlighted, including real-time energy prices, power usage, and the status of major appliances like the dishwasher and washing machine. The view also provides a high-level overview of the entire house, displaying camera feeds and status summaries for all key rooms (Sauna, Bathroom, Bedroom, etc.) using 'Streamline' area cards.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/home/#related-packages","title":"Related Packages","text":"<p>This view contains entities managed by:</p> <ul> <li>Aqara W500</li> <li>Car</li> <li>Dishwasher</li> <li>Nordpool Prices</li> <li>Unifi Access</li> <li>Washing Machine</li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/home/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:apexcharts-card</code></li> <li><code>custom:button-card</code></li> <li><code>custom:calendar-card-pro</code></li> <li><code>custom:card-mod</code></li> <li><code>custom:config-template-card</code></li> <li><code>custom:horizon-card</code></li> <li><code>custom:mushroom-entity-card</code></li> <li><code>custom:mushroom-template-card</code></li> <li><code>custom:mushroom-title-card</code></li> <li><code>custom:scheduler-card</code></li> <li><code>custom:streamline-card</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/home/#configuration","title":"Configuration","text":"<pre><code>title: Home\npath: home\ncards: []\ntype: sections\nsections:\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: ''\n    alignment: center\n    subtitle: HOME\n    title_tap_action:\n      action: none\n    subtitle_tap_action:\n      action: none\n  - clock_size: medium\n    time_zone: Europe/Helsinki\n    time_format: '24'\n    show_seconds: true\n    type: clock\n    grid_options:\n      columns: 12\n      rows: 2\n  - entities:\n    - entity: calendar.holidays\n      color: '#e63946'\n    - entity: calendar.family_calendar\n      color: '#457b9d'\n    - entity: calendar.energy_management\n    days_to_show: 30\n    compact_events_to_show: 5\n    compact_events_complete_days: true\n    filter_duplicates: true\n    first_day_of_week: monday\n    show_week_numbers: iso\n    day_separator_width: 1px\n    day_separator_color: '#444444'\n    today_indicator: dot\n    weekend_weekday_color: orange\n    weekend_day_color: orange\n    weekend_month_color: orange\n    weather:\n      position: date\n      date:\n        show_conditions: true\n        show_high_temp: true\n        show_low_temp: false\n        icon_size: 14px\n        font_size: 12px\n        color: var(--primary-text-color)\n      event:\n        show_conditions: true\n        show_temp: true\n        icon_size: 14px\n        font_size: 12px\n        color: var(--primary-text-color)\n    tap_action:\n      action: expand\n    hold_action:\n      action: navigate\n      navigation_path: /calendar\n    type: custom:calendar-card-pro\n  - type: custom:mushroom-title-card\n    title: ''\n    alignment: center\n    subtitle: WEATHER\n    title_tap_action:\n      action: none\n    subtitle_tap_action:\n      action: none\n  - show_current: true\n    show_forecast: true\n    type: weather-forecast\n    entity: weather.openweathermap\n    forecast_type: hourly\n    tap_action:\n      action: fire-dom-event\n      browser_mod:\n        service: browser_mod.popup\n        data:\n          title: Weather\n          content:\n            type: vertical-stack\n            cards:\n            - type: weather-forecast\n              entity: weather.openweathermap\n              show_current: true\n              show_forecast: true\n              forecast_type: hourly\n            - type: entities\n              entities:\n              - entity: sensor.openweathermap_feels_like_temperature\n                name: Feels Like\n              - entity: sensor.openweathermap_wind_speed\n                name: Wind\n              - entity: sensor.backyard_humidity\n                name: Backyard Humidity\n              - entity: sensor.backyard_temperature\n                name: Backyard Temperature\n            - type: custom:horizon-card\n            - type: weather-forecast\n              show_current: false\n              show_forecast: true\n              entity: weather.forecast_home\n              forecast_type: daily\n              name: Forecast\n  - type: custom:mushroom-title-card\n    title: ''\n    alignment: center\n    subtitle: ENERGY\n    title_tap_action:\n      action: none\n    subtitle_tap_action:\n      action: none\n  - type: custom:mushroom-template-card\n    entity: sensor.nord_pool_fi_current_price\n    secondary: 'c/kWh\n\n      NOW\n\n      '\n    icon: mdi:currency-eur\n    badge_icon: ''\n    badge_color: ''\n    tap_action:\n      action: more-info\n    hold_action:\n      action: none\n    double_tap_action:\n      action: none\n    color: \"{% set high = states('sensor.electricity_today_32nd_highest_price') |\\\n      \\ float(0) %} {% set low = states('sensor.electricity_today_32nd_lowest_price')\\\n      \\ | float(0) %} {% set price = states(entity) | float(0) %}\\n{% if price &gt; high\\\n      \\ %}\\n  red\\n{% elif price &lt; low %}\\n  green\\n{% else %}\\n  orange\\n{% endif\\\n      \\ %}\"\n    vertical: true\n    features_position: bottom\n    grid_options:\n      columns: 4\n      rows: 2\n    multiline_secondary: true\n    primary: '{{ (states(entity) | float(0) * 100) | round(1) }} '\n  - type: custom:mushroom-template-card\n    entity: sensor.electricity_daily_average_cents\n    primary: '{{ (states(entity) | float(0)) | round(1) }}'\n    secondary: 'c/kWh\n\n      Average'\n    icon: mdi:equal\n    badge_icon: ''\n    badge_color: ''\n    tap_action:\n      action: more-info\n    hold_action:\n      action: none\n    double_tap_action:\n      action: none\n    color: \"{% set high = states('sensor.electricity_today_32nd_highest_price') |\\\n      \\ float(0) %} {% set low = states('sensor.electricity_today_32nd_lowest_price')\\\n      \\ | float(0) %} {% set price = states(entity) | float(0) %}\\n{% if price &gt; high\\\n      \\ %}\\n  red\\n{% elif price &lt; low %}\\n  green\\n{% else %}\\n  orange\\n{% endif\\\n      \\ %}\"\n    vertical: true\n    features_position: bottom\n    grid_options:\n      columns: 4\n      rows: 2\n    multiline_secondary: true\n  - type: custom:mushroom-template-card\n    primary: '{{ states(entity) | float(0) | round(0) }} W'\n    secondary: NOW\n    icon: mdi:flash\n    entity: sensor.home_total_power\n    badge_color: ''\n    tap_action:\n      action: more-info\n    hold_action:\n      action: none\n    double_tap_action:\n      action: none\n    color: blue\n    vertical: true\n    features_position: bottom\n    grid_options:\n      columns: 4\n      rows: 2\n    multiline_secondary: true\n  - type: custom:mushroom-entity-card\n    entity: sensor.dishwasher_status_clean\n    name: Dishwasher Status\n    icon: mdi:dishwasher\n    secondary_info: state\n    grid_options:\n      columns: 12\n      rows: 1\n    card_mod:\n      style: \"ha-card {\\n  --card-mod-icon-color: var(--blue-color);\\n}\\n\"\n    visibility:\n    - condition: state\n      entity: binary_sensor.dishwasher_active\n      state: 'on'\n  - type: custom:mushroom-template-card\n    primary: Washing Machine Running\n    secondary: '{{ states(''sensor.washing_machine_plug_power'') }} W'\n    icon: mdi:washing-machine\n    entity: sensor.washing_machine_status\n    icon_color: blue\n    layout: horizontal\n    grid_options:\n      columns: 12\n      rows: 1\n    visibility:\n    - condition: state\n      entity: sensor.washing_machine_status\n      state_not: Stopped\n  - type: custom:mushroom-entity-card\n    entity: sensor.aqara_w500_bathroom_heating_hvac\n    grid_options:\n      columns: 12\n      rows: 1\n    visibility:\n    - condition: state\n      entity: sensor.aqara_w500_bathroom_heating_hvac\n      state: heating\n    name: Bathroom Floor Heating\n    icon_color: pink\n  - type: custom:config-template-card\n    variables:\n      PRICEHIGH: states['sensor.electricity_today_32nd_highest_price'].state\n      PRICELOW: states['sensor.electricity_today_32nd_lowest_price'].state\n    entities:\n    - sensor.electricity_prices\n    card:\n      type: custom:apexcharts-card\n      graph_span: 1d\n      span:\n        start: day\n      apex_config:\n        chart:\n          height: 250px\n          width: 115%\n          offsetX: -30\n        title:\n          text: Energy Price Today\n          align: center\n          offsetY: 0\n          margin: 30\n          style:\n            fontSize: 13px\n            fontFamily: Verdana\n            fontWeight: normal\n        grid:\n          show: true\n          borderColor: rgba(255,255,255,0.2)\n        stroke:\n          dashArray: 4\n          curve: smooth\n        xaxis:\n          position: bottom\n          labels:\n            format: H\n            hideOverlappingLabels: true\n            offsetX: 0\n          axisTicks:\n            offsetX: 0\n          all_series_config:\n            show:\n              offset_in_name: true\n        legend:\n          show: false\n          position: bottom\n          horizontalAlign: left\n          fontSize: 14px\n          itemMargin:\n            vertical: 10\n            horizontal: 10\n        tooltip:\n          enabled: false\n          style:\n            fontSize: 14px\n      header:\n        title: Electricity Today\n        standard_format: false\n        show: false\n        show_states: true\n        colorize_states: true\n      show:\n        last_updated: true\n      experimental:\n        color_threshold: true\n      now:\n        show: true\n      yaxis:\n      - id: cost\n        min: 0\n        opposite: true\n        decimals: 1\n        apex_config:\n          tickAmount: 4\n          labels:\n            show: true\n          title:\n            text: c/kWh\n            rotate: 0\n            offsetX: -25\n            offsetY: -90\n            style:\n              fontSize: 10px\n              fontFamily: verdana\n              color: orange\n      - id: energy\n        max: ~0.5\n        min: 0\n        decimals: 1\n        apex_config:\n          tickAmount: 4\n          labels:\n            show: true\n          title:\n            text: kWh\n            rotate: 0\n            offsetX: 25\n            offsetY: -90\n            style:\n              color: skyblue\n              fontSize: 10px\n              fontFamily: verdana\n      series:\n      - entity: sensor.electricity_prices\n        name: Current Price\n        yaxis_id: cost\n        type: column\n        opacity: 0.8\n        stroke_width: 0\n        show:\n          legend_value: false\n          extremas: true\n          in_header: true\n          header_color_threshold: true\n        data_generator: \"return entity.attributes.data.map(entry =&gt; {\\n  return [new\\\n          \\ Date(entry.start).getTime(), entry.price];\\n});\\n\"\n        color_threshold:\n        - value: -10\n          color: lightgreen\n        - value: ${PRICELOW * 1}\n          color: orange\n        - value: ${PRICEHIGH * 1}\n          color: darkred\n      - entity: sensor.electricity_daily_average_cents\n        name: Average Price\n        yaxis_id: cost\n        type: line\n        color: yellow\n        stroke_width: 1\n        opacity: 0.8\n        group_by:\n          func: last\n          duration: 24h\n        show:\n          legend_value: false\n          datalabels: false\n          extremas: true\n          in_header: true\n      - entity: sensor.home_total_energy_hourly\n        name: Energy Usage (kWh)\n        color: skyblue\n        type: line\n        opacity: 1\n        yaxis_id: energy\n        stroke_width: 2\n        float_precision: 1\n        unit: kWh\n        group_by:\n          duration: 15m\n          func: delta\n        show:\n          legend_value: false\n          datalabels: false\n          extremas: true\n          in_header: raw\n          header_color_threshold: true\n  - type: custom:config-template-card\n    variables:\n      PRICEHIGH: states['sensor.electricity_tomorrow_32nd_highest_price'].state\n      PRICELOW: states['sensor.electricity_tomorrow_32nd_lowest_price'].state\n    entities:\n    - sensor.electricity_prices\n    card:\n      type: custom:apexcharts-card\n      graph_span: 1d\n      span:\n        start: day\n        offset: +1d\n      apex_config:\n        stroke:\n          dashArray: 4\n        chart:\n          height: 225px\n          width: 115%\n          offsetX: -30\n        title:\n          text: Energy Price Tomorrow\n          align: center\n          offsetY: 10\n          style:\n            fontSize: 13px\n            fontFamily: Verdana\n            fontWeight: normal\n        grid:\n          show: true\n          borderColor: rgba(255,255,255,0.2)\n        xaxis:\n          position: bottom\n          labels:\n            format: H\n            hideOverlappingLabels: true\n            offsetX: 0\n          axisTicks:\n            offsetX: 0\n        legend:\n          show: false\n          itemMargin:\n            vertical: 10\n            horizontal: 10\n        tooltip:\n          enabled: false\n          style:\n            fontSize: 14px\n      show:\n        last_updated: true\n      experimental:\n        color_threshold: true\n      header:\n        show_states: true\n        colorize_states: true\n      now:\n        show: true\n      yaxis:\n      - id: cost\n        opposite: true\n        decimals: 1\n        apex_config:\n          tickAmount: 4\n          labels:\n            show: true\n          title:\n            text: c/kWh\n            rotate: 0\n            offsetX: -25\n            offsetY: -90\n            style:\n              fontSize: 10px\n              fontFamily: verdana\n              color: orange\n      - id: energy\n        max: ~2\n        min: 0\n        decimals: 1\n        apex_config:\n          tickAmount: 4\n          labels:\n            show: true\n          title:\n            text: kWh\n            rotate: 0\n            offsetX: 25\n            offsetY: -90\n            style:\n              color: skyblue\n              fontSize: 10px\n              fontFamily: verdana\n      series:\n      - entity: sensor.electricity_prices\n        name: Price\n        yaxis_id: cost\n        type: column\n        opacity: 0.8\n        stroke_width: 0\n        show:\n          extremas: true\n          in_header: raw\n          header_color_threshold: true\n        data_generator: \"const tomorrow = new Date();\\ntomorrow.setHours(0, 0, 0,\\\n          \\ 0);\\ntomorrow.setDate(tomorrow.getDate() + 1);\\n\\nreturn entity.attributes.data\\n\\\n          \\  .filter(entry =&gt; new Date(entry.start) &gt;= tomorrow)\\n  .map(entry =&gt;\\\n          \\ [new Date(entry.start).getTime(), entry.price]);\\n\"\n        color_threshold:\n        - value: -10\n          color: lightgreen\n        - value: ${PRICELOW * 1}\n          color: orange\n        - value: ${PRICEHIGH * 1}\n          color: darkred\n      - entity: sensor.home_total_energy_hourly\n        name: Energy (kWh)\n        color: skyblue\n        type: line\n        opacity: 1\n        yaxis_id: energy\n        stroke_width: 2\n        float_precision: 1\n        extend_to: false\n        unit: kWh\n        group_by:\n          duration: 1hour\n          func: max\n        show:\n          legend_value: false\n          datalabels: false\n          extremas: true\n          in_header: raw\n          header_color_threshold: true\n    visibility:\n    - condition: state\n      entity: sensor.electricity_tomorrow_valid\n      state: 'True'\n  - type: custom:mushroom-template-card\n    entity: sensor.electricity_daily_average_cents\n    primary: '{{ (states(entity) | float(0)) | round(1) }}'\n    secondary: 'c/kWh\n\n      Average'\n    icon: mdi:arrow-up-circle\n    badge_icon: ''\n    badge_color: ''\n    tap_action:\n      action: more-info\n    hold_action:\n      action: none\n    double_tap_action:\n      action: none\n    color: \"{% set high = states('sensor.electricity_today_32nd_highest_price') |\\\n      \\ float(0) %} {% set low = states('sensor.electricity_today_32nd_lowest_price')\\\n      \\ | float(0) %} {% set price = states(entity) | float(0) %}\\n{% if price &gt; high\\\n      \\ %}\\n  red\\n{% elif price &lt; low %}\\n  green\\n{% else %}\\n  orange\\n{% endif\\\n      \\ %}\"\n    vertical: true\n    features_position: bottom\n    grid_options:\n      columns: 4\n      rows: 2\n    multiline_secondary: true\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: ''\n    alignment: center\n    subtitle: OUTDOOR\n    title_tap_action:\n      action: none\n    subtitle_tap_action:\n      action: none\n  - type: custom:streamline-card\n    template: camera_area_card\n    variables:\n      camera_entity: camera.frontdoor_doorbell_frigate\n      aspect_ratio: 75%\n      video_zoom: 1\n      area_title: Front Door\n      navigation_path: /lovelace/front-door\n      presence_entity: select.front_door_presence\n      main_toggle_entity: light.front_door_rail_light\n      temp_sensor_entity: sensor.backyard_temperature\n      indicator_1_entity: light.front_door_rail_light\n      indicator_1_icon: mdi:lightbulb\n      indicator_1_state: 'on'\n      indicator_1_active_color: yellow\n      indicator_2_entity: lock.front_door_lock\n      indicator_2_icon: mdi:lock-open\n      indicator_2_state: unlocked\n      indicator_2_active_color: '#FF4444'\n      indicator_2_animation_on: blink 1s ease infinite\n      indicator_3_entity: binary_sensor.front_door_lock_cloud\n      indicator_3_icon: mdi:door-open\n      indicator_3_state: 'on'\n      indicator_3_active_color: '#FF4444'\n      indicator_3_animation_on: blink 1s ease infinite\n      indicator_4_entity: sensor.front_door_lock_bt_battery\n      indicator_4_icon: mdi:battery-alert\n      indicator_4_state: '20'\n      indicator_4_active_color: orange\n    grid_options:\n      columns: 6\n  - type: custom:streamline-card\n    template: camera_area_card\n    variables:\n      aspect_ratio: 75%\n      video_zoom: 1\n      area_title: Front Door\n      navigation_path: /lovelace/front-door\n      presence_entity: select.front_door_presence\n      main_toggle_entity: light.front_door_rail_light\n      temp_sensor_entity: sensor.backyard_temperature\n      indicator_1_entity: light.front_door_rail_light\n      indicator_1_icon: mdi:lightbulb\n      indicator_1_state: 'on'\n      indicator_1_active_color: yellow\n      indicator_2_entity: lock.front_door_lock\n      indicator_2_icon: mdi:lock-open\n      indicator_2_state: unlocked\n      indicator_2_active_color: '#FF4444'\n      indicator_2_animation_on: blink 1s ease infinite\n      indicator_3_entity: binary_sensor.front_door_lock_cloud\n      indicator_3_icon: mdi:door-open\n      indicator_3_state: 'on'\n      indicator_3_active_color: '#FF4444'\n      indicator_3_animation_on: blink 1s ease infinite\n      indicator_4_entity: sensor.front_door_lock_bt_battery\n      indicator_4_icon: mdi:battery-alert\n      indicator_4_state: '20'\n      indicator_4_active_color: orange\n      camera_entity: camera.front_porch_frigate\n    grid_options:\n      columns: 6\n  - type: custom:streamline-card\n    template: camera_area_card\n    variables:\n      camera_entity: camera.backyard_frigate\n      aspect_ratio: 57%\n      video_zoom: 1.5\n      area_title: Backyard\n      navigation_path: /lovelace/backyard\n      presence_entity: select.backyard_presence\n      main_toggle_entity: light.backyard_plug\n      temp_sensor_entity: sensor.backyard_temperature\n      indicator_1_entity: light.backyard_plug\n      indicator_1_icon: mdi:string-lights\n      indicator_1_state: 'on'\n      indicator_1_active_color: yellow\n      indicator_2_entity: binary_sensor.backyard_door_sensor_contact\n      indicator_2_icon: mdi:door-open\n      indicator_2_state: 'on'\n      indicator_2_active_color: '#FF4444'\n      indicator_2_animation_on: blink 1s ease infinite\n      indicator_3_entity: binary_sensor.backyard_frigate_person_occupancy\n      indicator_3_icon: mdi:account-alert\n      indicator_3_state: 'on'\n      indicator_3_active_color: '#088CF8'\n    grid_options:\n      columns: 6\n  - type: custom:streamline-card\n    template: camera_area_card\n    variables:\n      camera_entity: camera.storage_frigate\n      aspect_ratio: 57%\n      area_title: Storage\n      navigation_path: /lovelace/storage\n      presence_entity: select.storage_presence\n      main_toggle_entity: light.storage_light\n      temp_sensor_entity: sensor.storage_temperature\n      indicator_1_entity: light.storage_light\n      indicator_1_icon: mdi:lightbulb\n      indicator_1_state: 'on'\n      indicator_1_active_color: yellow\n      indicator_2_entity: binary_sensor.storage_cam_motion\n      indicator_2_icon: mdi:motion-sensor\n      indicator_2_state: 'on'\n      indicator_2_active_color: '#088CF8'\n    grid_options:\n      columns: 6\n  - type: custom:mushroom-title-card\n    title: ''\n    alignment: center\n    subtitle: 2nd Floor\n    title_tap_action:\n      action: none\n    subtitle_tap_action:\n      action: none\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: sauna\n      area_title: Sauna\n      temperature_sensor: sensor.airthings_wave_temperature\n      temp_sensor_entity: sensor.ruuvitag_8572_temperature\n      indicator_1_entity: binary_sensor.sauna_door_contact\n      indicator_1_icon: mdi:door\n      indicator_1_state: 'on'\n      indicator_1_active_color: '#FF4444'\n      indicator_1_animation_on: blink 1s ease infinite\n    grid_options:\n      columns: 6\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: bathroom\n      area_title: Bathroom\n      temperature_sensor: sensor.airthings_wave_temperature\n      indicator_1_entity: sensor.washing_machine_status\n      indicator_1_icon: mdi:washing-machine\n      indicator_1_state: Running\n      indicator_1_active_color: '#088CF8'\n      indicator_1_animation_on: blink 2s ease infinite\n      indicator_2_entity: input_select.bathroom_toilet_presence\n      indicator_2_icon: mdi:toilet\n      indicator_3_icon: mdi:shower-head\n      indicator_3_active_color: '#088CF8'\n      indicator_2_active_color: orange\n      indicator_3_entity: input_select.shower_presence\n      indicator_3_state: presence\n      indicator_2_state: presence\n      temp_sensor_entity: sensor.aqara_w500_temperature_smoothed\n      indicator_6_entity: sensor.aqara_w500_bathroom_heating_hvac\n      indicator_6_icon: mdi:heating-coil\n      indicator_6_state: heating\n      indicator_6_active_color: '#FF4444'\n      indicator_6_animation_on: blink 2s ease infinite\n    grid_options:\n      columns: 6\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: office\n      area_title: Office\n      temperature_sensor: sensor.airthings_wave_temperature\n      temp_sensor_entity: sensor.bedroom_temperature\n    grid_options:\n      columns: 6\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: bedroom\n      area_title: Bedroom\n      temperature_sensor: sensor.airthings_wave_temperature\n      temp_sensor_entity: sensor.bedroom_temperature\n      indicator_1_entity: cover.bedroom_window_blinds\n      indicator_1_icon: mdi:window-shutter\n      indicator_1_state: open\n      indicator_1_active_color: lightgreen\n      indicator_2_entity: cover.bedroom_window_roller_cover\n      indicator_2_icon: mdi:blinds-open\n      indicator_2_state: open\n      indicator_2_active_color: lightgreen\n      indicator_3_entity: input_boolean.bed_Evis_occupancy\n      indicator_3_icon: mdi:bed\n      indicator_3_state: 'on'\n      indicator_4_entity: input_boolean.bed_Guest-1_occupancy\n      indicator_4_icon: mdi:bed\n      indicator_4_state: 'on'\n      indicator_4_active_color: '#FF44C4'\n      indicator_3_active_color: '#088CF8'\n    grid_options:\n      columns: 6\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: Guest-2\n      area_title: E Room\n      temperature_sensor: sensor.airthings_wave_temperature\n      indicator_3_entity: binary_sensor.Guest-2_bed_fp2_presence_sensor\n      indicator_3_icon: mdi:bed\n      indicator_3_state: 'on'\n      indicator_3_active_color: lightgreen\n      indicator_4_entity: binary_sensor.Guest-2_desk_fp2_presence_sensor\n      indicator_4_icon: mdi:chair-rolling\n      indicator_4_state: 'on'\n      indicator_4_active_color: '#088CF8'\n    grid_options:\n      columns: 6\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: Guest-3\n      area_title: A Room\n      temperature_sensor: sensor.airthings_wave_temperature\n      temp_sensor_entity: sensor.Guest-3_temperature\n      indicator_3_entity: binary_sensor.Guest-3_bed_fp2_presence_sensor\n      indicator_3_icon: mdi:bed\n      indicator_3_state: 'on'\n      indicator_3_active_color: lightgreen\n      indicator_4_entity: binary_sensor.Guest-3_desk_fp2_presence_sensor\n      indicator_4_icon: mdi:chair-rolling\n      indicator_4_state: 'on'\n      indicator_4_active_color: '#088CF8'\n    grid_options:\n      columns: 6\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: stairs\n      area_title: Stairs\n      temperature_sensor: sensor.airthings_wave_temperature\n    grid_options:\n      columns: 6\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: lobby\n      area_title: Lobby\n      temperature_sensor: sensor.airthings_wave_temperature\n      temp_sensor_entity: sensor.bedroom_temperature\n    grid_options:\n      columns: 6\n  - type: custom:mushroom-title-card\n    title: ''\n    alignment: center\n    subtitle: 1st Floor\n    title_tap_action:\n      action: none\n    subtitle_tap_action:\n      action: none\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: hallway\n      area_title: Hallway\n      temperature_sensor: sensor.airthings_wave_temperature\n      temp_sensor_entity: sensor.airthings_wave_temperature\n    grid_options:\n      columns: 6\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: kitchen\n      area_title: Kitchen\n      temperature_sensor: sensor.airthings_wave_temperature\n      temp_sensor_entity: sensor.kitchen_fridge_door_device_temperature\n      indicator_1_entity: binary_sensor.kitchen_fridge_door_contact\n      indicator_1_icon: mdi:fridge\n      indicator_1_state: 'on'\n      indicator_1_active_color: '#FF4444'\n      indicator_1_animation_on: blink 0.5s ease infinite\n      indicator_2_entity: binary_sensor.kitchen_fridge_leak_sensor_water_leak\n      indicator_2_icon: mdi:fridge-alert\n      indicator_2_state: 'on'\n      indicator_2_active_color: '#088CF8'\n      indicator_2_animation_on: blink 0.5s ease infinite\n      indicator_3_entity: sensor.coffee_machine_state\n      indicator_3_icon: mdi:coffee\n      indicator_3_active_color: orange\n      indicator_3_state: Running\n      indicator_4_entity: switch.schedule_coffee_machine_schedule\n      indicator_4_icon: mdi:coffee-to-go-outline\n      indicator_4_state: 'on'\n      indicator_3_animation_on: blink 2s ease infinite\n      indicator_4_active_color: lightgreen\n      indicator_5_entity: sensor.dishwasher_current_status\n      indicator_5_icon: mdi:dishwasher\n      indicator_5_state: running\n      indicator_5_active_color: skyblue\n      indicator_5_animation_on: blink 2s ease infinite\n      indicator_6_entity: binary_sensor.kitchen_dishwasher_leak_sensor_water_leak\n      indicator_6_icon: mdi:dishwasher-alert\n      indicator_6_state: 'on'\n      indicator_6_active_color: '#088CF8'\n      indicator_6_animation_on: blink 0.5s ease infinite\n    grid_options:\n      columns: 6\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: Daughter\n      area_title: Guest Room\n      temperature_sensor: sensor.airthings_wave_temperature\n      indicator_1_entity: binary_sensor.Daughter_bed_fp2_presence_sensor\n      indicator_1_icon: mdi:bed-king\n      indicator_1_state: 'on'\n      indicator_1_active_color: lightgreen\n    grid_options:\n      columns: 6\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: living_room\n      area_title: Living Room\n      temperature_sensor: sensor.airthings_wave_temperature\n      temp_sensor_entity: sensor.airthings_wave_temperature\n      indicator_1_entity: light.fireplace\n      indicator_1_icon: mdi:fireplace\n      indicator_1_state: 'on'\n      indicator_1_active_color: orange\n      indicator_1_animation_on: blink 2s ease infinite\n      indicator_2_entity: media_player.70pus9005_12_2\n      indicator_2_icon: mdi:television\n      indicator_2_state: 'on'\n      indicator_2_active_color: lightgreen\n      indicator_2_animation_on: blink 2s ease infinite\n      indicator_3_entity: input_select.sofa_presence\n      indicator_3_icon: mdi:sofa\n      indicator_3_state: presence\n      indicator_3_active_color: lightgreen\n      indicator_5_entity: binary_sensor.inner_back_door_contact\n      indicator_5_icon: mdi:door\n      indicator_5_state: 'on'\n      indicator_6_entity: binary_sensor.backyard_door_sensor_contact\n      indicator_6_icon: mdi:door\n      indicator_6_state: 'on'\n      indicator_6_active_color: '#FF4444'\n      indicator_6_animation_on: blink 0.5s ease infinite\n      indicator_5_active_color: '#FF4444'\n      indicator_5_animation_on: blink 0.5s ease infinite\n    grid_options:\n      columns: 6\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: toilet\n      area_title: Toilet\n      temperature_sensor: sensor.airthings_wave_temperature\n    grid_options:\n      columns: 6\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: mud_room\n      area_title: Mud Room\n      temperature_sensor: sensor.airthings_wave_temperature\n      temp_sensor_entity: sensor.mud_room_motion_sensor_device_temperature\n      indicator_1_entity: binary_sensor.front_door_lock_door\n      indicator_1_icon: mdi:door\n      indicator_1_state: 'on'\n      indicator_1_active_color: '#FF4444'\n      indicator_1_animation_on: blink 0.5s ease infinite\n      indicator_2_entity: lock.front_door_lock\n      indicator_2_icon: mdi:lock\n      indicator_2_state: unlocked\n      indicator_2_active_color: '#FF4444'\n      indicator_2_animation_on: blink 0.5s ease infinite\n      indicator_6_entity: binary_sensor.mud_room_door_sensor_contact\n      indicator_6_icon: mdi:door\n      indicator_6_state: 'on'\n      indicator_6_active_color: orange\n      indicator_6_animation_on: blink 1s ease infinite\n    grid_options:\n      columns: 6\n  - type: picture-elements\n    image: local/car/Car-BG.png\n    elements:\n    - type: custom:button-card\n      template:\n      - area_base_overlay\n      entity: switch.[LICENSE_PLATE]_pre_entry_climate_control\n      tap_action:\n        action: navigate\n        navigation_path: /dashboard-persons/car\n      hold_action:\n        action: toggle\n      double_tap_action:\n        action: fire-dom-event\n        browser_mod:\n          service: browser_mod.popup\n          data:\n            title: CAR\n            content:\n              type: vertical-stack\n              cards:\n              - type: horizontal-stack\n                cards:\n                - type: custom:mushroom-template-card\n                  entity: sensor.fuel_level\n                  primary: Fuel Level\n                  secondary: '{{ states(''sensor.[LICENSE_PLATE]_fuel_level'') }}%\n                    | {{ states(''sensor.[LICENSE_PLATE]_range_liquid'') }} km range'\n                  icon: mdi:gas-station\n                  features_position: bottom\n                  color: \"{% set fuel = states('sensor.[LICENSE_PLATE]_fuel_level')\\\n                    \\ | int %} {% if fuel &lt; 20 %}\\n  darkred\\n{% elif fuel &lt; 50 %}\\n\\\n                    \\  yellow\\n{% else %}\\n  darkgreen\\n{% endif %}\\n\"\n                  card_mod:\n                    style: \"ha-card {\\n  background: linear-gradient(\\n    to right,\\n\\\n                      \\    orange {{ states('sensor.[LICENSE_PLATE]_fuel_level') }}%,\\n\\\n                      \\    var(--card-background-color) {{ states('sensor.[LICENSE_PLATE]_fuel_level')\\\n                      \\ }}%\\n  );\\n  );\\n  background-size: 100% 100%;\\n  background-repeat:\\\n                      \\ no-repeat;\\n  border-radius: 12px;\\n}\\n\"\n                - type: custom:mushroom-template-card\n                  entity: sensor.ev_battery_level\n                  primary: EV Charge\n                  secondary: '{{ states(''sensor.[LICENSE_PLATE]_state_of_charge'')\n                    }}% | {{ states(''sensor.[LICENSE_PLATE]_range_electric'') }}\n                    km range\n\n                    '\n                  icon: mdi:car-electric\n                  tap_action:\n                    action: more-info\n                  hold_action:\n                    action: more-info\n                  color: \"{% set charge = states('sensor.[LICENSE_PLATE]_state_of_charge')\\\n                    \\ | int %} {% if charge &lt; 20 %}\\n  red\\n{% elif charge &lt; 50 %}\\n\\\n                    \\  yellow\\n{% else %}\\n  lightgreen\\n{% endif %}\\n\"\n                  features_position: bottom\n                  card_mod:\n                    style: \"ha-card {\\n  --charge: {{ states('sensor.[LICENSE_PLATE]_state_of_charge')\\\n                      \\ }}%;\\n  background: linear-gradient(\\n    to right,\\n    green\\\n                      \\ var(--charge),\\n    var(--card-background-color) var(--charge)\\n\\\n                      \\  );\\n  background-size: 100% 100%;\\n  background-repeat: no-repeat;\\n\\\n                      \\  border-radius: 12px;\\n}\\n\"\n              - type: custom:scheduler-card\n                include:\n                - switch.[LICENSE_PLATE]_pre_entry_climate_control\n                exclude: []\n                discover_existing: false\n                title: true\n                show_header_toggle: false\n                time_step: 5\n                default_editor: single\n                display_options:\n                  primary_info: default\n                  secondary_info:\n                  - time\n                  icon: action\n                sort_by:\n                - state\n                - relative-time\n                customize: {}\n                tags:\n                - Car\n                exclude_tags: []\n                card_mod:\n                  style: \"ha-card {\\n  border-radius: 12px;\\n  box-shadow: var(--ha-card-box-shadow);\\n\\\n                    \\  background-color: var(--card-background-color);\\n  font-family:\\\n                    \\ var(--mush-font-family, \\\"Roboto\\\", sans-serif);\\n}\\n.card-header\\\n                    \\ {\\n  font-size: 1.2em;\\n  font-weight: 500;\\n  padding-bottom:\\\n                    \\ 8px;\\n}\\n.schedule-row {\\n  border-bottom: 1px solid var(--divider-color);\\n\\\n                    }\\n\"\n              - type: map\n                entities:\n                - entity: person.car\n                hours_to_show: 48\n                aspect_ratio: '1.5'\n                default_zoom: 15\n                theme_mode: auto\n      card_mod:\n        style: \"ha-card {\\n  /* Moves border logic here from original for border display\\\n          \\ */\\n  {% if is_state('sensor.[LICENSE_PLATE]_ignition_state','4') %}\\n\\\n          \\    border: 3px solid rgba(36, 255, 0, 0.8);\\n  {% elif is_state('sensor.[LICENSE_PLATE]_ignition_state','2')\\\n          \\ %}\\n    border: 3px solid rgba(255, 163, 0, 0.8);\\n  {% else %}\\n    border:\\\n          \\ 0px solid rgba(0, 0, 0, 0);\\n  {% endif %}\\n}\\n\"\n      style:\n        top: 50%\n        left: 50%\n        width: 100%\n        height: 100%\n        z-index: 4\n    - type: conditional\n      conditions:\n      - entity: device_tracker.[LICENSE_PLATE]_device_tracker\n        state: home\n      elements:\n      - type: image\n        image: local/car/GLC-front.png\n        style:\n          left: 50%\n          top: 50%\n          width: 80%\n          opacity: 100%\n          z-index: 2\n    - type: conditional\n      conditions:\n      - entity: device_tracker.[LICENSE_PLATE]_device_tracker\n        state: not_home\n      elements:\n      - type: image\n        image: local/car/GLC-back.png\n        style:\n          left: 50%\n          top: 50%\n          width: 65%\n          opacity: 100%\n          z-index: 2\n    - type: conditional\n      conditions:\n      - entity: binary_sensor.car_engine\n        state: 'on'\n      elements:\n      - type: image\n        image: local/car/road.png\n        style:\n          left: 50%\n          top: 65%\n          width: 100%\n          opacity: 100%\n          z-index: 2\n    - type: custom:button-card\n      template:\n      - area_text_element\n      name: Car\n      style:\n        top: 0%\n        left: 50%\n        width: 100%\n        height: 100%\n        z-index: 2\n        container-type: inline-size\n    - type: custom:button-card\n      template: area_text_element\n      entity: sensor.[LICENSE_PLATE]_state_of_charge\n      show_name: false\n      show_icon: false\n      show_state: true\n      style:\n        top: 0%\n        left: 50%\n        width: 100%\n        height: 100%\n        z-index: 2\n        container-type: inline-size\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: binary_sensor.car_charge_plug\n      icon: mdi:ev-plug-type2\n      layout: vertical\n      style:\n        top: 44%\n        left: 90%\n        width: 12%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: 'on'\n        styles:\n          icon:\n          - color: '#088CF8'\n          - animation: \"[[[\\n  if (states['binary_sensor.[LICENSE_PLATE]_charging_active'].state\\\n              \\ == 'on') {\\n    return 'blink 1s ease infinite';\\n  } else {\\n   \\\n              \\ return 'none';\\n  }\\n]]]\\n\"\n      - operator: ==\n        value: 'off'\n        styles:\n          card:\n          - display: none\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: binary_sensor.[LICENSE_PLATE]_park_brake_status\n      layout: vertical\n      style:\n        top: 75%\n        left: 10%\n        width: 14%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: 'on'\n        styles:\n          icon:\n          - color: orange\n      - operator: ==\n        value: 'off'\n        styles:\n          card:\n          - display: none\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: lock.[LICENSE_PLATE]_lock\n      icon: mdi:lock-open-variant\n      layout: vertical\n      style:\n        top: 75%\n        left: 26%\n        width: 14%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: unlocked\n        styles:\n          icon:\n          - animation: blink 0.5s linear infinite\n            color: rgba(253,89,89,1)\n      - operator: ==\n        value: locked\n        styles:\n          card:\n          - display: none\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: binary_sensor.[LICENSE_PLATE]_windows_closed\n      layout: vertical\n      style:\n        top: 75%\n        left: 42%\n        width: 14%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: 'off'\n        styles:\n          icon:\n          - animation: blink 0.5s ease infinite\n            color: rgba(253,89,89,1)\n      - operator: ==\n        value: 'on'\n        styles:\n          card:\n          - display: none\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: binary_sensor.[LICENSE_PLATE]_low_wash_water_warning\n      layout: vertical\n      style:\n        top: 75%\n        left: 58%\n        width: 14%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: 'on'\n        styles:\n          icon:\n          - animation: blink 1s ease infinite\n            color: '#088CF8'\n      - operator: ==\n        value: 'off'\n        styles:\n          card:\n          - display: none\n      card_mod:\n        style: \":host {\\n  {% if '[[entity]]' == '' %}\\n    display: none;\\n  {% endif\\\n          \\ %}\\n}\\n\"\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: binary_sensor.[LICENSE_PLATE]_tire_warning\n      icon: mdi:tire\n      layout: vertical\n      style:\n        top: 75%\n        left: 74%\n        width: 14%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: 'on'\n        styles:\n          icon:\n          - color: rgba(253,89,89,1)\n            animation: blink 1s ease infinite\n      - operator: ==\n        value: 'off'\n        styles:\n          card:\n          - display: none\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: switch.[LICENSE_PLATE]_pre_entry_climate_control\n      icon: mdi:fan\n      layout: vertical\n      style:\n        top: 75%\n        left: 90%\n        width: 14%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: 'on'\n        styles:\n          icon:\n          - animation: rotating 1s linear infinite\n            color: '#21ff21'\n      - operator: ==\n        value: 'off'\n        styles:\n          card:\n          - display: none\n    - type: custom:button-card\n      template: area_status_indicator\n      entity: switch.schedule_car_pre_entry_climate_control\n      icon: mdi:clock-outline\n      layout: vertical\n      style:\n        top: 85%\n        left: 94%\n        width: 6%\n        z-index: 2\n        container-type: inline-size\n      state:\n      - operator: ==\n        value: 'on'\n        styles:\n          icon:\n          - color: orange\n      - operator: ==\n        value: 'off'\n        styles:\n          card:\n          - display: none\n    grid_options:\n      columns: 6\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: ''\n    alignment: center\n    subtitle: HOME\n    title_tap_action:\n      action: none\n    subtitle_tap_action:\n      action: none\n  - type: custom:mushroom-entity-card\n    entity: input_boolean.home_occupancy\n    tap_action:\n      action: none\n    hold_action:\n      action: none\n    double_tap_action:\n      action: none\n    layout: vertical\n  - type: custom:mushroom-entity-card\n    entity: input_select.home_occupancy_state\n    tap_action:\n      action: none\n    hold_action:\n      action: none\n    double_tap_action:\n      action: none\n    layout: vertical\n  - type: custom:mushroom-template-card\n    primary: Home Occupancy\n    secondary: \"{% set status = states(entity) %}\\n{% if status == 'on' %}\\n  Occupied\\n\\\n      {% else %}\\n  Unoccupied\\n{% endif %}\"\n    icon: \"{% set status = states(entity) %}\\n{% if status == 'on' %}\\n  mdi:home-account\\n\\\n      {% else %}\\n  mdi:home-outline\\n{% endif %}\"\n    icon_color: \"{% set status = states(entity) %}\\n{% if status == 'on' %}\\n  green\\n\\\n      {% else %}\\n  orange\\n{% endif %}\"\n    entity: input_boolean.home_occupancy\n    layout: vertical\n  - type: custom:mushroom-template-card\n    primary: Home Occupancy State\n    secondary: '{{ states(entity) }}'\n    icon: \"{% set status = states(entity) %}\\n{% if status == 'on' %}\\n  mdi:home-account\\n\\\n      {% else %}\\n  mdi:home-outline\\n{% endif %}\"\n    entity: input_select.home_occupancy_state\n    color: \"{% set status = states(entity) %}\\n{% if status == 'sleeping' %}\\n  blue\\n\\\n      {% elif status == 'away' %}\\n  orange\\n{% elif status == 'home' %}\\n  green\\n\\\n      {% elif status == 'simulated' %}\\n  purple\\n{% else %}\\n  gray\\n{% endif %}\"\n    vertical: true\n    features_position: bottom\n  - type: custom:mushroom-title-card\n    title: ''\n    alignment: center\n    subtitle: COTTAGE\n    title_tap_action:\n      action: none\n    subtitle_tap_action:\n      action: none\n  - type: picture-elements\n    entity: camera.cottage_yard_high_resolution_channel\n    camera_image: camera.cottage_yard_high_resolution_channel\n    camera_view: live\n    aspect_ratio: 57%\n    elements:\n    - type: custom:button-card\n      name: Cottage YARD\n      style:\n        top: 50%\n        left: 50%\n        width: 100%\n        height: 100%\n        z-index: 2\n        container-type: inline-size\n      styles:\n        card:\n        - border-radius: 0px\n        - border: 0px\n        - height: 30%\n        - background-color: rgb(0,0,0,0)\n        - box-shadow: 0px 0px 2px rgb(255,255,255,0)\n        - font-size: 5cqw\n        name:\n        - font-family: arial\n        - font-weight: bold\n        - text-transform: uppercase\n        - justify-self: left\n        - padding-left: 15px\n        - color: rgb(255, 255, 255, 1)\n        - text-shadow: 0px 0px 5px rgb(0,0,0,1)\n    card_mod:\n      style: \"@keyframes blink {\\n  {% if is_state('sensor.car_charging','on') %}\\n\\\n        \\    50% { opacity: 0; }\\n  {% else %}\\n    50% { opacity: 100; }\\n  {% endif\\\n        \\ %}\\n}\\n@keyframes pulse {\\n  50% { opacity: 0.33; }\\n}\\nha-card {\\n  border-top-left-radius:\\\n        \\ 8px;\\n  border-top-right-radius: 8px;\\n  border-bottom-left-radius: 8px;\\n\\\n        \\  border-bottom-right-radius: 8px;\\n  background: rgb(0,0,0);\\n  z-index:0;\\n\\\n        \\  height: 100%\\n  container-type: inline-size\\n  {% if is_state('select.backyard_presence','presence')\\\n        \\ %}\\n    border: 3px solid rgba(36, 255, 0, 0.8);\\n  {% elif is_state('select.backyard_presence','idle')\\\n        \\ %}\\n    border: 3px solid rgba(255, 163, 0, 0.8);\\n  {% else %}\\n    border:\\\n        \\ 0px solid rgba(0, 0, 0, 0);\\n  {% endif %}\\n}\\n\"\n    layout_options:\n      grid_columns: 2\n  - type: picture-elements\n    entity: camera.cottage_medium_resolution_channel\n    camera_image: camera.cottage_medium_resolution_channel\n    camera_view: live\n    aspect_ratio: 57%\n    elements:\n    - type: custom:button-card\n      name: Cottage\n      style:\n        top: 50%\n        left: 50%\n        width: 100%\n        height: 100%\n        z-index: 2\n        container-type: inline-size\n      styles:\n        card:\n        - border-radius: 0px\n        - border: 0px\n        - height: 30%\n        - background-color: rgb(0,0,0,0)\n        - box-shadow: 0px 0px 2px rgb(255,255,255,0)\n        - font-size: 5cqw\n        name:\n        - font-family: arial\n        - font-weight: bold\n        - text-transform: uppercase\n        - justify-self: left\n        - padding-left: 15px\n        - color: rgb(255, 255, 255, 1)\n        - text-shadow: 0px 0px 5px rgb(0,0,0,1)\n    card_mod:\n      style: \"@keyframes blink {\\n  {% if is_state('sensor.car_charging','on') %}\\n\\\n        \\    50% { opacity: 0; }\\n  {% else %}\\n    50% { opacity: 100; }\\n  {% endif\\\n        \\ %}\\n}\\n@keyframes pulse {\\n  50% { opacity: 0.33; }\\n}\\nha-card {\\n  border-top-left-radius:\\\n        \\ 8px;\\n  border-top-right-radius: 8px;\\n  border-bottom-left-radius: 8px;\\n\\\n        \\  border-bottom-right-radius: 8px;\\n  background: rgb(0,0,0);\\n  z-index:0;\\n\\\n        \\  height: 100%\\n  container-type: inline-size\\n  {% if is_state('select.backyard_presence','presence')\\\n        \\ %}\\n    border: 3px solid rgba(36, 255, 0, 0.8);\\n  {% elif is_state('select.backyard_presence','idle')\\\n        \\ %}\\n    border: 3px solid rgba(255, 163, 0, 0.8);\\n  {% else %}\\n    border:\\\n        \\ 0px solid rgba(0, 0, 0, 0);\\n  {% endif %}\\n}\\n\"\n    layout_options:\n      grid_columns: 2\n  - type: picture-elements\n    entity: camera.cottage_driveway_high_resolution_channel\n    camera_image: camera.cottage_driveway_high_resolution_channel\n    camera_view: live\n    aspect_ratio: 57%\n    elements:\n    - type: custom:button-card\n      name: Cottage Drideway\n      style:\n        top: 50%\n        left: 50%\n        width: 100%\n        height: 100%\n        z-index: 2\n        container-type: inline-size\n      styles:\n        card:\n        - border-radius: 0px\n        - border: 0px\n        - height: 30%\n        - background-color: rgb(0,0,0,0)\n        - box-shadow: 0px 0px 2px rgb(255,255,255,0)\n        - font-size: 5cqw\n        name:\n        - font-family: arial\n        - font-weight: bold\n        - text-transform: uppercase\n        - justify-self: left\n        - padding-left: 15px\n        - color: rgb(255, 255, 255, 1)\n        - text-shadow: 0px 0px 5px rgb(0,0,0,1)\n    card_mod:\n      style: \"@keyframes blink {\\n  {% if is_state('sensor.car_charging','on') %}\\n\\\n        \\    50% { opacity: 0; }\\n  {% else %}\\n    50% { opacity: 100; }\\n  {% endif\\\n        \\ %}\\n}\\n@keyframes pulse {\\n  50% { opacity: 0.33; }\\n}\\nha-card {\\n  border-top-left-radius:\\\n        \\ 8px;\\n  border-top-right-radius: 8px;\\n  border-bottom-left-radius: 8px;\\n\\\n        \\  border-bottom-right-radius: 8px;\\n  background: rgb(0,0,0);\\n  z-index:0;\\n\\\n        \\  height: 100%\\n  container-type: inline-size\\n  {% if is_state('select.backyard_presence','presence')\\\n        \\ %}\\n    border: 3px solid rgba(36, 255, 0, 0.8);\\n  {% elif is_state('select.backyard_presence','idle')\\\n        \\ %}\\n    border: 3px solid rgba(255, 163, 0, 0.8);\\n  {% else %}\\n    border:\\\n        \\ 0px solid rgba(0, 0, 0, 0);\\n  {% endif %}\\n}\\n\"\n    layout_options:\n      grid_columns: 2\nmax_columns: 4\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/kitchen/","title":"Kitchen","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/kitchen/#kitchen","title":"Kitchen","text":"<p>Dashboard: Main Dashboard Path: <code>kitchen</code></p> <p>Kitchen management including appliance monitoring, detailed dishwasher stats, and zoned presence.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/kitchen/#summary","title":"Summary","text":"<p>This view offers comprehensive control over the Kitchen. It monitors critical appliances, showing the status of the fridge (door/leak), coffee machine, and detailed cycle information for the dishwasher. Lighting controls allow for general switching or individual bulb adjustments. A key feature is the visualization of zoned presence detection (Entrance, Table, Cooking) using FP2 sensors, enabling highly granular kitchen automations.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/kitchen/#related-packages","title":"Related Packages","text":"<p>This view contains entities managed by:</p> <ul> <li>Dishwasher</li> <li>Scenes</li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/kitchen/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:auto-entities</code></li> <li><code>custom:decluttering-card</code></li> <li><code>custom:mushroom-entity-card</code></li> <li><code>custom:mushroom-light-card</code></li> <li><code>custom:mushroom-template-card</code></li> <li><code>custom:mushroom-title-card</code></li> <li><code>custom:scheduler-card</code></li> <li><code>custom:streamline-card</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/kitchen/#configuration","title":"Configuration","text":"<pre><code>title: Kitchen\npath: kitchen\ntype: sections\nsections:\n- type: grid\n  cards:\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: kitchen\n      area_title: Kitchen\n      temperature_sensor: sensor.airthings_wave_temperature\n      temp_sensor_entity: sensor.kitchen_fridge_door_device_temperature\n      indicator_1_entity: binary_sensor.kitchen_fridge_door_contact\n      indicator_1_icon: mdi:fridge\n      indicator_1_state: 'on'\n      indicator_1_active_color: '#FF4444'\n      indicator_1_animation_on: blink 0.5s ease infinite\n      indicator_2_entity: binary_sensor.kitchen_fridge_leak_sensor_water_leak\n      indicator_2_icon: mdi:fridge-alert\n      indicator_2_state: 'on'\n      indicator_2_active_color: '#088CF8'\n      indicator_2_animation_on: blink 0.5s ease infinite\n      indicator_3_entity: sensor.coffee_machine_state\n      indicator_3_icon: mdi:coffee\n      indicator_3_active_color: orange\n      indicator_3_state: Running\n      indicator_4_entity: switch.schedule_coffee_machine_schedule\n      indicator_4_icon: mdi:coffee-to-go-outline\n      indicator_4_state: 'on'\n      indicator_3_animation_on: blink 2s ease infinite\n      indicator_4_active_color: lightgreen\n      indicator_5_entity: sensor.dishwasher_current_status\n      indicator_5_icon: mdi:dishwasher\n      indicator_5_state: running\n      indicator_5_active_color: skyblue\n      indicator_5_animation_on: blink 2s ease infinite\n      indicator_6_entity: binary_sensor.kitchen_dishwasher_leak_sensor_water_leak\n      indicator_6_icon: mdi:dishwasher-alert\n      indicator_6_state: 'on'\n      indicator_6_active_color: '#088CF8'\n      indicator_6_animation_on: blink 0.5s ease infinite\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: LIGHTS\n    alignment: center\n  - type: custom:mushroom-light-card\n    entity: light.kitchen_ceiling_light\n    show_brightness_control: true\n    show_color_control: false\n    show_color_temp_control: false\n    fill_container: false\n    tap_action:\n      action: toggle\n  - type: custom:mushroom-light-card\n    entity: light.kitchen_sink_light\n    show_color_temp_control: false\n    show_brightness_control: true\n    tap_action:\n      action: toggle\n  - type: custom:mushroom-entity-card\n    entity: switch.kitchen_wall_box_switch_left\n    name: Ceiling Light Switch\n    icon: mdi:light-switch\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: DISHWASHER\n    alignment: center\n  - type: custom:mushroom-entity-card\n    entity: sensor.dishwasher_state\n    layout: vertical\n    name: Dishwasher\n    icon: mdi:dishwasher\n    fill_container: true\n  - type: custom:mushroom-entity-card\n    entity: binary_sensor.kitchen_dishwasher_leak_sensor_water_leak\n    name: Leak Sensor\n    layout: vertical\n  - type: custom:mushroom-entity-card\n    entity: binary_sensor.dishwasher_door\n    layout: vertical\n    name: Dishwasher Door\n    icon: mdi:dishwasher\n    fill_container: true\n  - type: custom:mushroom-entity-card\n    entity: sensor.dishwasher_current_cycle\n    layout: vertical\n    name: Dishwasher Cycle\n    icon: mdi:recycle\n    fill_container: true\n  - type: custom:mushroom-entity-card\n    entity: sensor.dishwasher_remaining_time\n    layout: vertical\n    name: Dishwasher Remaining Time\n    icon: mdi:dishwasher\n    fill_container: true\n  - type: custom:mushroom-entity-card\n    entity: sensor.dishwasher_total_time\n    layout: vertical\n    name: Dishwasher Run Time\n    icon: mdi:dishwasher\n    fill_container: true\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: APPLIANCES\n    alignment: center\n  - type: custom:mushroom-template-card\n    primary: Fridge Door\n    secondary: \"{% set status = states(entity) %}\\n{% if status == 'off' %}\\n  Closed\\n\\\n      {% else %}\\n  Open\\n{% endif %}\"\n    icon: mdi:fridge\n    entity: binary_sensor.kitchen_fridge_door_contact\n    fill_container: true\n    layout: vertical\n    icon_color: \"{% set status = states(entity) %}\\n{% if status == 'off' %}\\n  green\\n\\\n      {% else %}\\n  red\\n{% endif %}\"\n  - type: custom:mushroom-template-card\n    primary: Coffee Machine\n    secondary_info: last-changed\n    secondary: \"{% set status = states(entity) %}\\n{% if status == 'Running' %}\\n\\\n      \\  Running\\n{% else %}\\n  {{ (as_timestamp(now()) - as_timestamp(states.sensor.coffee_machine_state.last_changed\\\n      \\ | default(0)) | int ) | timestamp_custom(\\\"%Hh %Mm\\\", false) }} ago\\n{% endif\\\n      \\ %}\"\n    icon: mdi:coffee\n    entity: sensor.coffee_machine_state\n    fill_container: true\n    layout: vertical\n    icon_color: \"{% set status = states(entity) %}\\n{% if status == 'Running' %}\\n\\\n      \\  red\\n{% else %}\\n  green\\n{% endif %}\"\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: POWER\n    alignment: center\n  - type: custom:mushroom-entity-card\n    entity: sensor.kitchen_coffee_machine_outlet_power\n    layout: vertical\n    name: Coffee Machine Power\n    icon_color: accent\n    tap_action:\n      action: none\n    double_tap_action:\n      action: none\n    hold_action:\n      action: more-info\n    fill_container: true\n  - type: custom:mushroom-entity-card\n    entity: switch.kitchen_coffee_machine_outlet\n    layout: vertical\n    name: Coffee Machine Outlet\n    icon_color: green\n    tap_action:\n      action: none\n    double_tap_action:\n      action: none\n    hold_action:\n      action: more-info\n    fill_container: true\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: LIGHT SETTINGS\n    alignment: center\n  - type: entities\n    entities:\n    - entity: light.kitchen_sink_light\n    - entity: light.kitchen_ceiling_light\n    - type: section\n      label: Ceiling Bulbs\n    - type: buttons\n      entities:\n      - entity: light.kitchen_ceiling_light_1\n        name: Ceiling Light 1\n      - entity: light.kitchen_ceiling_light_2\n        name: Ceiling Light 2\n      - entity: light.kitchen_ceiling_light_3\n        name: Ceiling Light 3\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: BATTERY LEVELS\n    alignment: center\n  - type: custom:auto-entities\n    card:\n      type: entities\n    filter:\n      include:\n      - entity_id: sensor.kitchen*battery*\n      - entity_id: sensor.dishwasher*battery\n      exclude: []\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: COFFEE MACHINE AUTOMATION\n    alignment: center\n  - type: entities\n    entities:\n    - entity: switch.kitchen_coffee_machine_outlet\n      secondary_info: last-changed\n      icon: mdi:coffee\n  - type: custom:scheduler-card\n    include:\n    - switch.kitchen_coffee_machine_outlet\n    exclude: []\n- type: grid\n  cards:\n  - type: heading\n    heading: New section\n  - type: markdown\n    content: &lt;li&gt;{{ expand('light.kitchen_ceiling_light')|map(attribute='name')|list|join('&lt;li&gt;')\n      }}\n  - square: false\n    columns: 1\n    type: grid\n    cards:\n    - type: custom:mushroom-title-card\n      title: SETTINGS\n      alignment: center\n      subtitle: OCCUPANCY SETTINGS\n  - type: history-graph\n    entities:\n    - entity: input_boolean.kitchen_occupancy\n      name: Presence\n    - entity: binary_sensor.kitchen_sensor_fp2_a94f_presence_sensor_6\n      name: Entrance\n    - entity: binary_sensor.kitchen_sensor_fp2_a94f_presence_sensor_4\n      name: Table\n    - entity: binary_sensor.kitchen_sensor_fp2_a94f_presence_sensor_3\n      name: Cooking\n    hours_to_show: 12\n  - type: custom:decluttering-card\n    template: area_occupancy_settings\n    variables:\n    - area: kitchen\n    - area_name: Kitchen\n  - type: entities\n    entities:\n    - entity: binary_sensor.kitchen_sensor_fp2_a94f_presence_sensor_1\n    - entity: binary_sensor.kitchen_sensor_fp2_a94f_presence_sensor_6\n    - entity: binary_sensor.kitchen_sensor_fp2_a94f_presence_sensor_5\n    - entity: binary_sensor.kitchen_sensor_fp2_a94f_presence_sensor_4\n    - entity: binary_sensor.kitchen_sensor_fp2_a94f_presence_sensor_3\nmax_columns: 4\nsubview: true\ncards: []\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/living_room/","title":"Living Room","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/living_room/#living-room","title":"Living Room","text":"<p>Dashboard: Main Dashboard Path: <code>living_room</code></p> <p>Living room environment monitoring, entertainment controls, and fireplace management.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/living_room/#summary","title":"Summary","text":"<p>The Living Room dashboard is a media and comfort hub. It features in-depth environmental monitoring (Radon, VOCs, CO2) via Airthings Wave, displaying historical trends. Entertainment controls are central, with remotes for the TV and Soundbar, plus power management for the media wall. The view also includes specific controls for the fireplace, air purifier modes, and various lighting scenes, alongside standard occupancy settings.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/living_room/#related-packages","title":"Related Packages","text":"<p>This view contains entities managed by:</p> <ul> <li>Airthings</li> <li>Room Manager</li> <li>Scenes</li> <li>Smart Notifications</li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/living_room/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:auto-entities</code></li> <li><code>custom:card-mod</code></li> <li><code>custom:decluttering-card</code></li> <li><code>custom:mini-graph-card</code></li> <li><code>custom:mushroom-entity-card</code></li> <li><code>custom:mushroom-fan-card</code></li> <li><code>custom:mushroom-light-card</code></li> <li><code>custom:mushroom-select-card</code></li> <li><code>custom:mushroom-template-card</code></li> <li><code>custom:mushroom-title-card</code></li> <li><code>custom:streamline-card</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/living_room/#configuration","title":"Configuration","text":"<pre><code>theme: Backend-selected\ntitle: Living Room\ntype: sections\nlayout:\n  max_cols: 5\nsubview: true\nbadges: []\ncards: []\nsections:\n- type: grid\n  cards:\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: living_room\n      area_title: Living Room\n      temperature_sensor: sensor.airthings_wave_temperature\n      temp_sensor_entity: sensor.airthings_wave_temperature\n      indicator_1_entity: light.fireplace\n      indicator_1_icon: mdi:fireplace\n      indicator_1_state: 'on'\n      indicator_1_active_color: orange\n      indicator_1_animation_on: blink 2s ease infinite\n      indicator_2_entity: media_player.70pus9005_12_2\n      indicator_2_icon: mdi:television\n      indicator_2_state: 'on'\n      indicator_2_active_color: lightgreen\n      indicator_2_animation_on: blink 2s ease infinite\n      indicator_3_entity: input_select.sofa_presence\n      indicator_3_icon: mdi:sofa\n      indicator_3_state: presence\n      indicator_3_active_color: lightgreen\n      indicator_5_entity: binary_sensor.inner_back_door_contact\n      indicator_5_icon: mdi:door\n      indicator_5_state: 'on'\n      indicator_6_entity: binary_sensor.backyard_door_sensor_contact\n      indicator_6_icon: mdi:door\n      indicator_6_state: 'on'\n      indicator_6_active_color: '#FF4444'\n      indicator_6_animation_on: blink 0.5s ease infinite\n      indicator_5_active_color: '#FF4444'\n      indicator_5_animation_on: blink 0.5s ease infinite\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: ENVIRONMENT\n      alignment: center\n    - square: false\n      type: grid\n      cards:\n      - type: custom:decluttering-card\n        template: minigraph_co2\n        variables:\n        - sensor: sensor.airthings_wave_living_room_co2\n      - type: custom:decluttering-card\n        template: minigraph_temperature\n        variables:\n        - sensor: sensor.airthings_wave_temperature\n      - type: custom:decluttering-card\n        template: minigraph_humidity\n        variables:\n        - sensor: sensor.airthings_wave_humidity\n      - type: custom:mini-graph-card\n        entities:\n        - entity: sensor.airthings_wave_living_room_voc\n          name: VOC\n        font_size_header: 12\n        font_size: 75\n        line_width: 8\n        height: 200\n        animate: true\n        hours_to_show: 24\n        show:\n          points: false\n        color_thresholds:\n        - value: 250\n          color: '#5FE787'\n        - value: 500\n          color: '#FF9800'\n        - value: 2000\n          color: '#FF535B'\n        card_mod:\n          style: \".header.flex .icon {\\n{% set sensor = states('sensor.airthings_wave_living_room_voc')|float\\\n            \\ %}\\n  {% if sensor &gt; 2000 %}\\n    color: red;\\n  {% elif sensor &gt; 500\\\n            \\  %}\\n    color: orange;\\n  {% else  %}\\n    color: lightgreen;\\n  {%\\\n            \\ endif %} }\\nha-card {\\n  {% if sensor &gt; 2000 %}\\n    --ha-card-background:\\\n            \\ rgba(255, 83, 91,0.05);\\n  {% elif sensor &gt; 500  %}\\n    --ha-card-background:\\\n            \\ rgba(255, 152, 0,0.05);\\n  {% else  %}\\n    --ha-card-background: rgba(95,\\\n            \\ 231, 135,0.05);\\n  {% endif %} }\\n}\\n\"\n      - type: custom:mini-graph-card\n        entities:\n        - entity: sensor.airthings_wave_living_room_radon_1_day_average\n          name: Radon Short\n        font_size_header: 12\n        font_size: 75\n        line_width: 8\n        height: 200\n        animate: true\n        hours_to_show: 24\n        show:\n          points: false\n        color_thresholds:\n        - value: 100\n          color: '#5FE787'\n        - value: 150\n          color: '#FF9800'\n        - value: 200\n          color: '#FF535B'\n        card_mod:\n          style: \".header.flex .icon {\\n  {% set sensor =\\nstates('sensor.airthings_wave_living_room_radon_1_day_average')|float\\\n            \\ %}\\n  {% if sensor &gt; 150 %}\\n    color: red;\\n  {% elif sensor &gt; 100\\\n            \\  %}\\n    color: orange;\\n  {% else  %}\\n    color: lightgreen;\\n  {%\\\n            \\ endif %} \\n} ha-card {\\n  {% if sensor &gt; 200 %}\\n    --ha-card-background:\\\n            \\ rgba(255, 83, 91,0.05);\\n  {% elif sensor &gt; 150  %}\\n    --ha-card-background:\\\n            \\ rgba(255, 152, 0,0.05);\\n  {% else  %}\\n    --ha-card-background: rgba(95,\\\n            \\ 231, 135,0.05);\\n  {% endif %} }\\n}\\n\"\n      - type: custom:mini-graph-card\n        entities:\n        - entity: sensor.airthings_wave_living_room_radon_longterm_average\n          name: Radon Long\n        font_size_header: 12\n        font_size: 75\n        line_width: 8\n        height: 200\n        animate: true\n        hours_to_show: 24\n        show:\n          points: false\n        color_thresholds:\n        - value: 100\n          color: '#5FE787'\n        - value: 150\n          color: '#FF9800'\n        - value: 200\n          color: '#FF535B'\n        card_mod:\n          style: \".header.flex .icon {\\n  {% set sensor =\\n  states('sensor.airthings_wave_living_room_radon_longterm_average')|float\\\n            \\ %}\\n  {% if sensor &gt; 150 %}\\n    color: red;\\n  {% elif sensor &gt; 100\\\n            \\  %}\\n    color: orange;\\n  {% else  %}\\n    color: lightgreen;\\n  {%\\\n            \\ endif %}\\n} ha-card {\\n  {% if sensor &gt; 200 %}\\n    --ha-card-background:\\\n            \\ rgba(255, 83, 91,0.05);\\n  {% elif sensor &gt; 150  %}\\n    --ha-card-background:\\\n            \\ rgba(255, 152, 0,0.05);\\n  {% else  %}\\n    --ha-card-background: rgba(95,\\\n            \\ 231, 135,0.05);\\n  {% endif %} }\\n}\\n\"\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: LIGHTS\n      alignment: center\n    - square: false\n      columns: 2\n      type: grid\n      cards:\n      - type: custom:mushroom-light-card\n        entity: light.living_room_ceiling_light\n        fill_container: false\n        use_light_color: false\n        show_brightness_control: true\n        show_color_control: false\n        show_color_temp_control: false\n        collapsible_controls: false\n        name: Ceiling\n        icon: ''\n      - type: custom:mushroom-light-card\n        entity: light.floor_light\n        show_brightness_control: true\n        show_color_control: false\n        show_color_temp_control: false\n        use_light_color: false\n        icon: mdi:floor-lamp\n      - type: custom:mushroom-light-card\n        entity: light.hallway_ceiling_light\n        show_brightness_control: true\n      - type: custom:mushroom-light-card\n        entity: light.stairs_wled\n        show_brightness_control: true\n  - type: custom:mushroom-entity-card\n    entity: switch.christmas_tree_plug\n    icon: mdi:pine-tree\n    layout: vertical\n    name: Christmas Tree\n    fill_container: true\n    icon_color: accent\n    visibility:\n    - condition: state\n      entity: switch.christmas_tree_plug\n      state_not: unavailable\n    - condition: state\n      entity: switch.christmas_tree_plug\n      state_not: unknown\n- type: grid\n  cards:\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: AIR PURIFIER\n      alignment: center\n    - square: false\n      columns: 1\n      type: grid\n      cards:\n      - type: custom:mushroom-fan-card\n        entity: fan.philips_air_purifier\n        show_percentage_control: true\n        layout: horizontal\n        tap_action:\n          action: toggle\n        hold_action:\n          action: more-info\n        double_tap_action:\n          action: none\n        card_mod:\n          style: \"ha-card {\\n  border-bottom-right-radius: 0px;\\n  border-bottom-left-radius:\\\n            \\ 0px;\\n}\\n\"\n      - square: false\n        columns: 4\n        type: grid\n        cards:\n        - type: custom:mushroom-template-card\n          entity: fan.philips_air_purifier\n          primary: Auto\n          secondary: ''\n          icon: mdi:fan\n          layout: vertical\n          icon_color: \"{% set status = states(entity) %}\\n{% if status == 'on' %}\\n\\\n            {% set mode = state_attr(entity,'preset_mode') %}\\n{% if mode == 'auto'\\\n            \\ %}\\n  blue\\n{% else %}\\n  disabled\\n{% endif %}\\n{% else %}\\n  disabled\\n\\\n            {% endif %}\\n\"\n          tap_action:\n            action: call-service\n            service: fan.set_preset_mode\n            data:\n              preset_mode: auto\n            target:\n              entity_id: fan.philips_air_purifier\n          card_mod:\n            style:\n              mushroom-shape-icon:\n                $: \".shape ha-icon\\n  {\\n    {% set status = states(config.entity)\\\n                  \\ %}\\n    {% if status == 'on' %}\\n    {% set mode = state_attr(config.entity,'preset_mode')\\\n                  \\ %}\\n    {% if mode == 'auto' %}\\n    {% set speed = state_attr(config.entity,'percentage')\\\n                  \\ | int %}\\n    {% if speed &lt; 60 %}\\n    --icon-animation: rotation\\\n                  \\ 2s linear infinite;\\n    {% elif speed &lt; 80 %}\\n    --icon-animation:\\\n                  \\ rotation 1s linear infinite;\\n    {% elif speed &lt; 100 %}\\n   \\\n                  \\ --icon-animation: rotation 0.6s linear infinite;\\n    {% else\\\n                  \\ %}\\n    --icon-animation: rotation 0.3s linear infinite;\\n   \\\n                  \\ {% endif %}\\n    {% endif %}\\n    {% endif %}\\n  }\\n  @keyframes\\\n                  \\ rotation {\\n    0% {\\n      transform: rotate(0deg);\\n    }\\n\\\n                  \\    100% {\\n      transform: rotate(360deg);\\n    }\\n  }\\n\"\n                .: \"ha-card {\\n  border-radius: 0px;\\n  box-shadow: 0px 0px;\\n  background-color:\\\n                  \\ rgba(0,0,0,0);\\n  border: 5px solid #222;\\n}\\n:host {\\n}\\n\"\n        - type: custom:mushroom-template-card\n          entity: fan.philips_air_purifier\n          primary: Allergen\n          secondary: ''\n          icon: mdi:fan\n          layout: vertical\n          icon_color: \"{% set status = states(entity) %}\\n{% if status == 'on' %}\\n\\\n            {% set mode = state_attr(entity,'preset_mode') %}\\n{% if mode == 'allergen'\\\n            \\ %}\\n  blue\\n{% else %}\\n  disabled\\n{% endif %}\\n{% else %}\\n  disabled\\n\\\n            {% endif %}\\n\"\n          tap_action:\n            action: call-service\n            service: fan.set_preset_mode\n            data:\n              preset_mode: allergen\n            target:\n              entity_id: fan.philips_air_purifier\n          card_mod:\n            style:\n              mushroom-shape-icon:\n                $: \".shape ha-icon\\n  {\\n    {% set status = states(config.entity)\\\n                  \\ %}\\n    {% if status == 'on' %}\\n    {% set mode = state_attr(config.entity,'preset_mode')\\\n                  \\ %}\\n    {% if mode == 'allergen' %}\\n    {% set speed = state_attr(config.entity,'percentage')\\\n                  \\ | int %}\\n    {% if speed &lt; 60 %}\\n    --icon-animation: rotation\\\n                  \\ 2s linear infinite;\\n    {% elif speed &lt; 80 %}\\n    --icon-animation:\\\n                  \\ rotation 1s linear infinite;\\n    {% elif speed &lt; 100 %}\\n   \\\n                  \\ --icon-animation: rotation 0.6s linear infinite;\\n    {% else\\\n                  \\ %}\\n    --icon-animation: rotation 0.3s linear infinite;\\n   \\\n                  \\ {% endif %}\\n    {% endif %}\\n    {% endif %}\\n  }\\n  @keyframes\\\n                  \\ rotation {\\n    0% {\\n      transform: rotate(0deg);\\n    }\\n\\\n                  \\    100% {\\n      transform: rotate(360deg);\\n    }\\n  }\\n\"\n                .: \"ha-card {\\n  border-radius: 0px;\\n  box-shadow: 0px 0px;\\n  background-color:\\\n                  \\ rgba(0,0,0,0);\\n  border: 5px solid #222;\\n}\\n:host {\\n}\\n\"\n        - type: custom:mushroom-template-card\n          entity: fan.philips_air_purifier\n          primary: Night\n          secondary: ''\n          icon: mdi:fan\n          layout: vertical\n          icon_color: \"{% set status = states(entity) %}\\n{% if status == 'on' %}\\n\\\n            {% set mode = state_attr(entity,'preset_mode') %}\\n{% if mode == 'night'\\\n            \\ %}\\n  blue\\n{% else %}\\n  disabled\\n{% endif %}\\n{% else %}\\n  disabled\\n\\\n            {% endif %}\\n\"\n          tap_action:\n            action: call-service\n            service: fan.set_preset_mode\n            data:\n              preset_mode: night\n            target:\n              entity_id: fan.philips_air_purifier\n          card_mod:\n            style:\n              mushroom-shape-icon:\n                $: \".shape ha-icon\\n  {\\n    {% set status = states(config.entity)\\\n                  \\ %}\\n    {% if status == 'on' %}\\n    {% set mode = state_attr(config.entity,'preset_mode')\\\n                  \\ %}\\n    {% if mode == 'night' %}\\n    {% set speed = state_attr(config.entity,'percentage')\\\n                  \\ | int %}\\n    {% if speed &lt; 60 %}\\n    --icon-animation: rotation\\\n                  \\ 2s linear infinite;\\n    {% elif speed &lt; 80 %}\\n    --icon-animation:\\\n                  \\ rotation 1s linear infinite;\\n    {% elif speed &lt; 100 %}\\n   \\\n                  \\ --icon-animation: rotation 0.6s linear infinite;\\n    {% else\\\n                  \\ %}\\n    --icon-animation: rotation 0.3s linear infinite;\\n   \\\n                  \\ {% endif %}\\n    {% endif %}\\n    {% endif %}\\n  }\\n  @keyframes\\\n                  \\ rotation {\\n    0% {\\n      transform: rotate(0deg);\\n    }\\n\\\n                  \\    100% {\\n      transform: rotate(360deg);\\n    }\\n  }\\n\"\n                .: \"ha-card {\\n  border-radius: 0px;\\n  box-shadow: 0px 0px;\\n  background-color:\\\n                  \\ rgba(0,0,0,0);\\n  border: 5px solid #222;\\n}\\n:host {\\n}\\n\"\n        - type: custom:mushroom-template-card\n          entity: fan.philips_air_purifier\n          primary: Manual\n          secondary: ''\n          icon: mdi:fan\n          layout: vertical\n          icon_color: \"{% set status = states(entity) %}\\n{% if status == 'on' %}\\n\\\n            {% set mode = state_attr(entity,'preset_mode') %}\\n{% if mode == 'manual'\\\n            \\ %}\\n  blue\\n{% else %}\\n  disabled\\n{% endif %}\\n{% else %}\\n  disabled\\n\\\n            {% endif %}\\n\"\n          tap_action:\n            action: call-service\n            service: fan.set_preset_mode\n            data:\n              preset_mode: manual\n            target:\n              entity_id: fan.philips_air_purifier\n          card_mod:\n            style:\n              mushroom-shape-icon:\n                $: \".shape ha-icon\\n  {\\n    {% set status = states(config.entity)\\\n                  \\ %}\\n    {% if status == 'on' %}\\n    {% set mode = state_attr(config.entity,'preset_mode')\\\n                  \\ %}\\n    {% if mode == 'manual' %}\\n    {% set speed = state_attr(config.entity,'percentage')\\\n                  \\ | int %}\\n    {% if speed &lt; 60 %}\\n    --icon-animation: rotation\\\n                  \\ 2s linear infinite;\\n    {% elif speed &lt; 80 %}\\n    --icon-animation:\\\n                  \\ rotation 1s linear infinite;\\n    {% elif speed &lt; 100 %}\\n   \\\n                  \\ --icon-animation: rotation 0.6s linear infinite;\\n    {% else\\\n                  \\ %}\\n    --icon-animation: rotation 0.3s linear infinite;\\n   \\\n                  \\ {% endif %}\\n    {% endif %}\\n    {% endif %}\\n  }\\n  @keyframes\\\n                  \\ rotation {\\n    0% {\\n      transform: rotate(0deg);\\n    }\\n\\\n                  \\    100% {\\n      transform: rotate(360deg);\\n    }\\n  }\\n\"\n                .: \"ha-card {\\n  border-radius: 0px;\\n  box-shadow: 0px 0px;\\n  background-color:\\\n                  \\ rgba(0,0,0,0);\\n  border: 5px solid #222;\\n}\\n:host {\\n}\\n\"\n      - square: false\n        columns: 3\n        type: grid\n        cards:\n        - type: custom:mushroom-template-card\n          entity: sensor.philips_air_purifier_pre_filter\n          primary: Pre-filter\n          secondary: '{{ states(entity) }} hours'\n          icon: mdi:air-filter\n          icon_color: \"{% set value = states(entity) | int\\n%}\\n{% if value &lt; 2 %}\\n\\\n            \\  red\\n{% elif value &lt; 168 %}\\n  orange\\n{% else %}\\n  green\\n{% endif\\\n            \\ %}\\n\"\n          tap_action:\n            action: none\n          hold_action:\n            action: more-info\n          double_tap_action:\n            action: none\n          card_mod:\n            style: \":host { display:\\n  {% set filter = states(config.entity) | int\\n\\\n              %}\\n  {% if filter &gt; 168 %}\\n    inline;\\n  {% else %}\\n    inline;\\n\\\n              \\  {% endif %}\\n}\\n@keyframes blink {\\n  50% { opacity: 0; }\\n}\\nha-card\\\n              \\ {\\n  --mush-chip-border-radius: 0px;\\n  {% set filter = states(config.entity)\\\n              \\ |\\n  int %}\\n  {% if filter == 0 %}\\n  animation: blinks 1s ease infinite;\\n\\\n              \\  {% endif %}\\n  border-radius: 0px;\\n}\\n\"\n        - type: custom:mushroom-template-card\n          entity: sensor.philips_air_purifier_hepa_filter\n          primary: Hepa\n          secondary: '{{ states(entity) }} hours'\n          icon: mdi:air-filter\n          icon_color: \"{% set value = states(entity) | int\\n%}\\n{% if value &lt; 2 %}\\n\\\n            \\  red\\n{% elif value &lt; 168 %}\\n  orange\\n{% else %}\\n  green\\n{% endif\\\n            \\ %}\\n\"\n          tap_action:\n            action: none\n          hold_action:\n            action: more-info\n          double_tap_action:\n            action: none\n          card_mod:\n            style: \":host { display:\\n  {% set filter = states(config.entity) | int\\n\\\n              %}\\n  {% if filter &lt; 168 %}\\n    inline;\\n  {% else %}\\n    inline;\\n\\\n              \\  {% endif %}\\n}\\n@keyframes blink {\\n  50% { opacity: 0; }\\n}\\nha-card\\\n              \\ {\\n  --mush-chip-border-radius: 0px;\\n  {% set filter = states(config.entity)\\\n              \\ |\\n  int %}\\n  {% if filter == 0 %}\\n  animation: blinks 1s ease infinite;\\n\\\n              \\  {% endif %}\\n  border-radius: 0px;\\n}\\n\"\n        - type: custom:mushroom-template-card\n          entity: sensor.philips_air_purifier_carbon_filter\n          primary: Carbon\n          secondary: '{{ states(entity) }} hours'\n          icon: mdi:air-filter\n          icon_color: \"{% set value = states(entity) | int\\n%}\\n{% if value &lt; 2 %}\\n\\\n            \\  red\\n{% elif value &lt; 168 %}\\n  orange\\n{% else %}\\n  green\\n{% endif\\\n            \\ %}\\n\"\n          tap_action:\n            action: none\n          hold_action:\n            action: more-info\n          double_tap_action:\n            action: none\n          card_mod:\n            style: \":host { display:\\n  {% set filter = states(config.entity) | int\\n\\\n              %}\\n  {% if filter &lt; 168 %}\\n    inline;\\n  {% else %}\\n    inline;\\n\\\n              \\  {% endif %}\\n}\\n@keyframes blink {\\n  50% { opacity: 0; }\\n}\\nha-card\\\n              \\ {\\n  --mush-chip-border-radius: 0px;\\n  {% set filter = states(config.entity)\\\n              \\ |\\n  int %}\\n  {% if filter == 0 %}\\n  animation: blinks 1s ease infinite;\\n\\\n              \\  {% endif %}\\n  border-radius: 0px;\\n}\\n\"\n      - square: false\n        columns: 1\n        type: grid\n        cards:\n        - type: custom:mushroom-template-card\n          primary: ''\n          secondary: AC1214/10\n          icon: ''\n          entity: fan.philips_air_purifier\n          card_mod:\n            style: \"ha-card {\\n  border-top-right-radius: 0px;\\n  border-top-left-radius:\\\n              \\ 0px;\\n}\\n\"\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      alignment: center\n      subtitle: FIREPLACE\n    - square: false\n      type: grid\n      cards:\n      - type: custom:mushroom-light-card\n        entity: light.fireplace\n        fill_container: true\n        layout: vertical\n        name: Fireplace\n      - type: custom:mushroom-select-card\n        entity: select.fireplace_preset\n        name: Fireplace Preset\n      columns: 2\n    - type: custom:mushroom-entity-card\n      entity: number.fireplace_fade_timeout\n      icon: mdi:camera-timer\n  - square: false\n    columns: 1\n    type: grid\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      alignment: center\n      subtitle: REMOTE CONTROLS\n    - square: false\n      columns: 3\n      type: grid\n      cards:\n      - type: custom:mushroom-entity-card\n        entity: input_button.tv_remote_button\n        icon: mdi:remote-tv\n        name: TV\n        secondary_info: none\n        icon_color: orange\n        fill_container: true\n        layout: vertical\n        tap_action:\n          action: navigate\n          navigation_path: /dashboard-popups/tv-remote\n      - type: custom:mushroom-entity-card\n        entity: input_button.tv_remote_button\n        icon: mdi:remote\n        name: SOUNDBAR\n        secondary_info: none\n        icon_color: orange\n        fill_container: true\n        layout: vertical\n        tap_action:\n          action: navigate\n          navigation_path: /dashboard-popups/soundbar-remote\n      - type: custom:mushroom-entity-card\n        entity: switch.remote_fix\n        icon: mdi:auto-fix\n        layout: vertical\n        fill_container: true\n        icon_color: primary\n        secondary_info: none\n        tap_action:\n          action: none\n        hold_action:\n          action: call-service\n          service: automation.trigger\n          target:\n            entity_id: automation.fix_tv_remote\n          data:\n            skip_condition: true\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: WALL OUTLETS\n      alignment: center\n    - square: false\n      type: grid\n      cards:\n      - type: custom:mushroom-entity-card\n        entity: sensor.living_room_media_outlet_power\n        layout: vertical\n        name: Media Wall Outlet\n        fill_container: true\n        icon_color: accent\n      - type: custom:mushroom-entity-card\n        entity: switch.living_room_media_outlet\n        layout: vertical\n        name: Media Wall Outlet\n        tap_action:\n          action: none\n        hold_action:\n          action: more-info\n        double_tap_action:\n          action: none\n        fill_container: true\n        icon_color: green\n      - type: custom:mushroom-entity-card\n        entity: sensor.living_room_desk_outlet_channel_1_power\n        layout: vertical\n        fill_container: true\n        name: Desk Wall Outlet\n        icon_color: accent\n      - type: custom:mushroom-entity-card\n        entity: switch.air_purifier_plug\n        layout: vertical\n        name: Air Purifier Plug\n        tap_action:\n          action: none\n        hold_action:\n          action: more-info\n        double_tap_action:\n          action: none\n        fill_container: true\n        icon_color: green\n      columns: 2\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: SOFA OUTLETS\n      alignment: center\n- type: grid\n  cards:\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: BATTERY LEVELS\n      alignment: center\n    - type: custom:auto-entities\n      card:\n        type: entities\n      filter:\n        include:\n        - entity_id: sensor.*living_room*battery*\n        - entity_id: sensor.*back_door*battery*\n        exclude: []\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: DEVICES\n    - type: horizontal-stack\n      cards:\n      - type: entities\n        entities:\n        - entity: sensor.airthings_wave_living_room_co2\n        - entity: sensor.airthings_wave_living_room_humidity\n        - entity: sensor.airthings_wave_living_room_pressure\n        - entity: sensor.airthings_wave_living_room_radon_1_day_average\n        - entity: sensor.airthings_wave_living_room_radon_longterm_average\n        - entity: sensor.airthings_wave_living_room_temperature\n        - entity: sensor.airthings_wave_living_room_voc\n        - entity: sensor.airthings_wave_living_room_illuminance\n        - entity: sensor.airthings_wave_living_room_battery\n        - type: section\n          label: Sensors\n        - entity: sensor.philips_air_purifier_pm25\n        - entity: sensor.philips_air_purifier_allergen_index\n        - type: section\n          label: Air Purifier\n        - entity: fan.philips_air_purifier\n        - entity: switch.air_purifier_plug\n          name: Air Purifier Power Plug\n        - entity: sensor.philips_air_purifier_pre_filter\n        - entity: sensor.philips_air_purifier_carbon_filter\n        - entity: sensor.philips_air_purifier_hepa_filter\n        - type: section\n          label: Presense\n        show_header_toggle: false\n        state_color: true\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: SETTINGS\n    alignment: center\n    subtitle: OCCUPANCY SETTINGS\n  - type: custom:decluttering-card\n    template: area_occupancy_settings\n    variables:\n    - area: living_room\n    - area_name: Living Room\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: SCHEDULES\n      alignment: center\n    - type: markdown\n      content: These schedules work when they are set on and _Presence Automation\n        Mode_ is set to _Schedule Mode_\n  - type: history-graph\n    entities:\n    - entity: binary_sensor.living_room_fp2_sensor\n      name: Presence\n    - entity: input_select.sofa_presence\n      name: Sofa\n    hours_to_show: 12\nmax_columns: 4\npath: living_room\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/lobby/","title":"Lobby","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/lobby/#lobby","title":"Lobby","text":"<p>Dashboard: Main Dashboard Path: <code>lobby</code></p> <p>Entry lobby controls for lights and automation modes.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/lobby/#summary","title":"Summary","text":"<p>This view manages the Lobby area. It offers basic control over the ceiling light. The primary focus is on automation scheduling, allowing users to define when the lobby lights operate and to schedule changes to the room's overall 'Automation Mode' based on time or sun position.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/lobby/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:decluttering-card</code></li> <li><code>custom:mushroom-light-card</code></li> <li><code>custom:mushroom-title-card</code></li> <li><code>custom:scheduler-card</code></li> <li><code>custom:streamline-card</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/lobby/#configuration","title":"Configuration","text":"<pre><code>theme: Backend-selected\ntitle: Lobby\npath: lobby\ntype: sections\nsubview: true\nlayout:\n  max_cols: 5\nbadges: []\ncards: []\nsections:\n- type: grid\n  cards:\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: lobby\n      area_title: Lobby\n      temperature_sensor: sensor.airthings_wave_temperature\n      temp_sensor_entity: sensor.bedroom_temperature\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: LIGHTS\n    alignment: center\n  - square: false\n    type: grid\n    cards:\n    - type: custom:mushroom-light-card\n      entity: light.lobby_ceiling_light\n      fill_container: true\n      layout: vertical\n      show_brightness_control: true\n      use_light_color: true\n    columns: 1\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: SETTINGS\n    subtitle: OCCUPANCY SETTINGS\n    alignment: center\n  - type: custom:decluttering-card\n    template: area_occupancy_settings\n    variables:\n    - area: lobby\n    - area_name: Lobby\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: SCHEDULES\n    alignment: center\n  - type: markdown\n    content: These schedules work when they are set on and _Presence Automation Mode_\n      is set to _Schedule Mode_\n  - type: custom:scheduler-card\n    include:\n    - input_select.office_automation_mode\n    - light.lobby_light\n    - light.lobby_lights\n    - sensor.presence_sensor_fp2_65ab_light_sensor_light_level\n    exclude: []\n    discover_existing: false\n    tags:\n    - Lobby\n    time_step: 1\n    show_header_toggle: false\n    title: false\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: AUTOMATION MODE SCHEDULES\n    alignment: center\n  - type: markdown\n    content: Automation Mode Changes, based on time or sun.\n  - type: custom:scheduler-card\n    include:\n    - input_select.lobby_automation_mode\n    exclude: []\n    discover_existing: false\n    tags:\n    - lobby-mode-control\n    - office-mode-control\n    time_step: 1\n    show_header_toggle: false\n    title: false\nmax_columns: 4\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/mud_room/","title":"Mud Room","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/mud_room/#mud-room","title":"Mud Room","text":"<p>Dashboard: Main Dashboard Path: <code>mud_room</code></p> <p>Mud room utility simple controls and occupancy tracking.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/mud_room/#summary","title":"Summary","text":"<p>This dashboard manages the Mud Room. It provides control for the ceiling light and visualizes occupancy status via motion sensors. The view includes standard settings for occupancy automations and light scheduling.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/mud_room/#related-packages","title":"Related Packages","text":"<p>This view contains entities managed by:</p> <ul> <li>Unifi Access</li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/mud_room/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:decluttering-card</code></li> <li><code>custom:mushroom-entity-card</code></li> <li><code>custom:mushroom-light-card</code></li> <li><code>custom:mushroom-title-card</code></li> <li><code>custom:scheduler-card</code></li> <li><code>custom:streamline-card</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/mud_room/#configuration","title":"Configuration","text":"<pre><code>theme: Backend-selected\ntitle: Mud Room\npath: mud_room\ntype: sections\nlayout:\n  max_cols: 5\nsubview: true\nbadges: []\ncards: []\nsections:\n- type: grid\n  cards:\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: mud_room\n      area_title: Mud Room\n      temperature_sensor: sensor.airthings_wave_temperature\n      temp_sensor_entity: sensor.mud_room_motion_sensor_device_temperature\n      indicator_1_entity: binary_sensor.front_door_lock_door\n      indicator_1_icon: mdi:door\n      indicator_1_state: 'on'\n      indicator_1_active_color: '#FF4444'\n      indicator_1_animation_on: blink 0.5s ease infinite\n      indicator_2_entity: lock.front_door_lock\n      indicator_2_icon: mdi:lock\n      indicator_2_state: unlocked\n      indicator_2_active_color: '#FF4444'\n      indicator_2_animation_on: blink 0.5s ease infinite\n      indicator_6_entity: binary_sensor.mud_room_door_sensor_contact\n      indicator_6_icon: mdi:door\n      indicator_6_state: 'on'\n      indicator_6_active_color: orange\n      indicator_6_animation_on: blink 1s ease infinite\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: LIGHT\n      alignment: center\n    - type: vertical-stack\n      cards:\n      - square: false\n        type: grid\n        cards:\n        - type: custom:mushroom-light-card\n          entity: light.mud_room_ceiling_light\n          layout: vertical\n          fill_container: true\n          use_light_color: true\n        columns: 1\n  - type: custom:mushroom-entity-card\n    entity: binary_sensor.mud_room_motion_sensor_occupancy\n    layout: vertical\n    name: Mudroom Occupancy\n    icon: mdi:account\n    grid_options:\n      columns: 12\n      rows: 2\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: SETTINGS\n    alignment: center\n    subtitle: Occupancy\n  - type: custom:decluttering-card\n    template: area_occupancy_settings\n    variables:\n    - area: mud_room\n    - area_name: Mud Room\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: SCHEDULES\n    alignment: center\n  - type: markdown\n    content: These schedules work when they are set on and _Presence Automation Mode_\n      is set to _Schedule Mode_\n  - type: custom:scheduler-card\n    include:\n    - input_select.mud_room_automation_mode\n    - light.mud_room_ceiling_light\n    - light.mud_room_lights\n    exclude: []\n    discover_existing: false\n    tags:\n    - mud-room\n    title: false\n    display_options:\n      primary_info: default\n      secondary_info:\n      - relative-time\n      - time\n      - additional-tasks\n      icon: action\n    sort_by:\n    - state\n    - relative-time\n    time_step: 5\n    show_header_toggle: false\nmax_columns: 4\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/office/","title":"Office","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/office/#office","title":"Office","text":"<p>Dashboard: Main Dashboard Path: <code>office</code></p> <p>Home office workspace controls and extensive system monitoring.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/office/#summary","title":"Summary","text":"<p>The Office dashboard handles both workspace environment and IT infrastructure. It offers detailed environmental tracking (Airthings Wave) and lighting prompts. Key features include remote PC control (Audio, Power, Displays) and extensive server monitoring (Proxmox, Home Assistant OS stats, SSD usage). It also manages potential window covers and detailed power consumption for office equipment.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/office/#related-packages","title":"Related Packages","text":"<p>This view contains entities managed by:</p> <ul> <li>Office Pc</li> <li>Scenes</li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/office/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:apexcharts-card</code></li> <li><code>custom:auto-entities</code></li> <li><code>custom:card-mod</code></li> <li><code>custom:decluttering-card</code></li> <li><code>custom:mini-graph-card</code></li> <li><code>custom:mushroom-cover-card</code></li> <li><code>custom:mushroom-entity-card</code></li> <li><code>custom:mushroom-light-card</code></li> <li><code>custom:mushroom-select-card</code></li> <li><code>custom:mushroom-template-card</code></li> <li><code>custom:mushroom-title-card</code></li> <li><code>custom:scheduler-card</code></li> <li><code>custom:streamline-card</code></li> <li><code>custom:uptime-card</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/office/#configuration","title":"Configuration","text":"<pre><code>theme: Backend-selected\ntitle: Office\ntype: sections\nlayout:\n  max_cols: 5\nsubview: true\nbadges: []\ncards: []\nmax_columns: 6\nsections:\n- type: grid\n  cards:\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: office\n      area_title: Office\n      temperature_sensor: sensor.airthings_wave_temperature\n      temp_sensor_entity: sensor.bedroom_temperature\n    grid_options:\n      columns: 12\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: ENVIRONMENT\n      alignment: center\n    - square: false\n      type: grid\n      cards:\n      - type: custom:decluttering-card\n        template: minigraph_co2\n        variables:\n        - sensor: sensor.bedroom_carbon_dioxide\n      - type: custom:decluttering-card\n        template: minigraph_temperature\n        variables:\n        - sensor: sensor.bedroom_temperature\n      - type: custom:decluttering-card\n        template: minigraph_humidity\n        variables:\n        - sensor: sensor.bedroom_humidity\n      columns: 3\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: LIGHTS\n      alignment: center\n    - square: false\n      type: grid\n      cards:\n      - type: custom:mushroom-light-card\n        entity: light.wled_2\n        layout: vertical\n        show_color_control: false\n        show_brightness_control: true\n        name: Desk\n        use_light_color: true\n      - type: custom:mushroom-light-card\n        entity: light.server_cabinet_light\n        layout: vertical\n        show_brightness_control: true\n        name: Rack\n        use_light_color: true\n        show_color_temp_control: false\n        show_color_control: false\n        collapsible_controls: false\n        fill_container: true\n      - type: custom:mushroom-light-card\n        entity: light.bedroom_ceiling_light\n        name: Ceiling\n        layout: vertical\n        show_brightness_control: true\n        use_light_color: true\n      - type: custom:mushroom-light-card\n        entity: light.office_desk_wall_light\n        name: Wall\n        layout: vertical\n        show_brightness_control: true\n        use_light_color: true\n      columns: 4\n    - square: false\n      type: grid\n      cards:\n      - type: custom:mushroom-select-card\n        entity: select.wled_preset_2\n        name: Office Desk Presets\n      columns: 1\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: WINDOW\n      alignment: center\n    - square: false\n      columns: 2\n      type: grid\n      cards:\n      - type: custom:mushroom-cover-card\n        entity: cover.bedroom_window_blinds\n        show_position_control: true\n        show_buttons_control: false\n        tap_action:\n          action: none\n        name: Blinds\n        layout: vertical\n      - type: custom:mushroom-cover-card\n        entity: cover.bedroom_window_roller_cover\n        fill_container: false\n        show_position_control: false\n        show_buttons_control: true\n        tap_action:\n          action: none\n        name: Roller Blind\n        layout: vertical\n- type: grid\n  cards:\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: PC\n      alignment: center\n    - square: false\n      type: grid\n      cards:\n      - type: custom:mushroom-template-card\n        primary: Audio Device\n        secondary: \"{% set status = states(entity) %}\\n{% if status == 'on' %}\\n \\\n          \\ Speakers\\n{% else %}\\n  Headset\\n{% endif %}\"\n        icon: \"{% set status = states(entity) %}\\n{% if status == 'on' %}\\n  mdi:speaker-multiple\\n\\\n          {% else %}\\n  mdi:headphones\\n{% endif %}\"\n        layout: vertical\n        entity: switch.officepc_audio_device\n        tap_action:\n          action: toggle\n        icon_color: \"{% set status = states(entity) %}\\n{% if status == 'on' %}\\n\\\n          \\  green\\n{% else %}\\n  orange\\n{% endif %}\"\n      - type: custom:mushroom-entity-card\n        entity: button.officepc_mediaplaypause\n        name: Play | Pause\n        icon: mdi:play-pause\n        icon_color: blue\n        layout: vertical\n        secondary_info: last-changed\n        fill_container: true\n        tap_action:\n          action: call-service\n          service: button.press\n          target:\n            entity_id: button.officepc_mediaplaypause\n          data: {}\n      - type: custom:mushroom-template-card\n        primary: Audio Mute\n        secondary: \"{% set status = states(entity) %}\\n{% if status == 'on' %}\\n \\\n          \\ Muted\\n{% else %}\\n Volume {{ states('sensor.officepc_audio_default_device_volume')\\\n          \\ }}\\n{% endif %}\"\n        icon: \"{% set status = states(entity) %}\\n{% if status == 'on' %}\\n  mdi:volume-mute\\n\\\n          {% else %}\\n  mdi:volume-high\\n{% endif %}\"\n        layout: vertical\n        entity: switch.officepc_audio_mute\n        tap_action:\n          action: toggle\n        icon_color: \"{% set status = states(entity) %}\\n{% if status == 'on' %}\\n\\\n          \\  red\\n{% else %}\\n  green\\n{% endif %}\"\n  - type: custom:mushroom-entity-card\n    entity: switch.office_pc_power\n    layout: vertical\n    fill_container: true\n    icon_color: green\n    tap_action:\n      action: none\n    hold_action:\n      action: toggle\n    name: PC Power\n  - type: custom:mushroom-template-card\n    primary: Displays\n    secondary: \"{% set status = states(entity) %}\\n{% if status == 'on' %}\\n  On\\n\\\n      {% else %}\\n Off\\n{% endif %}\"\n    icon: \"{% set status = states(entity) %}\\n{% if status == 'on' %}\\n  mdi:monitor\\n\\\n      {% else %}\\n  mdi:monitor-off\\n{% endif %}\"\n    layout: vertical\n    entity: switch.officepc_displays\n    tap_action:\n      action: toggle\n    icon_color: \"{% set status = states(entity) %}\\n{% if status == 'on' %}\\n  green\\n\\\n      {% else %}\\n  red\\n{% endif %}\"\n    fill_container: true\n  - type: history-graph\n    entities:\n    - entity: switch.office_pc_power\n      name: ' '\n  - type: custom:apexcharts-card\n    graph_span: 12h\n    show:\n      loading: false\n    apex_config:\n      chart:\n        height: 120px\n      grid:\n        show: true\n        borderColor: rgba(255,255,255,0.2)\n      legend:\n        show: false\n    header:\n      show: true\n      show_states: true\n      colorize_states: true\n      standard_format: false\n    all_series_config:\n      stroke_width: 2\n    yaxis:\n    - min: 0\n      max: 100\n      decimals: 0\n      apex_config:\n        tickAmount: 4\n    series:\n    - entity: sensor.officepc_memoryusage\n      type: area\n      opacity: 0.3\n      name: Memory\n      color: skyblue\n      float_precision: 0\n      fill_raw: zero\n      group_by:\n        func: max\n      show:\n        legend_value: false\n    - entity: sensor.officepc_cpuload\n      type: area\n      opacity: 0.3\n      name: CPU\n      color: orange\n      float_precision: 0\n      fill_raw: zero\n      group_by:\n        func: max\n      show:\n        legend_value: false\n    card_mod:\n      style: \"ha-card {\\n  padding-top: 12px;\\n}\\n\"\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: POWER OUTLETS\n      alignment: center\n    - type: grid\n      cards:\n      - type: custom:mini-graph-card\n        name: Desk\n        entities:\n        - entity: sensor.office_desk_outlet_power\n          name: Power\n        icon: mdi:flash\n        font_size_header: 12\n        font_size: 75\n        line_width: 8\n        hours_to_show: 24\n      - type: custom:mini-graph-card\n        name: Modem\n        entities:\n        - entity: sensor.shellyplusplugs_b0b21c1991a8_switch_0_power\n          name: Power\n        icon: mdi:flash\n        font_size_header: 12\n        font_size: 75\n        line_width: 8\n        hours_to_show: 24\n      - type: custom:mini-graph-card\n        name: Rack\n        entities:\n        - entity: sensor.rack_power_plug_power\n          name: Power\n        icon: mdi:flash\n        font_size_header: 12\n        font_size: 75\n        line_width: 8\n        hours_to_show: 24\n- type: grid\n  cards:\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: PROXMOX VE\n      subtitle: ''\n      alignment: center\n    - type: custom:uptime-card\n      entity: binary_sensor.node_halo_status\n      icon: mdi:heart-pulse\n      title_template: UPTIME\n      hours_to_show: 168\n      alignment:\n        status: spaced\n        header: center\n        icon_first: false\n      alias:\n        ok: Running\n        ko: Unvailable\n        half: Unvailable\n      color:\n        ko: red\n        ok: lightgreen\n        half: red\n        icon: orange\n      bar:\n        spacing: 4\n        height: 20\n        round: 5\n    - square: false\n      type: grid\n      cards:\n      - type: custom:apexcharts-card\n        graph_span: 48h\n        show:\n          loading: false\n        header:\n          show: true\n          title: MEMORY\n          standard_format: false\n          show_states: true\n          colorize_states: true\n        color_list:\n        - green\n        - rgba(253,80,80,1)\n        - skyblue\n        all_series_config:\n          stroke_width: 2\n          opacity: 1\n        chart_type: donut\n        series:\n        - entity: sensor.node_halo_memory_free\n          name: Free MEM\n          unit: GB\n          show:\n            in_header: false\n        - entity: sensor.node_halo_memory_used\n          name: Used MEM\n          show:\n            in_header: false\n        - entity: sensor.node_halo_memory_total_2\n          name: Total\n          show:\n            in_chart: false\n        card_mod:\n          style: \"ha-card {\\n  padding-bottom: 20px;\\n}\\n\"\n      - type: custom:apexcharts-card\n        graph_span: 48h\n        show:\n          loading: false\n        header:\n          show: true\n          title: SSD10\n          standard_format: false\n          show_states: true\n          colorize_states: true\n        color_list:\n        - green\n        - rgba(253,80,80,1)\n        - skyblue\n        all_series_config:\n          stroke_width: 2\n          opacity: 1\n        chart_type: donut\n        series:\n        - entity: sensor.storage_ssd10_disk_free\n          name: Free\n          unit: GB\n          show:\n            in_header: false\n        - entity: sensor.storage_ssd10_disk_used\n          name: Used\n          show:\n            in_header: false\n        - entity: sensor.storage_ssd10_disk_total\n          name: Total\n          show:\n            in_chart: false\n        card_mod:\n          style: \"ha-card {\\n  padding-bottom: 20px;\\n}\\n\"\n      columns: 2\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: PROXMOX VE\n      alignment: center\n    - square: false\n      type: grid\n      cards:\n      - type: custom:mushroom-entity-card\n        entity: binary_sensor.qemu_vm_homeassistantos_150_status\n        layout: vertical\n        fill_container: true\n        name: HAOS\n      - type: custom:mini-graph-card\n        title: Home Assistant\n        font_size_header: 12\n        font_size: 70\n        decimals: 0\n        height: 200\n        entities:\n        - entity: sensor.qemu_vm_homeassistantos_150_cpu_used\n          name: CPU\n          color: orange\n          show_state: true\n        - entity: sensor.qemu_vm_homeassistantos_150_memory_used_percentage\n          name: MEM\n          color: lightgreen\n          show_state: true\n      - square: false\n        type: grid\n        cards:\n        - type: custom:mushroom-entity-card\n          entity: sensor.qemu_vm_homeassistantos_150_uptime\n          layout: horizontal\n          fill_container: true\n          name: Uptime\n        - type: custom:mushroom-entity-card\n          entity: binary_sensor.qemu_vm_homeassistantos_150_health\n          layout: horizontal\n          fill_container: true\n          name: Health\n        - type: custom:mushroom-entity-card\n          entity: sensor.qemu_vm_homeassistantos_150_node\n          layout: horizontal\n          fill_container: false\n          name: Node\n        columns: 1\n      columns: 3\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: SETTINGS\n    alignment: center\n    subtitle: OCCUPANCY SETTINGS\n  - type: custom:decluttering-card\n    template: area_occupancy_settings\n    variables:\n    - area: office\n    - area_name: Office\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: SCHEDULES\n      alignment: center\n    - type: markdown\n      content: These schedules work when they are set on and _Presence Automation\n        Mode_ is set to _Schedule Mode_\n  - type: custom:scheduler-card\n    include:\n    - input_select.office_automation_mode\n    - light.office_desk_wall_light\n    - light.office_lights\n    exclude: []\n    discover_existing: false\n    tags:\n    - living-room\n    time_step: 1\n    show_header_toggle: false\n    title: false\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: AUTOMATION MODE SCHEDULES\n    alignment: center\n  - type: markdown\n    content: Automation Mode Changes, based on time or sun.\n  - type: custom:scheduler-card\n    include:\n    - input_select.office_automation_mode\n    exclude: []\n    discover_existing: false\n    tags:\n    - office-mode-control\n    time_step: 1\n    show_header_toggle: false\n    title: false\n- type: grid\n  cards:\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: null\n      alignment: center\n      subtitle: Battery Levels\n    - type: custom:auto-entities\n      card:\n        type: entities\n      filter:\n        include:\n        - entity_id: sensor.office*battery*\n        exclude: []\n  - type: markdown\n    content: '**Automation Modes**\n\n\n      _Presence Control:_ Lights are automatically controlled by the occupancy state\n      of the room.\n\n\n      _Absence Detection:_ When room is no longer occupied, lights will be turned\n      off after a the absence delay time.\n\n\n      _Schedule Mode:_ Light schedules are working as set in the Scheduler. (schedule-mode\n      condition)'\n  - type: custom:scheduler-card\n    include:\n    - input_select.living_room_automation_mode\n    - light.floor_light\n    - light.living_room_ceiling_light\n    - light.living_room_lights\n    exclude: []\n    discover_existing: false\n    tags:\n    - living-room\n    time_step: 1\n    show_header_toggle: false\n    title: true\n- type: grid\n  cards: []\npath: office\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/sauna/","title":"Sauna","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/sauna/#sauna","title":"Sauna","text":"<p>Dashboard: Main Dashboard Path: <code>sauna</code></p> <p>Sauna status monitoring and basic lighting control.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/sauna/#summary","title":"Summary","text":"<p>This view monitors the Sauna environment. It displays real-time temperature and humidity trends from a Ruuvitag sensor. Users can control the sauna lights and monitor the door status, along with configuring occupancy-related automations.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/sauna/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:decluttering-card</code></li> <li><code>custom:mushroom-light-card</code></li> <li><code>custom:mushroom-title-card</code></li> <li><code>custom:streamline-card</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/sauna/#configuration","title":"Configuration","text":"<pre><code>theme: Backend-selected\ntitle: Sauna\ntype: sections\nsubview: true\nlayout:\n  max_cols: 5\nbadges: []\ncards: []\nsections:\n- type: grid\n  cards:\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: sauna\n      area_title: Sauna\n      temperature_sensor: sensor.airthings_wave_temperature\n      temp_sensor_entity: sensor.ruuvitag_8572_temperature\n      indicator_1_entity: binary_sensor.sauna_door_contact\n      indicator_1_icon: mdi:door\n      indicator_1_state: 'on'\n      indicator_1_active_color: '#FF4444'\n      indicator_1_animation_on: blink 1s ease infinite\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: LIGHTS\n    alignment: center\n  - type: custom:mushroom-light-card\n    entity: light.bathroom_wall_box_switch_left\n    name: Sauna\n    layout: vertical\n    grid_options:\n      columns: full\n      rows: 2\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: ENVIRONMENT\n    alignment: center\n  - type: vertical-stack\n    cards:\n    - square: false\n      type: grid\n      cards:\n      - type: custom:decluttering-card\n        template: minigraph_temperature\n        variables:\n        - sensor: sensor.ruuvitag_8572_temperature\n      - type: custom:decluttering-card\n        template: minigraph_humidity\n        variables:\n        - sensor: sensor.ruuvitag_8572_humidity\n      columns: 2\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: SETTINGS\n    alignment: center\n    subtitle: Occupancy\n  - type: custom:decluttering-card\n    template: area_occupancy_settings\n    variables:\n    - area: sauna\n    - area_name: Sauna\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: SCHEDULES\n      alignment: center\n    - type: markdown\n      content: These schedules work when they are set on and _Presence Automation\n        Mode_ is set to _Schedule Mode_\nmax_columns: 4\npath: sauna\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/settings/","title":"Settings","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/settings/#settings","title":"Settings","text":"<p>Dashboard: Main Dashboard Path: <code>settings</code></p> <p>Global system settings for occupancy sensitivity, timeouts, and automation flags across all zones.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/settings/#summary","title":"Summary","text":"<p>This view serves as the global control panel for the home's automation logic. It provides a grid of identical configuration cards for every room (e.g., Kitchen, Hallway, Office) and specific sub-zones (e.g., Shower, Sofa). Each card, based on the <code>presence_settings</code> template, allows users to fine-tune occupancy timeouts, sensitivity thresholds, and enable/disable specific automation behaviors for that area.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/settings/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:decluttering-card</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/settings/#configuration","title":"Configuration","text":"<pre><code>title: Settings\npath: settings\ncards: []\ntype: sections\nsections:\n- type: grid\n  cards:\n  - type: custom:decluttering-card\n    template: presence_settings\n    variables:\n    - area: kitchen\n  - type: custom:decluttering-card\n    template: presence_settings\n    variables:\n    - area: hallway\n  - type: custom:decluttering-card\n    template: presence_settings\n    variables:\n    - area: stairs\n- type: grid\n  cards:\n  - type: custom:decluttering-card\n    template: presence_settings\n    variables:\n    - area: lobby\n  - type: custom:decluttering-card\n    template: presence_settings\n    variables:\n    - area: living_room\n  - type: custom:decluttering-card\n    template: presence_settings\n    variables:\n    - area: toilet\n- type: grid\n  cards:\n  - type: custom:decluttering-card\n    template: presence_settings\n    variables:\n    - area: bedroom\n  - type: custom:decluttering-card\n    template: presence_settings\n    variables:\n    - area: office\n  - type: custom:decluttering-card\n    template: presence_settings\n    variables:\n    - area: mud_room\n- type: grid\n  cards:\n  - type: custom:decluttering-card\n    template: presence_settings\n    variables:\n    - area: storage\n  - type: custom:decluttering-card\n    template: presence_settings\n    variables:\n    - area: bathroom\n  - type: custom:decluttering-card\n    template: presence_settings\n    variables:\n    - area: backyard\n- type: grid\n  cards:\n  - type: custom:decluttering-card\n    template: presence_settings\n    variables:\n    - area: front_door\n  - type: custom:decluttering-card\n    template: presence_settings\n    variables:\n    - area: Guest-2\n  - type: custom:decluttering-card\n    template: presence_settings\n    variables:\n    - area: Guest-3\n- type: grid\n  cards:\n  - type: custom:decluttering-card\n    template: presence_settings\n    variables:\n    - area: Daughter\n  - type: custom:decluttering-card\n    template: presence_settings\n    variables:\n    - area: sauna\n- type: grid\n  cards:\n  - type: custom:decluttering-card\n    template: place_presence_settings\n    variables:\n    - area: shower\n  - type: custom:decluttering-card\n    template: place_presence_settings\n    variables:\n    - area: bathroom_toilet\n  - type: custom:decluttering-card\n    template: place_presence_settings\n    variables:\n    - area: sofa\nmax_columns: 7\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/stairs/","title":"Stairs","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/stairs/#stairs","title":"Stairs","text":"<p>Dashboard: Main Dashboard Path: <code>stairs</code></p> <p>Staircase lighting controls including WLED effects.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/stairs/#summary","title":"Summary","text":"<p>This view manages the Stairs area. It features specific control for the WLED strip lighting on the stairs, allowing users to toggle power, adjust brightness, and select WLED presets/effects. Standard occupancy settings and scheduling options are also available.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/stairs/#related-packages","title":"Related Packages","text":"<p>This view contains entities managed by:</p> <ul> <li>Scenes</li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/stairs/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:decluttering-card</code></li> <li><code>custom:mushroom-light-card</code></li> <li><code>custom:mushroom-select-card</code></li> <li><code>custom:mushroom-title-card</code></li> <li><code>custom:scheduler-card</code></li> <li><code>custom:streamline-card</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/stairs/#configuration","title":"Configuration","text":"<pre><code>title: Stairs\npath: stairs\ntype: sections\nmax_columns: 5\nsubview: true\nsections:\n- type: grid\n  cards:\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: stairs\n      area_title: Stairs\n      temperature_sensor: sensor.airthings_wave_temperature\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: LIGHTS\n    alignment: center\n  - type: custom:mushroom-light-card\n    entity: light.stairs_wled\n    layout: vertical\n    icon: mdi:led-strip-variant\n    fill_container: true\n    show_brightness_control: true\n    show_color_control: false\n    use_light_color: true\n    grid_options:\n      columns: 6\n      rows: 3\n  - type: custom:mushroom-select-card\n    entity: select.stairs_wled_preset\n    name: Stairs Preset\n    fill_container: true\n    layout: vertical\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: SETTINGS\n    subtitle: OCCUPANCY SETTINGS\n    alignment: center\n  - type: custom:decluttering-card\n    template: area_occupancy_settings\n    variables:\n    - area: stairs\n    - area_name: Stairs\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: SCHEDULES\n      alignment: center\n    - type: markdown\n      content: These schedules work when they are set on and _Presence Automation\n        Mode_ is set to _Schedule Mode_\n  - type: custom:scheduler-card\n    include:\n    - input_select.stairs_automation_mode\n    - light.stairs_lights\n    - light.stairs_wled\n    exclude: []\n    discover_existing: false\n    tags:\n    - stairs\n    time_step: 1\n    show_header_toggle: false\n    title: false\ncards: []\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/storage/","title":"Storage","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/storage/#storage","title":"Storage","text":"<p>Dashboard: Main Dashboard Path: <code>storage</code></p> <p>Storage room surveillance and camera configuration.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/storage/#summary","title":"Summary","text":"<p>This dashboard focuses on the Storage room. It features a live feed and event clips from the storage camera via Frigate. The view provides extensive camera configuration options (Privacy mode, Infrared, Detection settings) and basic light control, alongside standard occupancy settings.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/storage/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:decluttering-card</code></li> <li><code>custom:frigate-card</code></li> <li><code>custom:mushroom-light-card</code></li> <li><code>custom:mushroom-title-card</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/storage/#configuration","title":"Configuration","text":"<pre><code>title: Storage\ntype: sections\nlayout:\n  max_cols: 5\nbadges: []\ncards: []\nsections:\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: STORAGE\n    alignment: center\n    title_tap_action:\n      action: navigate\n      navigation_path: /lovelace\n    subtitle: CONTROLS\n  - type: custom:frigate-card\n    cameras:\n    - camera_entity: camera.storage_cam_high\n    live:\n      preload: true\n    view:\n      default: live\n      timeout_seconds: 1200\n    menu:\n      style: outside\n      position: bottom\n      buttons:\n        frigate:\n          enabled: false\n        substreams:\n          enabled: false\n        cameras:\n          enabled: false\n        snapshots:\n          enabled: false\n        recordings:\n          enabled: false\n          priority: 10\n        clips:\n          priority: 10\n        timeline:\n          enabled: false\n        screenshot:\n          enabled: true\n      button_size: 48\n    performance: {}\n  - square: false\n    type: grid\n    cards:\n    - type: custom:mushroom-light-card\n      entity: light.storage_light\n      icon: ''\n      layout: vertical\n      name: Storage Light\n      tap_action:\n        action: toggle\n      hold_action:\n        action: more-info\n      double_tap_action:\n        action: none\n    columns: 1\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: EVENTS\n    alignment: center\n  - type: custom:frigate-card\n    cameras:\n    - camera_entity: camera.storage_frigate\n    live:\n      preload: true\n    view:\n      default: clips\n      timeout_seconds: 1200\n    menu:\n      style: outside\n      position: bottom\n      buttons:\n        frigate:\n          enabled: false\n        substreams:\n          enabled: false\n        cameras:\n          enabled: false\n        snapshots:\n          enabled: false\n        recordings:\n          enabled: false\n          priority: 10\n        clips:\n          priority: 10\n        timeline:\n          enabled: false\n        screenshot:\n          enabled: true\n      button_size: 48\n    performance: {}\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: CAMERA SETTINGS\n    alignment: center\n  - type: entities\n    entities:\n    - entity: binary_sensor.storage_cam_motion\n    - entity: select.storage_cam_infrared_mode\n    - entity: binary_sensor.storage_cam_is_dark\n    - entity: switch.storage_cam_privacy_mode\n    - entity: switch.storage_cam_detections_motion\n    - entity: number.storage_cam_microphone_level\n    - entity: select.storage_cam_hdr_mode\n    - entity: switch.storage_cam_hdr_mode\n    - entity: switch.storage_cam_overlay_show_date\n    - entity: switch.storage_cam_overlay_show_name\n    - entity: switch.storage_cam_overlay_show_nerd_mode\n  - type: custom:mushroom-title-card\n    title: ''\n    subtitle: FRIGATE SETTINGS\n    alignment: center\n  - type: entities\n    entities:\n    - entity: sensor.storage_frigate_all_count\n    - entity: switch.storage_frigate_detect\n    - entity: switch.storage_frigate_motion\n    - entity: binary_sensor.storage_frigate_motion\n    - entity: sensor.storage_frigate_person_count\n    - entity: binary_sensor.storage_frigate_person_occupancy\n    - entity: switch.storage_frigate_recordings\n    - entity: switch.storage_frigate_snapshots\n  visibility:\n  - condition: user\n    users:\n    - 5f4dd0e939344fd6b58ed4299cdafcd6\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: SETTINGS\n    alignment: center\n    subtitle: Occupancy\n  - type: custom:decluttering-card\n    template: area_occupancy_settings\n    variables:\n    - area: storage\n    - area_name: Storage\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: SCHEDULES\n      alignment: center\n    - type: markdown\n      content: These schedules work when they are set on and _Presence Automation\n        Mode_ is set to _Schedule Mode_\nmax_columns: 5\npath: storage\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/toilet/","title":"Toilet","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/toilet/#toilet","title":"Toilet","text":"<p>Dashboard: Main Dashboard Path: <code>toilet</code></p> <p>Toilet room controls and detailed motion sensor calibration.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/toilet/#summary","title":"Summary","text":"<p>This dashboard manages the Toilet room. It offers basic light control and occupancy settings. A key feature is the detailed sensor settings section, allowing fine-tuning of the mmWave and PIR motion sensors, including distance and latency adjustments to optimize presence detection.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/toilet/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:decluttering-card</code></li> <li><code>custom:mushroom-light-card</code></li> <li><code>custom:mushroom-title-card</code></li> <li><code>custom:streamline-card</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/main/toilet/#configuration","title":"Configuration","text":"<pre><code>theme: Backend-selected\ntitle: Toilet\npath: toilet\ntype: sections\nsubview: true\nbadges: []\ncards: []\nsections:\n- type: grid\n  cards:\n  - type: custom:streamline-card\n    template: area_card\n    variables:\n      area_name: toilet\n      area_title: Toilet\n      temperature_sensor: sensor.airthings_wave_temperature\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: LIGHTS\n      alignment: center\n    - type: custom:mushroom-light-card\n      entity: light.toilet_wall_box_switch\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: SETTINGS\n    alignment: center\n    subtitle: Occupancy\n  - type: custom:decluttering-card\n    template: area_occupancy_settings\n    variables:\n    - area: backyard\n    - area_name: Backyard\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: SCHEDULES\n      alignment: center\n    - type: markdown\n      content: These schedules work when they are set on and _Presence Automation\n        Mode_ is set to _Schedule Mode_\n- type: grid\n  cards:\n  - type: vertical-stack\n    cards:\n    - type: custom:mushroom-title-card\n      title: ''\n      subtitle: SENSOR SETTINGS\n      alignment: center\n  - type: entities\n    entities:\n    - entity: binary_sensor.toilet_mmwave\n    - entity: binary_sensor.toilet_pir\n    - entity: number.toilet_distance\n    - entity: number.toilet_latency\nmax_columns: 4\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/notification-center/notifications_management/","title":"Notifications Management","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/notification-center/notifications_management/#notifications-management","title":"Notifications Management","text":"<p>Dashboard: Notification Center Path: <code>notifications-management</code></p> <p>Centralized management for notification users, categories, and subscriptions.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/notification-center/notifications_management/#summary","title":"Summary","text":"<p>The Notification Center dashboard provides a comprehensive interface for managing the smart home's notification system. Administrators can add or remove users for mobile app notifications and define notification categories (e.g., 'Garage', 'Electricity'). The view allows for granular control over subscriptions, enabling individual users to opt-in or out of specific notification types, and includes tools to map and monitor notification-related automations.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/notification-center/notifications_management/#related-packages","title":"Related Packages","text":"<p>This view contains entities managed by:</p> <ul> <li>Room Manager</li> <li>Smart Notifications</li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/notification-center/notifications_management/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:auto-entities</code></li> <li><code>custom:card-mod</code></li> <li><code>custom:mushroom-title-card</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/notification-center/notifications_management/#configuration","title":"Configuration","text":"<pre><code>title: Notifications Management\nicon: mdi:bell-cog\ntype: sections\nmax_columns: 5\nsections:\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: User Management\n    alignment: center\n    title_tap_action:\n      action: none\n    subtitle_tap_action:\n      action: none\n  - type: heading\n    heading: Add / Update User\n    icon: mdi:account-plus\n    heading_style: title\n    card_mod:\n      style: \"ha-card {\\n  border: none;\\n  --primary-text-color: var(--green-color);\\n\\\n        \\  --secondary-text-color: var(--green-color);\\n  --card-mod-icon-color: var(--green-color);\\n\\\n        }\\n\"\n  - type: markdown\n    content: '**How to Add a User:**\n\n      1. Select a **Home Assistant Person**.\n\n      2. Select their **Mobile App Service**.\n\n      3. Click **Add User**.'\n  - type: entities\n    show_header_toggle: false\n    entities:\n    - entity: input_select.notify_mgmt_person_select\n      name: Select Person\n    - type: call-service\n      icon: mdi:refresh\n      name: Refresh Lists\n      action_name: REFRESH\n      service: automation.trigger\n      service_data:\n        entity_id: automation.system_populate_notify_services\n        skip_condition: true\n    - entity: input_select.notify_mgmt_service\n      name: Mobile App Service\n    - entity: input_select.notify_mgmt_platform\n      icon: mdi:cellphone-cog\n    card_mod:\n      style: \"ha-card {\\n  border: none;\\n  --card-mod-icon-color: var(--green-color);\\n\\\n        }\\n\"\n  - type: tile\n    entity: input_select.notify_mgmt_person_select\n    name: Add User\n    icon: mdi:account-plus\n    color: green\n    show_entity_picture: false\n    vertical: false\n    tap_action:\n      action: call-service\n      service: script.create_notify_user\n    features_position: bottom\n    card_mod:\n      style: \"ha-card {\\n  border: none;\\n  background: var(--green-color);\\n  --primary-text-color:\\\n        \\ white;\\n  --secondary-text-color: white;\\n  --card-mod-icon-color: black;\\n\\\n        }\\n\"\n    grid_options:\n      columns: 9\n      rows: 1\n  - type: heading\n    heading: Delete User\n    icon: mdi:account-remove\n    heading_style: title\n    card_mod:\n      style: \"ha-card {\\n  border: none;\\n  --primary-text-color: var(--red-color);\\n\\\n        \\  --card-mod-icon-color: var(--red-color);\\n}\\n\"\n  - type: markdown\n    content: '**User Cleanup:**\n\n\n      Select a user below and click Delete to remove their notification settings.\n\n      '\n  - type: entities\n    show_header_toggle: false\n    entities:\n    - entity: input_select.notify_mgmt_delete_user_select\n      name: Select User to Delete\n    - type: call-service\n      icon: mdi:refresh\n      name: Refresh User List\n      action_name: REFRESH\n      service: automation.trigger\n      service_data:\n        entity_id: automation.system_populate_notify_services\n        skip_condition: true\n    card_mod:\n      style: \"ha-card {\\n  border: none;\\n  --card-mod-icon-color: var(--red-color);\\n\\\n        }\\n\"\n  - type: tile\n    entity: input_select.notify_mgmt_delete_user_select\n    name: Delete User\n    icon: mdi:account-remove\n    color: red\n    show_entity_picture: false\n    vertical: false\n    tap_action:\n      action: call-service\n      service: script.delete_notify_user\n    features_position: bottom\n    card_mod:\n      style: \"ha-card {\\n  border: none;\\n  background: var(--red-color);\\n  --primary-text-color:\\\n        \\ white;\\n  --secondary-text-color: white;\\n  --card-mod-icon-color: black;\\n\\\n        }\\n\"\n    grid_options:\n      columns: 9\n      rows: 1\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: Category Management\n    alignment: center\n    title_tap_action:\n      action: none\n    subtitle_tap_action:\n      action: none\n  - type: heading\n    heading: Add Category\n    icon: mdi:playlist-plus\n    heading_style: title\n    card_mod:\n      style: \"ha-card {\\n  border: none;\\n  --primary-text-color: var(--green-color);\\n\\\n        \\  --secondary-text-color: var(--green-color);\\n  --card-mod-icon-color: var(--green-color);\\n\\\n        }\\n\"\n  - type: markdown\n    content: \"**Add Category:\\n\\n** Type a new category name below (e.g. 'Garage')\\\n      \\ and click Add. \\n\\n*This adds a switch to all users automatically.*\\n\"\n  - type: entities\n    show_header_toggle: false\n    entities:\n    - entity: input_text.notify_add_category\n      name: New Category Name\n      icon: mdi:playlist-plus\n    card_mod:\n      style: \"ha-card {\\n  border: none;\\n  --card-mod-icon-color: var(--green-color);\\n\\\n        }\\n\"\n    grid_options:\n      columns: 12\n  - type: tile\n    entity: input_text.notify_add_category\n    name: Add Category\n    icon: mdi:text-box-plus\n    color: green\n    show_entity_picture: false\n    vertical: false\n    tap_action:\n      action: call-service\n      service: script.add_notify_category_global\n    features_position: bottom\n    card_mod:\n      style: \"ha-card {\\n  border: none;\\n  background: var(--green-color);\\n  --primary-text-color:\\\n        \\ white;\\n  --secondary-text-color: white;\\n  --card-mod-icon-color: black;\\n\\\n        }\\n\"\n    grid_options:\n      columns: 9\n      rows: 1\n  - type: heading\n    heading: Delete Category\n    icon: mdi:playlist-remove\n    heading_style: title\n    card_mod:\n      style: \"ha-card {\\n  border: none;\\n  --primary-text-color: var(--red-color);\\n\\\n        \\  --secondary-text-color: var(--red-color);\\n  --card-mod-icon-color: var(--red-color);\\n\\\n        }\\n\"\n  - type: markdown\n    content: '**Category Cleanup:**\n\n\n      To delete a category, type the category name below and click the DELETE button.\n\n\n      *This deletes the category from the users and from the settings.*\n\n      '\n  - type: entities\n    show_header_toggle: false\n    entities:\n    - entity: input_select.notify_delete_category\n      name: Category to Delete\n      icon: mdi:playlist-remove\n    - type: call-service\n      icon: mdi:refresh\n      name: Refresh Category List\n      action_name: REFRESH\n      service: automation.trigger\n      service_data:\n        entity_id: automation.system_populate_notify_services\n        skip_condition: true\n    card_mod:\n      style: \"ha-card {\\n  border: none;\\n  --card-mod-icon-color: var(--red-color);\\n\\\n        }\\n\"\n    grid_options:\n      columns: 12\n  - type: tile\n    entity: input_select.notify_delete_category\n    name: Delete Category\n    icon: mdi:text-box-remove\n    color: red\n    show_entity_picture: false\n    vertical: false\n    tap_action:\n      action: call-service\n      service: script.delete_notify_category_global\n    features_position: bottom\n    card_mod:\n      style: \"ha-card {\\n  border: none;\\n  background: var(--red-color);\\n  --primary-text-color:\\\n        \\ white;\\n  --secondary-text-color: white;\\n  --card-mod-icon-color: black;\\n\\\n        }\\n\"\n    grid_options:\n      columns: 9\n      rows: 1\n  - type: entities\n    entities:\n    - entity: input_text.notify_mgmt_categories\n      name: Master List (ReadOnly)\n      icon: mdi:format-list-text\n      secondary_info: last-updated\n    card_mod:\n      style: \"ha-card {\\n  border: none;\\n  --card-mod-icon-color: var(--orange-color);\\n\\\n        }\\n\"\n    grid_options:\n      columns: 12\n      rows: auto\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    alignment: center\n    title_tap_action:\n      action: none\n    subtitle_tap_action:\n      action: none\n    title: Delivery Settings\n  - type: heading\n    heading: Category Settings\n    icon: mdi:playlist-check\n    heading_style: title\n    card_mod:\n      style: \"ha-card {\\n  border: none;\\n  --primary-text-color: var(--orange-color);\\n\\\n        \\  --secondary-text-color: var(--orange-color);\\n  --card-mod-icon-color:\\\n        \\ var(--orange-color);\\n}\\n\"\n  - type: markdown\n    content: '**Category Delivery Rules**\n\n\n      If the category toggle is on, notification is only sent to users who are currently\n      at home.\n\n\n      * **ON:** Send if person is at **Home**.\n\n      * **OFF:** Send always.\n\n      '\n  - type: custom:auto-entities\n    show_empty: true\n    card:\n      type: entities\n      title: Global Delivery Settings\n      show_header_toggle: false\n      card_mod:\n        style: \"/* hide the header row completely */\\n.card-header,\\n.card-header\\\n          \\ &gt; .name,\\n.card-header &gt; .menu,\\n.header {\\n  display: none !important;\\n\\\n          }\\n/* remove the extra top padding that can remain */\\nha-card &gt; :first-child\\\n          \\ {\\n  padding-top: 0 !important;\\n}\\n\"\n    filter:\n      template: \"{% set ns = namespace(rows=[]) %} {# Find switches matching the global\\\n        \\ category pattern #} {% set switches = states.switch \\n   | selectattr('entity_id',\\\n        \\ 'search', 'notify_category_.*_local') \\n   | sort(attribute='name') \\n \\\n        \\  | list %}\\n\\n{% if switches | length &gt; 0 %}\\n  {# Add a single label for\\\n        \\ all categories with Orange Style #}\\n  {% set ns.rows = ns.rows + [{\\n \\\n        \\     'type': 'section', \\n      'label': 'Categories',\\n      'card_mod':\\\n        \\ {\\n        'style': \\\".label { color: orange !important; }\\\"\\n      }\\n\\\n        \\  }] %}\\n\\n  {% for sw in switches %}\\n     {% set is_on = is_state(sw.entity_id,\\\n        \\ 'on') %}\\n     \\n     {# Define Icon and Color logic #}\\n     {% set icon\\\n        \\ = 'mdi:home-account' if is_on else 'mdi:earth' %}\\n     {% set color = 'lightgreen'\\\n        \\ if is_on else '#2196F3' %} {# Standard HA Blue #}\\n     \\n     {% set ns.rows\\\n        \\ = ns.rows + [{\\n       'entity': sw.entity_id,\\n       'secondary_info':\\\n        \\ 'If ON, requires presence',\\n       'icon': icon,\\n       'card_mod': {\\n\\\n        \\         'style': \\\":host { --card-mod-icon-color: \\\" ~ color ~ \\\"; }\\\"\\n\\\n        \\        }\\n      }] %}\\n  {% endfor %}\\n{% endif %}\\n{{ ns.rows | to_json\\\n        \\ }}\\n\"\n    sort:\n      method: none\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: Subsription Management\n    alignment: center\n    title_tap_action:\n      action: none\n    subtitle_tap_action:\n      action: none\n  - type: heading\n    heading: User Subscriptions\n    icon: mdi:comment-outline\n    heading_style: title\n    card_mod:\n      style: \"ha-card {\\n  border: none;\\n  --primary-text-color: var(--orange-color);\\n\\\n        \\  --secondary-text-color: var(--orange-color);\\n  --card-mod-icon-color:\\\n        \\ var(--orange-color);\\n}\\n\"\n  - type: markdown\n    content: '**User Preferences**\n\n\n      *Toggle a switch **OFF** to unsubscribe a specific user from notifications of\n      that category.*\n\n      '\n  - type: custom:auto-entities\n    show_empty: true\n    card:\n      type: entities\n      title: Notification Subscriptions\n      show_header_toggle: false\n      card_mod:\n        style: \"/* hide the header row completely */\\n.card-header,\\n.card-header\\\n          \\ &gt; .name,\\n.card-header &gt; .menu,\\n.header {\\n  display: none !important;\\n\\\n          }\\n/* remove the extra top padding that can remain */\\nha-card &gt; :first-child\\\n          \\ {\\n  padding-top: 0 !important;\\n}\\n\"\n    filter:\n      template: \"{% set ns = namespace(cards=[]) %} {# 1. Find all switches that belong\\\n        \\ to the notification system (have user_slug attribute) #} {% set switches\\\n        \\ = states.switch \\n   | selectattr('entity_id', 'search', '_notification_')\\\n        \\ \\n   | selectattr('attributes.user_slug', 'defined') \\n   | list %}\\n\\n\\\n        {# 2. Extract unique users to create groups #} {% set users = switches | map(attribute='attributes.user_slug')\\\n        \\ | unique | sort | list %}\\n{% for user in users %}\\n  {# Filter switches\\\n        \\ for this specific user #}\\n  {% set user_switches = switches | selectattr('attributes.user_slug',\\\n        \\ 'eq', user) | sort(attribute='name') | list %}\\n  \\n  {% if user_switches\\\n        \\ | length &gt; 0 %}\\n    {# 3. Add Section Header with Orange Style #}\\n   \\\n        \\ {% set ns.cards = ns.cards + [{\\n      'type': 'section', \\n      'label':\\\n        \\ user | capitalize ~ '\\\\'s Subscriptions',\\n      'card_mod': {\\n       \\\n        \\ 'style': \\\".label { color: orange !important; }\\\"\\n      }\\n    }] %}\\n\\\n        \\    \\n    {# 4. Add Switches #}\\n    {% for sw in user_switches %}\\n    \\\n        \\   {% set is_on = is_state(sw.entity_id, 'on') %}\\n       {% set icon_color\\\n        \\ = 'green' if is_on else 'red' %}\\n       {% set icon = 'mdi:email-check'\\\n        \\ if is_on else 'mdi:email-remove-outline' %}\\n       \\n       {# Clean up\\\n        \\ the name by removing ' Notification' for a cleaner list #}\\n       {% set\\\n        \\ clean_name = sw.name | replace(' Notification', '') %}\\n       \\n      \\\n        \\ {% set ns.cards = ns.cards + [{\\n         'entity': sw.entity_id,\\n    \\\n        \\     'name': clean_name,\\n         'secondary_info': 'last-changed',\\n  \\\n        \\       'icon': icon,\\n         'card_mod': {\\n           'style': \\\":host\\\n        \\ { --card-mod-icon-color: \\\" ~ icon_color ~ \\\"; }\\\"\\n          }\\n      \\\n        \\  }] %}\\n    {% endfor %}\\n  {% endif %}\\n{% endfor %}\\n{{ ns.cards | to_json\\\n        \\ }}\\n\"\n    sort:\n      method: none\n- type: grid\n  cards:\n  - type: custom:mushroom-title-card\n    title: Notifications List\n    alignment: center\n    title_tap_action:\n      action: none\n    subtitle_tap_action:\n      action: none\n  - type: heading\n    heading: Automation Map\n    icon: mdi:sitemap\n    heading_style: title\n    card_mod:\n      style: \"ha-card {\\n  border: none;\\n  --primary-text-color: var(--orange-color);\\n\\\n        \\  --secondary-text-color: var(--orange-color);\\n  --card-mod-icon-color:\\\n        \\ var(--orange-color);\\n}\\n\"\n  - type: markdown\n    content: '**Notifications Overview**\n\n\n      Lists all notifcation automations grouped by Category Labels. You can turn the\n      automations on or off.\n\n\n      *Tip: Add labels like ''Notify: Electricity'' to your automations to see them\n      here.*\n\n      '\n  - type: custom:auto-entities\n    show_empty: true\n    card:\n      type: entities\n      title: Labeled Automations\n      show_header_toggle: false\n      card_mod:\n        style: \"/* hide the header row completely */\\n.card-header,\\n.card-header\\\n          \\ &gt; .name,\\n.card-header &gt; .menu,\\n.header {\\n  display: none !important;\\n\\\n          }\\n/* remove the extra top padding that can remain */\\nha-card &gt; :first-child\\\n          \\ {\\n  padding-top: 0 !important;\\n}\\n\"\n    filter:\n      template: \"{% set ns = namespace(cards=[]) %} {% set all_labels = labels() %}\\\n        \\ {% set notify_labels = all_labels | select('search', '^notify_') | sort\\\n        \\ | list %}\\n{% for label_id in notify_labels %}\\n  {% set entities = label_entities(label_id)\\\n        \\ | select('search', '^automation\\\\.') | list %}\\n  \\n  {% if entities | length\\\n        \\ &gt; 0 %}\\n    {% set display_name = label_id.replace('notify_', '') | capitalize\\\n        \\ %}\\n    \\n    {# Add Section with Orange Label Style #}\\n    {% set ns.cards\\\n        \\ = ns.cards + [{\\n      'type': 'section', \\n      'label': display_name\\\n        \\ ~ ' Notifications',\\n      'card_mod': {\\n        'style': \\\".label { color:\\\n        \\ orange !important; }\\\"\\n      }\\n    }] %}\\n    \\n    {% for ent in entities\\\n        \\ %}\\n       {% set icon_color = 'lightgreen' if is_state(ent, 'on') else\\\n        \\ 'red' %}\\n       {% set ns.cards = ns.cards + [{\\n         'entity': ent,\\n\\\n        \\         'secondary_info': 'last-triggered',\\n         'icon': 'mdi:cellphone-message',\\n\\\n        \\         'card_mod': {\\n           'style': \\\":host { --card-mod-icon-color:\\\n        \\ \\\" ~ icon_color ~ \\\"; }\\\"\\n          }\\n        }] %}\\n    {% endfor %}\\n\\\n        \\  {% endif %}\\n{% endfor %}\\n{{ ns.cards | to_json }}\\n\"\n    sort:\n      method: none\ncards: []\nheader:\n  card:\n    type: markdown\n    text_only: true\n    content: '# Notification Center\n\n      Manage Home Assistant App Notifications'\npath: notifications-management\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/room-management/room_management/","title":"Room Management","text":"","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/room-management/room_management/#room-management","title":"Room Management","text":"<p>Dashboard: Room Management Path: <code>room-management</code></p> <p>Admin interface for creating, deleting, and managing room configurations and automation helpers.</p> <p></p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/room-management/room_management/#summary","title":"Summary","text":"<p>The Room Management dashboard serves as the administrative backend for the home's room logic. It allows users to initialize new rooms (creating necessary helper entities) or delete existing ones. It features a dynamic \"Configured Rooms\" section powered by <code>auto-entities</code>, which automatically lists all configured rooms and provides collapsible controls for their automation modes, occupancy sensors, and timeouts.</p>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/room-management/room_management/#related-packages","title":"Related Packages","text":"<p>This view contains entities managed by:</p> <ul> <li>Room Manager</li> <li>Smart Notifications</li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/room-management/room_management/#dependencies-custom-cards","title":"Dependencies (Custom Cards)","text":"<p>Required HACS frontend resources:</p> <ul> <li><code>custom:auto-entities</code></li> <li><code>custom:card-mod</code></li> </ul>","tags":["dashboard","view","automated"]},{"location":"smart-home/dashboards/room-management/room_management/#configuration","title":"Configuration","text":"<pre><code>title: Room Management\nicon: ''\ntype: sections\nmax_columns: 3\nsections:\n- type: grid\n  cards:\n  - type: heading\n    heading: Add / Update Room\n    icon: mdi:home-plus\n  - type: markdown\n    content: '**Instructions:**\n\n\n      1. Select a **Native Area** from the list.\n\n      2. Click **Initialize** to create helpers for it.\n\n\n      *Uses Home Assistant Areas as the source.*\n\n      '\n  - type: entities\n    show_header_toggle: false\n    entities:\n    - entity: input_select.room_mgmt_create_select\n      name: Select Area\n    - type: call-service\n      icon: mdi:refresh\n      name: Refresh Area List\n      action_name: REFRESH\n      service: automation.trigger\n      service_data:\n        entity_id: automation.system_populate_room_list\n        skip_condition: true\n  - type: tile\n    entity: input_select.room_mgmt_create_select\n    name: Initialize Area\n    icon: mdi:content-save\n    color: green\n    show_entity_picture: false\n    vertical: false\n    tap_action:\n      action: call-service\n      service: script.create_room_settings\n    card_mod:\n      style: \"ha-card {\\n  border: none;\\n  background: var(--green-color);\\n  --primary-text-color:\\\n        \\ white;\\n  --secondary-text-color: white;\\n  --card-mod-icon-color: black;\\n\\\n        }\\n\"\n  - type: heading\n    heading: Danger Zone\n    icon: mdi:alert-circle-outline\n  - type: entities\n    show_header_toggle: false\n    entities:\n    - entity: input_select.room_mgmt_delete_select\n      name: Select Room to Delete\n    - type: call-service\n      icon: mdi:refresh\n      name: Refresh Lists\n      action_name: REFRESH\n      service: automation.trigger\n      service_data:\n        entity_id: automation.system_populate_room_list\n        skip_condition: true\n  - type: tile\n    entity: input_select.room_mgmt_delete_select\n    name: Delete Room Config\n    icon: mdi:delete\n    color: red\n    show_entity_picture: false\n    vertical: false\n    tap_action:\n      action: call-service\n      service: script.delete_room_settings\n    card_mod:\n      style: \"ha-card {\\n  border: none;\\n  background: var(--red-color);\\n  --primary-text-color:\\\n        \\ white;\\n  --secondary-text-color: white;\\n  --card-mod-icon-color: black;\\\n        \\ /* Icon visibility fix */\\n}\\n\"\n- type: grid\n  cards:\n  - type: heading\n    heading: Configured Rooms\n    icon: mdi:view-dashboard-outline\n  - type: custom:auto-entities\n    show_empty: true\n    card:\n      type: entities\n      show_header_toggle: false\n    filter:\n      template: \"        {% set ns = namespace(rows=[]) %}\\n        {% set mode_selectors\\\n        \\ = states.select | selectattr('entity_id','search','automation_mode') | sort(attribute='entity_id')\\\n        \\ | list %}\\n\\n        {% for sel in mode_selectors %}\\n          {# Extract\\\n        \\ base id and normalize to room_key #}\\n          {% set raw_id = sel.entity_id.split('.')[1]\\\n        \\ %}\\n          {% set base = raw_id.replace('_automation_mode','') %}\\n \\\n        \\         {% if base.startswith('room_') %}\\n            {% set room_key =\\\n        \\ base[5:] %}\\n          {% else %}\\n            {% set room_key = base %}\\n\\\n        \\          {% endif %}\\n          {% set name = room_key.replace('_',' ')\\\n        \\ | title %}\\n\\n          {# Compose downstream entity ids with exactly one\\\n        \\ room_ prefix #}\\n          {% set state_select = 'select.room_' ~ room_key\\\n        \\ ~ '_state' %}\\n          {% set occ_sensor   = 'binary_sensor.room_' ~ room_key\\\n        \\ ~ '_occupancy' %}\\n          {% set idle_entity  = 'number.room_' ~ room_key\\\n        \\ ~ '_presence_idle_time' %}\\n          {% set delay_entity = 'number.room_'\\\n        \\ ~ room_key ~ '_lights_presence_delay' %}\\n          {% set bed_s       \\\n        \\ = 'text.room_' ~ room_key ~ '_bed_sensor' %}\\n          {% set sleep_entry\\\n        \\  = 'number.room_' ~ room_key ~ '_sleep_entry_delay' %}\\n          {% set\\\n        \\ sleep_exit   = 'number.room_' ~ room_key ~ '_sleep_exit_delay' %}\\n    \\\n        \\      {% set occ_source   = 'select.room_' ~ room_key ~ '_occupancy_source'\\\n        \\ %}\\n\\n          {# Build the collapsible group's entity list, conditionally\\\n        \\ #}\\n          {% set entities = [] %}\\n          {% set entities = entities\\\n        \\ + [{'entity': sel.entity_id, 'name': 'Mode'}] %}\\n\\n          {% if states[state_select]\\\n        \\ is defined %}\\n            {% set entities = entities + [{'entity': state_select,\\\n        \\ 'name': 'Current State'}] %}\\n          {% endif %}\\n          {% if states[occ_sensor]\\\n        \\ is defined %}\\n            {% set entities = entities + [{'entity': occ_sensor,\\\n        \\ 'name': 'Occupancy'}] %}\\n          {% endif %}\\n          {% if states[occ_source]\\\n        \\ is defined %}\\n            {% set entities = entities + [{'entity': occ_source,\\\n        \\ 'name': 'Occupancy Sensor'}] %}\\n          {% endif %}\\n\\n          {% if\\\n        \\ states[idle_entity] is defined %}\\n            {% set entities = entities\\\n        \\ + [{'entity': idle_entity, 'name': 'Idle Time (sec)'}] %}\\n          {%\\\n        \\ endif %}\\n          {% if states[delay_entity] is defined %}\\n         \\\n        \\   {% set entities = entities + [{'entity': delay_entity, 'name': 'Off Delay\\\n        \\ (sec)'}] %}\\n          {% endif %}\\n\\n          {# Bed sensor and sleep\\\n        \\ timers only if bed sensor has a usable value #}\\n          {% if states[bed_s]\\\n        \\ is defined %}\\n            {% set entities = entities + [{'entity': bed_s,\\\n        \\ 'name': 'Bed Sensor ID'}] %}\\n            {% set bed_val = states(bed_s)\\\n        \\ | lower %}\\n            {% if bed_val not in ['unknown','unavailable','','none']\\\n        \\ %}\\n              {% if states[sleep_entry] is defined %}\\n            \\\n        \\    {% set entities = entities + [{'entity': sleep_entry, 'name': 'Sleep\\\n        \\ Entry Delay (sec)'}] %}\\n              {% endif %}\\n              {% if\\\n        \\ states[sleep_exit] is defined %}\\n                {% set entities = entities\\\n        \\ + [{'entity': sleep_exit, 'name': 'Sleep Exit Delay (sec)'}] %}\\n      \\\n        \\        {% endif %}\\n            {% endif %}\\n          {% endif %}\\n\\n \\\n        \\         {# Only add the group if it has rows (it always has at least Mode)\\\n        \\ #}\\n          {% set group = {\\n            'type': 'custom:fold-entity-row',\\n\\\n        \\            'head': {'type':'section','label': name},\\n            'entities':\\\n        \\ entities\\n          } %}\\n          {% set ns.rows = ns.rows + [group] %}\\n\\\n        \\        {% endfor %}\\n\\n        {{ ns.rows | to_json }}\"\n    sort:\n      method: none\n- type: grid\n  cards:\n  - type: heading\n    heading: New section\npath: room-management\ncards: []\nheader:\n  card:\n    type: markdown\n    text_only: true\n    content: '# Room Management Center\n\n      '\n</code></pre>","tags":["dashboard","view","automated"]},{"location":"smart-home/integrations/","title":"External Integrations","text":"","tags":["index","integrations"]},{"location":"smart-home/integrations/#external-integrations","title":"External Integrations","text":"<p>This section documents external systems and custom integrations that run outside of Home Assistant but are critical to the smart home ecosystem.</p>","tags":["index","integrations"]},{"location":"smart-home/integrations/#integrations-catalog","title":"\ud83d\udd17 Integrations Catalog","text":"<ul> <li>AI Log Reporter Remote Python system running on Docker to analyze logs and report back to Home Assistant.</li> </ul>","tags":["index","integrations"]},{"location":"smart-home/integrations/ai_reporter/","title":"Integration: AI Log Reporter","text":"","tags":["integration","manual","ai","docker","monitoring"]},{"location":"smart-home/integrations/ai_reporter/#integration-ai-log-reporter","title":"Integration: AI Log Reporter","text":"<p>Type: Remote Monitoring Stack Host: Docker Capable Server (e.g., Unraid) Language: Python 3.11  </p>","tags":["integration","manual","ai","docker","monitoring"]},{"location":"smart-home/integrations/ai_reporter/#overview","title":"Overview","text":"<p>The AI Log Reporter is part of a larger Monitoring Stack that aggregates logs from various services (proxmox, unifi, promtail, docker, etc.) into Loki. A custom Python container then queries Loki for errors, uses Google Gemini 2.0 Flash to summarize them, and reports the health status back to Home Assistant.</p>","tags":["integration","manual","ai","docker","monitoring"]},{"location":"smart-home/integrations/ai_reporter/#process-description-non-technical","title":"Process Description (Non-Technical)","text":"<p>Think of this system as a Digital Security Guard that patrols your server logs every morning.</p> <ol> <li>Collection: All your servers (Unraid, Home Assistant, Routers) constantly write their specific \"diaries\" (logs) into a central safe, which we call Loki.</li> <li>The Patrol: Every morning, the Guard (our Python Script) wakes up and reads through the last 24 hours of diaries.</li> <li>Filtering: It ignores distinct \"normal\" events (like a door opening) and specifically hunts for \"red ink\" \u2014 words like Error, Failure, Warning, or Unauthorized.</li> <li>Analysis: It takes these scary-looking error messages and hands them to a Forensic Expert (Google Gemini AI). The Expert translates the technical gibberish into a simple English report, explaining what broke and why.</li> <li>Reporting: Finally, the Guard sends this simplified report directly to your phone (via Home Assistant), so you know if your system is healthy without ever looking at a line of code.</li> </ol>","tags":["integration","manual","ai","docker","monitoring"]},{"location":"smart-home/integrations/ai_reporter/#architecture","title":"Architecture","text":"<pre><code>sequenceDiagram\n    participant HA as \ud83c\udfe0 Home Assistant\n    participant Docker as \ud83d\udc33 Log Reporter\n    participant Loki as \ud83e\udd81 Loki\n    participant Gemini as \u2728 Gemini AI\n    participant API as \ud83d\udce1 HA API\n\n    HA-&gt;&gt;Docker: Trigger Script (SSH)\n    activate Docker\n    Docker-&gt;&gt;Loki: Query Logs (Last 24h)\n    Loki--&gt;&gt;Docker: JSON Logs\n    Docker-&gt;&gt;Docker: Filter Errors (Regex)\n    Docker-&gt;&gt;Gemini: Analyze Context (AI)\n    Gemini--&gt;&gt;Docker: \"System Logic Failure in Disk 2\"\n    Docker-&gt;&gt;API: POST /api/events/update_ai_summary\n    deactivate Docker</code></pre>","tags":["integration","manual","ai","docker","monitoring"]},{"location":"smart-home/integrations/ai_reporter/#deployment-setup","title":"Deployment Setup","text":"<p>The monitoring stack is composed of multiple service layers. Follow the guide below to set up the file structure and containers.</p>","tags":["integration","manual","ai","docker","monitoring"]},{"location":"smart-home/integrations/ai_reporter/#1-directory-structure","title":"1. Directory Structure","text":"<p>Create the following folder structure on your Host machine (e.g., <code>/mnt/docker/appdata/</code>). This ensures each service has a place to store its configuration.</p> <pre><code>/mnt/docker/appdata/\n\u251c\u2500\u2500 loki/\n\u2502   \u2514\u2500\u2500 local-config.yaml   # Configuration for the Log Database\n\u251c\u2500\u2500 otel-collector/\n\u2502   \u2514\u2500\u2500 config.yaml         # Configuration for the Log Collector\n\u251c\u2500\u2500 grafana/                # Storage for Dashboards (Auto-created)\n\u2514\u2500\u2500 ai-reporter/\n    \u2514\u2500\u2500 reporter.py         # The Python Brain of the operation\n</code></pre>","tags":["integration","manual","ai","docker","monitoring"]},{"location":"smart-home/integrations/ai_reporter/#2-the-log-database-loki","title":"2. The Log Database (Loki)","text":"<p>File Path: <code>/mnt/docker/appdata/loki/local-config.yaml</code> Purpose: Configures Loki to listen for logs and store them efficiently in the filesystem.</p> <pre><code>auth_enabled: false  # Disable authentication for local network simplicity\n\nserver:\n  http_listen_port: 3100  # Default port for Loki API\n\ncommon:\n  instance_addr: 0.0.0.0\n  path_prefix: /loki\n  storage:\n    filesystem:\n      chunks_directory: /loki/chunks  # Store log chunks on disk\n      rules_directory: /loki/rules\n  replication_factor: 1  # Single node setup (no clustering)\n  ring:\n    kvstore:\n      store: inmemory\n\nschema_config:\n  configs:\n    - from: 2024-04-01\n      store: tsdb  # Time Series Database format\n      object_store: filesystem\n      schema: v13\n      index:\n        prefix: index_\n        period: 24h  # Create a new index file every day\n\nlimits_config:\n  allow_structured_metadata: true  # Allow extra labels in logs\n</code></pre>","tags":["integration","manual","ai","docker","monitoring"]},{"location":"smart-home/integrations/ai_reporter/#3-the-log-collector-otel","title":"3. The Log Collector (OTel)","text":"<p>File Path: <code>/mnt/docker/appdata/otel-collector/config.yaml</code> Purpose: Receives logs from various sources (standardizing them via OpenTelemetry) and pushes them to Loki.</p> <pre><code>receivers:\n  otlp:\n    protocols:\n      grpc:\n      http:\n\nprocessors:\n  batch:  # Batches logs to reduce network calls\n\nexporters:\n  otlphttp:\n    endpoint: \"http://localhost:3100/otlp\" # Sends to Loki\n    tls:\n      insecure: true\n\nservice:\n  pipelines:\n    logs:\n      receivers: [otlp]\n      processors: [batch]\n      exporters: [otlphttp]\n</code></pre>","tags":["integration","manual","ai","docker","monitoring"]},{"location":"smart-home/integrations/ai_reporter/#4-the-intelligence-reporter-script","title":"4. The Intelligence (Reporter Script)","text":"<p>File Path: <code>/mnt/docker/appdata/ai-reporter/reporter.py</code> Purpose: This script connects the pieces. It fetches raw data from Loki, sends it to Gemini for reasoning, and notifies Home Assistant.</p> <pre><code>import os\nimport requests\nimport datetime\nimport time\nfrom google import genai\n\n# --- CONFIGURATION ---\n# Load secrets from Environment Variables (set in docker-compose)\nLOKI_URL = os.getenv(\"LOKI_URL\", \"http://localhost:3100\")\nGEMINI_API_KEY = os.getenv(\"GEMINI_API_KEY\")\nHA_URL = os.getenv(\"HA_URL\")\nHA_TOKEN = os.getenv(\"HA_TOKEN\")\n\n# --- 1. FETCH LOGS (FULL CAPACITY) ---\ndef get_loki_logs():\n    \"\"\"Fetches logs from the last 24h, filtering for errors AND security events.\"\"\"\n\n    # Calculate nanosecond timestamps for Loki API\n    end_time_ns = int(time.time() * 1e9)\n    start_time_ns = end_time_ns - (24 * 60 * 60 * 1000000000) # 24 Hours ago\n\n    # SMART QUERY:\n    # 1. {job=~\".+\"} matches ALL jobs/containers\n    # 2. |~ \"(?i)...\" is a Case-Insensitive Regex filter\n    # 3. We catch: error, warn, fail, exception, timeout, blocked (firewall), \n    #    detected (security), smartd (disk health), accessed (auth)\n    query = '{job=~\".+\"} |~ \"(?i)error|warn|fail|exception|timeout|blocked|detected|smartd|accessed\"'\n\n    params = {\n        'query': query,\n        'limit': 5000,  # Grab up to 5000 lines (we will crop later if needed)\n        'start': start_time_ns,\n        'end': end_time_ns,\n        'direction': 'backward' # Newest first\n    }\n\n    print(f\"Querying Loki at {LOKI_URL}...\")\n    try:\n        response = requests.get(f\"{LOKI_URL}/loki/api/v1/query_range\", params=params)\n        response.raise_for_status()\n        data = response.json()\n\n        logs = []\n        if 'data' in data and 'result' in data['data']:\n            for stream in data['data']['result']:\n                labels = stream.get('metric', {})\n                # Extract the source name: clean up identifying labels\n                source = labels.get('container_name') or labels.get('service_name') or 'unknown'\n\n                for entry in stream['values']:\n                    # Format: [ContainerName] Log Message\n                    logs.append(f\"[{source}] {entry[1]}\")\n\n        if not logs:\n            return \"No critical errors or security events found in the last 24 hours.\"\n\n        print(f\"Found {len(logs)} relevant log lines.\")\n        return \"\\n\".join(logs)\n\n    except Exception as e:\n        return f\"Error fetching logs: {str(e)}\"\n\n# --- 2. SUMMARIZE WITH GEMINI (PAID TIER) ---\ndef summarize_with_gemini(logs):\n    \"\"\"Sends logs to Gemini (Using Gemini 2.0 Flash for speed/cost balance).\"\"\"\n\n    # Fail-fast if no logs\n    if not logs or \"Error fetching logs\" in logs or \"No critical errors\" in logs:\n        return logs\n\n    client = genai.Client(api_key=GEMINI_API_KEY)\n\n    # --- TOKEN LIMIT PROTECTION ---\n    # Gemini 2.0 Flash has a huge context window, but we still cap it to be safe.\n    # 75,000 chars is roughly 18k tokens.\n    max_chars = 75000\n    if len(logs) &gt; max_chars:\n        logs = logs[:max_chars] + \"\\n...[TRUNCATED TO 75k CHARS]...\"\n\n    prompt = (\n        \"You are a Senior Site Reliability Engineer (SRE) AI. Analyze these Home Lab logs (Docker, Proxmox, Unifi).\\n\"\n        \"Your goal is to provide a clean, actionable daily report.\\n\\n\"\n        \"**ANALYSIS RULES:**\\n\"\n        \"1. **Group &amp; Deduplicate:** If an error repeats, Do NOT list same error 50 times. Say 'Traefik Error on [ubuntu-vm] (x50)'. ALWAYS mention the source machine name.\\n\"\n        \"2. **Identify Root Causes:** If you see 'Connection Refused', identify *which* service is down.\\n\"\n        \"3. **Categorize with Emojis:**\\n\"\n        \"   - \ud83d\udd34 **CRITICAL:** Data loss risk, disk failure (smartd), boot crashes, service death.\\n\"\n        \"   - \ud83d\udee1\ufe0f  **SECURITY:** Firewall blocks, failed login attempts (brute force).\\n\"\n        \"   - \ud83d\udfe1 **WARNING:** Timeouts, high latency, non-critical config errors.\\n\"\n        \"4. **Format:** Use a clean Markdown bullet list. Be concise.\\n\\n\"\n        f\"LOGS TO ANALYZE:\\n{logs}\"\n    )\n\n    try:\n        response = client.models.generate_content(\n            model=\"gemini-2.0-flash\",\n            contents=prompt\n        )\n        return response.text\n    except Exception as e:\n        return f\"Gemini API Error: {str(e)}\"\n\n# --- 3. POST TO HOME ASSISTANT ---\ndef post_to_home_assistant(summary):\n    \"\"\"Sends the summary back to Home Assistant.\"\"\"\n    headers = {\n        \"Authorization\": f\"Bearer {HA_TOKEN}\",\n        \"Content-Type\": \"application/json\",\n    }\n\n    # Endpoint 1: Persistent Notification (Popup in HA)\n    url_notify = f\"{HA_URL}/api/services/persistent_notification/create\"\n    payload_notify = {\n        \"message\": summary,\n        \"title\": f\"\ud83e\udd16 Daily Lab Report ({datetime.datetime.now().strftime('%H:%M')})\",\n        \"notification_id\": \"daily_ai_summary\"\n    }\n\n    # Endpoint 2: Update Sensor State (For Dashboards)\n    url_sensor = f\"{HA_URL}/api/states/sensor.daily_system_summary\"\n    payload_sensor = {\n        # The main state is just the timestamp\n        \"state\": datetime.datetime.now().strftime('%Y-%m-%d %H:%M'),\n        # The actual AI report lives in the attributes\n        \"attributes\": {\n            \"summary\": summary, \n            \"friendly_name\": \"Daily System Summary\",\n            \"icon\": \"mdi:robot\"\n        }\n    }\n\n    try:\n        # Send Notification\n        res1 = requests.post(url_notify, headers=headers, json=payload_notify)\n        res1.raise_for_status()\n\n        # Update Sensor\n        res2 = requests.post(url_sensor, headers=headers, json=payload_sensor)\n        res2.raise_for_status()\n\n        print(\"Success: Notification sent and Dashboard sensor updated.\")\n    except Exception as e:\n        print(f\"HA Post Error: {str(e)}\")\n\n# --- MAIN EXECUTION ---\nif __name__ == \"__main__\":\n    print(\"Fetching logs...\")\n    logs = get_loki_logs()\n\n    print(f\"Summarizing {len(logs)} characters of data...\")\n    summary = summarize_with_gemini(logs)\n\n    print(\"Posting to HA...\")\n    post_to_home_assistant(summary)\n    print(\"Done.\")\n</code></pre>","tags":["integration","manual","ai","docker","monitoring"]},{"location":"smart-home/integrations/ai_reporter/#5-orchestration-docker-compose","title":"5. Orchestration (Docker Compose)","text":"<p>File Path: <code>/mnt/docker/appdata/docker-compose.yaml</code> (or run via Portainer stack) Purpose: Defines and runs all the containers together.</p> <pre><code>services:\n  # --- LOG DATABASE ---\n  loki:\n    image: grafana/loki:3.1.0\n    container_name: loki\n    user: \"0:0\"  # CRITICAL: Runs as root to bypass Unraid/Linux permission issues with bind mounts\n    volumes:\n      - /mnt/docker/appdata/loki:/loki\n      - /etc/localtime:/etc/localtime:ro\n      - /etc/timezone:/etc/timezone:ro\n    command: -config.file=/loki/local-config.yaml\n    environment:\n      - TZ=Europe/Helsinki\n    network_mode: host # Uses host networking for max performance and easy discovery\n    restart: unless-stopped\n\n  # --- LOG INGESTION ---\n  otel-collector:\n    image: otel/opentelemetry-collector-contrib:0.98.0\n    container_name: otel-collector\n    user: \"0:0\"\n    volumes:\n      - /mnt/docker/appdata/otel-collector/config.yaml:/etc/otelcol-contrib/config.yaml:ro\n      # Grants access to Docker logs on the host\n      - /var/lib/docker/containers:/var/lib/docker/containers:ro \n      - /etc/localtime:/etc/localtime:ro\n      - /etc/timezone:/etc/timezone:ro\n    environment:\n      - TZ=Europe/Helsinki\n    restart: unless-stopped\n    network_mode: host\n    depends_on:\n      - loki # Wait for database to start\n\n  # --- VISUALIZATION (Optional) ---\n  grafana:\n    image: grafana/grafana:latest\n    container_name: grafana\n    restart: unless-stopped\n    environment:\n      - TZ=Europe/Helsinki\n    ports:\n      - \"3000:3000\" # Web UI Port\n    volumes:\n      - /mnt/docker/appdata/grafana:/var/lib/grafana\n      - /etc/localtime:/etc/localtime:ro\n      - /etc/timezone:/etc/timezone:ro\n\n  # --- AI ANALYSIS ---\n  ai-log-reporter:\n    image: python:3.11-slim\n    container_name: ai-log-reporter\n    volumes:\n      - /mnt/docker/appdata/ai-reporter:/app\n      - /etc/localtime:/etc/localtime:ro\n      - /etc/timezone:/etc/timezone:ro\n    environment:\n      - TZ=Europe/Helsinki\n      - LOKI_URL=http://localhost:3100\n      # REPLACE THESE WITH YOUR KEYS\n      - GEMINI_API_KEY=YOUR_GEMINI_API_KEY_HERE\n      - HA_URL=http://YOUR_HA_IP:8123\n      - HA_TOKEN=YOUR_LONG_LIVED_ACCESS_TOKEN_HERE\n    # This command installs dependencies, runs the script ONCE, and then sleeps forever.\n    # This allows us to use 'docker exec' later to trigger runs on demand without restarting.\n    command: &gt;\n      sh -c \"pip install requests google-genai &amp;&amp; \n      python /app/reporter.py &amp;&amp; \n      tail -f /dev/null\"\n    restart: unless-stopped\n    network_mode: host\n</code></pre>","tags":["integration","manual","ai","docker","monitoring"]},{"location":"smart-home/integrations/ai_reporter/#consumers","title":"\ud83e\udde9 Consumers","text":"<p>The following Home Assistant packages rely on this integration:</p> Package Description AI Summary Controls the scheduling (7:00 AM) of this reporter and exposes the results as a Sensor.","tags":["integration","manual","ai","docker","monitoring"]},{"location":"smart-home/packages/","title":"Package Catalog","text":"","tags":["package","index","automated"]},{"location":"smart-home/packages/#package-catalog","title":"Package Catalog","text":"<p>Use this catalog to browse all installed configuration packages. Each package is a self-contained unit of functionality.</p> <p>Auto-Generated</p> <p>This catalog is automatically maintained by the Documentation Agent.</p> Package Description Integrations Dashboards Ai Summary Frontend controller for the remote AI Log Reporter integration. AI Log Reporter System Airthings Normalizes Airthings Wave sensors (Temp, Humidity, CO2) - Living Room Aqara W500 Manages temperature settings and schedules for the Bathroom Floor Heat (Aqara W500 Climate). Includes logic for high electricity price reduction and shower occupancy boost. - BathroomElectricityElectricity DevHome Area Manager Dynamic creation of AREA settings via MQTT (Replaces Room Manager) - Living RoomNotifications ManagementRoom Management Car Unified logic for Mercedes GLC. Normalizes sensors (Windows/Doors), wrapper switches, and Status Notifications. Mercedes Me 2020 (mbapi2020), script.notify_smart_master CARHome Debug Script No description provided. - - Dishwasher Logic, sensors, flags, and automations for the LG Dishwasher. Handles normalization of LG ThinQ data, maintenance reminders, and leak detection. - HomeKitchen Dna Tv Hub Template switch for DNA TV Hub remote control - - Garmin Placeholder for Garmin integration - - Home Time Modes Parametric Time-of-Day Logic - System Nordpool Prices Nordpool energy price calculations and logic - BathroomElectricityElectricity DevHome Office Pc Office PC control (Audio, Displays, Power) - Office Philips Air Purifier Normalizes Philips Air Purifier attributes (PM2.5, Filters) - - Room Manager Dynamic creation of room settings via MQTT - Room ManagementSettings (System) Scenes Definitions for various lighting scenes (Daylight, Night, Movie, etc.) - BedroomHallwayKitchenLiving RoomOfficeStairs Shelly 3Em Power aggregation for Shelly 3EM (Total Power, Energy) - - Smart Notifications Helpers and logic for the dynamic notification router - SystemLiving RoomNotifications ManagementRoom Management Smart Speakers Configuration and helpers for managing Smart Speakers in Notification Center - Notifications Management Tailscale Monitoring No description provided. - - Unifi Access Unified management for G4 Doorbell Pro Fingerprint &amp; NFC. - Home Access CenterFront DoorHomeMud Room Washing Machine Logic for Washing Machine state tracking, run time calculation, and notifications. - SystemHome","tags":["package","index","automated"]},{"location":"smart-home/packages/ai_summary/","title":"Package: Ai Summary","text":"","tags":["package","automated"]},{"location":"smart-home/packages/ai_summary/#package-ai-summary","title":"Package: Ai Summary","text":"<p>Version: 1.0.0 Description: Frontend controller for the remote AI Log Reporter integration.</p> <p></p>","tags":["package","automated"]},{"location":"smart-home/packages/ai_summary/#executive-summary","title":"Executive Summary","text":"<p>The AI Summary package serves as the Home Assistant-side controller for the AI Log Reporter Integration. It manages the scheduling, triggering, and data ingestion of daily system reports generated by a remote AI agent. This package ensures that the heavy lifting of log analysis is offloaded to a dedicated Docker container while keeping the results fully integrated into the Home Assistant dashboard via native sensors and notifications.</p>","tags":["package","automated"]},{"location":"smart-home/packages/ai_summary/#process-description-non-technical","title":"Process Description (Non-Technical)","text":"<p>This system runs automatically every morning at 7:00 AM. 1.  Trigger: The system wakes up and sends a \"Start\" command to a remote server. 2.  Analysis: The remote server (running a specialized AI Reporter) reads the logs from the past 24 hours. It looks for errors, warnings, and unusual patterns. 3.  Reporting: Once finished, the remote server sends a summary back to Home Assistant. 4.  Notification: You receive a notification on your phone (and a persistent message in the dashboard) summarizing the health of your smart home.</p>","tags":["package","automated"]},{"location":"smart-home/packages/ai_summary/#integration-dependencies","title":"Integration Dependencies","text":"<ul> <li>AI Log Reporter: Required for log analysis and report generation.<ul> <li>Type: Remote Docker Container</li> <li>Role: Backend Logic</li> </ul> </li> </ul>","tags":["package","automated"]},{"location":"smart-home/packages/ai_summary/#dashboard-connections","title":"Dashboard Connections","text":"<p>This package powers the following dashboard views:</p> <ul> <li>System: This view provides deep insights into the Proxmox 'Halo' virtualization node. It features real-time resource monitoring (CPU, RAM) using <code>mini-graph-card</code>, and critical power controls (Reboot, Shutdown) protected by confirmation dialogs. It also offers bulk management for guest VMs/containers and tracks system update status, ensuring the infrastructure host is healthy and up-to-date. (Uses 2 entities)</li> </ul>","tags":["package","automated"]},{"location":"smart-home/packages/ai_summary/#architecture-diagram","title":"Architecture Diagram","text":"<p>The sequence diagram below details the interaction between the local Home Assistant instance and the remote AI Log Reporter. The process is initiated by a time-based trigger (7:00 AM) or a manual script invocation. Home Assistant opens a secure SSH tunnel to the remote host (<code>&lt;REMOTE_HOST_IP&gt;</code>) and executes a Docker command (<code>docker exec</code>). The <code>ai-log-reporter</code> container processes the logs and, upon completion, fires an asynchronous event (<code>update_ai_summary</code>) back to the Home Assistant API. This event payload is captured by a Template Trigger, which updates the permanent <code>sensor.daily_system_summary</code>.</p> <pre><code>sequenceDiagram\n    participant Sched as \u23f0 Schedule\n    participant Script as \ud83d\udcdc Script: run_ai_summary_now\n    participant SSH as \ud83d\udd10 SSH Tunnel\n    participant Remote as \ud83d\udce6 Docker: ai-log-reporter\n    participant API as \ud83d\udce1 HA API\n    participant Sensor as \ud83e\udde0 Sensor: daily_system_summary\n\n    Sched-&gt;&gt;Script: Trigger 7:00 AM\n    Script-&gt;&gt;SSH: ssh root@&lt;REMOTE_HOST_IP&gt; (Exec Reporter)\n    activate SSH\n    SSH-&gt;&gt;Remote: docker exec python /app/reporter.py\n    activate Remote\n    Note right of Remote: Analyze Logs...\n    Remote-&gt;&gt;API: POST /api/events/update_ai_summary\n    API-&gt;&gt;Sensor: Event: update_ai_summary\n    deactivate Remote\n    SSH--&gt;&gt;Script: Exit Code 0\n    deactivate SSH</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/ai_summary/#configuration-source-code","title":"Configuration (Source Code)","text":"<pre><code># Package: AI Summary\n# Version: 1.0.0\n# Description: Frontend controller for the remote AI Log Reporter integration.\n# -----------------------------------------------------------------------------\n\ntemplate:\n  - trigger:\n      # This trigger listens for a custom event we will send from the script\n      - platform: event\n        event_type: \"update_ai_summary\"\n    sensor:\n      - name: \"Daily System Summary\"\n        unique_id: ai_daily_summary_permanent\n        # The state is just the timestamp of the last update\n        state: \"{{ now().strftime('%Y-%m-%d %H:%M') }}\"\n        icon: mdi:robot\n        attributes:\n          # This pulls the 'summary' text from the event data sent by your script\n          summary: \"{{ trigger.event.data.summary }}\"\n\nshell_command:\n  generate_ai_log_summary: &gt;\n    ssh -i /config/.ssh/id_rsa\n    -o IdentitiesOnly=yes \n    -o BatchMode=yes\n    -o ConnectTimeout=5\n    -o StrictHostKeyChecking=no \n    -o UserKnownHostsFile=/dev/null \n    root@10.0.0.23 \n    'docker exec ai-log-reporter python /app/reporter.py'\n\nscript:\n  run_ai_summary_now:\n    alias: \"Run AI Log Summary Now\"\n    icon: mdi:robot\n    sequence:\n      - action: shell_command.generate_ai_log_summary # Service changed to Action in 2024.12+\n#      - action: notify.persistent_notification # Optional: popup in HA UI\n#        data:\n#          title: \"AI Reporter\"\n#          message: \"Gemini is analyzing logs and updating your dashboard.\"\n\nautomation:\n  - alias: \"Daily AI System Summary\"\n    id: daily_ai_summary_automation\n    trigger:\n      - platform: time\n        at: \"07:00:00\"\n      - platform: homeassistant\n        event: start # Triggers script whenever HA reboots\n    action:\n      - delay: \"00:01:00\" # Wait 1 min for network to be ready\n      - action: script.run_ai_summary_now\n\n  - alias: \"Restore AI Notification on Startup\"\n    id: restore_ai_notification_on_startup\n    trigger:\n      - platform: homeassistant\n        event: start\n    action:\n      - delay: \"00:00:15\" # Give the sensor a moment to restore its own state first\n      - condition: template\n        # Only restore if the sensor actually has a report saved\n        value_template: \"{{ state_attr('sensor.daily_system_summary', 'summary') not in [None, 'unknown', ''] }}\"\n      - action: persistent_notification.create\n        data:\n          title: \"\ud83e\udd16 Daily Lab Report (Restored)\"\n          message: \"{{ state_attr('sensor.daily_system_summary', 'summary') }}\"\n          notification_id: \"daily_ai_summary\"\n</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/airthings/","title":"Package: Airthings","text":"","tags":["package","automated"]},{"location":"smart-home/packages/airthings/#package-airthings","title":"Package: Airthings","text":"<p>Version: 1.0.0 Description: Normalizes Airthings Wave sensors (Temp, Humidity, CO2)</p> <p></p>","tags":["package","automated"]},{"location":"smart-home/packages/airthings/#executive-summary","title":"Executive Summary","text":"<p>This package standardizes environmental data from the Airthings Wave sensor located in the living room. It takes raw source sensors (typically providing data with excess precision or varying attributes) and normalizes them into clean, rounded Template Sensors for Temperature, Humidity, and CO2, ensuring consistent display across dashboards.</p>","tags":["package","automated"]},{"location":"smart-home/packages/airthings/#process-description-non-technical","title":"Process Description (Non-Technical)","text":"<ol> <li>Read: The system reads the raw data from the Airthings integration (e.g., <code>sensor.airthings_wave_living_room_temperature</code>).</li> <li>Process: It rounds the numbers to 1 decimal place for readability (e.g., 21.564\u00b0C becomes 21.6\u00b0C).</li> <li>Publish: It creates new \"clean\" sensors that are used in the Living Room dashboard.</li> </ol>","tags":["package","automated"]},{"location":"smart-home/packages/airthings/#dashboard-connections","title":"Dashboard Connections","text":"<p>This package powers the following dashboard views:</p> <ul> <li>Living Room: The Living Room dashboard is a media and comfort hub. It features in-depth environmental monitoring (Radon, VOCs, CO2) via Airthings Wave, displaying historical trends. Entertainment controls are central, with remotes for the TV and Soundbar, plus power management for the media wall. The view also includes specific controls for the fireplace, air purifier modes, and various lighting scenes, alongside standard occupancy settings. (Uses 3 entities)</li> </ul>","tags":["package","automated"]},{"location":"smart-home/packages/airthings/#architecture-diagram","title":"Architecture Diagram","text":"<p>Data flows unidirectionally from the physical Airthings device to Home Assistant. The raw sensor data is intercepted by the Template engine, which applies rounding logic. The resulting \"Normalized Sensors\" are the final output, providing clean data for the UI.</p> <pre><code>sequenceDiagram\n    participant Device as Airthings Wave\n    participant HA as Home Assistant\n    participant UI as Dashboard\n\n    Device-&gt;&gt;HA: Report Raw Data (21.564\u00b0C)\n    HA-&gt;&gt;HA: Template Logic (Round to 21.6\u00b0C)\n    HA-&gt;&gt;UI: Update \"Airthings Wave Temperature\"</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/airthings/#configuration-source-code","title":"Configuration (Source Code)","text":"<pre><code># ------------------------------------------------------------------------------\n# Package: Airthings\n# Version: 1.0.0\n# Description: Normalizes Airthings Wave sensors (Temp, Humidity, CO2)\n# Dependencies: sensor.airthings_wave_living_room_temperature\n# ------------------------------------------------------------------------------\ntemplate:\n  - sensor:\n      - name: \"Airthings Wave Temperature\"\n        unique_id: airthings_wave_temperature\n        unit_of_measurement: \"\u00b0C\"\n        device_class: temperature\n        state_class: measurement\n        state: &gt;\n          {% set value = states('sensor.airthings_wave_living_room_temperature') | float(0) %}\n          {{ value | round(1) }}\n\n      - name: \"Airthings Wave Humidity\"\n        unique_id: airthings_wave_humidity\n        unit_of_measurement: \"%\"\n        device_class: humidity\n        state_class: measurement\n        state: &gt;\n          {% set value = states('sensor.airthings_wave_living_room_humidity') | float(0) %}\n          {{ value | round(1) }}\n\n      - name: \"Airthings Wave CO2\"\n        unique_id: airthings_wave_co2\n        unit_of_measurement: \"ppm\"\n        device_class: carbon_dioxide\n        state_class: measurement\n        state: &gt;\n          {% set value = states('sensor.airthings_wave_living_room_co2') | float(0) %}\n          {{ value | round(1) }}\n</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/aqara_w500/","title":"Package: Aqara W500","text":"","tags":["package","automated"]},{"location":"smart-home/packages/aqara_w500/#package-aqara-w500","title":"Package: Aqara W500","text":"<p>Version: 1.0.0 Description: Manages temperature settings and schedules for the Bathroom Floor Heat (Aqara W500 Climate). Includes logic for high electricity price reduction and shower occupancy boost.</p> <p></p>","tags":["package","automated"]},{"location":"smart-home/packages/aqara_w500/#executive-summary","title":"Executive Summary","text":"<p>The Aqara W500 package manages the bathroom floor heating via a smart thermostat. It implements an advanced energy-saving strategy that balances comfort with cost. It features signal normalization for raw temperature data, an automated \"Boost Mode\" triggered by shower occupancy, and a \"Peak Shaving\" mechanism that reduces heating loads during high electricity price intervals.</p>","tags":["package","automated"]},{"location":"smart-home/packages/aqara_w500/#process-description-non-technical","title":"Process Description (Non-Technical)","text":"","tags":["package","automated"]},{"location":"smart-home/packages/aqara_w500/#how-it-works","title":"How It Works","text":"<ol> <li>Smart Schedule: The floor generally stays at a comfortable default temperature.</li> <li>Shower Boost: If the presence sensor detects you have been in the shower area for more than 30 minutes, it automatically raises the temperature to dry the floor and keep you warm.</li> <li>Cost Protection: If the electricity price spikes (goes above your set limit), the system will automatically lower the temperature to the default setting to save money, even if you had manually turned it up.</li> <li>Manual Protection: If you manually turn up the heat, a timer starts. Once the timer runs out, the temperature automatically resets to normal so you don't accidentally leave it running high all day.</li> </ol>","tags":["package","automated"]},{"location":"smart-home/packages/aqara_w500/#dashboard-connections","title":"Dashboard Connections","text":"<p>This package powers the following dashboard views:</p> <ul> <li>Bathroom: This view manages the bathroom environment. It features a 'Streamline' header card summarizing key states (temperature, washing machine status, occupancy). Lighting controls allow separate adjustments for the sauna, table, and ceiling. A major focus is the smart floor heating system (Aqara W500), which includes a thermostat control, historical temperature graphs, and a dedicated timer automation for overriding default heating schedules. (Uses 5 entities)</li> <li>Electricity: The Electricity dashboard is a detailed analytics hub for home energy. It features sophisticated charts tracking today's and tomorrow's hourly electricity prices (Nordpool), dynamically color-coded based on daily highs and lows. It also monitors daily energy consumption and real-time power usage via Shelly 3EM, providing cost estimates and historical usage trends. (Uses 2 entities)</li> <li>Electricity Dev: This is a development view for the main Electricity dashboard, used for testing new chart configurations and layouts (Panel mode). It replicates the core pricing and usage visualizations but may contain experimental features or alternative display styles like vertical stacks. (Uses 1 entities)</li> <li>Home: The Home dashboard serves as the central information hub. It features a large clock and family calendars, alongside detailed weather forecasts. Key home stats are highlighted, including real-time energy prices, power usage, and the status of major appliances like the dishwasher and washing machine. The view also provides a high-level overview of the entire house, displaying camera feeds and status summaries for all key rooms (Sauna, Bathroom, Bedroom, etc.) using 'Streamline' area cards. (Uses 1 entities)</li> </ul>","tags":["package","automated"]},{"location":"smart-home/packages/aqara_w500/#architecture-diagram","title":"Architecture Diagram","text":"<p>The system prioritizes comfort during active usage while strictly enforcing energy economy during idle periods or price spikes. When the <code>Bathroom FP2</code> sensor identifies continuous occupancy in the shower zone for 30 minutes, the automation triggers a 'Comfort Boost', raising the floor temperature, provided electricity prices are within acceptable limits. Conversely, if electricity prices surge above the defined threshold, the automation logic intercepts the state and throttles the heating back to the default 'Eco' temperature, overriding any manual increases to prevent billing shock.</p> <pre><code>sequenceDiagram\n    participant Sensor as FP2 Presence\n    participant Price as Electricity Price\n    participant HA as Automation Logic\n    participant Thermostat as Aqara W500\n\n    rect rgb(20, 50, 20)\n    Note over HA: Shower Boost Logic\n    Sensor-&gt;&gt;HA: Shower Occupied &gt; 30m\n    HA-&gt;&gt;Price: Check Price Level\n    alt Price Low\n        HA-&gt;&gt;Thermostat: Set Temp (Target Boost)\n    else Price High\n        HA-&gt;&gt;HA: Block Boost (Save Money)\n    end\n    end\n\n    rect rgb(50, 20, 20)\n    Note over HA: Price Protection logic\n    Price-&gt;&gt;HA: Price &gt; Threshold\n    HA-&gt;&gt;Thermostat: Force Reset to Default Temp\n    end\n\n    rect rgb(20, 20, 50)\n    Note over HA: Manual Override Logic\n    Thermostat-&gt;&gt;HA: User Increased Temp\n    HA-&gt;&gt;HA: Start Timer\n    HA-&gt;&gt;HA: Timer Finished\n    HA-&gt;&gt;Thermostat: Reset to Default Temp\n    end</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/aqara_w500/#configuration-source-code","title":"Configuration (Source Code)","text":"<pre><code># ------------------------------------------------------------------------------\n# Package: Aqara W500 Floor Heating Control\n# Version: 1.0.0\n# Description: Manages temperature settings and schedules for the Bathroom Floor Heat (Aqara W500 Climate). Includes logic for high electricity price reduction and shower occupancy boost.\n# Dependencies:\n#   - Entities: climate.aqara_w500, binary_sensor.bathroom_fp2_shower_occupancy, sensor.electricity_price_cents\n#   - Helpers: input_number.electricity_high_price_threshold, input_number.bathroom_floor_heat_target_temperature, input_number.bathroom_floor_heat_default_temperature, input_number.bathroom_floor_heat_override_duration, timer.bathroom_floor_heating_timer\n# ------------------------------------------------------------------------------\n\n# ==============================================================================\n# 1. TEMPLATE SENSORS (Raw Data Normalization)\n# ==============================================================================\ntemplate:\n  - sensor:\n      - name: \"Aqara W500 Temperature (Raw)\"\n        unique_id: aqara_w500_temperature_raw\n        unit_of_measurement: \"\u00b0C\"\n        device_class: temperature\n        state_class: measurement\n        state: &gt;\n          {% set raw = state_attr('climate.aqara_w500', 'current_temperature') %}\n          {% set value = raw | float(default=0.0) %}\n          {{ value | round(1) }}\n\n      - name: \"Aqara W500 Bathroom Heating HVAC\"\n        unique_id: aqara_w500_bathroom_heating_hvac\n        state: \"{{ state_attr('climate.aqara_w500', 'hvac_action') }}\"\n        icon: mdi:heating-coil\n\n# ==============================================================================\n# 2. FILTER SENSORS (Data Smoothing)\n# ==============================================================================\nsensor:\n  - platform: filter\n    name: \"Aqara W500 Temperature (Smoothed)\"\n    entity_id: sensor.aqara_w500_temperature_raw\n    unique_id: aqara_w500_temperature_smoothed\n    filters:\n      - filter: lowpass\n        time_constant: 10\n        precision: 1\n      - filter: time_throttle\n        window_size: 60\n\n# ==============================================================================\n# 3. AUTOMATION (Control Logic)\n# ==============================================================================\nautomation:\n  # ==============================================================================\n  # 1. Automation: Bathroom Heating On when showering\n  # ==============================================================================\n  - alias: \"Heating: Boost Heat on Shower Occupancy\"\n    id: heating_boost_on_shower\n    description: \"Sets the floor heating to target override temperature when prolonged shower occupancy is detected, provided electricity prices are below the high threshold.\"\n    trigger:\n      # If the bathroom is occupied for 30 minutes (suggesting a shower/bath is in progress)\n      - platform: state\n        entity_id: binary_sensor.bathroom_fp2_shower_occupancy\n        from:\n          - \"off\"\n          - \"on\"\n        to: \"on\"\n        for:\n          minutes: 30\n    condition:\n      # Condition 1: Electricity price is low enough to allow boosting\n      - condition: numeric_state\n        entity_id: sensor.electricity_price_cents\n        below: input_number.electricity_high_price_threshold\n      # Condition 2: Only boost if the current target is NOT already the override target\n      - condition: template\n        value_template: |\n          {{ \n            state_attr('climate.aqara_w500', 'temperature') | float != \n            states('input_number.bathroom_floor_heat_target_temperature') | float\n          }}\n    action:\n      - service: climate.set_temperature\n        target:\n          entity_id: climate.aqara_w500\n        data:\n          temperature: &gt;-\n            {{ states('input_number.bathroom_floor_heat_target_temperature') | float }}\n    mode: single\n\n  # ==============================================================================\n  # 2. Automation: Manage Floor Heat Override Timer\n  # ==============================================================================\n  - alias: \"Heating: Manage Floor Heat Override Timer\"\n    id: heating_manage_override_timer\n    description: \"Starts timer when manual temperature override is set; cancels timer if temperature is reset to default.\"\n    trigger:\n      # Trigger 1: User sets temp above default (Starts timer)\n      - platform: numeric_state\n        entity_id: climate.aqara_w500\n        attribute: temperature\n        above: input_number.bathroom_floor_heat_default_temperature\n        id: start_timer\n      # Trigger 2: User changes temp (Check if we need to cancel timer)\n      - platform: state\n        entity_id: climate.aqara_w500\n        attribute: temperature\n        id: cancel_check\n    condition: []\n    action:\n      - choose:\n          # Case 1: Start timer if temp is set above default\n          - conditions:\n              - condition: trigger\n                id: start_timer\n            sequence:\n              - service: timer.start\n                target:\n                  entity_id: timer.bathroom_floor_heating_timer\n                data:\n                  duration: &gt;-\n                    {{ states('input_number.bathroom_floor_heat_override_duration') | int(0) * 60 }}\n          # Case 2: Cancel timer if temp is set back to default or lower\n          - conditions:\n              - condition: trigger\n                id: cancel_check\n              - condition: template\n                value_template: &gt;\n                  {# Check if the current set temperature is &lt;= the default temperature #}\n                  {{ state_attr('climate.aqara_w500', 'temperature') | float(0) &lt;=  \n                      states('input_number.bathroom_floor_heat_default_temperature') | float(0) }}\n            sequence:\n              - service: timer.cancel\n                target:\n                  entity_id: timer.bathroom_floor_heating_timer\n    mode: single\n\n  # ==============================================================================\n  # 3. Automation: Reduce Floor Heat when Price is High\n  # ==============================================================================\n  - alias: \"Heating: Reduce Floor Heat when Price is High\"\n    id: heating_price_reduce\n    description: \"Sets Aqara W500 to default temp when electricity price exceeds a set threshold, but only if temperature is currently higher than the default temp.\"\n    trigger:\n      - platform: numeric_state\n        entity_id: sensor.electricity_prices\n        above: input_number.electricity_high_price_threshold\n    condition:\n      - condition: state\n        entity_id: climate.aqara_w500\n        state: heat\n      - condition: numeric_state\n        entity_id: climate.aqara_w500\n        attribute: temperature\n        above: input_number.bathroom_floor_heat_default_temperature\n    action:\n      - service: climate.set_temperature\n        target:\n          entity_id: climate.aqara_w500\n        data:\n          temperature: &gt;-\n            {{ states('input_number.bathroom_floor_heat_default_temperature') | float(22) }}\n    mode: single\n\n  # ==============================================================================\n  # 4. Automation: Reset Floor Heat on Timer Finish\n  # ==============================================================================\n  - alias: \"Heating: Reset Floor Heat on Timer Finish\"\n    id: heating_reset_on_timer\n    description: \"Sets Aqara W500 back to the default temperature when the override timer expires.\"\n    trigger:\n      - platform: event\n        event_type: timer.finished\n        event_data:\n          entity_id: timer.bathroom_floor_heating_timer\n    condition: []\n    action:\n      - service: climate.set_temperature\n        target:\n          entity_id: climate.aqara_w500\n        data:\n          temperature: &gt;-\n            {{ states('input_number.bathroom_floor_heat_default_temperature') | float(22) }}\n    mode: single\n# ------------------------------------------------------------------------------\n# Changelog\n# ------------------------------------------------------------------------------\n# 1.0.0 (2025-12-08): Initial package consolidation from multiple UI automations. Implemented logic for shower boost, high price reduction, and override timer management.\n# ------------------------------------------------------------------------------\n</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/area_manager/","title":"Package: Area Manager","text":"","tags":["package","automated"]},{"location":"smart-home/packages/area_manager/#package-area-manager","title":"Package: Area Manager","text":"<p>Version: 2.0.0 (Refactored from Room Manager) Description: Dynamic creation of AREA settings via MQTT (Replaces Room Manager)</p> <p></p>","tags":["package","automated"]},{"location":"smart-home/packages/area_manager/#executive-summary","title":"Executive Summary","text":"<p>No executive summary generated yet.</p>","tags":["package","automated"]},{"location":"smart-home/packages/area_manager/#process-description-non-technical","title":"Process Description (Non-Technical)","text":"<p>No detailed non-technical description generated yet.</p>","tags":["package","automated"]},{"location":"smart-home/packages/area_manager/#dashboard-connections","title":"Dashboard Connections","text":"<p>This package powers the following dashboard views:</p> <ul> <li>Living Room: The Living Room dashboard is a media and comfort hub. It features in-depth environmental monitoring (Radon, VOCs, CO2) via Airthings Wave, displaying historical trends. Entertainment controls are central, with remotes for the TV and Soundbar, plus power management for the media wall. The view also includes specific controls for the fireplace, air purifier modes, and various lighting scenes, alongside standard occupancy settings. (Uses 1 entities)</li> <li>Notifications Management: The Notification Center dashboard provides a comprehensive interface for managing the smart home's notification system. Administrators can add or remove users for mobile app notifications and define notification categories (e.g., 'Garage', 'Electricity'). The view allows for granular control over subscriptions, enabling individual users to opt-in or out of specific notification types, and includes tools to map and monitor notification-related automations. (Uses 1 entities)</li> <li>Room Management: The Room Management dashboard serves as the administrative backend for the home's room logic. It allows users to initialize new rooms (creating necessary helper entities) or delete existing ones. It features a dynamic \"Configured Rooms\" section powered by <code>auto-entities</code>, which automatically lists all configured rooms and provides collapsible controls for their automation modes, occupancy sensors, and timeouts. (Uses 1 entities)</li> </ul>","tags":["package","automated"]},{"location":"smart-home/packages/area_manager/#architecture-diagram","title":"Architecture Diagram","text":"<p>No architecture explanation generated yet.</p> <p>No architecture diagram generated yet.</p>","tags":["package","automated"]},{"location":"smart-home/packages/area_manager/#configuration-source-code","title":"Configuration (Source Code)","text":"<pre><code># Package: Area Automation Manager\n# Version: 2.0.0 (Refactored from Room Manager)\n# Description: Dynamic creation of AREA settings via MQTT (Replaces Room Manager)\n# ------------------------------------------------------------------------------\n\n# ------------------------------------------------------------------------------\n# 1. GLOBAL CUSTOMIZATION (Force Text Boxes)\n# ------------------------------------------------------------------------------\nhomeassistant:\n  customize_glob:\n    \"number.area_*_presence_idle_time\":\n      mode: box\n    \"number.area_*_lights_presence_delay\":\n      mode: box\n    \"number.area_*_sleep_entry_delay\":\n      mode: box\n    \"number.area_*_sleep_exit_delay\":\n      mode: box\n\n# ------------------------------------------------------------------------------\n# 2. HELPERS (Dashboard Inputs)\n# ------------------------------------------------------------------------------\ninput_text:\n  area_mgmt_name:\n    name: \"Area Name\"\n    icon: mdi:door-open\n  area_mgmt_slug:\n    name: \"Area ID (slug)\"\n    icon: mdi:identifier\n\ninput_select:\n  # SOURCE: Native Home Assistant Areas\n  area_mgmt_create_select:\n    name: \"Select Area to Initialize\"\n    icon: mdi:map-plus\n    options:\n      - \"unknown\"\n\n  # SOURCE: Existing Created Areas\n  area_mgmt_delete_select:\n    name: \"Select Area to Delete\"\n    icon: mdi:delete-sweep\n    options:\n      - \"unknown\"\n\n# ------------------------------------------------------------------------------\n# 3. SCRIPTS\n# ------------------------------------------------------------------------------\nscript:\n  # --- REFRESH AREA OPTIONS ---\n  refresh_area_options:\n    alias: \"System: Refresh Area Options\"\n    mode: single\n    sequence:\n      - service: automation.trigger\n        target:\n          entity_id: automation.system_populate_area_list\n\n  # --- CREATE AREA SETTINGS ---\n  create_area_settings:\n    alias: \"System: Create Area Settings\"\n    icon: mdi:home-plus\n    mode: single\n    sequence:\n      - variables:\n          target_slug: \"{{ area_slug if area_slug is defined else states('input_select.area_mgmt_create_select') }}\"\n          area_name: \"{{ area_name(target_slug) or target_slug | replace('_', ' ') | title }}\"\n          # Clean variable\n          area_slug: \"{{ target_slug }}\"\n          # Pre-calculate Sensor Options (DEBUG: Minimal List to test Pipeline)\n          sensor_options: &gt;-\n            {{ ['-Select-'] | to_json }}\n\n      - service: system_log.write\n        data:\n          message: \"Creating Area Settings for: {{ area_slug }} (v5 - Minimal)\"\n          level: warning\n\n      # 1. Create Automation Mode Selector (Select)\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/select/area_{{ area_slug }}_mode/config\"\n          payload: &gt;-\n            {\n              \"name\": \"{{ area_name }} Automation Mode\",\n              \"object_id\": \"area_{{ area_slug }}_automation_mode\",\n              \"unique_id\": \"area_select_{{ area_slug }}_mode_v5\",\n              \"icon\": \"mdi:home-lightning-bolt-outline\",\n              \"options\": [\"presence-control\", \"absence-detection\", \"manual-control\", \"schedule-mode\"],\n              \"command_topic\": \"area/{{ area_slug }}/mode/set\",\n              \"state_topic\": \"area/{{ area_slug }}/mode/state\",\n              \"availability_topic\": \"area/{{ area_slug }}/availability\",\n              \"payload_available\": \"online\",\n              \"device\": {\n                \"identifiers\": [\"area_settings_{{ area_slug }}\"],\n                \"name\": \"{{ area_name }} Settings\",\n                \"manufacturer\": \"Home Assistant\",\n                \"model\": \"Area Controller\"\n              }\n            }\n      # Set default\n      - if:\n          - condition: template\n            value_template: \"{{ states('select.area_' ~ area_slug ~ '_automation_mode') in ['unknown', 'unavailable', 'none'] }}\"\n        then:\n          - service: mqtt.publish\n            data:\n              retain: true\n              topic: \"area/{{ area_slug }}/mode/state\"\n              payload: \"presence-control\"\n      - delay: \"00:00:00.050\"\n\n      # 2. Create Idle Time (Number)\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/number/area_{{ area_slug }}_idle/config\"\n          payload: &gt;-\n            {\n              \"name\": \"{{ area_name }} Presence Idle Time\",\n              \"object_id\": \"area_{{ area_slug }}_presence_idle_time\",\n              \"unique_id\": \"area_number_{{ area_slug }}_idle_v5\",\n              \"device_class\": \"duration\",\n              \"icon\": \"mdi:timer-sand\",\n              \"min\": 0,\n              \"max\": 3600,\n              \"step\": 1,\n              \"unit_of_measurement\": \"s\",\n              \"command_topic\": \"area/{{ area_slug }}/idle/set\",\n              \"state_topic\": \"area/{{ area_slug }}/idle/state\",\n              \"availability_topic\": \"area/{{ area_slug }}/availability\",\n              \"device\": { \"identifiers\": [\"area_settings_{{ area_slug }}\"] }\n            }\n      - if:\n          - condition: template\n            value_template: \"{{ states('number.area_' ~ area_slug ~ '_presence_idle_time') in ['unknown', 'unavailable', 'none'] }}\"\n        then:\n          - service: mqtt.publish\n            data:\n              retain: true\n              topic: \"area/{{ area_slug }}/idle/state\"\n              payload: \"15\"\n      - delay: \"00:00:00.050\"\n\n      # 3. Create Delay Time (Number)\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/number/area_{{ area_slug }}_delay/config\"\n          payload: &gt;-\n            {\n              \"name\": \"{{ area_name }} Lights Presence Delay\",\n              \"object_id\": \"area_{{ area_slug }}_lights_presence_delay\",\n              \"unique_id\": \"area_number_{{ area_slug }}_delay_v5\",\n              \"device_class\": \"duration\",\n              \"icon\": \"mdi:lightbulb-clock\",\n              \"min\": 0,\n              \"max\": 3600,\n              \"step\": 1,\n              \"unit_of_measurement\": \"s\",\n              \"command_topic\": \"area/{{ area_slug }}/delay/set\",\n              \"state_topic\": \"area/{{ area_slug }}/delay/state\",\n              \"availability_topic\": \"area/{{ area_slug }}/availability\",\n              \"device\": { \"identifiers\": [\"area_settings_{{ area_slug }}\"] }\n            }\n      - if:\n          - condition: template\n            value_template: \"{{ states('number.area_' ~ area_slug ~ '_lights_presence_delay') in ['unknown', 'unavailable', 'none'] }}\"\n        then:\n          - service: mqtt.publish\n            data:\n              retain: true\n              topic: \"area/{{ area_slug }}/delay/state\"\n              payload: \"120\"\n      - delay: \"00:00:00.050\"\n\n      # 4. Create Timer Display (Timestamp Sensor)\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/sensor/area_{{ area_slug }}_timer/config\"\n          payload: &gt;-\n            {\n              \"name\": \"{{ area_name }} Timer\",\n              \"object_id\": \"area_{{ area_slug }}_timer\",\n              \"unique_id\": \"area_sensor_{{ area_slug }}_timer_v5\",\n              \"icon\": \"mdi:progress-clock\",\n              \"device_class\": \"timestamp\",\n              \"value_template\": \"{{ '{{' }} value if value not in ['unknown', 'unavailable', ''] else None {{ '}}' }}\",\n              \"state_topic\": \"area/{{ area_slug }}/timer/state\",\n              \"json_attributes_topic\": \"area/{{ area_slug }}/timer/attributes\",\n              \"availability_topic\": \"area/{{ area_slug }}/availability\",\n              \"device\": { \"identifiers\": [\"area_settings_{{ area_slug }}\"] }\n            }\n      - delay: \"00:00:00.050\"\n      # 5. Create Area State (Select)\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/select/area_{{ area_slug }}_state/config\"\n          payload: &gt;-\n            {\n              \"name\": \"{{ area_name }} State\",\n              \"object_id\": \"area_{{ area_slug }}_state\",\n              \"unique_id\": \"area_select_state_v5_{{ area_slug }}\",\n              \"icon\": \"mdi:eye-outline\",\n              \"options\": [\"Occupied\", \"Idle\", \"Absence\", \"Sleep\", \"DND\"],\n              \"command_topic\": \"area/{{ area_slug }}/state/set\",\n              \"state_topic\": \"area/{{ area_slug }}/state/state\",\n              \"availability_topic\": \"area/{{ area_slug }}/availability\",\n              \"payload_available\": \"online\",\n              \"device\": { \"identifiers\": [\"area_settings_{{ area_slug }}\"] }\n            }\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"area/{{ area_slug }}/state/state\"\n          payload: \"Absence\"\n      - delay: \"00:00:00.050\"\n\n      # 6. Create Occupancy (Binary Sensor)\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/binary_sensor/area_{{ area_slug }}_occupancy/config\"\n          payload: &gt;-\n            {\n              \"name\": \"{{ area_name }} Occupancy\",\n              \"object_id\": \"area_{{ area_slug }}_occupancy\",\n              \"unique_id\": \"area_occupancy_v5_{{ area_slug }}\",\n              \"icon\": \"mdi:motion-sensor\",\n              \"device_class\": \"occupancy\",\n              \"state_topic\": \"area/{{ area_slug }}/occupancy/state\",\n              \"availability_topic\": \"area/{{ area_slug }}/availability\",\n              \"device\": { \"identifiers\": [\"area_settings_{{ area_slug }}\"] }\n            }\n      - delay: \"00:00:00.050\"\n      # 7. Create Automation Switch\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/switch/area_{{ area_slug }}_automation/config\"\n          payload: &gt;-\n            {\n              \"name\": \"{{ area_name }} Automation\",\n              \"object_id\": \"area_{{ area_slug }}_automation\",\n              \"unique_id\": \"area_switch_automation_v5_{{ area_slug }}\",\n              \"icon\": \"mdi:robot\",\n              \"command_topic\": \"area/{{ area_slug }}/automation/set\",\n              \"state_topic\": \"area/{{ area_slug }}/automation/state\",\n              \"availability_topic\": \"area/{{ area_slug }}/availability\",\n              \"device\": { \"identifiers\": [\"area_settings_{{ area_slug }}\"] }\n            }\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"area/{{ area_slug }}/automation/state\"\n          payload: \"ON\"\n      - delay: \"00:00:00.050\"\n\n      # 8. Create Bed Sensor (Select)\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/select/area_{{ area_slug }}_bed_sensor/config\"\n          payload: &gt;-\n            {\n              \"name\": \"{{ area_name }} Bed Sensor\",\n              \"object_id\": \"area_{{ area_slug }}_bed_sensor\",\n              \"unique_id\": \"area_select_bed_{{ area_slug }}_v5\",\n              \"options\": {{ sensor_options }},\n              \"command_topic\": \"area/{{ area_slug }}/bed_sensor/set\",\n              \"state_topic\": \"area/{{ area_slug }}/bed_sensor/state\",\n              \"availability_topic\": \"area/{{ area_slug }}/availability\",\n              \"device\": { \"identifiers\": [\"area_settings_{{ area_slug }}\"] }\n            }\n      - delay: \"00:00:00.050\"\n      # 9. Create Sleep ENTRY Delay (Number)\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/number/area_{{ area_slug }}_sleep_entry_delay/config\"\n          payload: &gt;-\n            {\n              \"name\": \"{{ area_name }} Sleep Entry Delay\",\n              \"object_id\": \"area_{{ area_slug }}_sleep_entry_delay\",\n              \"unique_id\": \"area_number_{{ area_slug }}_sleep_entry_v5\",\n              \"device_class\": \"duration\",\n              \"icon\": \"mdi:bed-clock\",\n              \"min\": 0,\n              \"max\": 3600,\n              \"step\": 1,\n              \"unit_of_measurement\": \"s\",\n              \"command_topic\": \"area/{{ area_slug }}/sleep_entry_delay/set\",\n              \"state_topic\": \"area/{{ area_slug }}/sleep_entry_delay/state\",\n              \"availability_topic\": \"area/{{ area_slug }}/availability\",\n              \"device\": { \"identifiers\": [\"area_settings_{{ area_slug }}\"] }\n            }\n      - if:\n          - condition: template\n            value_template: \"{{ states('number.area_' ~ area_slug ~ '_sleep_entry_delay') in ['unknown', 'unavailable', 'none'] }}\"\n        then:\n          - service: mqtt.publish\n            data:\n              retain: true\n              topic: \"area/{{ area_slug }}/sleep_entry_delay/state\"\n              payload: \"300\"\n      - delay: \"00:00:00.050\"\n\n      # 10. Create Sleep EXIT Delay (Number)\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/number/area_{{ area_slug }}_sleep_exit_delay/config\"\n          payload: &gt;-\n            {\n              \"name\": \"{{ area_name }} Sleep Exit Delay\",\n              \"object_id\": \"area_{{ area_slug }}_sleep_exit_delay\",\n              \"unique_id\": \"area_number_{{ area_slug }}_sleep_exit_v5\",\n              \"device_class\": \"duration\",\n              \"icon\": \"mdi:run-fast\",\n              \"min\": 0,\n              \"max\": 3600,\n              \"step\": 1,\n              \"unit_of_measurement\": \"s\",\n              \"command_topic\": \"area/{{ area_slug }}/sleep_exit_delay/set\",\n              \"state_topic\": \"area/{{ area_slug }}/sleep_exit_delay/state\",\n              \"availability_topic\": \"area/{{ area_slug }}/availability\",\n              \"device\": { \"identifiers\": [\"area_settings_{{ area_slug }}\"] }\n            }\n      - if:\n          - condition: template\n            value_template: \"{{ states('number.area_' ~ area_slug ~ '_sleep_exit_delay') in ['unknown', 'unavailable', 'none'] }}\"\n        then:\n          - service: mqtt.publish\n            data:\n              retain: true\n              topic: \"area/{{ area_slug }}/sleep_exit_delay/state\"\n              payload: \"60\"\n      - delay: \"00:00:00.050\"\n\n      # 11. Set Online\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"area/{{ area_slug }}/availability\"\n          payload: \"online\"\n\n      # 12. Create Occupancy Source (Select)\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/select/area_{{ area_slug }}_occupancy_source/config\"\n          payload: &gt;-\n            {\n              \"name\": \"{{ area_name }} Occupancy Sensor\",\n              \"object_id\": \"area_{{ area_slug }}_occupancy_source\",\n              \"unique_id\": \"area_select_occ_source_v5_{{ area_slug }}\",\n              \"options\": {{ sensor_options }},\n              \"command_topic\": \"area/{{ area_slug }}/occupancy_source/set\",\n              \"state_topic\": \"area/{{ area_slug }}/occupancy_source/state\",\n              \"availability_topic\": \"area/{{ area_slug }}/availability\",\n              \"device\": { \"identifiers\": [\"area_settings_{{ area_slug }}\"] }\n            }\n      - delay: \"00:00:00.050\"\n      - service: script.refresh_area_options\n\n  # --- DELETE AREA SETTINGS ---\n  delete_area_settings:\n    alias: \"System: Delete Area Settings\"\n    icon: mdi:home-remove\n    mode: single\n    sequence:\n      - variables:\n          raw_slug: \"{{ states('input_select.area_mgmt_delete_select') }}\"\n          # SAFETY: If slug starts with 'area_', strip it\n          area_slug: \"{{ raw_slug | replace('area_', '') if raw_slug.startswith('area_') else raw_slug }}\"\n\n      # Clear Config Topics\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/select/area_{{ area_slug }}_mode/config\"\n          payload: \"\"\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/number/area_{{ area_slug }}_idle/config\"\n          payload: \"\"\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/number/area_{{ area_slug }}_delay/config\"\n          payload: \"\"\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/sensor/area_{{ area_slug }}_timer/config\"\n          payload: \"\"\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/select/area_{{ area_slug }}_state/config\"\n          payload: \"\"\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/binary_sensor/area_{{ area_slug }}_occupancy/config\"\n          payload: \"\"\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/switch/area_{{ area_slug }}_automation/config\"\n          payload: \"\"\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/select/area_{{ area_slug }}_bed_sensor/config\"\n          payload: \"\"\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/number/area_{{ area_slug }}_sleep_entry_delay/config\"\n          payload: \"\"\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/number/area_{{ area_slug }}_sleep_exit_delay/config\"\n          payload: \"\"\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/select/area_{{ area_slug }}_occupancy_source/config\"\n          payload: \"\"\n\n      # Delete Availability to 'offline'\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"area/{{ area_slug }}/availability\"\n          payload: \"\"\n      - service: script.refresh_area_options\n\n# ------------------------------------------------------------------------------\n# 4. AUTOMATIONS\n# ------------------------------------------------------------------------------\nautomation:\n  # POPULATE DROPDOWNS (\"Manage Areas\")\n  - alias: \"System: Populate Area List\"\n    id: system_populate_area_list\n    trigger:\n      - platform: homeassistant\n        event: start\n      - platform: time_pattern\n        hours: \"/1\"\n    action:\n      # 1. Populate 'Create' from HA Areas\n      - service: input_select.set_options\n        target:\n          entity_id: input_select.area_mgmt_create_select\n        data:\n          options: &gt;-\n            {% set areas = areas() | sort %}\n            {{ areas if areas else ['unknown'] }}\n\n      # 2. Populate 'Delete' from created 'area_*_automation_mode' entities\n      - service: input_select.set_options\n        target:\n          entity_id: input_select.area_mgmt_delete_select\n        data:\n          options: &gt;-\n            {% set mode_selectors = states.select | selectattr('object_id', 'search', '_automation_mode$') | list %}\n            {% set ns = namespace(areas=[]) %}\n            {% for sel in mode_selectors %}\n               {% set raw_id = sel.entity_id.split('.')[1] %}\n               {% set base = raw_id | replace('_automation_mode', '') %}\n               {% if base.startswith('area_') %}\n                  {% set slug = base[5:] %}\n               {% else %}\n                  {% set slug = base %}\n               {% endif %}\n               {% set ns.areas = ns.areas + [slug] %}\n            {% endfor %}\n            {{ ns.areas | unique | list if ns.areas else ['unknown'] }}\n\n            # END OF POPULATION\n\n  # MQTT PERSISTENCE\n  - alias: \"System: Area MQTT Persistence\"\n    id: system_area_mqtt_persistence\n    mode: queued\n    trigger:\n      - platform: mqtt\n        topic: \"area/+/+/set\"\n      - platform: mqtt\n        topic: \"area/+/+/+/set\"\n    action:\n      - variables:\n          target_topic: \"{{ trigger.topic | replace('/set', '/state') }}\"\n      - service: mqtt.publish\n        data:\n          topic: \"{{ target_topic }}\"\n          payload: \"{{ trigger.payload }}\"\n          retain: true\n</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/car/","title":"Package: Car","text":"","tags":["package","automated","car"]},{"location":"smart-home/packages/car/#package-car","title":"Package: Car","text":"<p>Version: 2.0.3 Description: Unified logic for Mercedes GLC. Normalizes sensors (Windows/Doors), wrapper switches, and Status Notifications.</p> <p></p>","tags":["package","automated","car"]},{"location":"smart-home/packages/car/#executive-summary","title":"Executive Summary","text":"<p>The <code>Car</code> package provides a unified interface for the Mercedes GLC, leveraging the <code>mbapi2020</code> integration. It normalizes proprietary attribute data (e.g., window status codes, specific lock states) into standard Home Assistant binary sensors and device classes. The package includes a comprehensive automation suite (<code>notify_car_status_glc</code>) that monitors critical vehicle states\u2014such as charging progress, pre-entry climate control, and fluid warnings\u2014and dispatches actionable notifications via the <code>notify_smart_master</code> script.</p>","tags":["package","automated","car"]},{"location":"smart-home/packages/car/#process-description-non-technical","title":"Process Description (Non-Technical)","text":"","tags":["package","automated","car"]},{"location":"smart-home/packages/car/#how-it-works","title":"How It Works","text":"<ul> <li>Real-time Monitoring: The system continuously checks the status of your car's doors, windows, and locks. You can instantly see if the car is secure or if the engine is running.</li> <li>Remote Control: You can lock or unlock the doors and close the windows directly from your dashboard. Additionally, the \"Pre-entry A/C\" switch allows you to heat or cool the car before you leave.</li> <li>Smart Notifications:<ul> <li>Charging: Receive alerts when the car is plugged in, when charging starts (with estimated completion time), and when the battery is full.</li> <li>Safety &amp; Maintenance: The system watches for warning signs like low tire pressure, low brake fluid, or low washer fluid and sends critical alerts to your phone if attention is needed.</li> </ul> </li> </ul>","tags":["package","automated","car"]},{"location":"smart-home/packages/car/#integration-dependencies","title":"Integration Dependencies","text":"<ul> <li>Mercedes Me 2020 (mbapi2020): Cloud integration for Mercedes-Benz.<ul> <li>Type: HACS Integration</li> <li>Role: Device Attributes &amp; Commands</li> </ul> </li> <li>script.notify_smart_master: Central notification router.<ul> <li>Type: Script</li> <li>Role: Alerting</li> </ul> </li> </ul>","tags":["package","automated","car"]},{"location":"smart-home/packages/car/#dashboard-connections","title":"Dashboard Connections","text":"<p>This package powers the following dashboard views:</p> <ul> <li>CAR: This view provides a comprehensive interface for the Mercedes GLC (\"The Car\"). It features a visual representation of the car's state (Home/Away, Engine On) using dynamic picture elements. Key controls include pre-entry climate scheduling via a scheduler card and door/window management. The dashboard also monitors critical telemetry such as fuel level, EV battery charge, tire pressure, and lock status, visualizing them with color-coded indicators and Mushroom cards. (Uses 1 entities)</li> <li>Home: The Home dashboard serves as the central information hub. It features a large clock and family calendars, alongside detailed weather forecasts. Key home stats are highlighted, including real-time energy prices, power usage, and the status of major appliances like the dishwasher and washing machine. The view also provides a high-level overview of the entire house, displaying camera feeds and status summaries for all key rooms (Sauna, Bathroom, Bedroom, etc.) using 'Streamline' area cards. (Uses 1 entities)</li> </ul>","tags":["package","automated","car"]},{"location":"smart-home/packages/car/#architecture-diagram","title":"Architecture Diagram","text":"<p>The architecture relies on the <code>mbapi2020</code> integration to poll data from the Mercedes Cloud. The <code>Car</code> package acts as a transformation layer, converting complex attribute data (like raw status codes for windows and doors) into discrete, easy-to-use binary sensors. This normalized data feeds into a central automation (<code>notify_car_status_glc</code>), which evaluates state changes\u2014such as a charging cable connection or a low fluid warning\u2014and routes the appropriate message priority to the user through the <code>notify_smart_master</code> script.</p> <pre><code>sequenceDiagram\n    participant Mercedes as Mercedes Cloud\n    participant Integration as HA Integration (mbapi2020)\n    participant Package as Car Package\n    participant User as User (Notification)\n\n    Note over Arrow: Polling Cycle\n    Mercedes-&gt;&gt;Integration: Vehicle Status Update\n    Integration-&gt;&gt;Package: Update Entity Attributes (Windows, Locks, Odometer)\n    Package-&gt;&gt;Package: Normalize Attributes to Binary Sensors\n\n    Note over Package: Automation Logic\n    alt Critical Warning (e.g., Low Brake Fluid)\n        Package-&gt;&gt;User: \ud83d\udea8 Critical Alert via script.notify_smart_master\n    else Standard Event (e.g., Charging Started)\n        Package-&gt;&gt;User: \u26a1 Info Notification (Power &amp; Est. Time)\n    end\n\n    Note over User: User Action\n    User-&gt;&gt;Package: Toggle \"Pre-entry A/C\"\n    Package-&gt;&gt;Integration: Call Service (preheat_start)\n    Integration-&gt;&gt;Mercedes: Send Command</code></pre>","tags":["package","automated","car"]},{"location":"smart-home/packages/car/#configuration-source-code","title":"Configuration (Source Code)","text":"<pre><code># ------------------------------------------------------------------------------\n# Package: Car GLC\n# Version: 2.0.3\n# Description: Unified logic for Mercedes GLC. Normalizes sensors (Windows/Doors), wrapper switches, and Status Notifications.\n# Dependencies:\n#   - Integration: ReneNulschDE/mbapi2020 (HACS)\n#   - Script: script.notify_smart_master\n# ------------------------------------------------------------------------------\n\n# ==============================================================================\n# 1. TEMPLATE SENSORS &amp; BINARY SENSORS\n# ==============================================================================\ntemplate:\n  - binary_sensor:\n      # --- Windows (Normalized from Attribute) ---\n      - name: \"Car GLC Window Front Left\"\n        unique_id: car_glc_window_front_left\n        device_class: window\n        state: &gt;\n          {{ state_attr('binary_sensor.[LICENSE_PLATE]_windows_closed', 'Windowstatusfrontleft') != '2' }}\n\n      - name: \"Car GLC Window Front Right\"\n        unique_id: car_glc_window_front_right\n        device_class: window\n        state: &gt;\n          {{ state_attr('binary_sensor.[LICENSE_PLATE]_windows_closed', 'Windowstatusfrontright') != '2' }}\n\n      - name: \"Car GLC Window Rear Left\"\n        unique_id: car_glc_window_rear_left\n        device_class: window\n        state: &gt;\n          {{ state_attr('binary_sensor.[LICENSE_PLATE]_windows_closed', 'Windowstatusrearleft') != '2' }}\n\n      - name: \"Car GLC Window Rear Right\"\n        unique_id: car_glc_window_rear_right\n        device_class: window\n        state: &gt;\n          {{ state_attr('binary_sensor.[LICENSE_PLATE]_windows_closed', 'Windowstatusrearright') != '2' }}\n\n      # --- Doors (Normalized from Attribute) ---\n      - name: \"Car GLC Door Front Left\"\n        unique_id: car_glc_door_front_left\n        device_class: door\n        state: &gt;\n          {{ state_attr('sensor.[LICENSE_PLATE]_lock', 'Door front left') != 'closed' }}\n\n      - name: \"Car GLC Door Front Right\"\n        unique_id: car_glc_door_front_right\n        device_class: door\n        state: &gt;\n          {{ state_attr('sensor.[LICENSE_PLATE]_lock', 'Door front right') != 'closed' }}\n\n      - name: \"Car GLC Door Rear Left\"\n        unique_id: car_glc_door_rear_left\n        device_class: door\n        state: &gt;\n          {{ state_attr('sensor.[LICENSE_PLATE]_lock', 'Door rear left') != 'closed' }}\n\n      - name: \"Car GLC Door Rear Right\"\n        unique_id: car_glc_door_rear_right\n        device_class: door\n        state: &gt;\n          {{ state_attr('sensor.[LICENSE_PLATE]_lock', 'Door rear right') != 'closed' }}\n\n      - name: \"Car GLC Deck Lid\"\n        unique_id: car_glc_deck_lid\n        device_class: opening\n        state: &gt;\n          {{ state_attr('sensor.[LICENSE_PLATE]_lock', 'Deck lid') != 'closed' }}\n\n      # --- Locks (Normalized from Attribute) ---\n      - name: \"Car GLC Lock Front Left\"\n        unique_id: car_glc_lock_front_left\n        device_class: lock\n        state: &gt;\n          {{ state_attr('sensor.[LICENSE_PLATE]_lock', 'Door lock front left') != 'locked' }}\n\n      - name: \"Car GLC Lock Front Right\"\n        unique_id: car_glc_lock_front_right\n        device_class: lock\n        state: &gt;\n          {{ state_attr('sensor.[LICENSE_PLATE]_lock', 'Door lock front right') != 'locked' }}\n\n      - name: \"Car GLC Lock Rear Left\"\n        unique_id: car_glc_lock_rear_left\n        device_class: lock\n        state: &gt;\n          {{ state_attr('sensor.[LICENSE_PLATE]_lock', 'Door lock rear left') != 'locked' }}\n\n      - name: \"Car GLC Lock Rear Right\"\n        unique_id: car_glc_lock_rear_right\n        device_class: lock\n        state: &gt;\n          {{ state_attr('sensor.[LICENSE_PLATE]_lock', 'Door lock rear right') != 'locked' }}\n\n      - name: \"Car GLC Gas Lock\"\n        unique_id: car_glc_gas_lock\n        device_class: lock\n        state: &gt;\n          {{ state_attr('sensor.[LICENSE_PLATE]_lock', 'Gas lock') != 'locked' }}\n\n      # --- Logic Sensors (Consolidated Status) ---\n      - name: \"Car Charge Plug\"\n        unique_id: car_charge_plug\n        device_class: plug\n        state: &gt;\n          {% set value = state_attr('sensor.[LICENSE_PLATE]_range_electric', 'chargingstatus') | float(0) %}\n          {{ value != 3 }}\n        icon: &gt;\n          {% set value = state_attr('sensor.[LICENSE_PLATE]_range_electric', 'chargingstatus') | float(0) %}\n          {% if value == 3 %}\n            mdi:power-plug-off\n          {% else %}\n            mdi:power-plug\n          {% endif %}\n\n      - name: \"Car Charging\"\n        unique_id: car_charging_active\n        device_class: power\n        state: &gt;\n          {% set value = states('sensor.[LICENSE_PLATE]_charging_power') | float(0) %}\n          {{ value != 0 }}\n        icon: &gt;\n          {% if states('sensor.[LICENSE_PLATE]_charging_power') | float(0) == 0 %}\n            mdi:power-off\n          {% else %}\n            mdi:power-on\n          {% endif %}\n\n      - name: \"Car Engine\"\n        unique_id: car_engine_status\n        device_class: running\n        state: &gt;\n          {% set value = states('sensor.[LICENSE_PLATE]_ignition_state') | float(0) %}\n          {{ value &gt;= 2 }}\n        icon: &gt;\n          {% if states('sensor.[LICENSE_PLATE]_ignition_state') | float(0) &lt; 2 %}\n            mdi:engine-off\n          {% else %}\n            mdi:engine\n          {% endif %}\n\n      - name: \"Car Doors\"\n        unique_id: car_doors_status\n        device_class: door\n        state: &gt;\n          {% set value = state_attr('sensor.[LICENSE_PLATE]_lock', 'doorStatusOverall') %}\n          {{ value == 0 }}\n        icon: &gt;\n          {% if state_attr('sensor.[LICENSE_PLATE]_lock', 'doorStatusOverall') == 0 %}\n            mdi:car-door\n          {% else %}\n            mdi:car-door-lock\n          {% endif %}\n\n  - sensor:\n      - name: \"Car Charge Ready\"\n        unique_id: car_charge_ready_time\n        state: &gt;\n          {% set end = state_attr('sensor.[LICENSE_PLATE]_range_electric', 'endofchargetime') %}\n          {% if end %}\n            {{ as_datetime(end).strftime('%H:%M') }}\n          {% else %}\n            unknown\n          {% endif %}\n\n  # ==============================================================================\n  # 2. SWITCHES (Wrappers for API Calls)\n  # ==============================================================================\n  - switch:\n      - name: \"Car Pre-entry A/C\"\n        unique_id: car_pre_entry_ac\n        icon: mdi:air-conditioner\n        state: \"{{ is_state_attr('sensor.[LICENSE_PLATE]_range_electric', 'precondNow', 1) }}\"\n        turn_on:\n          service: mbapi2020.preheat_start\n          data:\n            type: \"0\"\n            vin: !secret [REDACTED]\n        turn_off:\n          service: mbapi2020.preheat_stop\n          data:\n            vin: !secret [REDACTED]\n\n      - name: \"Car Windows\"\n        unique_id: car_windows\n        icon: mdi:car-door\n        state: \"{{ is_state('binary_sensor.[LICENSE_PLATE]_windows_closed', 'on') }}\"\n        turn_on:\n          service: mbapi2020.windows_close\n          data:\n            vin: !secret [REDACTED]\n        turn_off:\n          service: mbapi2020.windows_open\n          data:\n            vin: !secret [REDACTED]\n\n      - name: \"Car Door Locks\"\n        unique_id: car_doors\n        icon: mdi:car-door\n        state: \"{{ is_state('sensor.[LICENSE_PLATE]_lock', '2') }}\"\n        turn_on:\n          service: mbapi2020.doors_unlock\n          data:\n            vin: !secret [REDACTED]\n        turn_off:\n          service: mbapi2020.doors_lock\n          data:\n            vin: !secret [REDACTED]\n\n# ==============================================================================\n# 3. AUTOMATION (Notifications)\n# ==============================================================================\nautomation:\n  - alias: \"Notify: Car Status\"\n    id: notify_car_status_glc\n    description: \"Manages mobile notifications for critical car events including charging status, pre-conditioning, tire pressure warnings, and fluid levels. Uses the 'notify_smart_master' script.\"\n    trigger:\n      - entity_id: binary_sensor.car_charge_plug\n        from: \"off\"\n        to: \"on\"\n        id: plug_in\n        platform: state\n      - entity_id: binary_sensor.[LICENSE_PLATE]_charging_active\n        from: \"off\"\n        to: \"on\"\n        id: charging_start\n        platform: state\n      - entity_id: sensor.[LICENSE_PLATE]_state_of_charge\n        above: 99\n        id: charging_full\n        platform: numeric_state\n      - entity_id: binary_sensor.[LICENSE_PLATE]_preclimate_status\n        from: \"off\"\n        to: \"on\"\n        id: climate_started\n        platform: state\n      - entity_id: binary_sensor.[LICENSE_PLATE]_preclimate_status\n        from: \"on\"\n        to: \"off\"\n        id: climate_stopped\n        platform: state\n      - entity_id: binary_sensor.[LICENSE_PLATE]_tire_warning\n        to: \"on\"\n        id: warn_tire\n        platform: state\n      - entity_id: binary_sensor.[LICENSE_PLATE]_low_brake_fluid_warning\n        to: \"on\"\n        id: warn_brake\n        platform: state\n      - entity_id: binary_sensor.[LICENSE_PLATE]_low_coolant_level_warning\n        to: \"on\"\n        id: warn_coolant\n        platform: state\n      - entity_id: binary_sensor.[LICENSE_PLATE]_low_wash_water_warning\n        to: \"on\"\n        id: warn_wash_water\n        platform: state\n    action:\n      - choose:\n          - conditions:\n              - condition: trigger\n                id: charging_start\n            sequence:\n              - wait_for_trigger:\n                  - entity_id: sensor.[LICENSE_PLATE]_charging_power\n                    above: 0\n                    platform: numeric_state\n                timeout: \"00:02:00\"\n                continue_on_timeout: true\n      - variables:\n          notification_data: |\n            {% if trigger.id == 'plug_in' %}\n              {\n                \"title\": \"\ud83d\udd0c Car Connected\",\n                \"message\": \"Charging cable connected.\",\n                \"tag\": \"car_charging\",\n                \"critical\": false\n              }\n            {% elif trigger.id == 'charging_start' %}\n              {% set power = states('sensor.[LICENSE_PLATE]_charging_power') %}\n              {% set raw_end = state_attr('sensor.[LICENSE_PLATE]_end_of_charge', 'original_value') %}\n\n              {# Convert raw timestamp to HH:MM format (Local Time) #}\n              {% if raw_end not in ['unknown', 'unavailable', None] %}\n                  {% set end_time = as_timestamp(raw_end) | timestamp_custom('%H:%M') %}\n              {% else %}\n                  {% set end_time = 'Calculating...' %}\n              {% endif %}\n\n              {\n                \"title\": \"\u26a1 Car Charging Started\",\n                \"message\": \"Charging at {{ power }} kW. Ready by: {{ end_time }}\",\n                \"tag\": \"car_charging\",\n                \"critical\": false\n              }\n            {% elif trigger.id == 'charging_full' %}\n              {% set range = states('sensor.[LICENSE_PLATE]_range_electric') %}\n              {\n                \"title\": \"\ud83d\udd0b Car Fully Charged\",\n                \"message\": \"Battery is 100%. Range: {{ range }} km.\",\n                \"tag\": \"car_charging\",\n                \"critical\": false\n              }\n            {% elif trigger.id == 'climate_started' %}\n              {\n                \"title\": \"\ud83d\ude97 Car Climate\",\n                \"message\": \"Pre-conditioning has started.\",\n                \"tag\": \"car_climate\",\n                \"critical\": false\n              }\n            {% elif trigger.id == 'climate_stopped' %}\n              {\n                \"title\": \"\ud83d\ude97 Car Climate\",\n                \"message\": \"Pre-conditioning finished.\",\n                \"tag\": \"car_climate\",\n                \"critical\": false\n              }\n            {% elif trigger.id == 'warn_tire' %}\n              {\n                \"title\": \"\u26a0\ufe0f Car Warning\",\n                \"message\": \"Check Tire Pressure!\",\n                \"tag\": \"car_warning\",\n                \"critical\": false\n              }\n            {% elif trigger.id == 'warn_brake' %}\n              {\n                \"title\": \"\ud83d\udea8 Car Critical\",\n                \"message\": \"Low Brake Fluid Warning! Check immediately.\",\n                \"tag\": \"car_warning\",\n                \"critical\": true\n              }\n            {% elif trigger.id == 'warn_coolant' %}\n              {\n                \"title\": \"\u26a0\ufe0f Car Warning\",\n                \"message\": \"Low Coolant Level.\",\n                \"tag\": \"car_warning\",\n                \"critical\": true\n              }\n            {% elif trigger.id == 'warn_wash_water' %}\n              {\n                \"title\": \"\ud83d\udca7 Car Warning\",\n                \"message\": \"Low Washer Fluid Level.\",\n                \"tag\": \"car_warning\",\n                \"critical\": false\n              }\n            {% endif %}\n      - service: script.notify_smart_master\n        data:\n          category: car\n          title: \"{{ (notification_data | from_json).title }}\"\n          message: \"{{ (notification_data | from_json).message }}\"\n          tag: \"{{ (notification_data | from_json).tag }}\"\n          critical: \"{{ (notification_data | from_json).critical }}\"\n    mode: queued\n# ------------------------------------------------------------------------------\n# Changelog\n# ------------------------------------------------------------------------------\n# 2.0.3 (2025-12-07): Added Changelog footer.\n# 2.0.2 (2025-12-07): Added unique_id to automation for UI editing.\n# 2.0.1 (2025-12-07): Moved VIN to secrets. Updated automation description.\n# 2.0.0 (2025-12-07): Initial consolidation of Package A, B, and UI Automation.\n# ------------------------------------------------------------------------------\n</code></pre>","tags":["package","automated","car"]},{"location":"smart-home/packages/debug_script/","title":"Package: Debug Script","text":"","tags":["package","automated"]},{"location":"smart-home/packages/debug_script/#package-debug-script","title":"Package: Debug Script","text":"<p>Version: Unknown Description: No description provided.</p> <p></p>","tags":["package","automated"]},{"location":"smart-home/packages/debug_script/#executive-summary","title":"Executive Summary","text":"<p>No executive summary generated yet.</p>","tags":["package","automated"]},{"location":"smart-home/packages/debug_script/#process-description-non-technical","title":"Process Description (Non-Technical)","text":"<p>No detailed non-technical description generated yet.</p>","tags":["package","automated"]},{"location":"smart-home/packages/debug_script/#dashboard-connections","title":"Dashboard Connections","text":"<p>No specific entities detected to link.</p>","tags":["package","automated"]},{"location":"smart-home/packages/debug_script/#architecture-diagram","title":"Architecture Diagram","text":"<p>No architecture explanation generated yet.</p> <p>No architecture diagram generated yet.</p>","tags":["package","automated"]},{"location":"smart-home/packages/debug_script/#configuration-source-code","title":"Configuration (Source Code)","text":"<pre><code>script:\n  debug_mqtt_create_test:\n    alias: \"Debug: Create Test Entity\"\n    sequence:\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/switch/area_debug_test/config\"\n          payload: &gt;-\n            {\n              \"name\": \"Area Debug Switch\",\n              \"unique_id\": \"area_debug_switch_v1\",\n              \"command_topic\": \"area/debug/set\",\n              \"state_topic\": \"area/debug/state\",\n              \"availability_topic\": \"area/debug/availability\",\n              \"payload_available\": \"online\"\n            }\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"area/debug/availability\"\n          payload: \"online\"\n      - service: system_log.write\n        data:\n          message: \"Debug Script Ran: Published area_debug_test\"\n          level: warning\n</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/dishwasher/","title":"Package: Dishwasher","text":"","tags":["package","automated"]},{"location":"smart-home/packages/dishwasher/#package-dishwasher","title":"Package: Dishwasher","text":"<p>Version: 1.1.0 Description: Logic, sensors, flags, and automations for the LG Dishwasher. Handles normalization of LG ThinQ data, maintenance reminders, and leak detection.</p> <p></p>","tags":["package","automated"]},{"location":"smart-home/packages/dishwasher/#executive-summary","title":"Executive Summary","text":"<p>The Dishwasher package provides comprehensive integration for LG ThinQ dishwashers. It normalizes device states into user-friendly status messages (e.g., 'Running', 'Clean'), calculates human-readable remaining times, and manages maintenance schedules. Critical safety features include leak detection using an external sensor, triggering immediate alarms. This package ensures the dishwasher is not just a monitored appliance but an active participant in the smart home ecosystem.</p>","tags":["package","automated"]},{"location":"smart-home/packages/dishwasher/#process-description-non-technical","title":"Process Description (Non-Technical)","text":"","tags":["package","automated"]},{"location":"smart-home/packages/dishwasher/#how-it-works","title":"How It Works","text":"<ol> <li>Activity Monitoring: The system automatically detects when the dishwasher is powered on or running. It updates the status to \"Active\", making it visible on your dashboards.</li> <li>Cycle Notifications:<ul> <li>Started: When you start a cycle, you'll receive a notification on your phone estimating when the dishes will be ready.</li> <li>Finished: Once the cycle is complete, a \"Dishes are Clean\" notification arrives, detailing how long the cycle took.</li> </ul> </li> <li>Maintenance Reminders: The system tracks when a \"Machine Clean\" cycle is recommended by the manufacturer and flags it on your dashboard until you run the cleaning cycle.</li> <li>Leak Protection: Just like the smart water valve, this package monitors a dedicated leak sensor under the dishwasher. If water is detected, a critical alarm is triggered to prevent damage.</li> </ol>","tags":["package","automated"]},{"location":"smart-home/packages/dishwasher/#dashboard-connections","title":"Dashboard Connections","text":"<p>This package powers the following dashboard views:</p> <ul> <li>Home: The Home dashboard serves as the central information hub. It features a large clock and family calendars, alongside detailed weather forecasts. Key home stats are highlighted, including real-time energy prices, power usage, and the status of major appliances like the dishwasher and washing machine. The view also provides a high-level overview of the entire house, displaying camera feeds and status summaries for all key rooms (Sauna, Bathroom, Bedroom, etc.) using 'Streamline' area cards. (Uses 2 entities)</li> <li>Kitchen: This view offers comprehensive control over the Kitchen. It monitors critical appliances, showing the status of the fridge (door/leak), coffee machine, and detailed cycle information for the dishwasher. Lighting controls allow for general switching or individual bulb adjustments. A key feature is the visualization of zoned presence detection (Entrance, Table, Cooking) using FP2 sensors, enabling highly granular kitchen automations. (Uses 6 entities)</li> </ul>","tags":["package","automated"]},{"location":"smart-home/packages/dishwasher/#architecture-diagram","title":"Architecture Diagram","text":"<p>The system operates on an event-driven model. When the <code>LG Dishwasher</code> updates its Internal State, Home Assistant immediately normalizes this into a uniform <code>Dishwasher Active</code> binary sensor. If the cycle is 'Running', the system calculates the estimated completion time and notifies the users. A parallel logic stream monitors the <code>Leak Sensor</code> continuously; if water is detected, it bypasses the standard notification queue and triggers an immediate 'Critical Alarm' to the mobile app, ensuring rapid response to potential flooding.</p> <pre><code>sequenceDiagram\n    participant Dishwasher as LG Dishwasher\n    participant HA as Home Assistant\n    participant User as User (Mobile)\n    participant Leak as Leak Sensor\n\n    Dishwasher-&gt;&gt;HA: Status Change (Initial -&gt; Running)\n    HA-&gt;&gt;HA: Normalize Status &amp; Calculate Time\n    HA-&gt;&gt;User: Notify \"Dishwasher Started\" (Est. Time)\n\n    Dishwasher-&gt;&gt;HA: Status Change (Running -&gt; End)\n    HA-&gt;&gt;User: Notify \"Dishes are Clean\" (Run Time)\n\n    Dishwasher-&gt;&gt;HA: Maintenance Signal (Machine Clean)\n    HA-&gt;&gt;HA: Set Flag 'Dishwasher Needs Cleaning'\n    loop Until Cleaned\n        HA-&gt;&gt;User: Dashboard Alert\n    end\n\n    Dishwasher-&gt;&gt;HA: Cycle 'Machine Clean' Started\n    HA-&gt;&gt;HA: Clear Flag 'Dishwasher Needs Cleaning'\n\n    Leak-&gt;&gt;HA: Water Detected (On)\n    HA-&gt;&gt;User: CRITICAL ALARM \"Leak Detected!\"</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/dishwasher/#configuration-source-code","title":"Configuration (Source Code)","text":"<pre><code># ------------------------------------------------------------------------------\n# Package: Dishwasher\n# Version: 1.1.0\n# Description: Logic, sensors, flags, and automations for the LG Dishwasher. Handles normalization of LG ThinQ data, maintenance reminders, and leak detection.\n# Dependencies:\n#   - Integration: LG ThinQ (SmartThinQ LGE Sensors)\n#   - Entity: binary_sensor.kitchen_dishwasher_leak_sensor_water_leak\n#   - Script: script.notify_smart_master\n# ------------------------------------------------------------------------------\n\n# ==============================================================================\n# 1. HELPERS\n# ==============================================================================\ninput_boolean:\n  # Flag: Tracks if the 'Machine Clean' cycle is due.\n  # Logic:\n  #   - Turned ON by automation when 'binary_sensor.dishwasher_machine_clean_reminder' goes high.\n  #   - Turned OFF by automation when a 'machine_clean' cycle is actually started.\n  dishwasher_needs_cleaning:\n    name: \"Dishwasher Needs Cleaning\"\n    icon: mdi:spray-bottle\n\n# ==============================================================================\n# 2. TEMPLATE SENSORS (Normalize the LG Data)\n# ==============================================================================\ntemplate:\n  - binary_sensor:\n      - name: \"Dishwasher Active\"\n        unique_id: dishwasher_active_normalized\n        state: &gt;\n          {{ states('sensor.dishwasher_current_status') not in ['unavailable', 'unknown', 'initial', 'power_off'] }}\n        icon: mdi:dishwasher\n\n      - name: \"Dishwasher Door Open\"\n        unique_id: dishwasher_door_normalized\n        device_class: door\n        state: &gt;\n          {{ is_state('binary_sensor.dishwasher_door', 'on') }}\n\n  - sensor:\n      - name: \"Dishwasher Status Clean\"\n        unique_id: dishwasher_status_clean\n        icon: mdi:dishwasher\n        state: &gt;\n          {% set status = states('sensor.dishwasher_current_status') %}\n          {% if status in ['unavailable', 'unknown', 'power_off'] %}\n            Off\n          {% else %}\n            {{ status | replace('_', ' ') | title }}\n          {% endif %}\n\n      - name: \"Dishwasher Remaining Time Human\"\n        unique_id: dishwasher_remaining_time_human\n        icon: mdi:timer-outline\n        state: &gt;\n          {% set finish_time = states('sensor.dishwasher_remaining_time') %}\n          {% if finish_time in ['unavailable', 'unknown', 'none'] %}\n            --:--\n          {% else %}\n            {# Calculate difference between finish time and now #}\n            {% set time_diff = as_timestamp(finish_time) - as_timestamp(now()) %}\n            {% if time_diff &gt; 0 %}\n              {# Convert seconds to H:MM #}\n              {{ time_diff | timestamp_custom('%-H:%M', false) }}\n            {% else %}\n              0:00\n            {% endif %}\n          {% endif %}\n\n# ==============================================================================\n# 3. AUTOMATIONS\n# ==============================================================================\nautomation:\n  # --- DISHWASHER STARTED ---\n  # Notify when the dishwasher starts, with a wait for the time remaining sensor.\n  - alias: \"Notify: Dishwasher Started\"\n    id: notify_dishwasher_started_pkg\n    description: Notify when dishwasher starts a cycle, waiting for time remaining to be available.\n    trigger:\n      - entity_id: sensor.dishwasher_current_status\n        from: initial\n        to: running\n        platform: state\n      - entity_id: sensor.dishwasher_current_status\n        from: power_off\n        to: running\n        platform: state\n    action:\n      # Wait up to 2 minutes for a valid time from the sensor.\n      - wait_for_trigger:\n          - platform: template\n            value_template: &gt;\n              {{ states('sensor.dishwasher_remaining_time_human') not in ['unknown', 'unavailable', '--:--'] }}\n        timeout:\n          minutes: 2\n        continue_on_timeout: true\n\n      - service: script.notify_smart_master\n        data:\n          category: info\n          title: \ud83d\udca6 Dishwasher Started\n          # Use a conditional message in case the wait timed out.\n          message: &gt;\n            {% set remaining = states('sensor.dishwasher_remaining_time_human') %}\n            {% if remaining not in ['unknown', 'unavailable', '--:--'] %}\n              Cycle: {{ states('sensor.dishwasher_current_cycle') | replace('_', ' ') | title }}\n              Ready in: {{ remaining }} hours.\n            {% else %}\n              Dishwasher started. Time remaining not yet available.\n            {% endif %}\n          tag: dishwasher\n          clickAction: /lovelace/kitchen\n    mode: single\n\n  # --- DISHWASHER DONE ---\n  # Notify when dishwasher finishes. Triggers if door opens while status is 'end'.\n  - alias: \"Notify: Dishwasher Done\"\n    id: notify_dishwasher_done_pkg\n    description: Notify when dishwasher finishes, including run time.\n    trigger:\n      - entity_id: sensor.dishwasher_current_status\n        to: end\n        id: cycle_end\n        platform: state\n      - entity_id: binary_sensor.dishwasher_door\n        from: \"off\"\n        to: \"on\"\n        id: door_open\n        platform: state\n    condition:\n      - condition: or\n        conditions:\n          - condition: trigger\n            id: cycle_end\n          - condition: and\n            conditions:\n              - condition: trigger\n                id: door_open\n              - condition: state\n                entity_id: sensor.dishwasher_current_status\n                state: end\n    action:\n      # Calculate run time, handling unknown values safely.\n      - variables:\n          run_time_raw: \"{{ states('sensor.dishwasher_total_time') }}\"\n          run_time: |-\n            {% if run_time_raw not in ['unknown', 'unavailable', 'none'] %}\n              {{ run_time_raw }} min\n            {% else %}\n              Unknown time\n            {% endif %}\n      - service: script.notify_smart_master\n        data:\n          category: info\n          title: \u2728 Dishes are Clean\n          message: \"The cycle has finished. Total run time: {{ run_time }}.\"\n          tag: dishwasher\n          clickAction: app://com.lgeha.nuts\n          actions:\n            - action: URI\n              title: Open LG App\n              uri: app://com.lgeha.nuts\n    mode: single\n\n  # --- DISHWASHER MAINTENANCE ---\n  # Alerts when machine clean is needed and resets the flag when a clean cycle is started.\n  - alias: \"Notify: Dishwasher Maintenance\"\n    id: notify_dishwasher_maintenance_pkg\n    description: Alerts when machine clean is needed and resets when done.\n    trigger:\n      - entity_id: binary_sensor.dishwasher_machine_clean_reminder\n        to: \"on\"\n        id: needs_clean\n        platform: state\n      - entity_id: sensor.dishwasher_current_cycle\n        to: machine_clean\n        id: clean_cycle_started\n        platform: state\n    action:\n      - choose:\n          # Case 1: Reminder turns ON and we haven't acknowledged it yet.\n          - conditions:\n              - condition: trigger\n                id: needs_clean\n              - condition: state\n                entity_id: input_boolean.dishwasher_needs_cleaning\n                state: \"off\"\n            sequence:\n              - service: input_boolean.turn_on\n                target:\n                  entity_id: input_boolean.dishwasher_needs_cleaning\n              - service: script.notify_smart_master\n                data:\n                  category: info\n                  title: \ud83e\uddfc Dishwasher Maintenance\n                  message: The dishwasher needs a Machine Clean cycle.\n                  tag: dishwasher_maintenance\n                  sticky: true\n          # Case 2: A 'machine_clean' cycle is started, so we reset the flag.\n          - conditions:\n              - condition: trigger\n                id: clean_cycle_started\n            sequence:\n              - service: input_boolean.turn_off\n                target:\n                  entity_id: input_boolean.dishwasher_needs_cleaning\n    mode: single\n\n  # --- DISHWASHER LEAK DETECTION ---\n  # Critical alarm if the external leak sensor detects water.\n  - alias: \"Notify: Dishwasher Leak\"\n    id: notify_dishwasher_leak_pkg\n    description: Critical alarm triggered by the kitchen leak sensor.\n    trigger:\n      - platform: state\n        entity_id: binary_sensor.kitchen_dishwasher_leak_sensor_water_leak\n        to: \"on\"\n    action:\n      - service: script.notify_smart_master\n        data:\n          category: alarm\n          title: \"\ud83d\udca7 Dishwasher Leak Detected!\"\n          message: \"CRITICAL: Water detected under the dishwasher. Check immediately!\"\n          tag: dishwasher_leak\n          critical: true\n          sticky: true\n          clickAction: /lovelace/kitchen\n    mode: single\n# ------------------------------------------------------------------------------\n# Changelog\n# ------------------------------------------------------------------------------\n# 1.1.0 (2025-12-09): Added critical leak detection automation.\n# 1.0.0 (2025-12-07): Initial package creation with status, time logic, and maintenance reminders.\n# ------------------------------------------------------------------------------\n</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/dna_tv_hub/","title":"Package: Dna Tv Hub","text":"","tags":["package","automated"]},{"location":"smart-home/packages/dna_tv_hub/#package-dna-tv-hub","title":"Package: Dna Tv Hub","text":"<p>Version: 1.0.0 Description: Template switch for DNA TV Hub remote control</p> <p></p>","tags":["package","automated"]},{"location":"smart-home/packages/dna_tv_hub/#executive-summary","title":"Executive Summary","text":"<p>This package creates a simplified \"Master Switch\" for the DNA TV Hub, wrapping the underlying remote control commands into a single boolean entity. This allows the TV Hub to be treated like a standard appliance (On/Off) in dashboards and voice commands, abstrating the complexity of the remote service calls.</p>","tags":["package","automated"]},{"location":"smart-home/packages/dna_tv_hub/#process-description-non-technical","title":"Process Description (Non-Technical)","text":"<ol> <li>Switch Action: When you toggle the \"DNA TV HUB\" switch on the dashboard.</li> <li>Service Call: The system translates this into a <code>remote.turn_on</code> or <code>remote.turn_off</code> command sent to the specific hub device.</li> <li>State Feedback: The switch icon lights up based on the actual state reported by the device, establishing a two-way sync.</li> </ol>","tags":["package","automated"]},{"location":"smart-home/packages/dna_tv_hub/#dashboard-connections","title":"Dashboard Connections","text":"<p>No specific entities detected to link.</p>","tags":["package","automated"]},{"location":"smart-home/packages/dna_tv_hub/#architecture-diagram","title":"Architecture Diagram","text":"<p>The architecture is a simple wrapper pattern. The Template Switch sits between the User and the Remote entity. It intercepts the On/Off intent and routes it to the correct service call, while simultaneously reflecting the Remote's state back to the UI.</p> <pre><code>sequenceDiagram\n    participant User as Dashboard\n    participant Switch as Template Switch\n    participant Remote as Remote Service\n    participant Device as DNA TV Hub\n\n    User-&gt;&gt;Switch: Toggle ON\n    Switch-&gt;&gt;Remote: Call remote.turn_on\n    Remote-&gt;&gt;Device: Send IR/IP Command\n    Device--&gt;&gt;Remote: Report State \"On\"\n    Remote--&gt;&gt;Switch: Update State \"On\"</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/dna_tv_hub/#configuration-source-code","title":"Configuration (Source Code)","text":"<pre><code># ------------------------------------------------------------------------------\n# Package: DNA TV Hub\n# Version: 1.0.0\n# Description: Template switch for DNA TV Hub remote control\n# Dependencies: remote.dna_tv_hub\n# ------------------------------------------------------------------------------\ntemplate:\n  - switch:\n      - name: \"DNA TV HUB\"\n        unique_id: dna_tv_hub\n        icon: mdi:television\n        state: \"{{ is_state('remote.dna_tv_hub', 'on') }}\"\n        turn_on:\n          service: remote.turn_on\n          target:\n            entity_id: remote.dna_tv_hubi\n        turn_off:\n          service: remote.turn_off\n          target:\n            entity_id: remote.dna_tv_hubi\n</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/garmin/","title":"Package: Garmin","text":"","tags":["package","automated"]},{"location":"smart-home/packages/garmin/#package-garmin","title":"Package: Garmin","text":"<p>Version: 1.0.0 Description: Placeholder for Garmin integration</p> <p></p>","tags":["package","automated"]},{"location":"smart-home/packages/garmin/#executive-summary","title":"Executive Summary","text":"<p>This package is currently a placeholder for future Garmin wearable integration. It is intended to bridge health and activity data (e.g., Body Battery, Sleep Score) into Home Assistant for use in morning routines and \"Well-being\" dashboards.</p>","tags":["package","automated"]},{"location":"smart-home/packages/garmin/#process-description-non-technical","title":"Process Description (Non-Technical)","text":"<p>No active logic is currently implemented.</p>","tags":["package","automated"]},{"location":"smart-home/packages/garmin/#dashboard-connections","title":"Dashboard Connections","text":"<p>No specific entities detected to link.</p>","tags":["package","automated"]},{"location":"smart-home/packages/garmin/#architecture-diagram","title":"Architecture Diagram","text":"<p>Architecture pending implementation.</p> <p>No diagram available.</p>","tags":["package","automated"]},{"location":"smart-home/packages/garmin/#configuration-source-code","title":"Configuration (Source Code)","text":"<pre><code># ------------------------------------------------------------------------------\n# Package: Garmin\n# Version: 1.0.0\n# Description: Placeholder for Garmin integration\n# Dependencies: None\n# ------------------------------------------------------------------------------\n</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/home_time_modes/","title":"Package: Home Time Modes","text":"","tags":["package","automated"]},{"location":"smart-home/packages/home_time_modes/#package-home-time-modes","title":"Package: Home Time Modes","text":"<p>Version: 1.0.0 Description: Parametric Time-of-Day Logic</p> <p></p>","tags":["package","automated"]},{"location":"smart-home/packages/home_time_modes/#executive-summary","title":"Executive Summary","text":"<p>This package implements a robust \"State Machine\" for the home's time-of-day logic. Unlike simple time triggers, it defines discrete modes (Morning, Day, Evening, Night) and transitions between them based on a configurable mix of fixed times and dynamic solar events (Sunset). This central \"Home Mode\" is then used by all other automations (Lighting, Healing, Security) to determine behavior, ensuring synchronization across the entire smart home.</p>","tags":["package","automated"]},{"location":"smart-home/packages/home_time_modes/#process-description-non-technical","title":"Process Description (Non-Technical)","text":"<ol> <li>Triggers: The system watches the clock and the sun position.</li> <li>Logic Check:<ul> <li>Morning/Day/Night: Switches at specific times you set in the dashboard (e.g., 06:30, 09:00, 23:00).</li> <li>Evening: Can be set to a fixed time (e.g., 18:00) OR dynamically follow the sunset (e.g., \"Sunset minus 30 minutes\" to draw blinds before it gets dark).</li> </ul> </li> <li>Action: Updates the global \"Home Time Mode\" setting, which effectively tells the rest of the house what \"phase\" of the day it is.</li> </ol>","tags":["package","automated"]},{"location":"smart-home/packages/home_time_modes/#dashboard-connections","title":"Dashboard Connections","text":"<p>This package powers the following dashboard views:</p> <ul> <li>System: This view provides deep insights into the Proxmox 'Halo' virtualization node. It features real-time resource monitoring (CPU, RAM) using <code>mini-graph-card</code>, and critical power controls (Reboot, Shutdown) protected by confirmation dialogs. It also offers bulk management for guest VMs/containers and tracks system update status, ensuring the infrastructure host is healthy and up-to-date. (Uses 1 entities)</li> </ul>","tags":["package","automated"]},{"location":"smart-home/packages/home_time_modes/#architecture-diagram","title":"Architecture Diagram","text":"<p>The core component is a single automation (<code>system_manager_home_time_modes</code>) acting as a central controller. It subscribes to multiple triggers (Time, Sun). When triggered, it evaluates a <code>Choose</code> block to determine the correct target state. The unique feature is the \"Evening Strategy\" logic, which branches to handle either fixed formatting or solar calculations with offsets before committing the state change to the <code>input_select.house_mode</code> entity.</p> <pre><code>sequenceDiagram\n    participant Clock\n    participant Sun\n    participant Automation as Logic Manager\n    participant State as Input Select (House Mode)\n\n    rect rgb(240, 248, 255)\n    Note over Clock, State: Fixed Transitions\n    Clock-&gt;&gt;Automation: Trigger 06:30\n    Automation-&gt;&gt;State: Set \"Morning\"\n    end\n\n    rect rgb(255, 250, 240)\n    Note over Clock, State: Dynamic Transitions\n    Sun-&gt;&gt;Automation: Sunset Event\n    Automation-&gt;&gt;Automation: Check Strategy (Sunset + Offset?)\n    Automation-&gt;&gt;Automation: Apply Delay (-30min)\n    Automation-&gt;&gt;State: Set \"Evening\"\n    end</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/home_time_modes/#configuration-source-code","title":"Configuration (Source Code)","text":"<pre><code># ------------------------------------------------------------------------------\n# Package: Home Time Modes\n# Version: 1.0.0\n# Description: Parametric Time-of-Day Logic\n# Dependencies: input_datetime, sun.sun\n# ------------------------------------------------------------------------------\n# ------------------------------------------------------------------------------\n# 1. SETTINGS (Editable from Dashboard)\n# ------------------------------------------------------------------------------\ninput_datetime:\n  mode_time_morning:\n    name: \"Morning Start Time\"\n    has_date: false\n    has_time: true\n    initial: \"06:30\"\n\n  mode_time_day:\n    name: \"Day Start Time\"\n    has_date: false\n    has_time: true\n    initial: \"09:00\"\n\n  mode_time_evening_fixed:\n    name: \"Evening Fixed Time\"\n    has_date: false\n    has_time: true\n    initial: \"18:00\"\n\n  mode_time_night:\n    name: \"Night Start Time\"\n    has_date: false\n    has_time: true\n    initial: \"23:00\"\n\ninput_select:\n  # RENAMED: Clearer distinction\n  house_mode:\n    name: \"Home Time Mode\"\n    icon: mdi:home-clock\n    options:\n      - Morning\n      - Day\n      - Evening\n      - Night\n\n  mode_evening_strategy:\n    name: \"Evening Strategy\"\n    icon: mdi:weather-sunset\n    options:\n      - \"Fixed Time\"\n      - \"Sunset + Offset\"\n\ninput_number:\n  mode_evening_sun_offset:\n    name: \"Sunset Offset (Minutes)\"\n    icon: mdi:timer-sand\n    min: -120\n    max: 120\n    step: 10\n    unit_of_measurement: min\n    mode: box\n\n# ------------------------------------------------------------------------------\n# 2. LOGIC\n# ------------------------------------------------------------------------------\nautomation:\n  - alias: \"System: Manager Home Time Modes\"\n    id: system_manager_home_time_modes\n    mode: restart\n    trigger:\n      # Trigger on Time Inputs\n      - platform: time\n        at: input_datetime.mode_time_morning\n        id: \"Morning\"\n      - platform: time\n        at: input_datetime.mode_time_day\n        id: \"Day\"\n      - platform: time\n        at: input_datetime.mode_time_night\n        id: \"Night\"\n      - platform: time\n        at: input_datetime.mode_time_evening_fixed\n        id: \"Evening_Fixed\"\n\n      # Trigger on Sun\n      - platform: sun\n        event: sunset\n        id: \"Evening_Sun\"\n\n      # Failsafe\n      - platform: time_pattern\n        minutes: \"/15\"\n        id: \"Heartbeat\"\n\n    action:\n      - choose:\n          # --- MORNING ---\n          - conditions:\n              - condition: trigger\n                id: \"Morning\"\n            sequence:\n              - service: input_select.select_option\n                target:\n                  entity_id: input_select.house_mode\n                data: { option: \"Morning\" }\n\n          # --- DAY ---\n          - conditions:\n              - condition: trigger\n                id: \"Day\"\n            sequence:\n              - service: input_select.select_option\n                target:\n                  entity_id: input_select.house_mode\n                data: { option: \"Day\" }\n\n          # --- NIGHT ---\n          - conditions:\n              - condition: trigger\n                id: \"Night\"\n            sequence:\n              - service: input_select.select_option\n                target:\n                  entity_id: input_select.house_mode\n                data: { option: \"Night\" }\n\n          # --- EVENING (Complex Logic) ---\n          - conditions:\n              - condition: or\n                conditions:\n                  # Fixed Strategy\n                  - condition: and\n                    conditions:\n                      - condition: trigger\n                        id: \"Evening_Fixed\"\n                      - condition: state\n                        entity_id: input_select.mode_evening_strategy\n                        state: \"Fixed Time\"\n                  # Sun Strategy\n                  - condition: and\n                    conditions:\n                      - condition: trigger\n                        id: \"Evening_Sun\"\n                      - condition: state\n                        entity_id: input_select.mode_evening_strategy\n                        state: \"Sunset + Offset\"\n            sequence:\n              # Handle Offset\n              - if:\n                  - condition: state\n                    entity_id: input_select.mode_evening_strategy\n                    state: \"Sunset + Offset\"\n                then:\n                  - delay:\n                      minutes: \"{{ states('input_number.mode_evening_sun_offset') | int(0) }}\"\n\n              - service: input_select.select_option\n                target:\n                  entity_id: input_select.house_mode\n                data: { option: \"Evening\" }\n</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/nordpool_prices/","title":"Package: Nordpool Prices","text":"","tags":["package","automated"]},{"location":"smart-home/packages/nordpool_prices/#package-nordpool-prices","title":"Package: Nordpool Prices","text":"<p>Version: 1.0.0 Description: Nordpool energy price calculations and logic</p> <p></p>","tags":["package","automated"]},{"location":"smart-home/packages/nordpool_prices/#executive-summary","title":"Executive Summary","text":"<p>This package handles the complex financial logic for electricity monitoring. It retrieves raw spot prices from Nordpool, applies configurable \"Transfers Costs,\" \"Taxes,\" and \"VAT,\" and produces a \"Final Real Cost\" per kWh. It also synchronizes price data with energy usage (kWh) to calculate precise 15-minute cost blocks, enabling accurate daily cost tracking that matches the utility bill. It includes forecasting logic to confirm if tomorrow's price data is valid and sufficiently complete (32nd lowest/highest prices).</p>","tags":["package","automated"]},{"location":"smart-home/packages/nordpool_prices/#process-description-non-technical","title":"Process Description (Non-Technical)","text":"<ol> <li>Get Price: Every hour, the system checks the current stock market price for electricity.</li> <li>Add Fees: It adds your specific transfer fees and taxes (configurable in dashboard) to get the \"Plug Price.\"</li> <li>Match Usage: Every 15 minutes, it takes your home energy meter reading and multiplies it by the exact price for that 15-minute window.</li> <li>Forecast: It analyzes tomorrow's prices to find the cheapest windows, useful for scheduling the washing machine or car charging.</li> </ol>","tags":["package","automated"]},{"location":"smart-home/packages/nordpool_prices/#dashboard-connections","title":"Dashboard Connections","text":"<p>This package powers the following dashboard views:</p> <ul> <li>Bathroom: This view manages the bathroom environment. It features a 'Streamline' header card summarizing key states (temperature, washing machine status, occupancy). Lighting controls allow separate adjustments for the sauna, table, and ceiling. A major focus is the smart floor heating system (Aqara W500), which includes a thermostat control, historical temperature graphs, and a dedicated timer automation for overriding default heating schedules. (Uses 1 entities)</li> <li>Electricity: The Electricity dashboard is a detailed analytics hub for home energy. It features sophisticated charts tracking today's and tomorrow's hourly electricity prices (Nordpool), dynamically color-coded based on daily highs and lows. It also monitors daily energy consumption and real-time power usage via Shelly 3EM, providing cost estimates and historical usage trends. (Uses 5 entities)</li> <li>Electricity Dev: This is a development view for the main Electricity dashboard, used for testing new chart configurations and layouts (Panel mode). It replicates the core pricing and usage visualizations but may contain experimental features or alternative display styles like vertical stacks. (Uses 1 entities)</li> <li>Home: The Home dashboard serves as the central information hub. It features a large clock and family calendars, alongside detailed weather forecasts. Key home stats are highlighted, including real-time energy prices, power usage, and the status of major appliances like the dishwasher and washing machine. The view also provides a high-level overview of the entire house, displaying camera feeds and status summaries for all key rooms (Sauna, Bathroom, Bedroom, etc.) using 'Streamline' area cards. (Uses 2 entities)</li> </ul>","tags":["package","automated"]},{"location":"smart-home/packages/nordpool_prices/#architecture-diagram","title":"Architecture Diagram","text":"<p>The data flow is heavy on Template Sensors. The <code>nordpool</code> service fetches raw data. A Template Sensor (<code>electricity_prices</code>) enriches this with tax/fees. A crucial synchronous logical step happens every 15 minutes: The <code>Energy Cost Final</code> sensor triggers on energy meter resets, looks up the historical price for the just-finished block (15-min alignment), and computes the cost. This ensures that energy used at 13:59 is charged at the 13:00 price, not the 14:00 price.</p> <pre><code>sequenceDiagram\n    participant Cloud as Nordpool API\n    participant HA as Home Assistant\n    participant Meter as Shelly Energy\n    participant DB as Cost Database\n\n    Cloud-&gt;&gt;HA: Raw Prices (c/kWh)\n    HA-&gt;&gt;HA: Apply Tax &amp; Transfer Config\n    Meter-&gt;&gt;HA: Report 15min Usage (kWh)\n    HA-&gt;&gt;HA: Smart Lookback (Find Price for 13:45-14:00)\n    HA-&gt;&gt;HA: Calculate Cost (Price * Usage)\n    HA-&gt;&gt;DB: Record Cost Block</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/nordpool_prices/#configuration-source-code","title":"Configuration (Source Code)","text":"<pre><code># ------------------------------------------------------------------------------\n# Package: Nordpool Prices\n# Version: 1.0.0\n# Description: Nordpool energy price calculations and logic\n# Dependencies: nordpool.get_prices_for_date, sensor.shelly_home_energy_15min\n# ------------------------------------------------------------------------------\n# ------------------------------------------------------------------------------\n# 2. INPUT BOOLEANS (Flags &amp; Maintenance)\n# ------------------------------------------------------------------------------\ninput_boolean:\n  # Energy Prices: Sent flag\n  notify_flag_energy_tomorrow_sent:\n    name: \"Energy: Tomorrow Prices Sent\"\n    icon: mdi:checkbox-marked-circle-outline\n\ntemplate:\n  - triggers:\n      - platform: time_pattern\n        minutes: \"0\"\n      - platform: homeassistant\n        event: start\n\n    actions:\n      - alias: \"Fetch Today's Prices\"\n        service: nordpool.get_prices_for_date\n        data:\n          config_entry: 01K72AW80S016AZ3CPD6R2062J\n          date: \"{{ now().date() }}\"\n          areas: FI\n          currency: EUR\n        response_variable: today_price\n\n      - alias: \"Fetch Tomorrow's Prices\"\n        service: nordpool.get_prices_for_date\n        data:\n          config_entry: 01K72AW80S016AZ3CPD6R2062J\n          date: \"{{ now().date() + timedelta(days=1) }}\"\n          areas: FI\n          currency: EUR\n        response_variable: tomorrow_price\n\n    sensor:\n      - name: Electricity prices\n        unique_id: electricity_prices\n        unit_of_measurement: \"c/kWh\"\n        icon: mdi:cash\n        state: &gt;\n          {%- set region = (this.attributes.get('region', 'FI') | string) -%}\n          {%- set tax = (this.attributes.get('tax', 1.0) | float) -%}\n          {%- set additional_cost = (this.attributes.get('additional_cost', 0.0) | float) -%}\n\n          {% if (today_price is mapping) and (tomorrow_price is mapping) %}\n            {% set data = namespace(prices=[]) %}\n            {% for state in today_price[region] %}\n              {% set data.prices = data.prices + [(((state.price/10 | float)  * tax + additional_cost)) | round(3, default=0)] %}\n            {% endfor %}\n            {% for state in tomorrow_price[region] %}\n              {% set data.prices = data.prices + [(((state.price/10 | float) * tax + additional_cost)) | round(3, default=0)] %}\n            {% endfor %}\n            {{min(data.prices)}}\n          {% else %}\n            unavailable\n          {% endif %}\n        attributes:\n          tomorrow_valid: &gt;\n            {%- set region = (this.attributes.get('region', 'FI') | string) -%}\n            {%- if (tomorrow_price is mapping) %}\n              {%- if tomorrow_price[region] | list | count &gt; 0 -%}\n                {{ true | bool }}\n              {%- else %}\n                {{ false | bool }}\n              {%- endif %}\n            {%- else %}\n              {{ false | bool }}\n            {%- endif %}\n          data: &gt;\n            {%- set region = (this.attributes.get('region', 'FI') | string) -%}\n            {%- set tax = (this.attributes.get('tax', 1.0) | float) -%}\n            {%- set additional_cost = (this.attributes.get('additional_cost', 0.0) | float) -%}\n\n            {% if (today_price is mapping) and (tomorrow_price is mapping) %}\n            {% set data = namespace(prices=[]) %}\n              {% for state in today_price[region] %}\n                {% set local_start = as_datetime(state.start).astimezone().strftime('%Y-%m-%d %H:%M:%S') %}\n                {% set local_end = as_datetime(state.end).astimezone().strftime('%Y-%m-%d %H:%M:%S') %}\n                {% set data.prices = data.prices + [{'start':local_start, 'end':local_end, 'price': (((state.price/10 | float) * tax + additional_cost)) | round(3, default=0)}] %}\n              {% endfor %}\n              {% for state in tomorrow_price[region] %}\n                {% set local_start = as_datetime(state.start).astimezone().strftime('%Y-%m-%d %H:%M:%S') %}\n                {% set local_end = as_datetime(state.end).astimezone().strftime('%Y-%m-%d %H:%M:%S') %}\n                {% set data.prices = data.prices + [{'start':local_start, 'end':local_end, 'price': (((state.price/10 | float) * tax + additional_cost)) | round(3, default=0)}] %}\n              {% endfor %}\n              {{data.prices}}\n            {% else %}\n              []\n            {% endif %}\n          tax: \"1\"\n          additional_cost: \"0\"\n          region: FI\n\n  - sensor:\n      - name: \"Electricity Price (cents)\"\n        unique_id: electricity_price_cents\n        unit_of_measurement: \"c/kWh\"\n        state_class: measurement\n        state: &gt;\n          {{ (states('sensor.electricity_prices') | float(0) * 100) | round(1) }}\n\n  - sensor:\n      - name: \"Electricity Daily Average (cents)\"\n        unique_id: electricity_daily_average_cents\n        unit_of_measurement: \"c/kWh\"\n        state_class: measurement\n        state: &gt;\n          {{ (states('sensor.nord_pool_fi_daily_average') | float(0) * 100) | round(1) }}\n\n  - sensor:\n      - name: \"Electricity Today 32nd Lowest Price\"\n        unique_id: electricity_today_32nd_lowest\n        unit_of_measurement: \"c/kWh\"\n        availability: &gt;\n          {% set today = now().date().isoformat() %}\n          {% set entries = state_attr('sensor.electricity_prices', 'data') %}\n          {% if entries %}\n            {{ entries\n               | selectattr('start', 'defined')\n               | selectattr('start', 'string')\n               | selectattr('start', 'search', today)\n               | list\n               | count &gt;= 32 }}\n          {% else %}\n            {{ false }}\n          {% endif %}\n        state: &gt;\n          {% set today = now().date().isoformat() %}\n          {% set entries = state_attr('sensor.electricity_prices', 'data') %}\n          {% set today_prices = entries\n              | selectattr('start', 'defined')\n              | selectattr('start', 'string')\n              | selectattr('start', 'search', today)\n              | map(attribute='price')\n              | list %}\n          {% set sorted = today_prices | sort %}\n          {{ sorted[31] | round(2) }}\n\n  - sensor:\n      - name: \"Electricity Today 32nd Highest Price\"\n        unique_id: electricity_today_32nd_highest\n        unit_of_measurement: \"c/kWh\"\n        availability: &gt;\n          {% set today = now().date().isoformat() %}\n          {% set entries = state_attr('sensor.electricity_prices', 'data') %}\n          {% if entries %}\n            {{ entries\n               | selectattr('start', 'defined')\n               | selectattr('start', 'string')\n               | selectattr('start', 'search', today)\n               | list\n               | count &gt;= 32 }}\n          {% else %}\n            {{ false }}\n          {% endif %}\n        state: &gt;\n          {% set today = now().date().isoformat() %}\n          {% set entries = state_attr('sensor.electricity_prices', 'data') %}\n          {% set today_prices = entries\n              | selectattr('start', 'defined')\n              | selectattr('start', 'string')\n              | selectattr('start', 'search', today)\n              | map(attribute='price')\n              | list %}\n          {% set sorted = today_prices | sort(reverse=true) %}\n          {{ sorted[31] | round(2) }}\n\n  - sensor:\n      - name: \"Electricity Tomorrow Valid\"\n        unique_id: electricity_tomorrow_valid\n        state: &gt;\n          {{ state_attr('sensor.electricity_prices', 'tomorrow_valid') }}\n\n  - sensor:\n      - name: \"Electricity Tomorrow 32nd Lowest Price\"\n        unique_id: electricity_tomorrow_32nd_lowest\n        unit_of_measurement: \"c/kWh\"\n        availability: &gt;\n          {% set tomorrow = (now() + timedelta(days=1)).date().isoformat() %}\n          {% set entries = state_attr('sensor.electricity_prices', 'data') %}\n          {% if entries %}\n            {{ entries\n               | selectattr('start', 'defined')\n               | selectattr('start', 'string')\n               | selectattr('start', 'search', tomorrow)\n               | list\n               | count &gt;= 32 }}\n          {% else %}\n            {{ false }}\n          {% endif %}\n        state: &gt;\n          {% set tomorrow = (now() + timedelta(days=1)).date().isoformat() %}\n          {% set entries = state_attr('sensor.electricity_prices', 'data') %}\n          {% set tomorrow_prices = entries\n              | selectattr('start', 'defined')\n              | selectattr('start', 'string')\n              | selectattr('start', 'search', tomorrow)\n              | map(attribute='price')\n              | list %}\n          {% set sorted = tomorrow_prices | sort %}\n          {{ sorted[31] | round(2) }}\n\n  - sensor:\n      - name: \"Electricity Tomorrow 32nd Highest Price\"\n        unique_id: electricity_tomorrow_32nd_highest\n        unit_of_measurement: \"c/kWh\"\n        availability: &gt;\n          {% set tomorrow = (now() + timedelta(days=1)).date().isoformat() %}\n          {% set entries = state_attr('sensor.electricity_prices', 'data') %}\n          {% if entries %}\n            {{ entries\n               | selectattr('start', 'defined')\n               | selectattr('start', 'string')\n               | selectattr('start', 'search', tomorrow)\n               | list\n               | count &gt;= 32 }}\n          {% else %}\n            {{ false }}\n          {% endif %}\n        state: &gt;\n          {% set tomorrow = (now() + timedelta(days=1)).date().isoformat() %}\n          {% set entries = state_attr('sensor.electricity_prices', 'data') %}\n          {% set tomorrow_prices = entries\n              | selectattr('start', 'defined')\n              | selectattr('start', 'string')\n              | selectattr('start', 'search', tomorrow)\n              | map(attribute='price')\n              | list %}\n          {% set sorted = tomorrow_prices | sort(reverse=true) %}\n          {{ sorted[31] | round(2) }}\n\n  - sensor:\n      - name: \"Energy Cost 15min\"\n        unique_id: energy_cost_15min\n        unit_of_measurement: \"\u20ac\"\n        state_class: measurement\n        state: &gt;\n          {% set energy_kwh = states('sensor.shelly_home_energy_15min') | float(0) %}\n          {% set price_c = states('sensor.nord_pool_fi_current_price') | float(0) * 100 %}\n          {% set transfer_c = states('input_number.energy_transfer_fee') | float(0) %}\n          {% set tax_c = states('input_number.energy_tax_c_kwh') | float(0) %}\n          {% set vat_pct = states('input_number.energy_vat') | float(0) / 100 %}\n          {% set subtotal_c = price_c + transfer_c + tax_c %}\n          {% set cost_eur = (energy_kwh * subtotal_c / 100) * (1 + vat_pct) %}\n          {{ cost_eur | round(3) }}\n        attributes:\n          energy_kWh: \"{{ states('sensor.shelly_home_energy_15min') | float(0) | round(3) }}\"\n          spot_price_c_per_kWh: \"{{ (states('sensor.nord_pool_fi_current_price') | float(0) * 100) | round(2) }}\"\n          transfer_fee_c_per_kWh: \"{{ states('input_number.energy_transfer_fee') | float(0) | round(2) }}\"\n          energy_tax_c_per_kWh: \"{{ states('input_number.energy_tax_c_kwh') | float(0) | round(2) }}\"\n          vat_pct: \"{{ states('input_number.energy_vat') | float(0) | round(2) }}\"\n          subtotal_c_per_kWh: \"{{ ((states('sensor.nord_pool_fi_current_price') | float(0) * 100) + states('input_number.energy_transfer_fee') | float(0) + states('input_number.energy_tax_c_kwh') | float(0)) | round(2) }}\"\n          cost_eur: \"{{ ((states('sensor.shelly_home_energy_15min') | float(0) * ((states('sensor.nord_pool_fi_current_price') | float(0) * 100 + states('input_number.energy_transfer_fee') | float(0) + states('input_number.energy_tax_c_kwh') | float(0)) / 100)) * (1 + states('input_number.energy_vat') | float(0) / 100)) | round(3) }}\"\n\n  - sensor:\n      - name: \"Energy Cost 15min (c)\"\n        unique_id: energy_cost_15min_c\n        unit_of_measurement: \"c\"\n        state_class: measurement\n        state: &gt;\n          {% set energy_kwh = states('sensor.shelly_home_energy_15min') | float(0) %}\n          {% set price_c = states('sensor.nord_pool_fi_current_price') | float(0) * 100 %}\n          {% set transfer_c = states('input_number.energy_transfer_fee') | float(0) %}\n          {% set tax_c = states('input_number.energy_tax_c_kwh') | float(0) %}\n          {% set vat_pct = states('input_number.energy_vat') | float(0) / 100 %}\n          {% set subtotal_c = price_c + transfer_c + tax_c %}\n          {% set cost_c = energy_kwh * subtotal_c * (1 + vat_pct) %}\n          {{ cost_c | round(2) }}\n        attributes:\n          energy_kWh: \"{{ states('sensor.shelly_home_energy_15min') | float(0) | round(3) }}\"\n          spot_price_c_per_kWh: \"{{ (states('sensor.nord_pool_fi_current_price') | float(0) * 100) | round(2) }}\"\n          transfer_fee_c_per_kWh: \"{{ states('input_number.energy_transfer_fee') | float(0) | round(2) }}\"\n          energy_tax_c_per_kWh: \"{{ states('input_number.energy_tax_c_kwh') | float(0) | round(2) }}\"\n          vat_pct: \"{{ states('input_number.energy_vat') | float(0) | round(2) }}\"\n          subtotal_c_per_kWh: \"{{ ((states('sensor.nord_pool_fi_current_price') | float(0) * 100) + states('input_number.energy_transfer_fee') | float(0) + states('input_number.energy_tax_c_kwh') | float(0)) | round(2) }}\"\n          cost_eur: \"{{ ((states('sensor.shelly_home_energy_15min') | float(0) * ((states('sensor.nord_pool_fi_current_price') | float(0) * 100 + states('input_number.energy_transfer_fee') | float(0) + states('input_number.energy_tax_c_kwh') | float(0)) / 100)) * (1 + states('input_number.energy_vat') | float(0) / 100)) | round(3) }}\"\n\n  - trigger:\n      - platform: state\n        entity_id: sensor.shelly_home_energy_15min\n        to: \"0\"\n    sensor:\n      - name: \"Energy Cost Final 15min (c)\"\n        unique_id: energy_cost_final_15min_c\n        unit_of_measurement: \"c\"\n\n        state_class: measurement\n        state: &gt;\n          {% set energy_kwh = trigger.from_state.state | float(0) %}\n          {% set ts = now() - timedelta(seconds=1) %}\n          {% set aligned = ts.replace(minute=(ts.minute // 15) * 15, second=0, microsecond=0) %}\n          {% set blocks = state_attr('sensor.electricity_prices', 'data') %}\n          {% set block = blocks | selectattr('start', 'equalto', aligned.strftime('%Y-%m-%d %H:%M:%S')) | list | first %}\n          {% set price_c = block.price | float(0) * 100 %}\n          {% set transfer_c = states('input_number.energy_transfer_fee') | float(0) %}\n          {% set tax_c = states('input_number.energy_tax_c_kwh') | float(0) %}\n          {% set vat_pct = states('input_number.energy_vat') | float(0) / 100 %}\n          {% set subtotal_c = price_c + transfer_c + tax_c %}\n          {% set cost_c = energy_kwh * subtotal_c * (1 + vat_pct) %}\n          {{ cost_c | round(2) }}\n        attributes:\n          energy_kWh: \"{{ trigger.from_state.state | float(0) | round(3) }}\"\n          spot_price_c_per_kWh: &gt;\n            {% set ts = now() - timedelta(seconds=1) %}\n            {% set aligned = ts.replace(minute=(ts.minute // 15) * 15, second=0, microsecond=0) %}\n            {% set blocks = state_attr('sensor.electricity_prices', 'data') %}\n            {% set block = blocks | selectattr('start', 'equalto', aligned.strftime('%Y-%m-%d %H:%M:%S')) | list | first %}\n            {{ block.price | float(0) * 100 | round(2) }}\n          transfer_fee_c_per_kWh: \"{{ states('input_number.energy_transfer_fee') | float(0) | round(2) }}\"\n          energy_tax_c_per_kWh: \"{{ states('input_number.energy_tax_c_kwh') | float(0) | round(2) }}\"\n          vat_pct: \"{{ states('input_number.energy_vat') | float(0) | round(2) }}\"\n          subtotal_c_per_kWh: &gt;\n            {% set ts = now() - timedelta(seconds=1) %}\n            {% set aligned = ts.replace(minute=(ts.minute // 15) * 15, second=0, microsecond=0) %}\n            {% set blocks = state_attr('sensor.electricity_prices', 'data') %}\n            {% set block = blocks | selectattr('start', 'equalto', aligned.strftime('%Y-%m-%d %H:%M:%S')) | list | first %}\n            {% set price_c = block.price | float(0) * 100 %}\n            {% set transfer_c = states('input_number.energy_transfer_fee') | float(0) %}\n            {% set tax_c = states('input_number.energy_tax_c_kwh') | float(0) %}\n            {{ (price_c + transfer_c + tax_c) | round(2) }}\n          cost_eur: &gt;\n            {% set energy_kwh = trigger.from_state.state | float(0) %}\n            {% set ts = now() - timedelta(seconds=1) %}\n            {% set aligned = ts.replace(minute=(ts.minute // 15) * 15, second=0, microsecond=0) %}\n            {% set blocks = state_attr('sensor.electricity_prices', 'data') %}\n            {% set block = blocks | selectattr('start', 'equalto', aligned.strftime('%Y-%m-%d %H:%M:%S')) | list | first %}\n            {% set price_c = block.price | float(0) * 100 %}\n            {% set transfer_c = states('input_number.energy_transfer_fee') | float(0) %}\n            {% set tax_c = states('input_number.energy_tax_c_kwh') | float(0) %}\n            {% set vat_pct = states('input_number.energy_vat') | float(0) / 100 %}\n            {% set subtotal_c = price_c + transfer_c + tax_c %}\n            {% set cost_c = energy_kwh * subtotal_c * (1 + vat_pct) %}\n            {{ (cost_c / 100) | round(3) }}\n\n  - sensor: # &lt;-- CORRECTED: Use '- sensor:' inside the 'template:' block\n      - name: \"Current 15-Minute Electricity Price\"\n        unique_id: \"current_15min_electricity_price\"\n        unit_of_measurement: \"c/kWh\"\n\n        state_class: measurement\n        state: &gt;\n          {# 1. Get the list of prices from the 'data' attribute #}\n          {% set price_data = state_attr('sensor.electricity_prices', 'data') %}\n          {% set current_time = now() %}\n\n          {# 2. Find the entry where the current time is between 'start' and 'end' #}\n          {% set current_price_item = price_data | selectattr('start', 'le', current_time.isoformat()) | selectattr('end', 'gt', current_time.isoformat()) | first %}\n\n          {% if current_price_item is defined %}\n            {# 3. Use the price value directly (it is already in cents/kWh) #}\n            {{ current_price_item.price | float(0) | round(3) }}\n          {% else %}\n            {# Fallback: If no block is found, use the main state, also in c/kWh #}\n            {{ states('sensor.electricity_prices') | float(0) }}\n          {% endif %}\n\n  # The second sensor goes under the same top-level 'template:' key\n  - sensor: # &lt;-- CORRECTED: Use '- sensor:' for the second sensor as well\n      - name: \"15-Minute Energy Cost Block\"\n        unique_id: \"15min_energy_cost_block_total\"\n        unit_of_measurement: \"c\"\n        device_class: monetary\n        state_class: total\n        state: &gt;\n          {# Get the energy usage from the Utility Meter (Step 1: sensor.15_minute_energy_usage) #}\n          {% set usage = states('sensor.15_minute_energy_usage') | float(0) %}\n          {# Get the current price from the Template Sensor defined above #}\n          {% set price = states('sensor.current_15_minute_electricity_price') | float(0) %}\n\n          {# Calculation: Energy (kWh) * Price (c/kWh) = Total Cost in Cents (c) #}\n          {{ (usage * price) | float | round(2) }}\n\n  - sensor:\n      - name: \"Tomorrow Average Electricity Price\"\n        # Unique ID for the sensor\n        unique_id: tomorrow_average_electricity_price\n        # Set the unit of measurement, copied from your existing sensor\n        unit_of_measurement: \"c/kWh\"\n        # Set the device class to 'monetary' so it's treated as a price\n\n        # Set the state class for long-term statistics\n        state_class: measurement\n        # The 'icon' is optional, but this one fits\n        icon: \"mdi:chart-line\"\n        # This is where the magic happens\n        availability: &gt;\n          {% set tomorrow_str = (now().date() + timedelta(days=1)).isoformat() %}\n          {% set price_data = state_attr('sensor.electricity_prices', 'data') %}\n          {% if price_data is not none %}\n            {% set tomorrow_prices = price_data \n                                     | selectattr('start', 'search', tomorrow_str) \n                                     | list %}\n            {{ tomorrow_prices | count &gt; 0 }}\n          {% else %}\n            {{ false }}\n          {% endif %}\n        state: &gt;\n          {% set tomorrow_str = (now().date() + timedelta(days=1)).isoformat() %}\n          {% set price_data = state_attr('sensor.electricity_prices', 'data') %}\n          {% set tomorrow_prices = price_data \n                                   | selectattr('start', 'search', tomorrow_str) \n                                   | map(attribute='price') \n                                   | list %}\n          {{ tomorrow_prices | average | round(3) }}\n</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/office_pc/","title":"Package: Office Pc","text":"","tags":["package","automated"]},{"location":"smart-home/packages/office_pc/#package-office-pc","title":"Package: Office Pc","text":"<p>Version: 1.0.0 Description: Office PC control (Audio, Displays, Power)</p> <p></p>","tags":["package","automated"]},{"location":"smart-home/packages/office_pc/#executive-summary","title":"Executive Summary","text":"<p>This package provides a control interface for the Office PC, enabling \"Smart Wake\" capabilities and peripheral management. It uses Wake-on-LAN to power on the machine and a set of helper switches to control audio output (Headphones vs. Speakers), mute status, and monitor power. These switches trigger button presses on the local PC via an agent (IoT Link).</p>","tags":["package","automated"]},{"location":"smart-home/packages/office_pc/#process-description-non-technical","title":"Process Description (Non-Technical)","text":"<ol> <li>Power On: usage of the 'Power' switch sends a magic packet (WoL) to turn on the PC.</li> <li>Audio Control: Toggling the \"Audio Device\" switch sends a command to the PC to swap the default playback device between Speakers and Headphones.</li> <li>Monitors: The \"Displays\" switch allows you to remotely wake up or put the monitors to sleep without touching the mouse/keyboard.</li> </ol>","tags":["package","automated"]},{"location":"smart-home/packages/office_pc/#dashboard-connections","title":"Dashboard Connections","text":"<p>This package powers the following dashboard views:</p> <ul> <li>Office: The Office dashboard handles both workspace environment and IT infrastructure. It offers detailed environmental tracking (Airthings Wave) and lighting prompts. Key features include remote PC control (Audio, Power, Displays) and extensive server monitoring (Proxmox, Home Assistant OS stats, SSD usage). It also manages potential window covers and detailed power consumption for office equipment. (Uses 3 entities)</li> </ul>","tags":["package","automated"]},{"location":"smart-home/packages/office_pc/#architecture-diagram","title":"Architecture Diagram","text":"<p>The architecture bridges Home Assistant with the Windows OS. Commands initiated in the Dashboard (e.g., \"Toggle Audio\") flip a Template Switch in HA. This switch calls a <code>button.press</code> service, which talks to the MQTT-connected IoT Link agent installed on the PC. The agent then executes the local script/command to change the audio device or monitor state. State feedback travels back via MQTT sensors to update the Dashboard icon.</p> <pre><code>sequenceDiagram\n    participant User as Dashboard\n    participant HA as Home Assistant\n    participant MQTT as MQTT Broker\n    participant Agent as IoT Link (PC)\n    participant OS as Windows OS\n\n    User-&gt;&gt;HA: Turn \"Audio Device\" ON\n    HA-&gt;&gt;MQTT: Publish command (button.press)\n    MQTT-&gt;&gt;Agent: Receive Command\n    Agent-&gt;&gt;OS: Execute \"Set Audio to Speakers\"\n    OS--&gt;&gt;Agent: Confirm Change\n    Agent--&gt;&gt;MQTT: Update Sensor State\n    MQTT--&gt;&gt;HA: Update Switch State</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/office_pc/#configuration-source-code","title":"Configuration (Source Code)","text":"<pre><code># ------------------------------------------------------------------------------\n# Package: Office PC\n# Version: 1.0.0\n# Description: Office PC control (Audio, Displays, Power)\n# Dependencies: IoT Link (switch.officepc_*, button.officepc_*)\n# ------------------------------------------------------------------------------\ntemplate:\n  - switch:\n      - name: \"Office PC Audio Device\"\n        unique_id: officepc_audio_device\n        icon: &gt;\n          {% if is_state('switch.officepc_audio_device', 'on') %}\n            mdi:speaker\n          {% else %}\n            mdi:headphones\n          {% endif %}\n        state: \"{{ is_state('sensor.officepc_audio_default_device', 'Speakers (Realtek High Definition Audio)') }}\"\n        turn_on:\n          service: button.press\n          target:\n            entity_id: button.officepc_speakers\n        turn_off:\n          service: button.press\n          target:\n            entity_id: button.officepc_headphones\n\n      - name: \"Office PC Audio Mute\"\n        unique_id: officepc_audio_mute\n        icon: &gt;\n          {% if is_state('sensor.officepc_audio_default_device_muted', 'True') %}\n            mdi:volume-mute\n          {% else %}\n            mdi:volume-high\n          {% endif %}\n        state: \"{{ is_state('sensor.officepc_audio_default_device_muted', 'True') }}\"\n        turn_on:\n          service: button.press\n          target:\n            entity_id: button.officepc_mute\n        turn_off:\n          service: button.press\n          target:\n            entity_id: button.officepc_mute\n\n      - name: \"Office PC Displays\"\n        unique_id: officepc_displays\n        icon: &gt;\n          {% if is_state('sensor.officepc_monitorpowerstate', 'PowerOn') %}\n            mdi:monitor\n          {% else %}\n            mdi:monitor-off\n          {% endif %}\n        state: \"{{ is_state('sensor.officepc_monitorpowerstate', 'PowerOn') }}\"\n        turn_on:\n          service: button.press\n          target:\n            entity_id: button.officepc_monitorwake\n        turn_off:\n          service: button.press\n          target:\n            entity_id: button.officepc_monitorsleep\n\nswitch:\n  - platform: wake_on_lan\n    name: \"Office PC Power\"\n    mac: 24:4B:FE:B7:52:DD\n    host: 10.0.0.140\n    turn_off:\n      service: button.press\n      target:\n        entity_id: button.officepc_sleep\n</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/philips_air_purifier/","title":"Package: Philips Air Purifier","text":"","tags":["package","automated"]},{"location":"smart-home/packages/philips_air_purifier/#package-philips-air-purifier","title":"Package: Philips Air Purifier","text":"<p>Version: 1.0.0 Description: Normalizes Philips Air Purifier attributes (PM2.5, Filters)</p> <p></p>","tags":["package","automated"]},{"location":"smart-home/packages/philips_air_purifier/#executive-summary","title":"Executive Summary","text":"<p>This package enhances the integration of the Philips Air Purifier by extracting hidden attributes from the main fan entity. It creates individual sensors for PM2.5 levels, Allergen Index, and the remaining life of Pre/Carbon/HEPA filters. This \"Flattening\" of attributes makes it significantly easier to display these metrics on dashboards or use them as triggers for other automations (e.g., \"Order new filter\").</p>","tags":["package","automated"]},{"location":"smart-home/packages/philips_air_purifier/#process-description-non-technical","title":"Process Description (Non-Technical)","text":"<ol> <li>Listen: The system watches the main Air Purifier connection.</li> <li>Extract: When the purifier reports \"PM2.5: 14\", this package copies that number to a new standalone sensor <code>sensor.purifier_pm_2_5</code>.</li> <li>Display: This allows you to drag-and-drop the PM2.5 value onto a graph card, which isn't possible when it's hidden inside the fan's settings.</li> </ol>","tags":["package","automated"]},{"location":"smart-home/packages/philips_air_purifier/#dashboard-connections","title":"Dashboard Connections","text":"<p>No specific entities detected to link.</p>","tags":["package","automated"]},{"location":"smart-home/packages/philips_air_purifier/#architecture-diagram","title":"Architecture Diagram","text":"<p>This is a pure data transformation layer. The <code>fan.philips_air_purifier</code> entity acts as a complex object containing multiple data points. The Template Sensors defined here subscribe to state changes of that parent object and map specific attributes (<code>pm25</code>, <code>hepa_filter</code>) to the state of new, single-purpose entities.</p> <pre><code>sequenceDiagram\n    participant Device as Air Purifier\n    participant Parent as Fan Entity\n    participant Sensor as Template Sensor\n\n    Device-&gt;&gt;Parent: Update State (PM2.5=12, HEPA=4000h)\n    Parent-&gt;&gt;Sensor: Attribute Change Detected\n    Sensor-&gt;&gt;Sensor: Extract 'pm25'\n    Sensor-&gt;&gt;Dashboard: Update \"Purifier PM2.5\" to 12</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/philips_air_purifier/#configuration-source-code","title":"Configuration (Source Code)","text":"<pre><code># ------------------------------------------------------------------------------\n# Package: Philips Air Purifier\n# Version: 1.0.0\n# Description: Normalizes Philips Air Purifier attributes (PM2.5, Filters)\n# Dependencies: fan.philips_air_purifier\n# ------------------------------------------------------------------------------\ntemplate:\n  - sensor:\n      - name: \"Purifier PM 2.5\"\n        unique_id: purifier_pm25\n        unit_of_measurement: \"\u03bcg/m\u00b3\"\n        device_class: pm25\n        icon: mdi:blur\n        state: &gt;\n          {{ state_attr('fan.philips_air_purifier', 'pm25') }}\n\n      - name: \"Purifier Allergen Index\"\n        unique_id: purifier_allergen_index\n        unit_of_measurement: \"\"\n        icon: mdi:sprout\n        state: &gt;\n          {{ state_attr('fan.philips_air_purifier', 'allergen_index') }}\n\n      - name: \"Purifier Pre Filter\"\n        unique_id: purifier_pre_filter\n        unit_of_measurement: \"hours\"\n        icon: mdi:air-filter\n        state: &gt;\n          {{ state_attr('fan.philips_air_purifier', 'pre_filter') }}\n\n      - name: \"Purifier Carbon Filter\"\n        unique_id: purifier_carbon_filter\n        unit_of_measurement: \"hours\"\n        icon: mdi:air-filter\n        state: &gt;\n          {{ state_attr('fan.philips_air_purifier', 'carbon_filter') }}\n\n      - name: \"Purifier HEPA Filter\"\n        unique_id: purifier_hepa_filter\n        unit_of_measurement: \"hours\"\n        icon: mdi:air-filter\n        state: &gt;\n          {{ state_attr('fan.philips_air_purifier', 'hepa_filter') }}\n</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/room_manager/","title":"Package: Room Manager","text":"","tags":["package","automated"]},{"location":"smart-home/packages/room_manager/#package-room-manager","title":"Package: Room Manager","text":"<p>Version: 1.2.0 Description: Dynamic creation of room settings via MQTT</p> <p></p>","tags":["package","automated"]},{"location":"smart-home/packages/room_manager/#executive-summary","title":"Executive Summary","text":"<p>The Room Automation Manager is a dynamic configuration engine that enables the decentralized creation of smart room controllers. Unlike static YAML configuration, this package allows administrators to \"initialize\" a room directly from the dashboard. This triggers a script that publishes MQTT Discovery payloads to Home Assistant, effectively factory-generating a standardized suite of entities for that room (Automation Mode, Idle Timers, Occupancy Sensors, etc.) without requiring a system restart. It acts as a \"Room Controller Factory,\" ensuring every smart room has a consistent interface and logic structure.</p>","tags":["package","automated"]},{"location":"smart-home/packages/room_manager/#process-description-non-technical","title":"Process Description (Non-Technical)","text":"<p>This system allows you to turn any standard \"Area\" in your home into a fully functional Smart Room with a single click. 1.  Select &amp; Initialize: Go to the Room Management dashboard, pick a room (e.g., \"Kitchen\") from the list, and click \"Initialize\". 2.  Automatic Creation: The system instantly builds a \"Control Panel\" for that room behind the scenes. It creates:     *   Mode Switch: To set the room to \"Automatic\", \"Manual\", or \"Guest Mode\".     *   Timers: Dials to set how long lights stay on (e.g., 5 minutes).     *   Sensor Links: Dropdown menus to choose which Motion Sensor and Bed Sensor belongs to this room. 3.  Instant Control: New controls appear immediately. You can now tweak the \"Kitchen\" settings without ever touching a code file. If you delete the room, all these controls vanish cleanly.</p>","tags":["package","automated"]},{"location":"smart-home/packages/room_manager/#dashboard-connections","title":"Dashboard Connections","text":"<ul> <li>Room Management: The primary admin interface. Used to Create (Initialize) and Delete rooms. It also lists all active rooms and their configuration state.</li> <li>Settings (System): Displays the global list of active rooms and their current modes (Occupied/Idle).</li> </ul>","tags":["package","automated"]},{"location":"smart-home/packages/room_manager/#embedded-card-configured-rooms-list","title":"Embedded Card: Configured Rooms List","text":"<p>The following <code>auto-entities</code> configuration is used to dynamically list all rooms:</p> <pre><code>type: custom:auto-entities\nshow_empty: true\ncard:\n  type: entities\n  show_header_toggle: false\nfilter:\n  template: |\n    {% set ns = namespace(rows=[]) %}\n    {% set mode_selectors = states.select | selectattr('entity_id','search','automation_mode') | sort(attribute='entity_id') | list %}\n\n    {% for sel in mode_selectors %}\n      {# Extract base id and normalize to room_key #}\n      {% set raw_id = sel.entity_id.split('.')[1] %}\n      {% set base = raw_id.replace('_automation_mode','') %}\n      {% if base.startswith('room_') %}\n        {% set room_key = base[5:] %}\n      {% else %}\n        {% set room_key = base %}\n      {% endif %}\n      {% set name = room_key.replace('_',' ') | title %}\n\n      {# Entity IDs #}\n      {% set state_select = 'select.room_' ~ room_key ~ '_state' %}\n      {% set auto_switch  = 'switch.room_' ~ room_key ~ '_automation' %}\n      {% set occ_sensor   = 'binary_sensor.room_' ~ room_key ~ '_occupancy' %}\n      {% set idle_entity  = 'number.room_' ~ room_key ~ '_presence_idle_time' %}\n      {% set delay_entity = 'number.room_' ~ room_key ~ '_lights_presence_delay' %}\n      {% set bed_s        = 'select.room_' ~ room_key ~ '_bed_sensor' %}\n      {% set sleep_entry  = 'number.room_' ~ room_key ~ '_sleep_entry_delay' %}\n      {% set sleep_exit   = 'number.room_' ~ room_key ~ '_sleep_exit_delay' %}\n      {% set occ_source   = 'select.room_' ~ room_key ~ '_occupancy_source' %}\n      {% set timer_entity = 'sensor.room_' ~ room_key ~ '_timer' %}\n\n      {% set entities = [] %}\n\n      {# 1. Mode #}\n      {% set entities = entities + [{'entity': sel.entity_id, 'name': 'Mode'}] %}\n\n      {# 2. Switch #}\n      {% if states[auto_switch] is defined %}\n        {% set entities = entities + [{'entity': auto_switch, 'name': 'Automation Enabled'}] %}\n      {% endif %}\n\n      {# 3. State #}\n      {% if states[state_select] is defined %}\n        {% set entities = entities + [{'entity': state_select, 'name': 'Current State'}] %}\n      {% endif %}\n\n      {# 4. Occupancy #}\n      {% if states[occ_sensor] is defined %}\n        {% set entities = entities + [{'entity': occ_sensor, 'name': 'Occupancy'}] %}\n      {% endif %}\n\n      {# 5. Occupancy Source #}\n      {% if states[occ_source] is defined %}\n        {% set entities = entities + [{'entity': occ_source, 'name': 'Occupancy Sensor'}] %}\n      {% endif %}\n\n      {# 6. Timer Bar (Conditional Row) #}\n      {% if states[timer_entity] is defined %}\n         {% set entities = entities + [{\n            'type': 'conditional',\n            'conditions': [\n              {'entity': timer_entity, 'state_not': 'unavailable'},\n              {'entity': timer_entity, 'state_not': 'unknown'},\n              {'entity': timer_entity, 'state_not': 'none'},\n              {'entity': timer_entity, 'state_not': ''}\n            ],\n            'row': {\n               'entity': timer_entity,\n               'name': 'Timer'\n            }\n         }] %}\n      {% endif %}\n\n      {# 7. Config Numbers #}\n      {% if states[idle_entity] is defined %}\n        {% set entities = entities + [{'entity': idle_entity, 'name': 'Idle Time (sec)'}] %}\n      {% endif %}\n      {% if states[delay_entity] is defined %}\n        {% set entities = entities + [{'entity': delay_entity, 'name': 'Off Delay (sec)'}] %}\n      {% endif %}\n\n      {# 8. Bed Sensor &amp; Sleep Timers (Conditional) #}\n      {% if states[bed_s] is defined %}\n        {% set entities = entities + [{'entity': bed_s, 'name': 'Bed Occupancy Sensor'}] %}\n\n        {# Sleep Entry Delay #}\n        {% if states[sleep_entry] is defined %}\n          {% set entities = entities + [{\n             'type': 'conditional',\n             'conditions': [\n                {'entity': bed_s, 'state_not': '-Select-'},\n                {'entity': bed_s, 'state_not': 'unknown'},\n                {'entity': bed_s, 'state_not': 'unavailable'}\n             ],\n             'row': {\n                'entity': sleep_entry,\n                'name': 'Sleep Entry Delay (sec)'\n             }\n          }] %}\n        {% endif %}\n\n        {# Sleep Exit Delay #}\n        {% if states[sleep_exit] is defined %}\n          {% set entities = entities + [{\n             'type': 'conditional',\n             'conditions': [\n                {'entity': bed_s, 'state_not': '-Select-'},\n                {'entity': bed_s, 'state_not': 'unknown'},\n                {'entity': bed_s, 'state_not': 'unavailable'}\n             ],\n             'row': {\n                'entity': sleep_exit,\n                'name': 'Sleep Exit Delay (sec)'\n             }\n          }] %}\n        {% endif %}\n      {% endif %}\n\n      {# Create the Group #}\n      {% set group = {\n        'type': 'custom:fold-entity-row',\n        'head': {'type':'section', 'label': name},\n        'entities': entities\n      } %}\n      {% set ns.rows = ns.rows + [group] %}\n    {% endfor %}\n\n    {{ ns.rows | to_json }}\n</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/room_manager/#architecture-diagram","title":"Architecture Diagram","text":"<p>The sequence diagram below illustrates the Room Initialization Flow. When a user clicks \"Initialize\" for a specific room (e.g., \"Kitchen\"), the <code>create_room_settings</code> script triggers. It loops through a definition of required entities (Automation Mode, Idle Timer, Occupancy Sensor Link) and publishes MQTT Configuration Payloads to the <code>homeassistant/</code> discovery topic. Home Assistant detects these payloads and dynamically creates the entities in its registry. Finally, the script publishes default state values (retained) to ensure the new controls are immediately usable.</p> <pre><code>sequenceDiagram\n    participant User as \ud83d\udc64 Admin (Dashboard)\n    participant Script as \ud83d\udcdc Script: create_room\n    participant MQTT as \ud83d\udce1 MQTT Broker\n    participant HA as \ud83c\udfe0 Home Assistant (Discovery)\n\n    User-&gt;&gt;Script: Run(room_slug=\"kitchen\")\n    activate Script\n\n    rect rgb(20, 20, 20)\n        note right of Script: 1. Entity Construction Loop\n        Script-&gt;&gt;MQTT: Publish config: select.room_kitchen_mode\n        MQTT--&gt;&gt;HA: Discovery: New Entity (select...mode)\n        Script-&gt;&gt;MQTT: Publish config: number.room_kitchen_idle\n        MQTT--&gt;&gt;HA: Discovery: New Entity (number...idle)\n        Script-&gt;&gt;MQTT: Publish config: binary_sensor.room_kitchen_occupancy\n        MQTT--&gt;&gt;HA: Discovery: New Entity (binary_sensor...occupancy)\n    end\n\n    rect rgb(30, 30, 50)\n        note right of Script: 2. Default State Injection (Retained)\n        Script-&gt;&gt;MQTT: Publish state: mode = \"presence-control\"\n        Script-&gt;&gt;MQTT: Publish state: idle_time = 120s\n        Script-&gt;&gt;MQTT: Publish state: occupancy = OFF\n    end\n\n    deactivate Script\n    HA--&gt;&gt;User: UI Updates (New Controls Appear)</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/room_manager/#configuration-source-code","title":"Configuration (Source Code)","text":"<p>```yaml</p>","tags":["package","automated"]},{"location":"smart-home/packages/room_manager/#package-room-automation-manager","title":"Package: Room Automation Manager","text":"","tags":["package","automated"]},{"location":"smart-home/packages/room_manager/#version-120","title":"Version: 1.2.0","text":"","tags":["package","automated"]},{"location":"smart-home/packages/room_manager/#description-dynamic-creation-of-room-settings-via-mqtt","title":"Description: Dynamic creation of room settings via MQTT","text":"","tags":["package","automated"]},{"location":"smart-home/packages/room_manager/#dependencies-mqtt-input_textroom_mgmt_name-automationsystem_populate_room_list","title":"Dependencies: MQTT, input_text.room_mgmt_name, automation.system_populate_room_list","text":"","tags":["package","automated"]},{"location":"smart-home/packages/room_manager/#-","title":"------------------------------------------------------------------------------","text":"","tags":["package","automated"]},{"location":"smart-home/packages/room_manager/#-_1","title":"------------------------------------------------------------------------------","text":"","tags":["package","automated"]},{"location":"smart-home/packages/room_manager/#1-global-customization-force-text-boxes","title":"1. GLOBAL CUSTOMIZATION (Force Text Boxes)","text":"","tags":["package","automated"]},{"location":"smart-home/packages/room_manager/#-_2","title":"------------------------------------------------------------------------------","text":"<p>homeassistant:   customize_glob:     \"number._presence_idle_time\":       mode: box     \"number._lights_presence_delay\":       mode: box     \"number._sleep_entry_delay\":       mode: box     \"number._sleep_exit_delay\":       mode: box</p>","tags":["package","automated"]},{"location":"smart-home/packages/room_manager/#-_3","title":"------------------------------------------------------------------------------","text":"","tags":["package","automated"]},{"location":"smart-home/packages/room_manager/#2-helpers-dashboard-inputs","title":"2. HELPERS (Dashboard Inputs)","text":"","tags":["package","automated"]},{"location":"smart-home/packages/room_manager/#-_4","title":"------------------------------------------------------------------------------","text":"<p>input_text:   room_mgmt_name:     name: \"Room Name\"     icon: mdi:door-open   room_mgmt_slug:     name: \"Room ID (slug)\"     icon: mdi:identifier</p> <p>input_select:   # SOURCE: Native Home Assistant Areas   room_mgmt_create_select:     name: \"Select Area to Initialize\"     icon: mdi:map-plus     options:       - \"unknown\"</p> <p># SOURCE: Existing Created Rooms   room_mgmt_delete_select:     name: \"Select Room to Delete\"     icon: mdi:delete-sweep     options:       - \"unknown\"</p>","tags":["package","automated"]},{"location":"smart-home/packages/room_manager/#-_5","title":"------------------------------------------------------------------------------","text":"","tags":["package","automated"]},{"location":"smart-home/packages/room_manager/#3-scripts","title":"3. SCRIPTS","text":"","tags":["package","automated"]},{"location":"smart-home/packages/room_manager/#-_6","title":"------------------------------------------------------------------------------","text":"<p>script:   # --- CREATE ROOM SETTINGS ---   create_room_settings:     alias: \"System: Create Room Settings\"     icon: mdi:home-plus     mode: single     sequence:       - variables:           # Get the selected Area ID (slug) directly from the dropdown           room_slug: \"{{ states('input_select.room_mgmt_create_select') }}\"           # Use the Area Name as the Friendly Name (Title Case)           room_name: \"{{ area_name(room_slug) }}\"</p> <pre><code>  # 1. Create Automation Mode Selector (Select)\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"homeassistant/select/room_{{ room_slug }}_mode/config\"\n      payload: &gt;-\n        {\n          \"name\": \"{{ room_name }} Automation Mode\",\n          \"object_id\": \"room_{{ room_slug }}_automation_mode\",\n          \"unique_id\": \"room_select_{{ room_slug }}_mode_v4\",\n          \"icon\": \"mdi:home-lightning-bolt-outline\",\n          \"options\": [\"presence-control\", \"absence-detection\", \"manual-control\", \"schedule-mode\"],\n          \"command_topic\": \"room/{{ room_slug }}/mode/set\",\n          \"state_topic\": \"room/{{ room_slug }}/mode/state\",\n          \"availability_topic\": \"room/{{ room_slug }}/availability\",\n          \"payload_available\": \"online\",\n          \"device\": {\n            \"identifiers\": [\"room_settings_{{ room_slug }}\"],\n            \"name\": \"{{ room_name }} Settings\",\n            \"manufacturer\": \"Home Assistant\",\n            \"model\": \"Room Controller\"\n          }\n        }\n  # Set default if new\n  - if:\n      - condition: template\n        value_template: \"{{ states('select.room_' ~ room_slug ~ '_automation_mode') in ['unknown', 'unavailable', 'none'] }}\"\n    then:\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"room/{{ room_slug }}/mode/state\"\n          payload: \"presence-control\"\n  - delay: \"00:00:00.050\"\n\n  # 1.1 Create Automation Master Switch (Switch)\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"homeassistant/switch/room_{{ room_slug }}_automation/config\"\n      payload: &gt;-\n        {\n          \"name\": \"{{ room_name }} Automation\",\n          \"object_id\": \"room_{{ room_slug }}_automation\",\n          \"unique_id\": \"room_switch_{{ room_slug }}_automation_v1\",\n          \"icon\": \"mdi:robot\",\n          \"command_topic\": \"room/{{ room_slug }}/automation/set\",\n          \"state_topic\": \"room/{{ room_slug }}/automation/state\",\n          \"availability_topic\": \"room/{{ room_slug }}/availability\",\n          \"payload_on\": \"ON\",\n          \"payload_off\": \"OFF\",\n          \"device\": { \"identifiers\": [\"room_settings_{{ room_slug }}\"] }\n        }\n  # Default to ON if new\n  - if:\n      - condition: template\n        value_template: \"{{ states('switch.room_' ~ room_slug ~ '_automation') in ['unknown', 'unavailable', 'none'] }}\"\n    then:\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"room/{{ room_slug }}/automation/state\"\n          payload: \"ON\"\n  - delay: \"00:00:00.050\"\n\n  # 2. Create Idle Time Slider (Number)\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"homeassistant/number/room_{{ room_slug }}_idle/config\"\n      payload: &gt;-\n        {\n          \"name\": \"{{ room_name }} Presence Idle Time\",\n          \"object_id\": \"room_{{ room_slug }}_presence_idle_time\",\n          \"unique_id\": \"room_number_{{ room_slug }}_idle_v5\",\n          \"device_class\": \"duration\",\n          \"icon\": \"mdi:timer-sand\",\n          \"min\": 0,\n          \"max\": 1800,\n          \"step\": 1,\n          \"unit_of_measurement\": \"s\",\n          \"command_topic\": \"room/{{ room_slug }}/idle/set\",\n          \"state_topic\": \"room/{{ room_slug }}/idle/state\",\n          \"availability_topic\": \"room/{{ room_slug }}/availability\",\n          \"device\": { \"identifiers\": [\"room_settings_{{ room_slug }}\"] }\n        }\n  # Default Value\n  - if:\n      - condition: template\n        value_template: \"{{ states('number.room_' ~ room_slug ~ '_presence_idle_time') in ['unknown', 'unavailable', 'none'] }}\"\n    then:\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"room/{{ room_slug }}/idle/state\"\n          payload: \"15\"\n  - delay: \"00:00:00.050\"\n\n  # 3. Create Delay Time (Number)\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"homeassistant/number/room_{{ room_slug }}_delay/config\"\n      payload: &gt;-\n        {\n          \"name\": \"{{ room_name }} Lights Presence Delay\",\n          \"object_id\": \"room_{{ room_slug }}_lights_presence_delay\",\n          \"unique_id\": \"room_number_{{ room_slug }}_delay_v5\",\n          \"device_class\": \"duration\",\n          \"icon\": \"mdi:lightbulb-clock\",\n          \"min\": 0,\n          \"max\": 3600,\n          \"step\": 1,\n          \"unit_of_measurement\": \"s\",\n          \"command_topic\": \"room/{{ room_slug }}/delay/set\",\n          \"state_topic\": \"room/{{ room_slug }}/delay/state\",\n          \"availability_topic\": \"room/{{ room_slug }}/availability\",\n          \"device\": { \"identifiers\": [\"room_settings_{{ room_slug }}\"] }\n        }\n  - if:\n      - condition: template\n        value_template: \"{{ states('number.room_' ~ room_slug ~ '_lights_presence_delay') in ['unknown', 'unavailable', 'none'] }}\"\n    then:\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"room/{{ room_slug }}/delay/state\"\n          payload: \"120\"\n  - delay: \"00:00:00.050\"\n\n  # 4. Create Timer Display (Timestamp Sensor)\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"homeassistant/sensor/room_{{ room_slug }}_timer/config\"\n      payload: &gt;-\n        {\n          \"name\": \"{{ room_name }} Timer\",\n          \"object_id\": \"room_{{ room_slug }}_timer\",\n          \"unique_id\": \"room_sensor_{{ room_slug }}_timer_v4\",\n          \"icon\": \"mdi:progress-clock\",\n          \"device_class\": \"timestamp\",\n          \"value_template\": \"{{ '{{' }} value if value not in ['unknown', 'unavailable', ''] else None {{ '}}' }}\",\n          \"state_topic\": \"room/{{ room_slug }}/timer/state\",\n          \"json_attributes_topic\": \"room/{{ room_slug }}/timer/attributes\",\n          \"availability_topic\": \"room/{{ room_slug }}/availability\",\n          \"device\": { \"identifiers\": [\"room_settings_{{ room_slug }}\"] }\n        }\n  - delay: \"00:00:00.050\"\n  # 5. Create Room State (Select)\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"homeassistant/select/room_{{ room_slug }}_state/config\"\n      payload: &gt;-\n        {\n          \"name\": \"{{ room_name }} State\",\n          \"object_id\": \"room_{{ room_slug }}_state\",\n          \"unique_id\": \"room_select_state_v4_{{ room_slug }}\",\n          \"icon\": \"mdi:eye-outline\",\n          \"options\": [\"Occupied\", \"Idle\", \"Absence\", \"Sleep\"],\n          \"command_topic\": \"room/{{ room_slug }}/state/set\",\n          \"state_topic\": \"room/{{ room_slug }}/state/state\",\n          \"availability_topic\": \"room/{{ room_slug }}/availability\",\n          \"payload_available\": \"online\",\n          \"device\": { \"identifiers\": [\"room_settings_{{ room_slug }}\"] }\n        }\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"room/{{ room_slug }}/state/state\"\n      payload: \"Absence\"\n  - delay: \"00:00:00.050\"\n\n  # 6. Create Occupancy (Binary Sensor)\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"homeassistant/binary_sensor/room_{{ room_slug }}_occupancy/config\"\n      payload: &gt;-\n        {\n          \"name\": \"{{ room_name }} Occupancy\",\n          \"object_id\": \"room_{{ room_slug }}_occupancy\",\n          \"unique_id\": \"room_occupancy_v4_{{ room_slug }}\",\n          \"icon\": \"mdi:motion-sensor\",\n          \"device_class\": \"occupancy\",\n          \"state_topic\": \"room/{{ room_slug }}/occupancy/state\",\n          \"payload_on\": \"ON\",\n          \"payload_off\": \"OFF\",\n          \"availability_topic\": \"room/{{ room_slug }}/availability\",\n          \"payload_available\": \"online\",\n          \"device\": { \"identifiers\": [\"room_settings_{{ room_slug }}\"] }\n        }\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"room/{{ room_slug }}/occupancy/state\"\n      payload: \"OFF\"\n  - delay: \"00:00:00.050\"\n\n  # 9. Create Bed Sensor (Select)\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"homeassistant/select/room_{{ room_slug }}_bed_sensor/config\"\n      payload: &gt;-\n        {\n          \"name\": \"{{ room_name }} Bed Sensor ID\",\n          \"object_id\": \"room_{{ room_slug }}_bed_sensor\",\n          \"unique_id\": \"room_select_bed_sensor_v4_{{ room_slug }}\",\n          \"icon\": \"mdi:bed\",\n          \"options\": [\"-Select-\"],\n          \"command_topic\": \"room/{{ room_slug }}/bed_sensor/set\",\n          \"state_topic\": \"room/{{ room_slug }}/bed_sensor/state\",\n          \"availability_topic\": \"room/{{ room_slug }}/availability\",\n          \"device\": { \"identifiers\": [\"room_settings_{{ room_slug }}\"] }\n        }\n  - delay: \"00:00:00.050\"\n  # 10. Create Sleep Entry Delay (Number)\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"homeassistant/number/room_{{ room_slug }}_sleep_entry_delay/config\"\n      payload: &gt;-\n        {\n          \"name\": \"{{ room_name }} Sleep Entry Delay\",\n          \"object_id\": \"room_{{ room_slug }}_sleep_entry_delay\",\n          \"unique_id\": \"room_number_sleep_entry_delay_v4_{{ room_slug }}\",\n          \"icon\": \"mdi:bed-clock\",\n          \"min\": 0, \"max\": 3600, \"step\": 15, \"unit_of_measurement\": \"s\",\n          \"command_topic\": \"room/{{ room_slug }}/sleep_entry_delay/set\",\n          \"state_topic\": \"room/{{ room_slug }}/sleep_entry_delay/state\",\n          \"availability_topic\": \"room/{{ room_slug }}/availability\",\n          \"device\": { \"identifiers\": [\"room_settings_{{ room_slug }}\"] }\n        }\n  - if:\n      - condition: template\n        value_template: \"{{ states('number.room_' ~ room_slug ~ '_sleep_entry_delay') in ['unknown', 'unavailable', 'none'] }}\"\n    then:\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"room/{{ room_slug }}/sleep_entry_delay/state\"\n          payload: \"300\"\n  - delay: \"00:00:00.050\"\n\n  # 11. Create Sleep Exit Delay (Number)\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"homeassistant/number/room_{{ room_slug }}_sleep_exit_delay/config\"\n      payload: &gt;-\n        {\n          \"name\": \"{{ room_name }} Sleep Exit Delay\",\n          \"object_id\": \"room_{{ room_slug }}_sleep_exit_delay\",\n          \"unique_id\": \"room_number_sleep_exit_delay_v4_{{ room_slug }}\",\n          \"icon\": \"mdi:run-fast\",\n          \"min\": 0, \"max\": 3600, \"step\": 15, \"unit_of_measurement\": \"s\",\n          \"command_topic\": \"room/{{ room_slug }}/sleep_exit_delay/set\",\n          \"state_topic\": \"room/{{ room_slug }}/sleep_exit_delay/state\",\n          \"availability_topic\": \"room/{{ room_slug }}/availability\",\n          \"device\": { \"identifiers\": [\"room_settings_{{ room_slug }}\"] }\n        }\n  - if:\n      - condition: template\n        value_template: \"{{ states('number.room_' ~ room_slug ~ '_sleep_exit_delay') in ['unknown', 'unavailable', 'none'] }}\"\n    then:\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"room/{{ room_slug }}/sleep_exit_delay/state\"\n          payload: \"60\"\n  - delay: \"00:00:00.050\"\n\n  # 12. Set Online &amp; Refresh Lists\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"room/{{ room_slug }}/availability\"\n      payload: \"online\"\n\n  # 13. Create Occupancy Source (Select)\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"homeassistant/select/room_{{ room_slug }}_occupancy_source/config\"\n      payload: &gt;-\n        {\n          \"name\": \"{{ room_name }} Occupancy Sensor\",\n          \"object_id\": \"room_{{ room_slug }}_occupancy_source\",\n          \"unique_id\": \"room_select_occ_source_v1_{{ room_slug }}\",\n          \"icon\": \"mdi:motion-sensor-off\",\n          \"options\": [\"-Select-\"],\n          \"command_topic\": \"room/{{ room_slug }}/occupancy_source/set\",\n          \"state_topic\": \"room/{{ room_slug }}/occupancy_source/state\",\n          \"availability_topic\": \"room/{{ room_slug }}/availability\",\n          \"device\": { \"identifiers\": [\"room_settings_{{ room_slug }}\"] }\n        }\n  - delay: \"00:00:00.050\"\n  # Trigger Refresh to populate options\n  - service: script.refresh_room_options\n</code></pre> <p># --- DELETE ROOM SETTINGS ---   delete_room_settings:     alias: \"System: Delete Room Settings\"     icon: mdi:home-remove     mode: single     sequence:       - variables:           raw_slug: \"{{ states('input_select.room_mgmt_delete_select') }}\"           # SAFETY: If slug starts with 'room_', strip it to get the clean ID           room_slug: \"{{ raw_slug | replace('room_', '') if raw_slug.startswith('room_') else raw_slug }}\"</p> <pre><code>  # Clear Config Topics\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"homeassistant/select/room_{{ room_slug }}_mode/config\"\n      payload: \"\"\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"homeassistant/number/room_{{ room_slug }}_idle/config\"\n      payload: \"\"\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"homeassistant/number/room_{{ room_slug }}_delay/config\"\n      payload: \"\"\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"homeassistant/sensor/room_{{ room_slug }}_timer/config\"\n      payload: \"\"\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"homeassistant/select/room_{{ room_slug }}_state/config\"\n      payload: \"\"\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"homeassistant/binary_sensor/room_{{ room_slug }}_occupancy/config\"\n      payload: \"\"\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"homeassistant/switch/room_{{ room_slug }}_automation/config\"\n      payload: \"\"\n  # Cleanup New Bed Sensor Select\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"homeassistant/select/room_{{ room_slug }}_bed_sensor/config\"\n      payload: \"\"\n\n  # RESTORED: Cleanup for deprecated entities to remove legacy retained messages\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"homeassistant/text/room_{{ room_slug }}_lux_sensor/config\"\n      payload: \"\"\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"homeassistant/number/room_{{ room_slug }}_lux_threshold/config\"\n      payload: \"\"\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"homeassistant/select/room_{{ room_slug }}_light_target/config\"\n      payload: \"\"\n  # END RESTORED\n\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"homeassistant/text/room_{{ room_slug }}_bed_sensor/config\"\n      payload: \"\"\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"homeassistant/number/room_{{ room_slug }}_sleep_exit_delay/config\"\n      payload: \"\"\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"homeassistant/select/room_{{ room_slug }}_occupancy_source/config\"\n      payload: \"\"\n\n  # Set Offline\n  - service: mqtt.publish\n    data:\n      retain: true\n      topic: \"room/{{ room_slug }}/availability\"\n      payload: \"offline\"\n\n  # Refresh Lists\n  # PURGE LEGACY TEXT BED SENSORS (Fixes MQTT Warnings)\n  - repeat:\n      for_each: \"{{ room_slugs }}\"\n      sequence:\n        - service: mqtt.publish\n          data:\n            retain: true\n            topic: \"homeassistant/text/room_{{ repeat.item }}_bed_sensor/config\"\n            payload: \"\"\n\n  # Refresh Lists\n\n  - delay: \"00:00:02\"\n  - service: automation.trigger\n    target:\n      entity_id: automation.system_populate_room_list\n    data:\n      skip_condition: true\n</code></pre> <p># --- REFRESH OPTIONS FOR SELECTS ---   refresh_room_options:     alias: \"System: Refresh Room Options\"     mode: single     sequence:       - variables:           # FILTER: Binary Sensors (Occupancy/Presence/Motion OR 'presence'/'occupancy' in name)           sensor_list: &gt;-             {% set ns = namespace(items=['-Select-']) %}             {% for s in states.binary_sensor %}                {% set dev_class = s.attributes.device_class | default('') %}                {% set name = s.name | lower %}                {% if dev_class in ['occupancy', 'presence', 'motion'] or 'presence' in name or 'occupancy' in name %}                  {% set ns.items = ns.items + [s.entity_id] %}                {% endif %}             {% endfor %}             {{ ns.items | sort | list }}</p> <pre><code>      # FILTER: Bed Sensors (Must have 'bed' AND ('occupancy' OR 'presence') in name/id)\n      bed_sensor_list: &gt;-\n        {% set ns = namespace(items=['-Select-']) %}\n        {% for s in states.binary_sensor %}\n           {% set name = s.entity_id | lower %}\n           {% if 'bed' in name and ('occupancy' in name or 'presence' in name) %}\n             {% set ns.items = ns.items + [s.entity_id] %}\n           {% endif %}\n        {% endfor %}\n        {{ ns.items | sort | list }}\n\n      # Find all active room slugs\n      room_slugs: &gt;-\n        {% set ns = namespace(rooms=[]) %}\n        {% set selectors = states.select | selectattr('object_id', 'search', '_automation_mode$') | list %}\n        {% for sel in selectors %}\n           {% set raw_id = sel.entity_id.split('.')[1] %}\n           {% set base = raw_id | replace('_automation_mode', '') %}\n           {% if base.startswith('room_') %}\n              {% set slug = base[5:] %}\n           {% else %}\n              {% set slug = base %}\n           {% endif %}\n           {% set ns.rooms = ns.rooms + [slug] %}\n        {% endfor %}\n        {{ ns.rooms | unique | list }}\n\n  # Loop through each room and update its config topic with new options\n  - repeat:\n      for_each: \"{{ room_slugs }}\"\n      sequence:\n        # 1. Update Occupancy Source Options\n        - service: mqtt.publish\n          data:\n            topic: \"homeassistant/select/room_{{ repeat.item }}_occupancy_source/config\"\n            retain: true\n            payload: &gt;-\n              {\n                \"name\": \"{{ area_name(repeat.item) | default(repeat.item) }} Occupancy Sensor\",\n                \"object_id\": \"room_{{ repeat.item }}_occupancy_source\",\n                \"unique_id\": \"room_select_occ_source_v1_{{ repeat.item }}\",\n                \"icon\": \"mdi:motion-sensor-off\",\n                \"options\": {{ sensor_list | to_json }},\n                \"command_topic\": \"room/{{ repeat.item }}/occupancy_source/set\",\n                \"state_topic\": \"room/{{ repeat.item }}/occupancy_source/state\",\n                \"availability_topic\": \"room/{{ repeat.item }}/availability\",\n                \"device\": { \"identifiers\": [\"room_settings_{{ repeat.item }}\"] }\n              }\n\n        # 2. Update Bed Sensor Options\n        - service: mqtt.publish\n          data:\n            topic: \"homeassistant/select/room_{{ repeat.item }}_bed_sensor/config\"\n            retain: true\n            payload: &gt;-\n              {\n                \"name\": \"{{ area_name(repeat.item) | default(repeat.item) }} Bed Sensor ID\",\n                \"object_id\": \"room_{{ repeat.item }}_bed_sensor\",\n                \"unique_id\": \"room_select_bed_sensor_v4_{{ repeat.item }}\",\n                \"icon\": \"mdi:bed\",\n                \"options\": {{ bed_sensor_list | to_json }},\n                \"command_topic\": \"room/{{ repeat.item }}/bed_sensor/set\",\n                \"state_topic\": \"room/{{ repeat.item }}/bed_sensor/state\",\n                \"availability_topic\": \"room/{{ repeat.item }}/availability\",\n                \"device\": { \"identifiers\": [\"room_settings_{{ repeat.item }}\"] }\n              }\n</code></pre> <p># ... (Helper Scripts set_room_timer, etc. remain the same) ...   set_room_timer:     alias: \"System: Set Room Timer\"     mode: parallel     fields:       room_slug:         description: \"Room Slug (e.g. bathroom)\"         required: true     sequence:       - variables:           seconds: \"{{ states('number.' ~ room_slug ~ '_lights_presence_delay') | int(0) }}\"       - service: mqtt.publish         data:           topic: \"room/{{ room_slug }}/timer/attributes\"           payload: &gt;-             { \"duration\": \"{{ seconds }}\" }           retain: true       - service: mqtt.publish         data:           topic: \"room/{{ room_slug }}/timer/state\"           payload: \"{{ (now() + timedelta(seconds=seconds)).isoformat() }}\"           retain: true</p> <p>cancel_room_timer:     alias: \"System: Cancel Room Timer\"     mode: parallel     fields:       room_slug:         description: \"Room Slug\"         required: true     sequence:       - service: mqtt.publish         data:           topic: \"room/{{ room_slug }}/timer/attributes\"           payload: \"{}\"           retain: true       - service: mqtt.publish         data:           topic: \"room/{{ room_slug }}/timer/state\"           payload: \"unknown\"           retain: true</p> <p>set_room_state:     alias: \"System: Set Room State\"     mode: parallel     fields:       room_slug:         description: \"Room Slug\"         required: true       state:         description: \"Occupied, Idle, or Absence\"         required: true     sequence:       - service: mqtt.publish         data:           topic: \"room/{{ room_slug }}/state/set\"           payload: \"{{ state }}\"           retain: true</p> <p>set_room_occupancy:     alias: \"System: Set Room Occupancy\"     mode: parallel     fields:       room_slug:         description: \"Room Slug\"         required: true       occupied:         description: \"True (ON) or False (OFF)\"         required: true     sequence:       - service: mqtt.publish         data:           topic: \"room/{{ room_slug }}/occupancy/state\"           payload: \"{{ 'ON' if occupied else 'OFF' }}\"           retain: true</p>","tags":["package","automated"]},{"location":"smart-home/packages/room_manager/#-_7","title":"------------------------------------------------------------------------------","text":"","tags":["package","automated"]},{"location":"smart-home/packages/room_manager/#4-automations","title":"4. AUTOMATIONS","text":"","tags":["package","automated"]},{"location":"smart-home/packages/room_manager/#-_8","title":"------------------------------------------------------------------------------","text":"<p>automation:   # Keeps the MQTT Selects/Numbers in sync (State Persistence)   - alias: \"System: Room MQTT Persistence\"     id: system_room_mqtt_persistence     mode: parallel     trigger:       - platform: mqtt         topic: \"room/#\"     condition:       - condition: template         value_template: \"{{ trigger.topic.endswith('/set') }}\"     action:       - service: mqtt.publish         data:           topic: \"{{ trigger.topic[:-4] }}/state\"           payload: \"{{ trigger.payload }}\"           retain: true</p> <ul> <li> <p>alias: \"System: Populate Room Lists\"     id: system_populate_room_list     trigger:</p> <ul> <li>platform: homeassistant     event: start</li> <li>platform: time_pattern     hours: \"/1\" action:   # Define room_slugs for use in cleanup loop</li> <li>variables:       room_slugs: &gt;-         {% set ns = namespace(rooms=[]) %}         {% set mode_selectors = states.select | selectattr('object_id', 'search', 'automation_mode$') | list %}         {% for sel in mode_selectors %}            {% set raw_id = sel.entity_id.split('.')[1] %}            {% set base = raw_id | replace('_automation_mode', '') %}            {% if base.startswith('room') %}               {% set slug = base[5:] %}            {% else %}               {% set slug = base %}            {% endif %}            {% set ns.rooms = ns.rooms + [slug] %}         {% endfor %}         {{ ns.rooms | unique | list }}</li> </ul> <p># 1. Populate 'Create' dropdown with Native Areas   - service: input_select.set_options     target:       entity_id: input_select.room_mgmt_create_select     data:       options: &gt;         {# Get list of all area IDs #}         {{ (['unknown'] + areas() | sort | list) }}</p> <p># 2. Populate 'Delete' dropdown with Existing Rooms   - service: input_select.set_options     target:       entity_id: input_select.room_mgmt_delete_select     data:       # UPDATED: Fixed populate logic to properly strip prefixes       options: &gt;         {% set ns = namespace(rooms=[]) %}         {% set mode_selectors = states.select | selectattr('object_id', 'search', 'automation_mode$') | list %}         {% for sel in mode_selectors %}            {# Extract slug. Handles \"select.bathroom_automation_mode\" or \"select.room_bathroom_automation_mode\" #}            {% set raw_id = sel.entity_id.split('.')[1] %}            {% set base = raw_id | replace('_automation_mode', '') %}            {% if base.startswith('room') %}               {% set slug = base[5:] %}            {% else %}               {% set slug = base %}            {% endif %}            {% set ns.rooms = ns.rooms + [slug] %}         {% endfor %}         {{ (['unknown'] + ns.rooms | unique | list) }}   # 3. Purge Legacy Text Bed Sensors (Fixes MQTT Warnings)   - repeat:       for_each: \"{{ room_slugs }}\"       sequence:         - service: mqtt.publish           data:             retain: true             topic: \"homeassistant/text/room_{{ repeat.item }}_bed_sensor/config\"             payload: \"\"</p> <ul> <li>service: script.refresh_room_options</li> </ul> </li> </ul>","tags":["package","automated"]},{"location":"smart-home/packages/scenes/","title":"Package: Scenes","text":"","tags":["package","automated"]},{"location":"smart-home/packages/scenes/#package-scenes","title":"Package: Scenes","text":"<p>Version: 1.0.0 Description: Definitions for various lighting scenes (Daylight, Night, Movie, etc.)</p> <p></p>","tags":["package","automated"]},{"location":"smart-home/packages/scenes/#executive-summary","title":"Executive Summary","text":"<p>The Scenes package serves as the centralized library for lighting presets across the home. It defines specific, reproducible states (brightness, color, and temperature) for groups of lights, enabling standardized \"moods\" like \"Daylight\", \"Night\", \"TV\", and \"Relax\" to be activated by dashboards or automations.</p>","tags":["package","automated"]},{"location":"smart-home/packages/scenes/#process-description-non-technical","title":"Process Description (Non-Technical)","text":"<p>Think of this package as a \"Recipe Book\" for your lights. Instead of manually adjusting five different bulbs to get the perfect movie lighting, you define a \"TV Scene\" once. 1.  Definition: Contains the exact settings (color, brightness) for every light in a room for a specific activity. 2.  Activation: When you tap a button or a motion sensor triggers, Home Assistant simply looks up the \"Recipe\" and tells all the lights to match it instantly.</p>","tags":["package","automated"]},{"location":"smart-home/packages/scenes/#dashboard-connections","title":"Dashboard Connections","text":"<p>This package powers the following dashboard views:</p> <ul> <li>Bedroom: The Bedroom dashboard focuses on comfort and sleep tracking. It provides controls for the ceiling and bed lights, as well as both window blinds and roller covers. Environmental health is monitored via CO2, temperature, and humidity graphs. A specialized section covers 'Bed Occupancy', aggregating data from pressure sensors and mmWave (FP2) sensors to accurately detect presence in bed for both sides, enabling advanced sleep automations. (Uses 2 entities)</li> <li>Hallway: This view manages the Hallway area. It provides simple controls for the ceiling and stair lights. The dashboard also visualizes presence data from multiple FP2 sensors (Hallway and Downstairs) and includes standard occupancy and scheduling settings. (Uses 1 entities)</li> <li>Kitchen: This view offers comprehensive control over the Kitchen. It monitors critical appliances, showing the status of the fridge (door/leak), coffee machine, and detailed cycle information for the dishwasher. Lighting controls allow for general switching or individual bulb adjustments. A key feature is the visualization of zoned presence detection (Entrance, Table, Cooking) using FP2 sensors, enabling highly granular kitchen automations. (Uses 1 entities)</li> <li>Living Room: The Living Room dashboard is a media and comfort hub. It features in-depth environmental monitoring (Radon, VOCs, CO2) via Airthings Wave, displaying historical trends. Entertainment controls are central, with remotes for the TV and Soundbar, plus power management for the media wall. The view also includes specific controls for the fireplace, air purifier modes, and various lighting scenes, alongside standard occupancy settings. (Uses 2 entities)</li> <li>Office: The Office dashboard handles both workspace environment and IT infrastructure. It offers detailed environmental tracking (Airthings Wave) and lighting prompts. Key features include remote PC control (Audio, Power, Displays) and extensive server monitoring (Proxmox, Home Assistant OS stats, SSD usage). It also manages potential window covers and detailed power consumption for office equipment. (Uses 3 entities)</li> <li>Stairs: This view manages the Stairs area. It features specific control for the WLED strip lighting on the stairs, allowing users to toggle power, adjust brightness, and select WLED presets/effects. Standard occupancy settings and scheduling options are also available. (Uses 1 entities)</li> </ul>","tags":["package","automated"]},{"location":"smart-home/packages/scenes/#architecture-diagram","title":"Architecture Diagram","text":"<p>The diagram below depicts the straightforward execution of a scene. Whether triggered by a user on a dashboard or by an automation (e.g., sunset), the <code>scene.turn_on</code> service is called. Home Assistant then retrieves the pre-defined state dictionary for that scene and issues parallel control commands to the target entities.</p> <pre><code>sequenceDiagram\n    participant User as \ud83d\udc64 User/Automation\n    participant HA as \ud83c\udfe0 Home Assistant\n    participant Scene as \ud83c\udfad Scene Registry\n    participant Lights as \ud83d\udca1 Target Lights\n\n    User-&gt;&gt;HA: Call service: scene.turn_on(scene_id)\n    HA-&gt;&gt;Scene: Lookup Entity States (e.g., \"TV Scene\")\n    Scene--&gt;&gt;HA: Return {Light A: 20%, Light B: Off}\n\n    par Parallel Execution\n        HA-&gt;&gt;Lights: Set Light A to 20%\n        HA-&gt;&gt;Lights: Turn Light B Off\n    end</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/scenes/#configuration-source-code","title":"Configuration (Source Code)","text":"<pre><code># ------------------------------------------------------------------------------\n# Package: Scenes\n# Version: 1.0.0\n# Description: Definitions for various lighting scenes (Daylight, Night, Movie, etc.)\n# Dependencies: light.* entities\n# ------------------------------------------------------------------------------\nscene:\n  - id: \"1581424717324\"\n    name: Daylight Scene\n    entities:\n      light.ikea_hallway_1:\n        state: \"off\"\n      light.ikea_hallway_2:\n        state: \"off\"\n      light.kitchen_ikea_1:\n        state: \"on\"\n        brightness: 254\n        color_temp_kelvin: 4000\n      light.kitchen_ikea_2:\n        state: \"on\"\n        brightness: 254\n        color_temp_kelvin: 4000\n      light.kitchen_ikea_3:\n        state: \"on\"\n        brightness: 254\n        color_temp_kelvin: 4000\n      light.kitchen_sink:\n        state: \"on\"\n        brightness: 254\n        color_temp_kelvin: 6500\n        effect: none\n      light.livingroom_light:\n        state: \"on\"\n        brightness: 254\n        color_temp_kelvin: 6500\n        effect: none\n      light.stairs_light:\n        state: \"on\"\n        brightness: 254\n        color_temp_kelvin: 6500\n        effect: none\n\n  - id: \"1581434276374\"\n    name: Early Morning Scene\n    icon: mdi:weather-sunset-up\n    entities:\n      light.kitchen_sink:\n        state: \"on\"\n        brightness: 128\n        color_temp_kelvin: 6500\n        effect: none\n      light.livingroom_light:\n        state: \"on\"\n        brightness: 64\n        color_temp_kelvin: 6500\n        effect: none\n\n  - id: \"1581486599024\"\n    name: TV Scene\n    entities:\n      light.ikea_hallway_1:\n        state: \"off\"\n      light.ikea_hallway_2:\n        state: \"off\"\n      light.livingroom_light:\n        state: \"on\"\n        brightness: 46\n        color_temp_kelvin: 3000\n        effect: none\n      light.stairs_light:\n        state: \"on\"\n        brightness: 51\n        color_temp_kelvin: 3000\n        effect: none\n\n  - id: \"1581525515761\"\n    name: Bedroom Mood\n    entities:\n      light.bedroom_bed_light:\n        state: \"on\"\n        brightness: 255\n        color_mode: xy\n        hs_color: [300.414, 56.863]\n        rgb_color: [255, 110, 254]\n        xy_color: [0.373, 0.19]\n      light.bedroom_ceiling_light:\n        state: \"off\"\n    metadata:\n      light.bedroom_bed_light:\n        entity_only: true\n      light.bedroom_ceiling_light:\n        entity_only: true\n\n  - id: \"1581525625146\"\n    name: Bedroom Relax\n    entities:\n      light.bedroom_bed_light:\n        state: \"on\"\n        brightness: 255\n        color_mode: xy\n        hs_color: [30.207, 56.863]\n        rgb_color: [255, 183, 110]\n        xy_color: [0.491, 0.39]\n      light.bedroom_ceiling_light:\n        state: \"off\"\n    metadata:\n      light.bedroom_bed_light:\n        entity_only: true\n      light.bedroom_ceiling_light:\n        entity_only: true\n\n  - id: \"1606678546699\"\n    name: Floor Light Bright\n    entities:\n      light.floor_light:\n        state: \"on\"\n        brightness: 255\n        color_temp_kelvin: 4000\n        hs_color: [26.812, 34.87]\n        rgb_color: [255, 205, 166]\n        xy_color: [0.421, 0.364]\n    metadata: {}\n\n  - id: \"1606678620167\"\n    name: Floor Light Daylight\n    entities:\n      light.floor_light:\n        state: \"on\"\n        brightness: 255\n        color_temp_kelvin: 6500\n        hs_color: [54.768, 1.6]\n        rgb_color: [255, 254, 250]\n        xy_color: [0.326, 0.333]\n\n  - id: \"1607802679221\"\n    name: Bedroom Bed Bright\n    entities:\n      light.bedroom_bed_light:\n        state: \"on\"\n        brightness: 255\n        color_temp_kelvin: 6500\n        hs_color: [54.768, 1.6]\n        rgb_color: [255, 254, 250]\n        xy_color: [0.326, 0.333]\n      light.bedroom_ceiling_light:\n        state: \"off\"\n    metadata:\n      light.bedroom_bed_light:\n        entity_only: true\n      light.bedroom_ceiling_light:\n        entity_only: true\n\n  - id: \"1664968673604\"\n    name: Floor Light Blue\n    entities:\n      light.floor_light:\n        state: \"on\"\n        brightness: 255\n        color_mode: xy\n        hs_color: [210.364, 96.863]\n        rgb_color: [8, 130, 255]\n        xy_color: [0.141, 0.137]\n\n  - id: \"1664974178898\"\n    name: Floor Light Night\n    entities:\n      light.floor_light:\n        state: \"on\"\n        brightness: 76\n        color_temp_kelvin: 2500\n        hs_color: [28.874, 72.522]\n        rgb_color: [255, 159, 70]\n        xy_color: [0.546, 0.389]\n\n  - id: \"1664974204685\"\n    name: Floor Light Pink\n    entities:\n      light.floor_light:\n        state: \"on\"\n        brightness: 255\n        color_mode: xy\n        hs_color: [299.754, 95.686]\n        rgb_color: [254, 11, 255]\n        xy_color: [0.385, 0.155]\n\n  - id: \"1664974379307\"\n    name: Living Room Ceiling Bright\n    entities:\n      light.living_room_ceiling_light:\n        state: \"on\"\n        brightness: 255\n        color_temp_kelvin: 4760\n        hs_color: [26.815, 22.59]\n        rgb_color: [255, 223, 197]\n        xy_color: [0.382, 0.353]\n    metadata:\n      light.living_room_ceiling_light:\n        entity_only: true\n\n  - id: \"1664974407957\"\n    name: Living Room Ceiling Daylight\n    entities:\n      light.living_room_ceiling_light:\n        state: \"on\"\n        brightness: 255\n        color_temp_kelvin: 6500\n        hs_color: [54.768, 1.6]\n        rgb_color: [255, 254, 250]\n        xy_color: [0.326, 0.333]\n    metadata:\n      light.living_room_ceiling_light:\n        entity_only: true\n\n  - id: \"1664974436190\"\n    name: Living Room Ceiling Night\n    entities:\n      light.living_room_ceiling_light:\n        state: \"on\"\n        brightness: 51\n        color_temp_kelvin: 2440\n        hs_color: [29.04, 74.777]\n        rgb_color: [255, 156, 64]\n        xy_color: [0.554, 0.389]\n    metadata:\n      light.living_room_ceiling_light:\n        entity_only: true\n\n  - id: \"1664974470333\"\n    name: Living Room Ceiling Dim\n    entities:\n      light.living_room_ceiling_light:\n        state: \"on\"\n        brightness: 64\n        color_temp_kelvin: 4760\n        hs_color: [26.815, 22.59]\n        rgb_color: [255, 223, 197]\n        xy_color: [0.382, 0.353]\n    metadata:\n      light.living_room_ceiling_light:\n        entity_only: true\n\n  - id: \"1664974508232\"\n    name: Living Room Ceiling Mood\n    entities:\n      light.living_room_ceiling_light:\n        state: \"on\"\n        brightness: 255\n        color_mode: xy\n        hs_color: [300.331, 70.98]\n        rgb_color: [255, 74, 254]\n        xy_color: [0.38, 0.17]\n    metadata:\n      light.living_room_ceiling_light:\n        entity_only: true\n\n  - id: \"1665121007096\"\n    name: Daughter Bed Dim\n    entities:\n      light.Daughter_bed_light:\n        state: \"on\"\n        brightness: 127\n        color_temp_kelvin: 5000\n        hs_color: [27.001, 19.243]\n        rgb_color: [255, 228, 205]\n        xy_color: [0.372, 0.35]\n\n  - id: \"1665121039862\"\n    name: Daughter Bed Daylight\n    entities:\n      light.Daughter_bed_light:\n        state: \"on\"\n        brightness: 255\n        color_temp_kelvin: 6500\n        hs_color: [54.768, 1.6]\n        rgb_color: [255, 254, 250]\n        xy_color: [0.326, 0.333]\n\n  - id: \"1665121075215\"\n    name: Daughter Bed Pink\n    entities:\n      light.Daughter_bed_light:\n        state: \"on\"\n        brightness: 255\n        color_mode: xy\n        hs_color: [300.331, 70.98]\n        rgb_color: [255, 74, 254]\n        xy_color: [0.38, 0.17]\n\n  - id: \"1665121117806\"\n    name: Daughter Bed Relax\n    entities:\n      light.Daughter_bed_light:\n        state: \"on\"\n        brightness: 51\n        color_mode: xy\n        hs_color: [30, 43.137]\n        rgb_color: [255, 200, 145]\n        xy_color: [0.443, 0.379]\n\n  - id: \"1665121500547\"\n    name: Bedroom Bright\n    entities:\n      light.bedroom_ceiling_light:\n        state: \"on\"\n        brightness: 255\n      light.bedroom_bed_light:\n        state: \"on\"\n        brightness: 255\n        color_temp_kelvin: 5000\n        hs_color: [27.001, 19.243]\n        rgb_color: [255, 228, 205]\n        xy_color: [0.372, 0.35]\n\n  - id: \"1666102359369\"\n    name: Guest-2 Dim\n    entities:\n      light.Guest-2_ceiling_light:\n        state: \"on\"\n        brightness: 64\n        color_temp_kelvin: 4000\n        hs_color: [26.812, 34.87]\n        rgb_color: [255, 205, 166]\n        xy_color: [0.421, 0.364]\n    metadata:\n      light.Guest-2_ceiling_light:\n        entity_only: true\n\n  - id: \"1666102385906\"\n    name: Guest-2 Bright\n    entities:\n      light.Guest-2_ceiling_light:\n        state: \"on\"\n        brightness: 255\n        color_temp_kelvin: 4000\n        hs_color: [26.812, 34.87]\n        rgb_color: [255, 205, 166]\n        xy_color: [0.421, 0.364]\n    metadata:\n      light.Guest-2_ceiling_light:\n        entity_only: true\n\n  - id: \"1666102425014\"\n    name: Guest-2 Night\n    entities:\n      light.Guest-2_ceiling_light:\n        state: \"on\"\n        brightness: 13\n        color_temp_kelvin: 2200\n        hs_color: [29.79, 84.553]\n        rgb_color: [255, 146, 39]\n        xy_color: [0.579, 0.388]\n    metadata:\n      light.Guest-2_ceiling_light:\n        entity_only: true\n</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/shelly_3em/","title":"Package: Shelly 3Em","text":"","tags":["package","automated"]},{"location":"smart-home/packages/shelly_3em/#package-shelly-3em","title":"Package: Shelly 3Em","text":"<p>Version: 1.0.0 Description: Power aggregation for Shelly 3EM (Total Power, Energy)</p> <p></p>","tags":["package","automated"]},{"location":"smart-home/packages/shelly_3em/#executive-summary","title":"Executive Summary","text":"<p>The Shelly 3EM package is a critical energy monitoring abstraction layer. It aggregates data from the three individual phases of the physical Shelly 3EM device into unified \"Whole Home\" metrics. It calculates real-time total power (Watts) and cumulative energy consumption (kWh), providing the foundational data for energy dashboards and cost calculations.</p>","tags":["package","automated"]},{"location":"smart-home/packages/shelly_3em/#process-description-non-technical","title":"Process Description (Non-Technical)","text":"<p>Your home connects to the grid via three separate power lines (phases). The Shelly 3EM measures each one individually. This package combines them: 1.  Summing: It adds Phase A + Phase B + Phase C to give you one simple number: \"Total House Power.\" 2.  Standardization: It ensures units are correct so the Energy Dashboard can read them. 3.  Special calculations: It creates a \"15-minute energy\" tracker, useful for seeing short-term consumption spikes.</p>","tags":["package","automated"]},{"location":"smart-home/packages/shelly_3em/#dashboard-connections","title":"Dashboard Connections","text":"<p>No linked dashboard views found (Automatic Scan).</p>","tags":["package","automated"]},{"location":"smart-home/packages/shelly_3em/#architecture-diagram","title":"Architecture Diagram","text":"<p>The diagram below shows the data aggregation flow. The physical Shelly 3EM device provides three separate data streams (one per phase). The Template Sensors defined in this package subscribe to state changes on all three channels. Whenever a change is detected, the template logic executes, summing the values (A+B+C) and updating the single \"Home Total\" entity effectively in real-time.</p> <pre><code>graph LR\n    subgraph Physical Device\n    A[Phase A Power]\n    B[Phase B Power]\n    C[Phase C Power]\n    end\n\n    subgraph Template Logic\n    Sum((\u03a3 Sum))\n    Start[Phase A + B + C]\n    end\n\n    subgraph Output Entities\n    Total[Home Total Power&lt;br&gt;(Watts)]\n    Energy[Home Total Energy&lt;br&gt;(kWh)]\n    end\n\n    A &amp; B &amp; C --&gt; Start --&gt; Sum\n    Sum --&gt; Total\n    Sum --&gt; Energy</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/shelly_3em/#configuration-source-code","title":"Configuration (Source Code)","text":"<pre><code># ------------------------------------------------------------------------------\n# Package: Shelly 3EM\n# Version: 1.0.0\n# Description: Power aggregation for Shelly 3EM (Total Power, Energy)\n# Dependencies: sensor.home_energy_shelly_3em_*\n# ------------------------------------------------------------------------------\ntemplate:\n  - sensor:\n      - name: \"Home Total Power\"\n        unique_id: home_total_power\n        unit_of_measurement: \"W\"\n        device_class: power\n        state_class: measurement\n        state: &gt;\n          {{ states('sensor.home_energy_shelly_3em_channel_a_power') | float(0)\n            + states('sensor.home_energy_shelly_3em_channel_b_power') | float(0)\n            + states('sensor.home_energy_shelly_3em_channel_c_power') | float(0) }}\n\n      - name: \"Home Total 3EM Energy\"\n        unique_id: home_total_3em_energy\n        unit_of_measurement: \"kWh\"\n        device_class: energy\n        state_class: total_increasing\n        state: &gt;\n          {{ states('sensor.home_energy_shelly_3em_channel_a_energy') | float(0)\n            + states('sensor.home_energy_shelly_3em_channel_b_energy') | float(0)\n            + states('sensor.home_energy_shelly_3em_channel_c_energy') | float(0) }}\n\n      - name: \"Home Energy 15min\"\n        unique_id: home_energy_15min\n        unit_of_measurement: \"kWh\"\n        device_class: energy\n        state_class: total_increasing\n        state: &gt;\n          {% set power_a = states('sensor.shelly_3em_channel_a_power') | float(0) %}\n          {% set power_b = states('sensor.shelly_3em_channel_b_power') | float(0) %}\n          {% set power_c = states('sensor.shelly_3em_channel_c_power') | float(0) %}\n          {% set total_power = power_a + power_b + power_c %}\n          {{ ((total_power / 1000) * 0.25) | round(4) }}\n</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/smart_notifications/","title":"Package: Smart Notifications","text":"","tags":["package","automated"]},{"location":"smart-home/packages/smart_notifications/#package-smart-notifications","title":"Package: Smart Notifications","text":"<p>Version: 1.0.0 Description: Helpers and logic for the dynamic notification router</p> <p></p>","tags":["package","automated"]},{"location":"smart-home/packages/smart_notifications/#executive-summary","title":"Executive Summary","text":"<p>The Smart Notifications package is a dynamic, user-centric routing engine for Home Assistant. Unlike static notification groups, this system allows users to manage their own subscriptions to different notification categories (e.g., Security, System, Info) directly from the dashboard. It abstracts the complexity of device management, automatically handling device services (Android/iOS) and presence detection, ensuring alerts are delivered only when relevant and desired.</p>","tags":["package","automated"]},{"location":"smart-home/packages/smart_notifications/#process-description-non-technical","title":"Process Description (Non-Technical)","text":"<p>The system operates on a \"Publish-Subscribe\" model adapted for a smart home:</p> <ol> <li>User Onboarding: An administrator selects a Home Assistant <code>person</code> entity and \"initializes\" them. The system automatically generates a suite of configuration \"helpers\" (switches) for every notification category defined in the system.</li> <li>Preference Management: Users interact with a dashboard calling these switches. If a user wants to mute \"Security\" alerts but keep \"Energy\" alerts, they simply toggle the respective switches.</li> <li>Smart Routing: When an automation needs to send a notification, it calls the <code>notify_smart_master</code> script with a <code>category</code> (e.g., <code>security</code>) and the message.</li> <li>Delivery Logic: The router iterates through all registered users. For each user, it checks:<ul> <li>Subscription: Is the switch for this category ON?</li> <li>Presence: If the alert is \"local only\" or the user is away (and presence checks are enabled), the message is suppressed.</li> <li>Platform: It formats the message specifically for the user's defined device type (iOS vs Android), handling critical alerts and actionable notifications appropriate to the platform.</li> </ul> </li> </ol>","tags":["package","automated"]},{"location":"smart-home/packages/smart_notifications/#dashboard-connections","title":"Dashboard Connections","text":"<p>This package powers the following dashboard views:</p> <ul> <li>System: This view provides deep insights into the Proxmox 'Halo' virtualization node. It features real-time resource monitoring (CPU, RAM) using <code>mini-graph-card</code>, and critical power controls (Reboot, Shutdown) protected by confirmation dialogs. It also offers bulk management for guest VMs/containers and tracks system update status, ensuring the infrastructure host is healthy and up-to-date. (Uses 1 entities)</li> <li>Living Room: The Living Room dashboard is a media and comfort hub. It features in-depth environmental monitoring (Radon, VOCs, CO2) via Airthings Wave, displaying historical trends. Entertainment controls are central, with remotes for the TV and Soundbar, plus power management for the media wall. The view also includes specific controls for the fireplace, air purifier modes, and various lighting scenes, alongside standard occupancy settings. (Uses 1 entities)</li> <li>Notifications Management: The Notification Center dashboard provides a comprehensive interface for managing the smart home's notification system. Administrators can add or remove users for mobile app notifications and define notification categories (e.g., 'Garage', 'Electricity'). The view allows for granular control over subscriptions, enabling individual users to opt-in or out of specific notification types, and includes tools to map and monitor notification-related automations. (Uses 9 entities)</li> <li>Room Management: The Room Management dashboard serves as the administrative backend for the home's room logic. It allows users to initialize new rooms (creating necessary helper entities) or delete existing ones. It features a dynamic \"Configured Rooms\" section powered by <code>auto-entities</code>, which automatically lists all configured rooms and provides collapsible controls for their automation modes, occupancy sensors, and timeouts. (Uses 2 entities)</li> </ul>","tags":["package","automated"]},{"location":"smart-home/packages/smart_notifications/#architecture-diagram","title":"Architecture Diagram","text":"<p>When a notification request triggers the <code>notify_smart_master</code> router, the system begins a parallel evaluation for every registered user. It retrieves the user's specific settings\u2014checking if they have subscribed to the message's <code>category</code>, verifying if a 'Presence Check' is required, and determining their current device platform (iOS or Android). Only if the subscription is active and the presence criteria are met does the router format the payload (adjusting for platform-specifics like critical volume or click actions) and dispatch it to the specific mobile app service.</p> <pre><code>sequenceDiagram\n    participant Auto as Automation\n    participant Router as Script: Smart Master\n    participant Config as User Switches\n    participant Logic as Logic Filter\n    participant App as Mobile App\n\n    Auto-&gt;&gt;Router: Call (Title, Msg, Category=\"security\")\n    loop For Each User\n        Router-&gt;&gt;Config: Check State: switch.user_security_notification\n        Config--&gt;&gt;Router: State \"ON\"\n\n        Router-&gt;&gt;Logic: Check Presence Requirement\n        alt User is Home OR Presence User Not Required\n            Logic--&gt;&gt;Router: Allowed\n            Router-&gt;&gt;Router: Format Data (Android/iOS)\n            Router-&gt;&gt;App: Send Notification\n        else User Away AND Required\n            Logic--&gt;&gt;Router: Blocked\n        end\n    end</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/smart_notifications/#configuration-source-code","title":"Configuration (Source Code)","text":"<pre><code># ------------------------------------------------------------------------------\n# Package: Smart Notification System\n# Version: 1.0.0\n# Description: Helpers and logic for the dynamic notification router\n# Dependencies: notify.*, input_select.notify_mgmt_service, script.notify_smart_master\n# ------------------------------------------------------------------------------\n\n# ------------------------------------------------------------------------------\n# 1. HELPERS (Input Text, Select)\n# ------------------------------------------------------------------------------\ninput_text:\n  # RETAINED: Only retained helpers for categories and deletion IDs\n  ## MASTER LIST FOR THE CATEGORIES\n  notify_mgmt_categories:\n    name: \"Categories (comma-separated)\"\n    initial: \"info,system,security,alarm,doorbell\"\n\n  # TO BE REMOVED\n  notify_delete_category:\n    name: \"Category to Delete\"\n    icon: mdi:archive-remove\n\n  notify_add_category:\n    name: \"New Category Name\"\n    icon: mdi:playlist-plus\n\ninput_select:\n  # Dropdown for selecting a category to delete\n  notify_delete_category:\n    name: \"Category to Delete\"\n    icon: mdi:archive-remove\n    options:\n      - \"-select-\"\n\n  # Dropdown populated with existing Home Assistant Persons\n  notify_mgmt_person_select:\n    name: \"Select Person to Initialize\"\n    icon: mdi:account-circle\n    options:\n      - \"-select-\" # Placeholder before population\n\n  # List of the Notify services for devices\n  notify_mgmt_service:\n    name: \"Notify Service\"\n    icon: mdi:cellphone-message\n    options:\n      - \"-select-\"\n\n  # Dropdown for mobile platform\n  notify_mgmt_platform:\n    name: \"Platform\"\n    options:\n      - android\n      - ios\n    icon: mdi:apple-ios\n\n  # Dropdown for deleting users\n  notify_mgmt_delete_user_select:\n    name: \"Select User to Delete\"\n    icon: mdi:account-remove\n    options:\n      - \"-select-\"\n\n# ------------------------------------------------------------------------------\n# 2. INPUT BOOLEANS (Flags &amp; Maintenance)\n# ------------------------------------------------------------------------------\ninput_boolean:\n\n  # Global Category Settings (Generated dynamically, but good to have base logic ready)\n  # Note: Individual category switches are MQTT switches now, not input_booleans.\n\n  # Removed: notify_flag_person_list_refresh (Not used, we trigger automation directly)\n\n# ... (Rest of the file remains the same)\n\n# ------------------------------------------------------------------------------\n# 3. SCRIPTS &amp; AUTOMATIONS (Logic)\n# ------------------------------------------------------------------------------\nscript:\n  # --- CREATE USER (Pulls Name and ID from Person Entity) ---\n  create_notify_user:\n    alias: \"System: Create Notification User\"\n    icon: mdi:account-plus\n    mode: single\n    sequence:\n      - variables:\n          # Get selected person name (e.g., \"Evis\")\n          user_name: \"{{ states('input_select.notify_mgmt_person_select') }}\"\n          # CRITICAL: Create slug (e.g., \"Evis\" -&gt; \"Evis\")\n          user_slug: \"{{ user_name | slugify }}\"\n          # Ensure we link back to the native HA person entity\n          person_entity: \"person.{{ user_name | slugify }}\"\n\n          notify_service: \"{{ states('input_select.notify_mgmt_service') }}\"\n          platform: \"{{ states('input_select.notify_mgmt_platform') }}\"\n          categories: \"{{ states('input_text.notify_mgmt_categories') }}\"\n\n      - repeat:\n          for_each: \"{{ categories.split(',') | map('trim') | list }}\"\n          sequence:\n            # A. Create User Switch\n            - service: mqtt.publish\n              data:\n                retain: true\n                topic: \"homeassistant/switch/notify_{{ user_slug }}_{{ repeat.item }}/config\"\n                payload: &gt;-\n                  {\n                    \"name\": \"{{ repeat.item|capitalize }} Notification\",\n                    \"default_entity_id\": \"switch.{{ repeat.item }}_notification_{{ user_slug }}\",\n                    \"unique_id\": \"notify_switch_{{ user_slug }}_{{ repeat.item }}\",\n                    \"icon\": \"mdi:bell-ring\",\n                    \"command_topic\": \"notify/{{ user_slug }}/{{ repeat.item }}/set\",\n                    \"state_topic\": \"notify/{{ user_slug }}/{{ repeat.item }}/state\",\n                    \"availability_topic\": \"notify/{{ user_slug }}/availability\",\n                    \"payload_available\": \"online\",\n                    \"json_attributes_topic\": \"notify/{{ user_slug }}/attributes\",\n                    \"device\": {\n                      \"identifiers\": [\"notify_user_{{ user_slug }}\"],\n                      \"name\": \"{{ user_name }} |\",\n                      \"manufacturer\": \"Home Assistant\",\n                      \"model\": \"Notification Profile\"\n                    }\n                  }\n            - service: mqtt.publish\n              data:\n                retain: true\n                topic: \"notify/{{ user_slug }}/attributes\"\n                payload: &gt;-\n                  { \"user_slug\": \"{{ user_slug }}\", \"linked_person\": \"{{ person_entity }}\" }\n\n            - if:\n                - condition: template\n                  value_template: &gt;-\n                    {{ states('switch.' ~ repeat.item ~ '_notification_' ~ user_slug) in ['unknown', 'unavailable', 'none'] }}\n              then:\n                - service: mqtt.publish\n                  data:\n                    retain: true\n                    topic: \"notify/{{ user_slug }}/{{ repeat.item }}/state\"\n                    payload: \"ON\"\n\n            # B. Create GLOBAL CATEGORY SETTING Switch (Unchanged)\n            - service: mqtt.publish\n              data:\n                retain: true\n                topic: \"homeassistant/switch/notify_category_{{ repeat.item }}_local/config\"\n                payload: &gt;-\n                  {\n                    \"name\": \"Notify {{ repeat.item|capitalize }}: When Home\",\n                    \"name\": \"Notify {{ repeat.item|capitalize }}: When Home\",\n                    \"unique_id\": \"notify_category_{{ repeat.item }}_local\",\n                    \"icon\": \"mdi:home-account\",\n                    \"command_topic\": \"notify/settings/{{ repeat.item }}/local_only/set\",\n                    \"state_topic\": \"notify/settings/{{ repeat.item }}/local_only/state\",\n                    \"device\": {\n                      \"identifiers\": [\"notify_system_settings\"],\n                      \"name\": \"Cat |\",\n                      \"manufacturer\": \"Home Assistant\",\n                      \"model\": \"Global Rules\"\n                    }\n                  }\n\n            - if:\n                - condition: template\n                  value_template: &gt;-\n                    {{ states('switch.notify_category_' ~ repeat.item ~ '_local') in ['unknown', 'unavailable', 'none'] }}\n              then:\n                - service: mqtt.publish\n                  data:\n                    retain: true\n                    topic: \"notify/settings/{{ repeat.item }}/local_only/state\"\n                    payload: \"OFF\"\n\n      # C. Create Helpers\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/text/notify_{{ user_slug }}_service/config\"\n          payload: &gt;-\n            {\n              \"name\": \"{{ user_name }} Notify Service\",\n              \"name\": \"{{ user_name }} Notify Service\",\n              \"unique_id\": \"notify_service_{{ user_slug }}\",\n              \"icon\": \"mdi:cellphone\",\n              \"command_topic\": \"notify/{{ user_slug }}/service/set\",\n              \"state_topic\": \"notify/{{ user_slug }}/service/state\",\n              \"availability_topic\": \"notify/{{ user_slug }}/availability\",\n              \"device\": { \"identifiers\": [\"notify_user_{{ user_slug }}\"] }\n            }\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"notify/{{ user_slug }}/service/state\"\n          payload: \"{{ notify_service }}\"\n\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/select/notify_{{ user_slug }}_platform/config\"\n          payload: &gt;-\n            {\n              \"name\": \"{{ user_name }} Phone Platform\",\n              \"name\": \"{{ user_name }} Phone Platform\",\n              \"unique_id\": \"notify_platform_{{ user_slug }}\",\n              \"icon\": \"mdi:apple-ios\",\n              \"options\": [\"android\", \"ios\"],\n              \"command_topic\": \"notify/{{ user_slug }}/platform/set\",\n              \"state_topic\": \"notify/{{ user_slug }}/platform/state\",\n              \"availability_topic\": \"notify/{{ user_slug }}/availability\",\n              \"device\": { \"identifiers\": [\"notify_user_{{ user_slug }}\"] }\n            }\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"notify/{{ user_slug }}/platform/state\"\n          payload: \"{{ platform }}\"\n\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"notify/{{ user_slug }}/availability\"\n          payload: \"online\"\n\n      # Refresh Lists\n      - delay: \"00:00:02\"\n      - service: automation.trigger\n        target:\n          entity_id: automation.system_populate_notify_services\n        data:\n          skip_condition: true\n\n      # Reset Dropdowns\n      - service: input_select.select_option\n        target:\n          entity_id:\n            - input_select.notify_mgmt_person_select\n            - input_select.notify_mgmt_service\n        data:\n          option: \"-select-\"\n\n  # --- DELETE USER (Updated to use Dropdown) ---\n  delete_notify_user:\n    alias: \"System: Delete Notification User\"\n    icon: mdi:account-remove\n    mode: single\n    sequence:\n      - variables:\n          # Get slug from dropdown\n          user_slug: \"{{ states('input_select.notify_mgmt_delete_user_select') }}\"\n          categories: \"{{ states('input_text.notify_mgmt_categories') }}\"\n\n      - repeat:\n          for_each: \"{{ categories.split(',') | map('trim') | list }}\"\n          sequence:\n            - service: mqtt.publish\n              data:\n                retain: true\n                topic: \"homeassistant/switch/notify_{{ user_slug }}_{{ repeat.item }}/config\"\n                payload: \"\"\n\n      # Delete Helpers\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/text/notify_{{ user_slug }}_service/config\"\n          payload: \"\"\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/select/notify_{{ user_slug }}_platform/config\"\n          payload: \"\"\n\n      # Set Offline\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"notify/{{ user_slug }}/availability\"\n          payload: \"offline\"\n\n      # Refresh Lists\n      - delay: \"00:00:02\"\n      - service: automation.trigger\n        target:\n          entity_id: automation.system_populate_notify_services\n        data:\n          skip_condition: true\n\n      # Reset Dropdown\n      - service: input_select.select_option\n        target:\n          entity_id: input_select.notify_mgmt_delete_user_select\n        data:\n          option: \"-select-\"\n\n  # --- DELETE CATEGORY ---\n  delete_notify_category_global:\n    alias: \"System: Delete Notification Category\"\n    icon: mdi:archive-remove\n    mode: single\n    sequence:\n      - variables:\n          # NOW USES THE INPUT SELECT\n          category: \"{{ states('input_select.notify_delete_category') | trim | lower }}\"\n          current_list: \"{{ states('input_text.notify_mgmt_categories') }}\"\n\n      # Prevent deleting if 'select' is chosen or empty\n      - condition: template\n        value_template: \"{{ category not in ['-select-', 'select', 'unknown', 'unavailable', ''] }}\"\n\n      # Remove from Master List (Text Input)\n      - service: input_text.set_value\n        target:\n          entity_id: input_text.notify_mgmt_categories\n        data:\n          value: &gt;-\n            {{ current_list.split(',') \n               | map('trim') \n               | reject('eq', category) \n               | join(',') }}\n\n      # Remove Global Switch Config\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/switch/notify_category_{{ category }}_local/config\"\n          payload: \"\"\n\n      # Remove User Switches for this category\n      - repeat:\n          for_each: &gt;-\n            {{ states.switch \n               | selectattr('entity_id', 'search', '^switch\\.' ~ category ~ '_notification_')\n               | map(attribute='attributes.user_slug') \n               | reject('undefined')\n               | unique \n               | list }}\n          sequence:\n            - service: mqtt.publish\n              data:\n                retain: true\n                topic: \"homeassistant/switch/notify_{{ repeat.item }}_{{ category }}/config\"\n                payload: \"\"\n\n      # Refresh Lists (updates dropdowns immediately)\n      - delay: \"00:00:01\"\n      - service: automation.trigger\n        target:\n          entity_id: automation.system_populate_notify_services\n        data:\n          skip_condition: true\n\n      # Reset dropdown to safe default\n      - service: input_select.select_option\n        target:\n          entity_id: input_select.notify_delete_category\n        data:\n          option: \"-select-\"\n\n  # --- ADD NEW CATEGORY (Global + All Users) ---\n  add_notify_category_global:\n    alias: \"System: Add Notification Category\"\n    icon: mdi:playlist-plus\n    mode: single\n    sequence:\n      - variables:\n          new_category: \"{{ states('input_text.notify_add_category') | trim | lower }}\"\n          current_list: \"{{ states('input_text.notify_mgmt_categories') }}\"\n\n      # 1. Update Master List (if not exists)\n      - if:\n          - condition: template\n            value_template: \"{{ new_category not in current_list.split(',') }}\"\n        then:\n          - service: input_text.set_value\n            target:\n              entity_id: input_text.notify_mgmt_categories\n            data:\n              value: \"{{ current_list ~ ',' ~ new_category if current_list|length &gt; 0 else new_category }}\"\n\n      # 2. Create Global Setting Switch\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/switch/notify_category_{{ new_category }}_local/config\"\n          payload: &gt;-\n            {\n              \"name\": \"Notify {{ new_category|capitalize }}: When Home\",\n              \"default_entity_id\": \"switch.notify_category_{{ new_category }}_local\",\n              \"unique_id\": \"notify_category_{{ new_category }}_local\",\n              \"icon\": \"mdi:home-account\",\n              \"command_topic\": \"notify/settings/{{ new_category }}/local_only/set\",\n              \"state_topic\": \"notify/settings/{{ new_category }}/local_only/state\",\n              \"device\": {\n                \"identifiers\": [\"notify_system_settings\"],\n                \"name\": \"Cat |\",\n                \"manufacturer\": \"Home Assistant\",\n                \"model\": \"Global Rules\"\n              }\n            }\n      # Init to OFF\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"notify/settings/{{ new_category }}/local_only/state\"\n          payload: \"OFF\"\n\n      # 3. Add Switch to ALL Existing Users\n      - repeat:\n          for_each: &gt;-\n            {{ states.text \n               | selectattr('entity_id', 'search', '^text\\.notify_service_') \n               | map(attribute='object_id') \n               | map('replace', 'notify_service_', '') \n               | list }}\n          sequence:\n            - variables:\n                user_slug: \"{{ repeat.item }}\"\n\n            # Create the switch for this user\n            - service: mqtt.publish\n              data:\n                retain: true\n                topic: \"homeassistant/switch/notify_{{ user_slug }}_{{ new_category }}/config\"\n                payload: &gt;-\n                  {\n                    \"name\": \"{{ new_category|capitalize }} Notification\",\n                    \"object_id\": \"{{ new_category }}_notification_{{ user_slug }}\",\n                    \"default_entity_id\": \"switch.{{ new_category }}_notification_{{ user_slug }}\",\n                    \"unique_id\": \"notify_switch_{{ user_slug }}_{{ new_category }}\",\n                    \"icon\": \"mdi:bell-ring\",\n                    \"command_topic\": \"notify/{{ user_slug }}/{{ new_category }}/set\",\n                    \"state_topic\": \"notify/{{ user_slug }}/{{ new_category }}/state\",\n                    \"availability_topic\": \"notify/{{ user_slug }}/availability\",\n                    \"payload_available\": \"online\",\n                    \"json_attributes_topic\": \"notify/{{ user_slug }}/attributes\",\n                    \"device\": {\n                      \"identifiers\": [\"notify_user_{{ user_slug }}\"],\n                      \"manufacturer\": \"Home Assistant\",\n                      \"model\": \"Notification Profile\"\n                    }\n                  }\n            # Set State ON\n            - service: mqtt.publish\n              data:\n                retain: true\n                topic: \"notify/{{ user_slug }}/{{ new_category }}/state\"\n                payload: \"ON\"\n\n      # 4. Add Switch to ALL Smart Speakers\n      - variables:\n          all_speakers: &gt;-\n            {{ states.switch \n               | selectattr('attributes.speaker_slug', 'defined')\n               | map(attribute='attributes.speaker_slug')\n               | unique\n               | list }}\n      - repeat:\n          for_each: \"{{ all_speakers }}\"\n          sequence:\n            - service: mqtt.publish\n              data:\n                retain: true\n                topic: \"homeassistant/switch/speaker_{{ repeat.item }}_notify_{{ new_category }}/config\"\n                payload: &gt;-\n                  {{\n                    {\n                      \"name\": new_category | title,\n                      \"default_entity_id\": \"switch.speaker_\" ~ repeat.item ~ \"_notify_\" ~ new_category,\n                      \"unique_id\": \"speaker_notif_\" ~ repeat.item ~ \"_\" ~ new_category ~ \"_v4\",\n                      \"icon\": \"mdi:bell-ring\",\n                      \"command_topic\": \"speaker/\" ~ repeat.item ~ \"/notify_\" ~ new_category ~ \"/set\",\n                      \"state_topic\": \"speaker/\" ~ repeat.item ~ \"/notify_\" ~ new_category ~ \"/state\",\n                      \"payload_on\": \"ON\",\n                      \"payload_off\": \"OFF\",\n                      \"device\": { \"identifiers\": [\"smart_speaker_\" ~ repeat.item] }\n                    } | to_json\n                  }}\n            # Default to ON\n            - service: mqtt.publish\n              data:\n                retain: true\n                topic: \"speaker/{{ repeat.item }}/notify_{{ new_category }}/state\"\n                payload: \"ON\"\n\n      # Refresh Lists\n      - delay: \"00:00:01\"\n      - service: automation.trigger\n        target:\n          entity_id: automation.system_populate_notify_services\n        data:\n          skip_condition: true\n\n  # --- MASTER ROUTER (Unchanged) ---\n  notify_smart_master:\n    alias: \"Notify: Master Router\"\n    icon: mdi:message-badge-outline\n    mode: parallel\n    fields:\n      category:\n        description: \"Notification Category\"\n        default: \"info\"\n      title:\n        description: \"Title\"\n      message:\n        description: \"Body\"\n      image:\n        description: \"Image Path\"\n      tag:\n        description: \"Grouping tag\"\n      actions:\n        description: \"List of buttons\"\n      clickAction:\n        description: \"Link click\"\n      sticky:\n        description: \"Sticky\"\n      critical:\n        description: \"Critical alert\"\n      presence_only:\n        description: \"Override: Force check presence\"\n        default: null\n      source_room:\n        description: \"Slug of the room where event originated (for suppression)\"\n        default: null\n      room:\n        description: \"Override: Specific room to target (bypass occupancy)\"\n        default: null\n    sequence:\n      - variables:\n          global_presence_setting: &gt;-\n            {{ states('switch.notify_category_' ~ category | default('info') ~ '_local') == 'on' }}\n          use_presence_check: &gt;-\n            {% set pres = presence_only | default(none) %}\n            {{ pres if pres is not none else global_presence_setting }}\n      - repeat:\n          for_each: &gt;-\n            {{ states.switch \n               | selectattr('entity_id', 'search', '\\.' ~ category | default('info') ~ '_notification_')\n               | selectattr('state', 'eq', 'on')\n               | map(attribute='entity_id')\n               | list }}\n          sequence:\n            - variables:\n                match_id: \"{{ repeat.item }}\"\n                # Fallback: Extract from Entity ID\n                slug_from_id: &gt;-\n                  {{ repeat.item \n                     | replace('switch.', '') \n                     | replace(category | default('info') ~ '_notify_', '') \n                     | replace('_notification', '') }}\n                user_slug: \"{{ state_attr(repeat.item, 'user_slug') | default(slug_from_id, true) }}\"\n                # Fetch Service\n                target_service: \"{{ states('text.notify_service_' ~ user_slug) }}\"\n                # Fetch Linked Person for Presence Check\n                linked_person: \"{{ state_attr(repeat.item, 'linked_person') }}\"\n\n            - service: system_log.write\n              data:\n                message: \"DEBUG MOBILE {{ user_slug }} | Service: {{ target_service }} | Match: {{ match_id }}\"\n                level: warning\n            - if:\n                - condition: template\n                  value_template: &gt;-\n                    {{ \n                      target_service is not none and target_service not in ['unknown', 'unavailable', '']\n                      and (\n                        use_presence_check == false \n                        or (linked_person is not none and is_state(linked_person, 'home'))\n                      )\n                    }}\n              then:\n                - service: \"{{ target_service }}\"\n                  data:\n                    title: \"{{ title | default('Notification') }}\"\n                    message: \"{{ message }}\"\n                    data:\n                      tag: \"{{ tag | default('') }}\"\n                      image: \"{{ image | default('') }}\"\n                      sticky: \"{{ sticky | default(false) }}\"\n                      push:\n                        sound:\n                          name: \"default\"\n                          critical: \"{{ 1 if critical | default(false) else 0 }}\"\n                          volume: \"{{ 1.0 if critical | default(false) else 0.5 }}\"\n                      ttl: \"{{ 0 if critical | default(false) else 0 }}\"\n                      priority: \"{{ 'high' if critical | default(false) else 'normal' }}\"\n                      clickAction: &gt;-\n                        {% set clk = clickAction | default('') %}\n                        {% if target_platform == 'ios' and 'app://' in (clk|string) %}\n                          unifi-protect://\n                        {% else %}\n                          {{ clk }}\n                        {% endif %}\n                      actions: \"{{ actions | default([]) }}\"\n\n      # --- 2. SMART SPEAKER ROUTING ---\n      - variables:\n          # Define Priority based on Critical flag or Category\n          # Categories 'alarm', 'security', 'doorbell', 'smoke' are inherently Critical\n          is_critical: &gt;-\n            {{ critical | default(false) or category in ['alarm', 'security', 'doorbell', 'smoke'] }}\n\n      - repeat:\n          # Find all speakers subscribed to this category\n          for_each: &gt;-\n            {{ states.switch \n               | selectattr('entity_id', 'search', '^switch\\.speaker_.*_notify_' ~ category | default('info'))\n               | selectattr('state', 'eq', 'on')\n               | map(attribute='entity_id')\n               | list }}\n          sequence:\n            - variables:\n                # Extract Slug: switch.speaker_{slug}_notify_{category}\n                config_entity: \"{{ repeat.item }}\"\n                # Regex to pull slug\n                speaker_slug: &gt;-\n                  {{ config_entity \n                     | replace('switch.speaker_', '') \n                     | replace('_notify_' ~ category | default('info'), '') }}\n\n                # Get Config Entity (now attached to Quiet Mode Switch)\n                speaker_config_entity: \"switch.speaker_{{ speaker_slug }}_quiet_mode\"\n\n                # Attributes are on the switch now\n                # Attributes are on the switch now\n                media_player: \"{{ state_attr(speaker_config_entity, 'entity_id') }}\"\n                # Get Linked Areas\n                linked_areas: \"{{ state_attr(media_player, 'linked_areas') | default([]) }}\"\n\n                # Status Tests\n                dnd_switch: \"{{ speaker_config_entity | default('') }}\"\n                # Check if Quiet Mode is ON\n                is_dnd_active: \"{{ is_state(dnd_switch, 'on') }}\"\n\n                # Room State Checks (Sleep/DND)\n                # We check if ANY linked room is in a restrictive state\n                is_room_quiet: &gt;-\n                  {% set ns = namespace(quiet=false) %}\n                  {% for area in linked_areas %}\n                    {% set state = states('select.area_' ~ area ~ '_state') %}\n                    {% if state in ['Sleep', 'DND'] %}\n                      {% set ns.quiet = true %}\n                    {% endif %}\n                  {% endfor %}\n                  {{ ns.quiet }}\n\n                # Occupancy Check\n                is_occupied: &gt;-\n                  {% set ns = namespace(occupied=false) %}\n                  {% set areas = linked_areas if linked_areas is iterable and linked_areas is not string else [] %}\n                  {% for area in areas %}\n                    {# Debug Sensor Logic #}\n                    {% set s1 = 'binary_sensor.area_' ~ area ~ '_occupancy' %}\n                    {% set s2 = 'binary_sensor.' ~ area ~ '_occupancy' %}\n                    {% set v1 = states(s1) %}\n                    {% set v2 = states(s2) %}\n\n                    {# Logic #}\n                    {% if v1 == 'on' or v2 == 'on' %}\n                      {% set ns.occupied = true %}\n                    {% endif %}\n                  {% endfor %}\n                  {{ ns.occupied }}\n\n                # Extended Debug Info\n                debug_occ_trace: &gt;-\n                  {% set areas = linked_areas if linked_areas is iterable and linked_areas is not string else [] %}\n                  {% set ns = namespace(log=[]) %}\n                  {% for area in areas %}\n                     {% set s1 = 'binary_sensor.area_' ~ area ~ '_occupancy' %}\n                     {% set s2 = 'binary_sensor.' ~ area ~ '_occupancy' %}\n                     {% set ns.log = ns.log + [s1 ~ '=' ~ states(s1) ~ ' / ' ~ s2 ~ '=' ~ states(s2)] %}\n                  {% endfor %}\n                  {{ ns.log | join(', ') }}\n\n                # Source Suppression Check\n                # If source_room is provided, and matches a linked room, and I am in that room?\n                # Design: \"If source_room is Occupied, start simple: If source matches linked room, suppress\"\n                # Actually User said: \"coffee ready... you in kitchen... silence\"\n                # So: If source_room is in linked_rooms AND binary_sensor.room_{source_room}_occupancy is ON -&gt; Suppress\n                is_at_source: &gt;-\n                  {% if source_room is defined and source_room and source_room in linked_areas and is_state('binary_sensor.area_' ~ source_room ~ '_occupancy', 'on') %}\n                    true\n                  {% else %}\n                    false\n                  {% endif %}\n\n                # Targeted Override: If 'room' var is passed, force speak in that room (bypass occupancy)\n                # Targeted Override: Check if my linked rooms match the requested targets\n                is_targeted: &gt;-\n                  {% if room is defined and room not in [none, '', 'unknown'] %}\n                     {% set targets = (room | string).split(',') | map('trim') | list %}\n                     {% set ns = namespace(match=false) %}\n                     {% for r in linked_areas %}\n                       {% if r in targets %}\n                         {% set ns.match = true %}\n                       {% endif %}\n                     {% endfor %}\n                     {{ ns.match }}\n                  {% else %}\n                     false\n                  {% endif %}\n\n            - service: system_log.write\n              data:\n                message: &gt;-\n                  DEBUG SPEAKER {{ speaker_slug }} | \n                  Media: {{ media_player }} | \n                  Targeted: {{ is_targeted }} | \n                  Room: {{ room }} |\n                  Linked: {{ linked_rooms }} |\n                  Occ: {{ is_occupied }} | \n                  DND: {{ is_dnd_active }} | \n                  Quiet: {{ is_room_quiet }}\n                level: warning\n\n            # LOGIC GATE\n            - if:\n                - condition: template\n                  value_template: &gt;-\n                    {% set source_bool = is_at_source | bool %}\n                    {% set allow_priority = is_critical or (not is_dnd_active and not is_room_quiet) %}\n\n                    {# Logic Gate: Exclusive Targeting vs Occupancy #}\n                    {% set global_target_defined = room is defined and room not in [none, '', 'unknown'] %}\n\n                    {% if global_target_defined %}\n                       {# If targeting is active, ONLY allow targeted speakers #}\n                       {% set allow_occupancy = is_targeted %}\n                    {% else %}\n                       {# Standard Mode: Play if Critical OR Occupied #}\n                       {% set allow_occupancy = is_critical or is_occupied %}\n                    {% endif %}\n\n                    {% set allow_source = not source_bool %}\n                    {{ allow_priority and allow_occupancy and allow_source }}\n              then:\n                - service: system_log.write\n                  data:\n                    message: \"DEBUG: Speaking to {{ media_player }} (Method: Cloud Say). Msg: {{ message }}\"\n                    level: warning\n                - service: tts.cloud_say\n                  target:\n                    entity_id: \"{{ media_player }}\"\n                  data:\n                    message: \"{{ message }}\"\n                    # Optionally add chimes for critical?\n                    options:\n                      voice: \"Katherine\" # Customize as needed\n\n  # --- DEBUG DIAGNOSTICS ---\n  debug_notify_diagnostics:\n    alias: \"System: Debug Notification Targets\"\n    icon: mdi:bug\n    fields:\n      category:\n        description: \"Category to test\"\n        default: \"info\"\n    sequence:\n      - variables:\n          cat: \"{{ category | default('info') }}\"\n          # 1. Dump ALL Switches that look related\n          all_switches: &gt;-\n            {{ states.switch | map(attribute='entity_id') | select('search', 'notify|speaker') | list }}\n\n          # 2. Test Mobile Regex\n          mobile_regex: \"_{{ cat }}_notification\"\n          mobile_matches: &gt;-\n            {{ states.switch \n               | selectattr('entity_id', 'search', mobile_regex)\n               | map(attribute='entity_id') | list }}\n\n          # 3. Test Speaker Regex\n          speaker_regex: \"^switch\\\\.speaker_.*_notify_{{ cat }}\"\n          speaker_matches: &gt;-\n            {{ states.switch \n               | selectattr('entity_id', 'search', speaker_regex)\n               | map(attribute='entity_id') | list }}\n\n      - service: system_log.write\n        data:\n          level: warning\n          message: &gt;-\n            DEBUG DIAGNOSTICS (Category: {{ cat }})\n            --------------------------------------------------\n            Regex Mobile: '{{ mobile_regex }}' -&gt; Found: {{ mobile_matches }}\n            Regex Speaker: '{{ speaker_regex }}' -&gt; Found: {{ speaker_matches }}\n            --------------------------------------------------\n            ALL CANDIDATES: {{ all_switches }}\n\n      - service: system_log.write\n        data:\n          level: warning\n          message: &gt;-\n            DEBUG DIAGNOSTICS (Category: {{ cat }})\n            --------------------------------------------------\n            Regex Mobile: '{{ mobile_regex }}' -&gt; Found: {{ mobile_matches }}\n            Regex Speaker: '{{ speaker_regex }}' -&gt; Found: {{ speaker_matches }}\n            --------------------------------------------------\n            ALL CANDIDATES: {{ all_switches }}\n\n  # --- PURGE GHOSTS ---\n  purge_notification_ghosts:\n    alias: \"System: Purge Legacy Notification Ghosts\"\n    icon: mdi:ghost-off\n    mode: single\n    sequence:\n      - variables:\n          categories: \"{{ states('input_text.notify_mgmt_categories').split(',') | map('trim') | list + ['action', 'doorbell', 'doorbell2', 'network'] }}\"\n          users: &gt;-\n            {{ states.text \n               | selectattr('entity_id', 'search', '^text\\.notify_service_') \n               | map(attribute='object_id') \n               | map('replace', 'notify_service_', '') \n               | list }}\n\n      - repeat:\n          for_each: \"{{ users }}\"\n          sequence:\n            - variables:\n                user: \"{{ repeat.item }}\"\n            - repeat:\n                for_each: \"{{ categories }}\"\n                sequence:\n                  - variables:\n                      cat: \"{{ repeat.item }}\"\n\n                  # PATTERN 1: switch.Evis_garden_notification\n                  # Topic: homeassistant/switch/Evis_garden_notification/config (Guess)\n                  - service: mqtt.publish\n                    data:\n                      retain: true\n                      topic: \"homeassistant/switch/{{ user }}_{{ cat }}_notification/config\"\n                      payload: \"\"\n\n                  # PATTERN 2: switch.Evis_garden_notify\n                  - service: mqtt.publish\n                    data:\n                      retain: true\n                      topic: \"homeassistant/switch/{{ user }}_{{ cat }}_notify/config\"\n                      payload: \"\"\n\n                  # PATTERN 3: switch.notify_garden_Evis (Old Flipped)\n                  - service: mqtt.publish\n                    data:\n                      retain: true\n                      topic: \"homeassistant/switch/notify_{{ cat }}_{{ user }}/config\"\n                      payload: \"\"\n\n                  # PATTERN 4: switch.notify_Evis_garden (Legacy Loop)\n                  - service: mqtt.publish\n                    data:\n                      retain: true\n                      topic: \"homeassistant/switch/notify_{{ user }}_{{ cat }}/config\"\n                      # Wait! Pattern 4 IS THE CURRENT CORRECT TOPIC.\n                      # DO NOT DELETE THIS unless object_id matches bad pattern?\n                      # We cannot target object_id here, only topic.\n                      # IF the ghost shares the topic with the new entity, deleting it kills the new entity too.\n                      # BUT create_notify_user will restore it.\n                      # Safer to NOT touch Pattern 4.\n                      payload: \"\" # SKIP THIS ONE\n\nautomation:\n  - alias: \"System: Populate Notify Services\"\n    id: populate_notify_services_auto\n    trigger:\n      - platform: homeassistant\n        event: start\n      - platform: time_pattern\n        hours: \"/1\"\n    action:\n      # Use this to populate the new person selector list\n      - service: input_select.set_options\n        target:\n          entity_id: input_select.notify_mgmt_person_select\n        data:\n          options: &gt;\n            {% set person_names = states.person | map(attribute='attributes.friendly_name') | list | sort %}\n            {{ ['-select-'] + person_names + ['Guest'] }} # Always include 'Guest' option\n\n      - service: input_select.set_options\n        target:\n          entity_id: input_select.notify_mgmt_service\n        data:\n          options: &gt;\n            {% set ns = namespace(services=[]) %}\n            {% set trackers = integration_entities('mobile_app') | select('search', '^device_tracker\\.') | list %}\n            {% for tracker in trackers %}\n              {% set dev_id = device_id(tracker) %}\n              {% set dev_name = device_attr(dev_id, 'name') %}\n              {% if dev_name %}\n                {% set service_name = 'notify.mobile_app_' ~ dev_name | slugify %}\n                {% set ns.services = ns.services + [service_name] %}\n              {% endif %}\n            {% endfor %}\n            {{ (['-select-'] + ns.services + ['notify.mobile_app_unknown']) | unique | sort }}\n\n      # 3. Populate Delete User list\n      # Scans for existing 'text.notify_service_*' entities to find valid user slugs\n      - service: input_select.set_options\n        target:\n          entity_id: input_select.notify_mgmt_delete_user_select\n        data:\n          options: &gt;\n            {% set ns = namespace(users=[]) %}\n            {% set user_helpers = states.text | selectattr('object_id', 'search', '^notify_service_') | list %}\n            {% for helper in user_helpers %}\n               {% set slug = helper.object_id.replace('notify_service_', '') %}\n               {% set ns.users = ns.users + [slug] %}\n            {% endfor %}\n            {{ (['-select-'] + ns.users + ['unknown']) | unique | sort }}\n\n      # 4. Populate Delete Category List (NEW)\n      - service: input_select.set_options\n        target:\n          entity_id: input_select.notify_delete_category\n        data:\n          options: &gt;\n            {% set cats = states('input_text.notify_mgmt_categories').split(',') \n               | map('trim') \n               | select('ne', '')\n               | list \n               | sort %}\n            {{ ['-select-'] + cats }}\n\n  - alias: \"System: MQTT State Persistence\"\n    id: system_mqtt_state_persistence\n    mode: parallel\n    trigger:\n      - platform: mqtt\n        topic: \"notify/#\"\n    condition:\n      - condition: template\n        value_template: \"{{ trigger.topic.endswith('/set') }}\"\n    action:\n      - service: mqtt.publish\n        data:\n          topic: \"{{ trigger.topic[:-4] }}/state\"\n          payload: \"{{ trigger.payload }}\"\n          retain: true\n</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/smart_speakers/","title":"Package: Smart Speakers","text":"","tags":["package","automated"]},{"location":"smart-home/packages/smart_speakers/#package-smart-speakers","title":"Package: Smart Speakers","text":"<p>Version: 1.0.0 Description: Configuration and helpers for managing Smart Speakers in Notification Center</p> <p></p>","tags":["package","automated"]},{"location":"smart-home/packages/smart_speakers/#executive-summary","title":"Executive Summary","text":"<p>No executive summary generated yet.</p>","tags":["package","automated"]},{"location":"smart-home/packages/smart_speakers/#process-description-non-technical","title":"Process Description (Non-Technical)","text":"<p>No detailed non-technical description generated yet.</p>","tags":["package","automated"]},{"location":"smart-home/packages/smart_speakers/#dashboard-connections","title":"Dashboard Connections","text":"<p>This package powers the following dashboard views:</p> <ul> <li>Notifications Management: The Notification Center dashboard provides a comprehensive interface for managing the smart home's notification system. Administrators can add or remove users for mobile app notifications and define notification categories (e.g., 'Garage', 'Electricity'). The view allows for granular control over subscriptions, enabling individual users to opt-in or out of specific notification types, and includes tools to map and monitor notification-related automations. (Uses 1 entities)</li> </ul>","tags":["package","automated"]},{"location":"smart-home/packages/smart_speakers/#architecture-diagram","title":"Architecture Diagram","text":"<p>No architecture explanation generated yet.</p> <p>No architecture diagram generated yet.</p>","tags":["package","automated"]},{"location":"smart-home/packages/smart_speakers/#configuration-source-code","title":"Configuration (Source Code)","text":"<pre><code># Package: Smart Speaker Manager\n# Version: 1.0.0\n# Description: Configuration and helpers for managing Smart Speakers in Notification Center\n# ------------------------------------------------------------------------------\n\n# ------------------------------------------------------------------------------\n# 1. HELPERS (Dashboard Inputs)\n# ------------------------------------------------------------------------------\ninput_text:\n  speaker_mgmt_name:\n    name: \"Speaker Name\"\n    icon: mdi:rename-box\n    initial: \"New Speaker\"\n\ninput_select:\n  # List of available Media Players (Auto-Populated)\n  speaker_mgmt_entity:\n    name: \"Select Media Player\"\n    icon: mdi:speaker\n    options:\n      - \"unknown\"\n\n  # List of Areas (Auto-Populated from Area Manager)\n  speaker_mgmt_area:\n    name: \"Select Coverage Area\"\n    icon: mdi:map-marker\n    options:\n      - \"unknown\"\n\n  # List of Registered Speakers (For Deletion/Management)\n  speaker_mgmt_registered_list:\n    name: \"Registered Speakers\"\n    icon: mdi:speaker-multiple\n    options:\n      - \"unknown\"\n\n# ------------------------------------------------------------------------------\n# 2. SCRIPTS\n# ------------------------------------------------------------------------------\nscript:\n  # --- REGISTER SPEAKER ---\n  create_smart_speaker:\n    alias: \"Speaker: Register Entity\"\n    icon: mdi:speaker-plus\n    mode: single\n    sequence:\n      - variables:\n          friendly_name: \"{{ states('input_text.speaker_mgmt_name') }}\"\n          media_player: \"{{ states('input_select.speaker_mgmt_entity') }}\"\n          # Slugify the friendly name for the ID\n          speaker_slug: \"{{ friendly_name | slugify }}\"\n\n      - service: system_log.write\n        data:\n          message: \"DEBUG: Registering speaker {{ friendly_name }} (slug: {{ speaker_slug }})\"\n          level: warning\n\n      # 1. Publish Config Entity (Text) - REMOVED\n      # We now attach attributes to the Quiet Mode switch for simplicity and reliability.\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/text/speaker_{{ speaker_slug }}_config/config\"\n          payload: \"\"\n\n      # 2. Publish DND Switch\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/switch/speaker_{{ speaker_slug }}_quiet_mode/config\"\n          payload: &gt;-\n            {{\n              {\n                \"name\": \"Quiet Mode\",\n                \"object_id\": \"speaker_\" ~ speaker_slug ~ \"_quiet_mode\",\n                \"unique_id\": \"speaker_dnd_\" ~ speaker_slug ~ \"_v4\",\n                \"icon\": \"mdi:volume-off\",\n                \"command_topic\": \"speaker/\" ~ speaker_slug ~ \"/quiet/set\",\n                \"state_topic\": \"speaker/\" ~ speaker_slug ~ \"/quiet/state\",\n                \"payload_on\": \"ON\",\n                \"payload_off\": \"OFF\",\n                \"json_attributes_topic\": \"speaker/\" ~ speaker_slug ~ \"/config/attributes\",\n                \"device\": {\n                  \"identifiers\": [\"smart_speaker_\" ~ speaker_slug],\n                  \"name\": friendly_name,\n                  \"manufacturer\": \"Smart Home\",\n                  \"model\": \"NotiSpeaker\"\n                }\n              } | to_json\n            }}\n\n      # 3. Publish Notification Switches (Categories)\n      # We iterate dynamic categories from the Smart Notification package\n      - repeat:\n          for_each: \"{{ states('input_text.notify_mgmt_categories').split(',') | map('trim') | list }}\"\n          sequence:\n            - service: mqtt.publish\n              data:\n                retain: true\n                topic: \"homeassistant/switch/speaker_{{ speaker_slug }}_notify_{{ repeat.item }}/config\"\n                payload: &gt;-\n                  {{\n                    {\n                      \"name\": repeat.item | title,\n                      \"default_entity_id\": \"switch.speaker_\" ~ speaker_slug ~ \"_notify_\" ~ repeat.item,\n                      \"unique_id\": \"speaker_notif_\" ~ speaker_slug ~ \"_\" ~ repeat.item ~ \"_v4\",\n                      \"icon\": \"mdi:bell-ring\",\n                      \"command_topic\": \"speaker/\" ~ speaker_slug ~ \"/notify_\" ~ repeat.item ~ \"/set\",\n                      \"state_topic\": \"speaker/\" ~ speaker_slug ~ \"/notify_\" ~ repeat.item ~ \"/state\",\n                      \"payload_on\": \"ON\",\n                      \"payload_off\": \"OFF\",\n                      \"device\": { \"identifiers\": [\"smart_speaker_\" ~ speaker_slug] }\n                    } | to_json\n                  }}\n            # Set Default ON\n            - service: mqtt.publish\n              data:\n                retain: true\n                topic: \"speaker/{{ speaker_slug }}/notify_{{ repeat.item }}/state\"\n                payload: \"ON\"\n\n      # 4. Save Initial State &amp; Attributes\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"speaker/{{ speaker_slug }}/config/state\"\n          payload: \"{{ media_player }}\"\n\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"speaker/{{ speaker_slug }}/config/attributes\"\n          payload: &gt;-\n            {{\n              {\n                \"entity_id\": media_player,\n                \"speaker_slug\": speaker_slug,\n                \"linked_areas\": []\n              } | to_json\n            }}\n\n      - if:\n          - condition: template\n            value_template: \"{{ states('input_select.speaker_mgmt_area') not in ['unknown', 'unavailable'] }}\"\n        then:\n          - service: mqtt.publish\n            data:\n              retain: true\n              topic: \"speaker/{{ speaker_slug }}/config/attributes\"\n              payload: &gt;-\n                {{\n                  {\n                    \"entity_id\": media_player,\n                    \"speaker_slug\": speaker_slug,\n                    \"linked_areas\": [states('input_select.speaker_mgmt_area')]\n                  } | to_json\n                }}\n\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"speaker/{{ speaker_slug }}/quiet/state\"\n          payload: \"OFF\"\n\n      - delay: \"00:00:01\"\n      - service: script.refresh_speaker_list\n\n  # --- REFRESH LISTS ---\n  refresh_speaker_list:\n    alias: \"Speaker: Refresh Lists\"\n    mode: single\n    sequence:\n      # 1. Populate Media Players\n      - service: input_select.set_options\n        target:\n          entity_id: input_select.speaker_mgmt_entity\n        data:\n          options: &gt;-\n            {{ (states.media_player | map(attribute='entity_id') | list | sort) or ['unknown'] }}\n\n      # 2. Populate Areas (Safe fetch from Area Manager selects)\n      - variables:\n          areas: &gt;-\n            {{ states.select \n               | selectattr('entity_id', 'match', 'select\\.area_.*_state') \n               | map(attribute='entity_id') \n               | map('regex_replace', 'select\\.area_(.*)_state', '\\\\1') \n               | list | sort }}\n      - service: input_select.set_options\n        target:\n          entity_id: input_select.speaker_mgmt_area\n        data:\n          options: \"{{ areas or ['unknown'] }}\"\n\n      # 3. Populate Registered Speakers\n      - variables:\n          # Find all switches that have a 'speaker_slug' attribute (Robust finding)\n          speakers: &gt;-\n            {{ states.switch \n               | selectattr('attributes.speaker_slug', 'defined') \n               | map(attribute='attributes.speaker_slug') \n               | list | sort }}\n      - service: input_select.set_options\n        target:\n          entity_id: input_select.speaker_mgmt_registered_list\n        data:\n          options: \"{{ speakers or ['unknown'] }}\"\n\n  # --- DELETE SPEAKER ---\n  delete_smart_speaker:\n    alias: \"Speaker: Delete Entity\"\n    mode: single\n    sequence:\n      - variables:\n          # Expects input from speaker_mgmt_registered_list or similar\n          # For now, let's assume we pass a slug or get it from a select\n          # FIX: Prioritize passed variable, fallback to input_select\n          target_slug: \"{{ speaker_slug if speaker_slug is defined else states('input_select.speaker_mgmt_registered_list') }}\"\n          # Re-assign to ensure downstream usage is consistent\n          speaker_slug: \"{{ target_slug }}\"\n\n      # Remove Config\n      - service: mqtt.publish\n        data:\n          topic: \"homeassistant/text/speaker_{{ speaker_slug }}_config/config\"\n          payload: \"\"\n\n      # Remove Quiet Mode\n      - service: mqtt.publish\n        data:\n          topic: \"homeassistant/switch/speaker_{{ speaker_slug }}_quiet_mode/config\"\n          payload: \"\"\n\n      # Remove Categories\n      - repeat:\n          for_each: [\"info\", \"alarm\", \"doorbell\", \"security\", \"system\"]\n          sequence:\n            - service: mqtt.publish\n              data:\n                topic: \"homeassistant/switch/speaker_{{ speaker_slug }}_notify_{{ repeat.item }}/config\"\n                payload: \"\"\n            # Legacy cleanup (Remove old schema too)\n            - service: mqtt.publish\n              data:\n                topic: \"homeassistant/switch/notify_speaker_{{ speaker_slug }}_{{ repeat.item }}/config\"\n                payload: \"\"\n\n  # --- MANAGE COVERAGE: ADD AREA ---\n  speaker_add_area:\n    alias: \"Speaker: Add Coverage Area\"\n    mode: single\n    sequence:\n      - variables:\n          # Inputs: Speaker Slug, and Area Slug to ADD\n          speaker_slug: \"{{ states('input_select.speaker_mgmt_registered_list') }}\"\n          area_to_add: \"{{ states('input_select.speaker_mgmt_area') }}\"\n\n      - if:\n          - condition: template\n            value_template: &gt;-\n              {{ speaker_slug not in ['unknown', 'unavailable', '', none] \n                 and area_to_add not in ['unknown', 'unavailable', '', none] }}\n        then:\n          # Get Current Config (from Quiet Mode Switch)\n          # Use default([], true) to handle None if attribute is missing\n          - variables:\n              current_areas: \"{{ state_attr('switch.speaker_' ~ speaker_slug ~ '_quiet_mode', 'linked_areas') | default([], true) }}\"\n              entity_id: \"{{ state_attr('switch.speaker_' ~ speaker_slug ~ '_quiet_mode', 'entity_id') }}\"\n\n          - if:\n              - condition: template\n                value_template: \"{{ area_to_add not in current_areas }}\"\n            then:\n              - variables:\n                  new_areas: \"{{ (current_areas + [area_to_add]) | unique | list }}\"\n              - service: mqtt.publish\n                data:\n                  retain: true\n                  topic: \"speaker/{{ speaker_slug }}/config/attributes\"\n                  payload: &gt;-\n                    {\n                      \"entity_id\": \"{{ entity_id }}\",\n                      \"speaker_slug\": \"{{ speaker_slug }}\",\n                      \"linked_areas\": {{ new_areas | to_json }}\n                    }\n        else:\n          - service: system_log.write\n            data:\n              message: \"Speaker Add Area Failed: Invalid Input\"\n              level: warning\n\n  # --- SYSTEM: PURGE ALL SPEAKERS (Cleanup Tool) ---\n  purge_all_speakers:\n    alias: \"System: Purge All Speakers\"\n    icon: mdi:nuke\n    mode: single\n    sequence:\n      - variables:\n          # 1. Gather slugs from Switch attributes (New System)\n          slugs_from_switches: &gt;-\n            {{ states.switch \n               | selectattr('attributes.speaker_slug', 'defined')\n               | map(attribute='attributes.speaker_slug')\n               | list }}\n          # 2. Gather slugs from Input Select (Old System/Lists)\n          slugs_from_list: &gt;-\n            {{ state_attr('input_select.speaker_mgmt_registered_list', 'options') \n               | reject('eq', 'unknown') \n               | list }}\n          # 3. Combine and Unique\n          all_slugs: \"{{ (slugs_from_switches + slugs_from_list) | unique | list }}\"\n\n      - if:\n          - condition: template\n            value_template: \"{{ all_slugs | length &gt; 0 }}\"\n        then:\n          - service: system_log.write\n            data:\n              message: \"Purging Speakers: {{ all_slugs }}\"\n              level: warning\n          - repeat:\n              for_each: \"{{ all_slugs }}\"\n              sequence:\n                - service: script.delete_smart_speaker\n                  data:\n                    speaker_slug: \"{{ repeat.item }}\"\n                - delay: \"00:00:00.500\"\n        else:\n          - service: system_log.write\n            data:\n              message: \"No speakers found to purge.\"\n              level: info\n\n  # --- MANAGE COVERAGE: REMOVE AREA ---\n  speaker_remove_area:\n    alias: \"Speaker: Remove Coverage Area\"\n    mode: single\n    sequence:\n      - variables:\n          speaker_slug: \"{{ states('input_select.speaker_mgmt_registered_list') }}\"\n          # For removal, we might want to select FROM the speaker's room list?\n          # Or just use the global area selector to pick which one to remove.\n          # Let's use the global area selector for simplicity, or complex UI logic later.\n          area_to_remove: \"{{ states('input_select.speaker_mgmt_area') }}\"\n\n      - if:\n          - condition: template\n            value_template: &gt;-\n              {{ speaker_slug not in ['unknown', 'unavailable', '', none] \n                 and area_to_remove not in ['unknown', 'unavailable', '', none] }}\n        then:\n          - variables:\n              current_areas: \"{{ state_attr('switch.speaker_' ~ speaker_slug ~ '_quiet_mode', 'linked_areas') | default([], true) }}\"\n              entity_id: \"{{ state_attr('switch.speaker_' ~ speaker_slug ~ '_quiet_mode', 'entity_id') }}\"\n\n          - if:\n              - condition: template\n                # Ensure current_areas is iterable\n                value_template: \"{{ area_to_remove in current_areas }}\"\n            then:\n              - variables:\n                  new_areas: \"{{ current_areas | reject('eq', area_to_remove) | list }}\"\n              - service: mqtt.publish\n                data:\n                  retain: true\n                  topic: \"speaker/{{ speaker_slug }}/config/attributes\"\n                  payload: &gt;-\n                    {\n                      \"entity_id\": \"{{ entity_id }}\",\n                      \"speaker_slug\": \"{{ speaker_slug }}\",\n                      \"linked_areas\": {{ new_areas | to_json }}\n                    }\n        else:\n          - service: system_log.write\n            data:\n              message: \"Speaker Remove Area Failed: Invalid Input\"\n              level: warning\n\n# ------------------------------------------------------------------------------\n# 3. AUTOMATIONS\n# ------------------------------------------------------------------------------\nautomation:\n  # Keeps the MQTT Switches in sync (State Persistence)\n  - alias: \"Speaker: MQTT Persistence\"\n    id: speaker_mqtt_persistence\n    mode: parallel\n    trigger:\n      - platform: mqtt\n        topic: \"speaker/#\"\n    condition:\n      - condition: template\n        value_template: \"{{ trigger.topic.endswith('/set') }}\"\n    action:\n      - service: mqtt.publish\n        data:\n          topic: \"{{ trigger.topic[:-4] }}/state\"\n          payload: \"{{ trigger.payload }}\"\n          retain: true\n\n  - alias: \"Speaker: Auto Populate Lists\"\n    id: speaker_auto_populate_lists\n    trigger:\n      - platform: homeassistant\n        event: start\n      - platform: time_pattern\n        hours: \"/1\"\n    action:\n      - delay: \"00:00:30\"\n      - service: script.refresh_speaker_list\n</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/tailscale_monitoring/","title":"Package: Tailscale Monitoring","text":"","tags":["package","automated"]},{"location":"smart-home/packages/tailscale_monitoring/#package-tailscale-monitoring","title":"Package: Tailscale Monitoring","text":"<p>Version: Unknown Description: No description provided.</p> <p></p>","tags":["package","automated"]},{"location":"smart-home/packages/tailscale_monitoring/#executive-summary","title":"Executive Summary","text":"<p>No executive summary generated yet.</p>","tags":["package","automated"]},{"location":"smart-home/packages/tailscale_monitoring/#process-description-non-technical","title":"Process Description (Non-Technical)","text":"<p>No detailed non-technical description generated yet.</p>","tags":["package","automated"]},{"location":"smart-home/packages/tailscale_monitoring/#dashboard-connections","title":"Dashboard Connections","text":"<p>No linked dashboard views found (Automatic Scan).</p>","tags":["package","automated"]},{"location":"smart-home/packages/tailscale_monitoring/#architecture-diagram","title":"Architecture Diagram","text":"<p>No architecture explanation generated yet.</p> <p>No architecture diagram generated yet.</p>","tags":["package","automated"]},{"location":"smart-home/packages/tailscale_monitoring/#configuration-source-code","title":"Configuration (Source Code)","text":"<pre><code># ---------------------------------------------------------\n# 1. The Listener (Dead Man's Switch)\n#    - Listens for the webhook from the LXC container.\n#    - Turns \"On\" when ping is received.\n#    - Automatically turns \"Off\" if no ping for 130 seconds.\n# ---------------------------------------------------------\n\ntemplate:\n  - trigger:\n      - platform: webhook\n        webhook_id: tailscale_edge_keepalive\n        local_only: true\n    binary_sensor:\n      - name: \"Tailscale Edge Status\"\n        unique_id: tailscale_edge_status_heartbeat\n        state: \"on\"\n        device_class: connectivity\n        auto_off: \"00:03:10\" # 3 mins 10s buffer (allows for 1 missed ping)\n\n# ---------------------------------------------------------\n# 2. The Enforcer (Reboot Automation)\n#    - Watches the sensor above.\n#    - If it goes 'off', it pushes the Proxmox Reboot button.\n# ---------------------------------------------------------\nautomation:\n  - alias: \"Fix Tailscale Edge Node\"\n    id: fix_tailscale_edge_node # ID is required for debugging traces\n    mode: single\n    trigger:\n      - platform: state\n        entity_id: binary_sensor.tailscale_edge_status\n        to: \"off\"\n        for:\n          minutes: 2 # Wait 2 extra minutes to be absolutely sure\n    action:\n      - service: notify.persistent_notification\n        data:\n          message: \"Tailscale Edge heartbeat lost. Rebooting container...\"\n          title: \"Tailscale Watchdog\"\n\n      # PRESS THE PROXMOX BUTTON\n      # (Replace this entity ID with your actual Proxmox integration button)\n      - service: button.press\n        target:\n          entity_id: button.tailscale_edge_reboot\n# ---------------------------------------------------------\n# 3. The Heartbeat Script (Tailscale Edge Node)\n#    - Runs on the LXC container.\n#    - Sends a webhook to Home Assistant when Tailscale is running.\n#    - Logs errors to a file if Tailscale is not running.\n# ---------------------------------------------------------\n# Run in the Tailscale Edge Node\n\n# ``` bash\n# apt update &amp;&amp; apt install -y curl\n# ```\n\n# ``` bash\n# nano /usr/local/bin/ts-heartbeat.sh\n# ```\n\n# #File: /usr/local/bin/ts-heartbeat.sh\n# #!/bin/bash\n#\n## CHANGE URL TO TAILSCALE EDGE ID\n#HA_URL=\"http://192.168.1.X:8123/api/webhook/tailscale_edge_keepalive\"\n#\n#if /usr/bin/tailscale status --json | grep -q 'BackendState.*Running'; then\n#    /usr/bin/curl -X POST -d \"\" \"$HA_URL\"\n#else\n#    echo \"$(date): Heartbeat failed.\" &gt;&gt; /var/log/ts-heartbeat.log\n#fi\n\n# chmod +x /usr/local/bin/ts-heartbeat.sh\n# crontab -e -&gt; * * * * * /usr/local/bin/ts-heartbeat.sh\n\n# ---------------------------------------------------------\n# 4. Log Rotation (Optional but Recommended)\n#    - If using the log file method above, prevent it from filling the disk.\n# ---------------------------------------------------------\n# ``` bash\n# nano /etc/logrotate.d/ts-heartbeat\n# ```\n#\n# /var/log/ts-heartbeat.log {\n#     size 1M\n#     rotate 1\n#     compress\n#     missingok\n#     notifempty\n# }\n\n# ---------------------------------------------------------\n# 5. System Maintenance (Debian/LXC Best Practices)\n#    - Prevent system logs (journald) directly filling the disk.\n#    - Standard Debian logrotate handles /var/log/syslog, etc.\n# ---------------------------------------------------------\n#\n# # 5.1 Limit Journald Size (Critical for small containers)\n# ``` bash\n# nano /etc/systemd/journald.conf\n# ```\n# # Uncomment and set:\n# # SystemMaxUse=50M\n#\n# # Then restart:\n# # systemctl restart systemd-journald\n#\n# # 5.2 Verify Logrotate is active\n# # systemctl status logrotate\n# # (It should be loaded and active as a timer)\n</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/unifi_access/","title":"Package: Unifi Access","text":"","tags":["package","automated"]},{"location":"smart-home/packages/unifi_access/#package-unifi-access","title":"Package: Unifi Access","text":"<p>Version: 1.1.0 Description: Unified management for G4 Doorbell Pro Fingerprint &amp; NFC.</p> <p></p>","tags":["package","automated"]},{"location":"smart-home/packages/unifi_access/#executive-summary","title":"Executive Summary","text":"<p>The Unifi Access package implements a unified access control layer on top of the Ubiquiti G4 Doorbell Pro. It abstracts distinct hardware events (NFC, Fingerprint) into a single logical \"Unified User\" entity backed by MQTT discovery. The system provides granular, per-credential access management (switches), a centralized Guest Schedule (input_helpers), and \"Fail-Closed\" authorization logic. State persistence is handled via MQTT Retain to ensure reliability across reboots.</p>","tags":["package","automated"]},{"location":"smart-home/packages/unifi_access/#process-description-non-technical","title":"Process Description (Non-Technical)","text":"<ol> <li>Scan: A user scans their fingerprint or NFC tag at the doorbell.</li> <li>Identify: The system instantly recognizes the person (e.g., \"Dad\" or \"Guest\").</li> <li>Check Permissions:<ul> <li>Family: Checks if their specific access (Fingerprint or Card) is currently switched ON.</li> <li>Guests: Checks if they are allowed today AND if it is currently within the \"Guest Hours\".</li> </ul> </li> <li>Unlock: If valid, the door unlocks and a snapshot is sent to your phone. If denied, a security alert is triggered.</li> </ol>","tags":["package","automated"]},{"location":"smart-home/packages/unifi_access/#dashboard-connections","title":"Dashboard Connections","text":"<p>This package powers the following dashboard views:</p> <ul> <li>Home Access Center: The Home Access Center serves as the central administrative hub for managing physical security and entry credentials. Its primary function is to maintain a unified user registry where distinct hardware identifiers\u2014such as Fingerprints and NFC tags\u2014are mapped to specific individuals. This abstraction allows homeowners to easily enroll new keys, assign them to family members or guests, and instantly revoke permissions if a credential is lost or compromised. (Uses 8 entities)</li> <li>Front Door: This view is the central security hub for the Front Door. It features live feeds and event clips from Frigate cameras (Doorbell and Porch). Users can control the smart lock, arm/disarm the alarm system, and manage the front entry lights. It also monitors door status and presence, with settings for occupancy-based automations. (Uses 1 entities)</li> <li>Home: The Home dashboard serves as the central information hub. It features a large clock and family calendars, alongside detailed weather forecasts. Key home stats are highlighted, including real-time energy prices, power usage, and the status of major appliances like the dishwasher and washing machine. The view also provides a high-level overview of the entire house, displaying camera feeds and status summaries for all key rooms (Sauna, Bathroom, Bedroom, etc.) using 'Streamline' area cards. (Uses 1 entities)</li> <li>Mud Room: This dashboard manages the Mud Room. It provides control for the ceiling light and visualizes occupancy status via motion sensors. The view includes standard settings for occupancy automations and light scheduling. (Uses 1 entities)</li> </ul>","tags":["package","automated"]},{"location":"smart-home/packages/unifi_access/#architecture-diagram","title":"Architecture Diagram","text":"<p>The sequence starts when the G4 Doorbell Pro broadcasts a hardware event (fingerprint or NFC) to Home Assistant. The automation logic intercepts this event and resolves the raw ID to a \"Unified User\" using a mapped MQTT lookup. Once the user is identified, the system performs a multi-stage authorization check: first verifying the specific credential type is enabled (e.g., is NFC allowed for this user?), and then\u2014if the user is a Guest\u2014verifying the request against the global Guest Schedule. A \"Pass\" decision triggers the Z-Wave lock and logs the entry; a \"Fail\" decision prevents access and logs a security warning.</p> <pre><code>sequenceDiagram\n    participant User\n    participant G4 as G4 Doorbell Pro\n    participant HA as Home Assistant\n    participant Logic as Access Logic\n    participant MQTT as MQTT Broker\n    participant Lock as Yale Lock\n    participant Notify as Notification Svc\n\n    User-&gt;&gt;G4: Scans Fingerprint / NFC\n    G4-&gt;&gt;HA: Event (ulp_id)\n    HA-&gt;&gt;Logic: Trigger Automation\n\n    rect rgb(240, 240, 240)\n        Note over Logic: Identity Resolution\n        Logic-&gt;&gt;MQTT: Query User for ulp_id\n        MQTT--&gt;&gt;Logic: Returns \"Unified User\"\n    end\n\n    rect rgb(230, 245, 255)\n        Note over Logic: Authorization Check\n        alt is Unknown ID\n            Logic-&gt;&gt;Logic: Auto-Learn (Create \"Unknown\")\n            Logic-&gt;&gt;Notify: Alert \"New ID Found\"\n        else is Known User\n            Logic-&gt;&gt;Logic: Check Access Switch (FP/NFC)\n            opt is Guest\n                Logic-&gt;&gt;Logic: Validate Schedule (Time/Day)\n            end\n\n            alt Access Granted\n                Logic-&gt;&gt;Lock: Unlock Command\n                Logic-&gt;&gt;Notify: Send \"Unlocked\" Snapshot\n            else Access Denied\n                Logic-&gt;&gt;Notify: Send Critical Alert\n            end\n        end\n    end</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/unifi_access/#configuration-source-code","title":"Configuration (Source Code)","text":"<pre><code># ------------------------------------------------------------------------------\n# Package: Unifi Unified Access Control\n# Version: 1.1.0\n# Description: Unified management for G4 Doorbell Pro Fingerprint &amp; NFC.\n#              - Shared Identity: 'select.unifi_user_ID'\n#              - Separate Access: 'switch.fp_access_USER' &amp; 'switch.nfc_access_USER'\n#              - Unified Schedule: 'input_datetime.guest_access_...'\n# ------------------------------------------------------------------------------\n\n# ------------------------------------------------------------------------------\n# 1. HELPERS &amp; SCHEDULES\n# ------------------------------------------------------------------------------\ninput_select:\n  unifi_delete_id:\n    name: \"Select ID to Delete\"\n    icon: mdi:delete-empty\n    options: [\"-select-\"]\n\n# --- UNIFIED GUEST SCHEDULE ---\ninput_datetime:\n  guest_access_start:\n    name: \"Guest Access Start\"\n    has_date: false\n    has_time: true\n    icon: mdi:clock-start\n    initial: \"09:00\"\n  guest_access_end:\n    name: \"Guest Access End\"\n    has_date: false\n    has_time: true\n    icon: mdi:clock-end\n    initial: \"21:00\"\n\ninput_boolean:\n  guest_access_mon:\n    name: \"Mon\"\n    icon: mdi:calendar\n  guest_access_tue:\n    name: \"Tue\"\n    icon: mdi:calendar\n  guest_access_wed:\n    name: \"Wed\"\n    icon: mdi:calendar\n  guest_access_thu:\n    name: \"Thu\"\n    icon: mdi:calendar\n  guest_access_fri:\n    name: \"Fri\"\n    icon: mdi:calendar\n  guest_access_sat:\n    name: \"Sat\"\n    icon: mdi:calendar\n  guest_access_sun:\n    name: \"Sun\"\n    icon: mdi:calendar\n\n# ------------------------------------------------------------------------------\n# 2. AUTOMATIONS\n# ------------------------------------------------------------------------------\nautomation:\n  # --- LOGIC 1: FINGERPRINT ENTRY ---\n  - alias: \"Access: Fingerprint Entry Logic\"\n    id: access_fingerprint_entry_logic\n    mode: single\n    trigger:\n      - platform: state\n        entity_id: event.front_door_fingerprint\n        not_from:\n          - \"unknown\"\n          - \"unavailable\"\n        not_to:\n          - \"unknown\"\n          - \"unavailable\"\n    variables:\n      raw_id: &gt;-\n        {{ trigger.to_state.attributes.ulp_id | default('unknown') }}\n      slug_id: \"{{ raw_id | replace('-', '_') | lower }}\"\n      # SHARED IDENTITY ENTITY\n      assigned_user: \"{{ states('select.unifi_user_' ~ slug_id) }}\"\n      # FP ACCESS SWITCH\n      user_switch: \"switch.fp_access_{{ assigned_user | slugify }}\"\n    action:\n      - target:\n          entity_id: camera.g4_doorbell_pro_poe_high_resolution_channel\n        data:\n          filename: /config/www/front_door_unlock_snapshot.jpg\n        action: camera.snapshot\n\n      - choose:\n          # ROLE 1: GUEST\n          - conditions:\n              - condition: template\n                value_template: \"{{ 'guest' in assigned_user | lower }}\"\n            sequence:\n              - if:\n                  - condition: template\n                    value_template: &gt;\n                      {# FAIL CLOSED: Switch MUST be ON #}\n                      {% set access_enabled = is_state(user_switch, 'on') %}\n                      {# SCHEDULE CHECK (UNIFIED) #}\n                      {% set current_day = now().strftime('%a')|lower %}\n                      {% set is_day_allowed = is_state('input_boolean.guest_access_' ~ current_day, 'on') %}\n                      {% set current_time = now().strftime('%H:%M:%S') %}\n                      {% set start_time = states('input_datetime.guest_access_start') %}\n                      {% set end_time = states('input_datetime.guest_access_end') %}\n                      {% set is_time_allowed = (current_time &gt;= start_time) and (current_time &lt;= end_time) %}\n\n                      {{ access_enabled and is_day_allowed and is_time_allowed }}\n                then:\n                  - action: lock.unlock\n                    target:\n                      entity_id: lock.front_door_lock\n                  - action: script.notify_smart_master\n                    data:\n                      category: security\n                      title: \ud83d\udd13 Guest Entry (Fingerprint)\n                      message: \"Guest entered via Fingerprint.\"\n                      image: /local/front_door_unlock_snapshot.jpg?t={{ now().timestamp() }}\n                      tag: door_lock\n                else:\n                  - action: script.notify_smart_master\n                    data:\n                      category: security\n                      title: \u26d4 Access Denied (Fingerprint)\n                      message: &gt;\n                        {% if not is_state(user_switch, 'on') %}\n                          Guest FP access manually DISABLED.\n                        {% else %}\n                          Guest outside allowed schedule.\n                        {% endif %}\n                      critical: true\n                      image: /local/front_door_unlock_snapshot.jpg?t={{ now().timestamp() }}\n                      tag: door_lock_denied\n\n          # ROLE 2: STANDARD USER\n          - conditions:\n              - condition: template\n                value_template: &gt;\n                  {{ assigned_user not in ['unknown', 'unavailable', 'none', 'Unknown', '-Unassigned-', '-unassigned-', 'Guest'] }}\n            sequence:\n              - if:\n                  - condition: template\n                    # FAIL CLOSED: Switch MUST be ON\n                    value_template: \"{{ is_state(user_switch, 'on') }}\"\n                then:\n                  - action: lock.unlock\n                    target:\n                      entity_id: lock.front_door_lock\n                  - action: logbook.log\n                    data:\n                      name: \"Front Door Access\"\n                      message: \"\ud83d\udd13 Guest {{ assigned_user }} entered via Fingerprint.\"\n                      entity_id: lock.front_door_lock_cloud\n                  - action: logbook.log\n                    data:\n                      name: \"Front Door Access\"\n                      message: \"\ud83d\udd13 {{ assigned_user }} unlocked via Fingerprint.\"\n                      entity_id: lock.front_door_lock_cloud\n                  - action: script.notify_smart_master\n                    data:\n                      category: security\n                      title: \ud83d\udd13 Front Door Unlocked\n                      message: \"Unlocked by: {{ assigned_user }}\"\n                      image: /local/front_door_unlock_snapshot.jpg?t={{ now().timestamp() }}\n                      tag: door_lock\n                else:\n                  - action: logbook.log\n                    data:\n                      name: \"Front Door Access\"\n                      message: \"\u26d4 Guest Access Denied (Fingerprint): {{ assigned_user }}.\"\n                      entity_id: lock.front_door_lock_cloud\n                  - action: logbook.log\n                    data:\n                      name: \"Front Door Access\"\n                      message: \"\u26d4 Access Disabled (Fingerprint): {{ assigned_user }}.\"\n                      entity_id: lock.front_door_lock_cloud\n                  - action: script.notify_smart_master\n                    data:\n                      category: security\n                      title: \u26d4 Access Disabled\n                      message: \"Fingerprint valid, but {{ assigned_user }}'s access is switched OFF.\"\n                      critical: true\n                      image: /local/front_door_unlock_snapshot.jpg?t={{ now().timestamp() }}\n                      tag: door_lock_denied\n\n          # ROLE 3: AUTO-LEARN\n          - conditions:\n              - condition: template\n                value_template: \"{{ raw_id != 'unknown' and raw_id != '' }}\"\n            sequence:\n              - action: script.add_unifi_user_entity\n                data:\n                  ulp_id: \"{{ raw_id }}\"\n                  current_user: Unknown\n              - action: script.notify_smart_master\n                data:\n                  category: system\n                  title: \ud83d\udd90\ufe0f New Fingerprint ID\n                  message: \"ID: {{ raw_id }}\\nAdded to User Management as 'Unknown'.\"\n                  image: /local/front_door_unlock_snapshot.jpg?t={{ now().timestamp() }}\n                  tag: door_lock_unknown\n                  clickAction: /lovelace/access-control\n\n  # --- LOGIC 2: NFC ENTRY ---\n  - alias: \"Access: NFC Entry Logic\"\n    id: access_nfc_entry_logic\n    mode: single\n    trigger:\n      - platform: state\n        entity_id: event.front_door_nfc\n        not_from:\n          - \"unknown\"\n          - \"unavailable\"\n        not_to:\n          - \"unknown\"\n          - \"unavailable\"\n    variables:\n      raw_id: &gt;-\n        {{ trigger.to_state.attributes.ulp_id | default('unknown') }}\n      slug_id: \"{{ raw_id | replace('-', '_') | lower }}\"\n      # SHARED IDENTITY ENTITY\n      assigned_user: \"{{ states('select.unifi_user_' ~ slug_id) }}\"\n      # NFC ACCESS SWITCH\n      user_switch: \"switch.nfc_access_{{ assigned_user | slugify }}\"\n    action:\n      - target:\n          entity_id: camera.g4_doorbell_pro_poe_high_resolution_channel\n        data:\n          filename: /config/www/front_door_nfc_snapshot.jpg\n        action: camera.snapshot\n\n      - choose:\n          # ROLE 1: GUEST\n          - conditions:\n              - condition: template\n                value_template: \"{{ 'guest' in assigned_user | lower }}\"\n            sequence:\n              - if:\n                  - condition: template\n                    value_template: &gt;\n                      {# FAIL CLOSED: Switch MUST be ON #}\n                      {% set access_enabled = is_state(user_switch, 'on') %}\n                      {# SCHEDULE CHECK (UNIFIED) #}\n                      {% set current_day = now().strftime('%a')|lower %}\n                      {% set is_day_allowed = is_state('input_boolean.guest_access_' ~ current_day, 'on') %}\n                      {% set current_time = now().strftime('%H:%M:%S') %}\n                      {% set start_time = states('input_datetime.guest_access_start') %}\n                      {% set end_time = states('input_datetime.guest_access_end') %}\n                      {% set is_time_allowed = (current_time &gt;= start_time) and (current_time &lt;= end_time) %}\n\n                      {{ access_enabled and is_day_allowed and is_time_allowed }}\n                then:\n                  - action: lock.unlock\n                    target:\n                      entity_id: lock.front_door_lock\n                  - action: logbook.log\n                    data:\n                      name: \"Front Door Access\"\n                      message: \"\ud83d\udd13 Guest {{ assigned_user }} entered via NFC.\"\n                      entity_id: lock.front_door_lock_cloud\n                  - action: script.notify_smart_master\n                    data:\n                      category: security\n                      title: \ud83d\udd13 Guest Entry (NFC)\n                      message: \"Guest entered via NFC.\"\n                      image: /local/front_door_nfc_snapshot.jpg?t={{ now().timestamp() }}\n                      tag: door_lock\n                else:\n                  - action: logbook.log\n                    data:\n                      name: \"Front Door Access\"\n                      message: \"\u26d4 Guest Access Denied (NFC): {{ assigned_user }}.\"\n                      entity_id: lock.front_door_lock_cloud\n                  - action: script.notify_smart_master\n                    data:\n                      category: security\n                      title: \u26d4 Access Denied (NFC)\n                      message: &gt;\n                        {% if not is_state(user_switch, 'on') %}\n                          Guest NFC access manually DISABLED.\n                        {% else %}\n                          Guest outside allowed schedule.\n                        {% endif %}\n                      critical: true\n                      image: /local/front_door_nfc_snapshot.jpg?t={{ now().timestamp() }}\n                      tag: door_lock_denied\n\n          # ROLE 2: STANDARD USER\n          - conditions:\n              - condition: template\n                value_template: &gt;\n                  {{ assigned_user not in ['unknown', 'unavailable', 'none', 'Unknown', '-Unassigned-', '-unassigned-', 'Guest'] }}\n            sequence:\n              - if:\n                  - condition: template\n                    # FAIL CLOSED\n                    value_template: \"{{ is_state(user_switch, 'on') }}\"\n                then:\n                  - action: lock.unlock\n                    target:\n                      entity_id: lock.front_door_lock\n                  - action: logbook.log\n                    data:\n                      name: \"Front Door Access\"\n                      message: \"\ud83d\udd13 {{ assigned_user }} unlocked via NFC.\"\n                      entity_id: lock.front_door_lock_cloud\n                  - action: script.notify_smart_master\n                    data:\n                      category: security\n                      title: \ud83d\udd13 Front Door Unlocked (NFC)\n                      message: \"Unlocked by: {{ assigned_user }}\"\n                      image: /local/front_door_nfc_snapshot.jpg?t={{ now().timestamp() }}\n                      tag: door_lock\n                else:\n                  - action: logbook.log\n                    data:\n                      name: \"Front Door Access\"\n                      message: \"\u26d4 Access Disabled (NFC): {{ assigned_user }}.\"\n                      entity_id: lock.front_door_lock_cloud\n                  - action: script.notify_smart_master\n                    data:\n                      category: security\n                      title: \u26d4 Access Disabled\n                      message: \"NFC valid, but {{ assigned_user }}'s NFC access is switched OFF.\"\n                      critical: true\n                      image: /local/front_door_nfc_snapshot.jpg?t={{ now().timestamp() }}\n                      tag: door_lock_denied\n\n          # ROLE 3: AUTO-LEARN\n          - conditions:\n              - condition: template\n                value_template: \"{{ raw_id != 'unknown' and raw_id != '' }}\"\n            sequence:\n              - action: script.add_unifi_user_entity\n                data:\n                  ulp_id: \"{{ raw_id }}\"\n                  current_user: Unknown\n              - action: script.notify_smart_master\n                data:\n                  category: system\n                  title: \ud83c\udff7\ufe0f New NFC ID\n                  message: \"ID: {{ raw_id }}\\nAdded to User Management as 'Unknown'.\"\n                  image: /local/front_door_nfc_snapshot.jpg?t={{ now().timestamp() }}\n                  tag: door_lock_unknown\n                  clickAction: /lovelace/access-control\n\n  # --- SYSTEM PERSISTENCE (Universal) ---\n  - alias: \"System: Unifi Access MQTT Persistence\"\n    id: system_unifi_access_mqtt_persistence\n    mode: parallel\n    trigger:\n      - platform: mqtt\n        topic: \"unifi_access/+/user/set\"\n      - platform: mqtt\n        topic: \"unifi_access/access/+/set\"\n      - platform: mqtt\n        topic: \"fingerprint/access/+/set\" # Legacy/Compatibility\n      - platform: mqtt\n        topic: \"nfc/access/+/set\" # Legacy/Compatibility\n    action:\n      - service: mqtt.publish\n        data:\n          topic: \"{{ trigger.topic | replace('/set', '/state') }}\"\n          payload: \"{{ trigger.payload }}\"\n          retain: true\n\n  # --- AUTO-CREATE SWITCHES ON ASSIGNMENT CHANGE ---\n  - alias: \"System: Unifi User Assignment Update\"\n    id: system_unifi_user_assignment_update\n    mode: parallel\n    trigger:\n      - platform: mqtt\n        topic: \"unifi_access/+/user/set\"\n    action:\n      - variables:\n          slug: \"{{ trigger.topic.split('/')[1] }}\"\n          entity_id: \"select.unifi_user_{{ slug }}\"\n      - delay: \"00:00:00.200\"\n      - service: script.add_unifi_user_entity\n        data:\n          ulp_id: \"{{ state_attr(entity_id, 'ulp_id') | default(slug) }}\"\n          current_user: \"{{ trigger.payload }}\"\n      - delay: \"00:00:00.200\"\n      - service: script.cleanup_unused_unifi_switches\n\n# ------------------------------------------------------------------------------\n# 3. SCRIPTS\n# ------------------------------------------------------------------------------\nscript:\n  # --- ADD / UPDATE USER &amp; CREATE BOTH SWITCHES ---\n  add_unifi_user_entity:\n    alias: \"System: Add Unifi User\"\n    mode: parallel\n    fields:\n      ulp_id:\n        description: \"The Unifi ID (Member ID)\"\n        required: true\n      current_user:\n        description: \"Current assigned user\"\n        default: \"-unassigned-\"\n    sequence:\n      - variables:\n          slug: \"{{ ulp_id | replace('-', '_') | lower }}\"\n          user_list: &gt;-\n            {% set ns = namespace(users=['-Unassigned-', 'Guest']) %}\n            {% for p in states.person %}\n              {% set ns.users = ns.users + [p.attributes.friendly_name] %}\n            {% endfor %}\n            {{ ns.users | unique | sort | list }}\n\n          # Clean Name\n          clean_current_user: &gt;-\n            {% set step1 = current_user | replace(' Notify Service', '') | replace(' Notifications', '') %}\n            {% set parts = step1.split(' ') %}\n            {% if parts|length &gt; 1 and parts[0] == parts[-1] %}\n               {{ parts[0] }}\n            {% else %}\n               {{ step1 }}\n            {% endif %}\n\n      # --- 1. PUBLISH SHARED IDENTITY SELECT ---\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"homeassistant/select/unifi_user_{{ slug }}/config\"\n          payload: &gt;-\n            {\n              \"name\": \"Unifi User {{ ulp_id[:4] }}...\",\n              \"object_id\": \"unifi_user_{{ slug }}\",\n              \"unique_id\": \"unifi_user_{{ slug }}\",\n              \"icon\": \"mdi:account-key\",\n              \"options\": {{ user_list | to_json }},\n              \"command_topic\": \"unifi_access/{{ slug }}/user/set\",\n              \"state_topic\": \"unifi_access/{{ slug }}/user/state\",\n              \"availability_topic\": \"unifi_access/{{ slug }}/availability\",\n              \"payload_available\": \"online\",\n              \"json_attributes_topic\": \"unifi_access/{{ slug }}/attributes\",\n              \"device\": {\n                \"identifiers\": [\"unifi_access_manager\"],\n                \"name\": \"Unifi Access DB\",\n                \"manufacturer\": \"Home Assistant\",\n                \"model\": \"Unified ID DB\"\n              }\n            }\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"unifi_access/{{ slug }}/attributes\"\n          payload: &gt;-\n            { \"ulp_id\": \"{{ ulp_id }}\" }\n\n      # --- 2. UPDATE STATE ---\n      - if:\n          - condition: template\n            value_template: &gt;-\n              {{ states('select.unifi_user_' ~ slug) != clean_current_user }}\n        then:\n          - service: mqtt.publish\n            data:\n              retain: true\n              topic: \"unifi_access/{{ slug }}/user/state\"\n              payload: \"{{ clean_current_user }}\"\n\n      # --- 3. CREATE SWITCHES (FP &amp; NFC) ---\n      - variables:\n          user_slug: \"{{ clean_current_user | slugify }}\"\n\n      - if:\n          - condition: template\n            value_template: \"{{ clean_current_user not in ['-Unassigned-', 'Unknown', 'unknown'] }}\"\n        then:\n          # --- SWITCH 1: FINGERPRINT ACCESS ---\n          - service: mqtt.publish\n            data:\n              retain: true\n              topic: \"homeassistant/switch/fp_access_{{ user_slug }}/config\"\n              payload: &gt;-\n                {\n                  \"name\": \"FP Access: {{ clean_current_user }}\",\n                  \"object_id\": \"fp_access_{{ user_slug }}\",\n                  \"unique_id\": \"fp_access_switch_{{ user_slug }}\",\n                  \"icon\": \"mdi:fingerprint\",\n                  \"command_topic\": \"fingerprint/access/{{ user_slug }}/set\",\n                  \"state_topic\": \"fingerprint/access/{{ user_slug }}/state\",\n                  \"device\": { \"identifiers\": [\"unifi_access_manager\"] }\n                }\n          # Init FP ON\n          - if:\n              - condition: template\n                value_template: \"{{ states('switch.fp_access_' ~ user_slug) in ['unknown', 'unavailable', 'none'] }}\"\n            then:\n              - service: mqtt.publish\n                data:\n                  retain: true\n                  topic: \"fingerprint/access/{{ user_slug }}/state\"\n                  payload: \"ON\"\n\n          # --- SWITCH 2: NFC ACCESS ---\n          - service: mqtt.publish\n            data:\n              retain: true\n              topic: \"homeassistant/switch/nfc_access_{{ user_slug }}/config\"\n              payload: &gt;-\n                {\n                  \"name\": \"NFC Access: {{ clean_current_user }}\",\n                  \"object_id\": \"nfc_access_{{ user_slug }}\",\n                  \"unique_id\": \"nfc_access_switch_{{ user_slug }}\",\n                  \"icon\": \"mdi:tag-check\",\n                  \"command_topic\": \"nfc/access/{{ user_slug }}/set\",\n                  \"state_topic\": \"nfc/access/{{ user_slug }}/state\",\n                  \"device\": { \"identifiers\": [\"unifi_access_manager\"] }\n                }\n          # Init NFC ON\n          - if:\n              - condition: template\n                value_template: \"{{ states('switch.nfc_access_' ~ user_slug) in ['unknown', 'unavailable', 'none'] }}\"\n            then:\n              - service: mqtt.publish\n                data:\n                  retain: true\n                  topic: \"nfc/access/{{ user_slug }}/state\"\n                  payload: \"ON\"\n\n      # --- 4. SET ONLINE ---\n      - service: mqtt.publish\n        data:\n          retain: true\n          topic: \"unifi_access/{{ slug }}/availability\"\n          payload: \"online\"\n\n  # --- REFRESH ALL USERS ---\n  refresh_unifi_users:\n    alias: \"System: Refresh Unifi Users\"\n    mode: single\n    sequence:\n      - repeat:\n          for_each: &gt;-\n            {{ states.select | selectattr('entity_id', 'search', '^select\\\\.unifi_user_') | list }}\n          sequence:\n            - service: script.add_unifi_user_entity\n              data:\n                ulp_id: \"{{ state_attr(repeat.item.entity_id, 'ulp_id') }}\"\n                current_user: \"{{ repeat.item.state }}\"\n      - service: script.cleanup_unused_unifi_switches\n\n  # --- CLEANUP ORPHANED SWITCHES (FP &amp; NFC) ---\n  cleanup_unused_unifi_switches:\n    alias: \"System: Cleanup Unused Unifi Switches\"\n    mode: single\n    sequence:\n      - variables:\n          active_user_slugs: &gt;-\n            {% set ns = namespace(slugs=[]) %}\n            {% for s in states.select | selectattr('entity_id', 'search', '^select\\\\.unifi_user_') %}\n               {% if s.state not in ['-Unassigned-', 'Unknown', 'unknown', 'unavailable', 'none'] %}\n                 {% set ns.slugs = ns.slugs + [s.state | slugify] %}\n               {% endif %}\n            {% endfor %}\n            {{ ns.slugs | unique | list }}\n\n          # Find all existing switches\n          fp_switches: \"{{ states.switch | selectattr('entity_id', 'search', '^switch\\\\.fp_access_') | map(attribute='entity_id') | list }}\"\n          nfc_switches: \"{{ states.switch | selectattr('entity_id', 'search', '^switch\\\\.nfc_access_') | map(attribute='entity_id') | list }}\"\n\n      # Cleanup FP Switches\n      - repeat:\n          for_each: \"{{ fp_switches }}\"\n          sequence:\n            - variables:\n                switch_slug: \"{{ repeat.item.replace('switch.fp_access_', '') }}\"\n            - if:\n                - condition: template\n                  value_template: \"{{ switch_slug not in active_user_slugs }}\"\n              then:\n                - service: mqtt.publish\n                  data:\n                    topic: \"homeassistant/switch/fp_access_{{ switch_slug }}/config\"\n                    payload: \"\"\n                    retain: true\n                - service: mqtt.publish\n                  data:\n                    topic: \"fingerprint/access/{{ switch_slug }}/state\"\n                    payload: \"\"\n                    retain: true\n\n      # Cleanup NFC Switches\n      - repeat:\n          for_each: \"{{ nfc_switches }}\"\n          sequence:\n            - variables:\n                switch_slug: \"{{ repeat.item.replace('switch.nfc_access_', '') }}\"\n            - if:\n                - condition: template\n                  value_template: \"{{ switch_slug not in active_user_slugs }}\"\n              then:\n                - service: mqtt.publish\n                  data:\n                    topic: \"homeassistant/switch/nfc_access_{{ switch_slug }}/config\"\n                    payload: \"\"\n                    retain: true\n                - service: mqtt.publish\n                  data:\n                    topic: \"nfc/access/{{ switch_slug }}/state\"\n                    payload: \"\"\n                    retain: true\n</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/washing_machine/","title":"Package: Washing Machine","text":"","tags":["package","automated"]},{"location":"smart-home/packages/washing_machine/#package-washing-machine","title":"Package: Washing Machine","text":"<p>Version: 1.0.0 Description: Logic for Washing Machine state tracking, run time calculation, and notifications.</p> <p></p>","tags":["package","automated"]},{"location":"smart-home/packages/washing_machine/#executive-summary","title":"Executive Summary","text":"<p>The Washing Machine package provides intelligent state tracking for any washing machine connected to a smart plug with power monitoring. It uses power consumption data to automatically detect when a cycle starts and finishes. The system tracks the exact run time of each load and sends actionable notifications to users, ensuring laundry is never left forgotten in the machine. It abstracts complex power fluctuations into simple statuses like \"Idle\", \"Running\", and \"Clean\".</p>","tags":["package","automated"]},{"location":"smart-home/packages/washing_machine/#process-description-non-technical","title":"Process Description (Non-Technical)","text":"","tags":["package","automated"]},{"location":"smart-home/packages/washing_machine/#how-it-works","title":"How It Works","text":"<ol> <li>Auto-Detection: The system monitors the electricity usage of the washing machine smart plug.</li> <li>Cycle Start: When power usage exceeds 10W for more than 1 minute, the system marks the machine as \"Running\" and records the start time.</li> <li>Notifications:<ul> <li>Started: A notification confirms the cycle has begun.</li> <li>Finished: When power drops below 3W for 2 minutes, the system marks the laundry as \"Clean\" and sends a notification including the total cycle duration (e.g., \"1 hr 45 min\").</li> </ul> </li> <li>Continuous Status: The system maintains a live \"Run Time\" sensor, so you can always see how long the current load has been washing.</li> </ol>","tags":["package","automated"]},{"location":"smart-home/packages/washing_machine/#dashboard-connections","title":"Dashboard Connections","text":"<p>This package powers the following dashboard views:</p> <ul> <li>System: This view provides deep insights into the Proxmox 'Halo' virtualization node. It features real-time resource monitoring (CPU, RAM) using <code>mini-graph-card</code>, and critical power controls (Reboot, Shutdown) protected by confirmation dialogs. It also offers bulk management for guest VMs/containers and tracks system update status, ensuring the infrastructure host is healthy and up-to-date. (Uses 1 entities)</li> <li>Home: The Home dashboard serves as the central information hub. It features a large clock and family calendars, alongside detailed weather forecasts. Key home stats are highlighted, including real-time energy prices, power usage, and the status of major appliances like the dishwasher and washing machine. The view also provides a high-level overview of the entire house, displaying camera feeds and status summaries for all key rooms (Sauna, Bathroom, Bedroom, etc.) using 'Streamline' area cards. (Uses 1 entities)</li> </ul>","tags":["package","automated"]},{"location":"smart-home/packages/washing_machine/#architecture-diagram","title":"Architecture Diagram","text":"<p>The architecture relies on a state machine driven by numeric state triggers from the power sensor. High power draw triggers the <code>Running</code> state and initializes the start timer. Low power draw triggers the <code>Clean</code> state and calculates the final duration. A generic reset mechanism or a subsequent high power event transitions the system back to <code>Idle</code> or directly to <code>Running</code> for the next load.</p> <pre><code>sequenceDiagram\n    participant Machine as Smart Plug (Washing Machine)\n    participant HA as Home Assistant\n    participant User as User (Mobile)\n\n    Machine-&gt;&gt;HA: Power &gt; 10W (for 1 min)\n    HA-&gt;&gt;HA: Set Status 'Running'\n    HA-&gt;&gt;HA: Record Start Time\n    HA-&gt;&gt;User: Notify \"Washing Machine Started\"\n\n    loop Monitoring\n        HA-&gt;&gt;HA: Update Run Time Sensor\n    end\n\n    Machine-&gt;&gt;HA: Power &lt; 3W (for 2 min)\n    HA-&gt;&gt;HA: Set Status 'Clean'\n    HA-&gt;&gt;HA: Calculate Total Duration\n    HA-&gt;&gt;User: Notify \"Laundry is Ready\" (Duration)\n\n    opt Reset\n        HA-&gt;&gt;HA: Auto-change to 'Idle' (if logic enabled)\n        Note over HA: Ready for next load\n    end</code></pre>","tags":["package","automated"]},{"location":"smart-home/packages/washing_machine/#configuration-source-code","title":"Configuration (Source Code)","text":"<pre><code># ------------------------------------------------------------------------------\n# Package: Washing Machine\n# Version: 1.0.0\n# Description: Logic for Washing Machine state tracking, run time calculation, and notifications.\n# Dependencies:\n#   - Sensor: sensor.washing_machine_plug_power\n#   - Script: script.notify_smart_master\n# ------------------------------------------------------------------------------\n\n# ------------------------------------------------------------------------------\n# 1. HELPERS\n# ------------------------------------------------------------------------------\ninput_select:\n  washing_machine_status:\n    name: \"Washing Machine Status\"\n    icon: mdi:washing-machine\n    options:\n      - Idle\n      - Running\n      - Clean\n    initial: Idle\n\ninput_datetime:\n  washing_machine_start_time:\n    name: \"Washing Machine Start Time\"\n    has_date: true\n    has_time: true\n\n# ------------------------------------------------------------------------------\n# 2. SENSORS\n# ------------------------------------------------------------------------------\ntemplate:\n  - sensor:\n      - name: \"Washing Machine Run Time\"\n        unique_id: washing_machine_run_time\n        icon: mdi:timer-outline\n        state: &gt;\n          {% if is_state('input_select.washing_machine_status', 'Running') %}\n             {% set start = states('input_datetime.washing_machine_start_time') | as_datetime %}\n             {% if start %}\n               {{ (now() - start).total_seconds() | timestamp_custom('%-H:%M', false) }}\n             {% else %}\n               0:00\n             {% endif %}\n          {% else %}\n             0:00\n          {% endif %}\n\n# ------------------------------------------------------------------------------\n# 3. AUTOMATIONS\n# ------------------------------------------------------------------------------\nautomation:\n  # --- START DETECTED ---\n  - alias: \"Notify: Washing Machine Started\"\n    id: notify_washing_machine_started\n    trigger:\n      - platform: numeric_state\n        entity_id: sensor.washing_machine_plug_power\n        above: 10\n        for: \"00:01:00\"\n    condition:\n      - condition: state\n        entity_id: input_select.washing_machine_status\n        state:\n          - \"Idle\"\n          - \"Clean\"\n    action:\n      - service: input_select.select_option\n        target:\n          entity_id: input_select.washing_machine_status\n        data:\n          option: \"Running\"\n      - service: input_datetime.set_datetime\n        target:\n          entity_id: input_datetime.washing_machine_start_time\n        data:\n          timestamp: \"{{ now().timestamp() }}\"\n      - service: script.notify_smart_master\n        data:\n          category: info\n          title: \ud83e\uddfa Washing Machine Started\n          message: \"The cycle has started.\"\n          tag: washing_machine\n          clickAction: /lovelace/utility\n    mode: single\n\n  # --- FINISH DETECTED ---\n  - alias: \"Notify: Washing Machine Finished\"\n    id: notify_washing_machine_finished\n    trigger:\n      - platform: numeric_state\n        entity_id: sensor.washing_machine_plug_power\n        below: 5\n        for: \"00:02:00\"\n    condition:\n      - condition: state\n        entity_id: input_select.washing_machine_status\n        state: \"Running\"\n    action:\n      - service: input_select.select_option\n        target:\n          entity_id: input_select.washing_machine_status\n        data:\n          option: \"Clean\"\n\n      # Calculate Final Duration\n      - variables:\n          start_time: \"{{ states('input_datetime.washing_machine_start_time') | as_datetime }}\"\n          duration_str: &gt;-\n            {% if start_time %}\n               {{ (now() - start_time).total_seconds() | timestamp_custom('%-H hr %-M min', false) }}\n            {% else %}\n               unknown time\n            {% endif %}\n\n      - service: script.notify_smart_master\n        data:\n          category: info\n          title: \u2728 Laundry is Ready\n          message: \"Cycle finished. Duration: {{ duration_str }}.\"\n          tag: washing_machine\n          clickAction: /lovelace/utility\n    mode: single\n\n  # --- RESET TO IDLE ---\n  # Optional: Reset to Idle manually or when power drops after door opening/unloading logic (if sensor avail).\n  # For now, we auto-reset to Idle if power stays low for a long time OR if it restarts.\n  # Simplest approach: \"Clean\" transitions back to \"Running\" if power spikes (handled above if we remove condition),\n  # OR we add a manual reset / auto-reset after X hours.\n  # Let's add a simple \"Reset to Idle\" if it stays \"Clean\" for 15 mins (assuming unloaded?)\n  # OR just let the next Start trigger reset it?\n  # BETTER: The \"Start\" automation requires state to be \"Idle\".\n  # So we need a transition Clean -&gt; Idle.\n  # Transition: If Clean AND Power &lt; 1W for 15 mins?\n  # Or just allow Start to trigger from \"Clean\" too?\n  # Let's Modify Start automation to NOT block on \"Idle\".\n\n  - alias: \"System: Washing Machine Reset\"\n    id: system_washing_machine_reset\n    trigger:\n      # If we want to automatically mark it as 'Idle' after some time\n      - platform: state\n        entity_id: input_select.washing_machine_status\n        to: \"Clean\"\n        for: \"01:00:00\" # Auto-reset after 1 hour if not unloaded\n    action:\n      - service: input_select.select_option\n        target:\n          entity_id: input_select.washing_machine_status\n        data:\n          option: \"Idle\"\n    mode: single\n  # ------------------------------------------------------------------------------\n  # 4. OVERRIDES\n  # ------------------------------------------------------------------------------\n  # Allow \"Start\" to trigger even if status is \"Clean\" (forgot to unload)\n  # See modification in Automation 1 Check: currently checks for \"Idle\".\n  # Let's change Automation 1 condition to be status != Running.\n\n  - alias: \"System: Washing Machine Recovery\"\n    id: system_washing_machine_recovery\n    trigger:\n      - platform: homeassistant\n        event: start\n      - platform: event\n        event_type: automation_reloaded\n    action:\n      # If Power &gt; 10W and Status is Idle/Clean -&gt; Set Running\n      - if:\n          - condition: numeric_state\n            entity_id: sensor.washing_machine_plug_power\n            above: 10\n          - condition: not\n            conditions:\n              - condition: state\n                entity_id: input_select.washing_machine_status\n                state: \"Running\"\n        then:\n          - service: input_select.select_option\n            target:\n              entity_id: input_select.washing_machine_status\n            data:\n              option: \"Running\"\n          - service: input_datetime.set_datetime\n            target:\n              entity_id: input_datetime.washing_machine_start_time\n            data:\n              timestamp: \"{{ now().timestamp() }}\"\n          - service: script.notify_smart_master\n            data:\n              category: info\n              title: \u267b\ufe0f System Recovery\n              message: \"Washing machine resumed from power state.\"\n              tag: washing_machine\n\n      # If Power &lt; 5W and Status is Running -&gt; Set Clean\n      - if:\n          - condition: numeric_state\n            entity_id: sensor.washing_machine_plug_power\n            below: 5\n          - condition: state\n            entity_id: input_select.washing_machine_status\n            state: \"Running\"\n        then:\n          - service: input_select.select_option\n            target:\n              entity_id: input_select.washing_machine_status\n            data:\n              option: \"Clean\"\n</code></pre>","tags":["package","automated"]},{"location":"workflow/","title":"Home Assistant Documentation Workflow","text":"","tags":["meta","architecture","guide"]},{"location":"workflow/#documentation-architecture-workflow","title":"Documentation Architecture &amp; Workflow","text":"<p>This article details the technical implementation of the EvisHomeLab Home Assistant documentation. It explains the \"Detached Docs\" strategy, the automation machinery that generates it, AI content injection, and how we ensure privacy and security.</p>","tags":["meta","architecture","guide"]},{"location":"workflow/#summary-non-technical","title":"Summary (Non-Technical)","text":"<p>What This System Achieves This system solves the \"Stale Documentation\" problem by treating documentation as living code. Instead of relying on humans to remember to update a wiki every time they change a configuration, our \"Agentic\" system automatically regenerates the manual from the actual source code. This ensures that the public documentation website always reflects the reality of the Home Lab, while strictly preserving privacy by redaction of names and secrets. It transforms a private, messy technical setup into a polished, public-facing product showcase.</p> <p>How It Actually Works Think of the system as a \"Secure Publishing Bridge\". On one side is your private Home Assistant server, with some privacy-security-sensitive data (names, MAC addresses, etc.). On the other side is the public internet. Our automation scripts act as the bridge: they read the private data, \"sanitize\" it (anonymizing names, api keys, passwords, etc.), format it into readable articles, and then push only the clean, safe version to GitHub. This works in two steps: first creating the document md file with the code and placeholders for screenshots, AI summaries, descriptions, diagrams, and the letting AI read through the code and actually generate the summaries, descriptions, and diagrams. This way the documentation is always up to date and accurate and the format is consistent</p> <p>Future Improvements (Roadmap) While currently robust, we have exciting ideas for \"V3\". I'm thinking to implement AI-Generated Changelogs, where the system explains why a change was made, not just what changed. We also thinking to add Automated Screenshotting, using a headless browser to take real photos of dashboards during the build process, replacing the current manual \"Drop &amp; Link\" method.</p>","tags":["meta","architecture","guide"]},{"location":"workflow/#1-the-detached-docs-strategy","title":"1. The \"Detached Docs\" Strategy","text":"<p>The core architectural decision of this project is the separation of concerns between the live system and the public documentation.</p>","tags":["meta","architecture","guide"]},{"location":"workflow/#the-problem","title":"The Problem","text":"<p>Home Assistant's configuration (<code>/config</code>) is full of sensitive data: - <code>secrets.yaml</code> (passwords, tokens) - <code>known_devices.yaml</code> (MAC addresses) - <code>home-assistant_v2.db</code> (detailed usage history) - Personal entity IDs (e.g., <code>device_tracker.jukka_iphone</code>)</p> <p>Pushing the entire <code>/config</code> folder to GitHub, even with <code>.gitignore</code>, is high-risk. Accidental leakage of <code>secrets.yaml</code> or personal data is catastrophic.</p>","tags":["meta","architecture","guide"]},{"location":"workflow/#the-solution","title":"The Solution","text":"<p>We maintain two separate repositories:</p> <ol> <li> <p>Private Config (Local Only):</p> <ul> <li>Location: <code>z:\\</code> (The root <code>/config</code> folder)</li> <li>Contains: Live YAML, databases, logs, original scripts.</li> <li>NEVER pushed to GitHub.</li> </ul> </li> <li> <p>Public Docs (Remote):</p> <ul> <li>Location: <code>z:\\docs_site</code></li> <li>Contains: Sanitized Markdown, diagrams, and assets.</li> <li>Pushed to GitHub EvisHomeLab.</li> </ul> </li> </ol> <p>The \"Bridge\" between these two worlds is our Automation Layer.</p> <pre><code>graph LR\n    subgraph Private [\"Private Zone (Local HA)\"]\n        Config[\"Live YAML Config (Packages)\"]\n        Storage[\"JSON Dashboards (.storage)\"]\n    end\n\n    subgraph Bridge [\"Automation &amp; Intelligence\"]\n        Generator[\"Scripted Generator\"]\n        Redactor[\"Privacy Redactor\"]\n        AI[\"AI Agent (Antigravity)\"]\n    end\n\n    subgraph Public [\"Public Zone (GitHub)\"]\n        Markdown[Markdown Files]\n        Site[MkDocs Site]\n    end\n\n    %% Flow 1: Scripted Generation\n    Config --&gt; Generator\n    Storage --&gt; Generator\n    Generator --&gt; Redactor\n    Redactor --&gt;|Scaffolding| Markdown\n\n    %% Flow 2: AI Injection\n    Config -.-&gt;|Read Context| AI\n    Storage -.-&gt;|Read Context| AI\n    AI --&gt;|Inject Content| Markdown\n\n    %% Flow 3: Build\n    Markdown --&gt; Site</code></pre>","tags":["meta","architecture","guide"]},{"location":"workflow/#2-the-automation-machinery","title":"2. The Automation Machinery","text":"<p>We do not write most of the documentation manually. Instead, we generate it from the live configuration to ensure it never goes stale.</p> <p>The tooling is built as a modular Python package located in <code>z:\\.ag_scripts</code>.</p>","tags":["meta","architecture","guide"]},{"location":"workflow/#21-entry-point","title":"2.1 Entry Point","text":"<p>The main entry point for the user is the update script in the root directory:</p> <pre><code>python ag_v2_update.py\n</code></pre> <p>This script bootstraps the <code>orchestrator</code> module, which runs the generation pipeline.</p>","tags":["meta","architecture","guide"]},{"location":"workflow/#22-key-modules","title":"2.2 Key Modules","text":"<ul> <li> <p><code>common/privacy.py</code>: The Single Source of Truth for redaction. It defines a strict mapping (regex patterns) to sanitize data before it is written to the <code>docs_site</code> folder.</p> <ul> <li><code>Jukka</code> -&gt; <code>Evis</code></li> <li><code>\"name\"</code> -&gt; <code>Daughter</code></li> <li>License Plates -&gt; <code>[LICENSE_PLATE]</code></li> </ul> </li> <li> <p><code>dashboard_manager/</code>: Reads the hidden <code>.storage/lovelace.*</code> JSON files.</p> <ul> <li>Converts JSON to YAML Block Style (for readability).</li> <li>Applies redaction.</li> <li>Generates <code>docs/smart-home/dashboards.md</code> with \"Drop &amp; Link\" placeholders for screenshots.</li> </ul> </li> <li> <p><code>package_manager/</code>: Scans the <code>packages/</code> directory.</p> <ul> <li>Parses YAML to understand the package structure.</li> <li> <p>Dependency Lookup: Automatically scans all Dashboard documentation to find where package entities are used (\"Reverse Dependency Search\").</p> </li> <li> <p>Generates \"Executive Summaries\" and wiring diagrams.</p> </li> <li>Updates <code>docs/smart-home/packages/*.md</code>.</li> </ul> </li> </ul>","tags":["meta","architecture","guide"]},{"location":"workflow/#23-the-magic-ai-intelligence-injection","title":"2.3 The \"Magic\": AI Intelligence Injection","text":"<p>While the Python scripts handle the Scaffolding (creating files, basic headers, standard layouts), they cannot understand context. This is where the AI Agent (Google Antigravity) steps in to perform the \"Intelligence Injection\".</p> <p>This is the two-step dance:</p> <ol> <li> <p>The Scripts Build the Skeleton:     The <code>ag_v2_package.py</code> script creates the Markdown file and inserts \"Slots\" (HTML comments) for content:     </p><pre><code>&lt;!-- START_SUMMARY --&gt;\n*No summary generated yet.*\n&lt;!-- END_SUMMARY --&gt;\n</code></pre><p></p> </li> <li> <p>The AI Fills the Brains:     You (the developer) ask the AI to \"Analyze the Car Package\". The AI then:</p> <ul> <li>Reads the Code: Scans the raw YAML to understand logic flow.</li> <li>Identifies Dependencies: Distinguishes between a simple <code>input_boolean</code> (internal helper) and a complex <code>mqtt</code> sensor (External Integration).</li> <li>Generates Diagrams: Writings <code>Mermaid JS</code> sequence diagrams that visually explain how the automation works.</li> <li>Writes the Narrative: Replaces the empty placeholders in the Markdown file with human-readable \"Executive Summaries\" and \"Process Descriptions\".</li> </ul> </li> </ol> <p>This hybrid approach gives us the best of both worlds: Machine consistency (files always exist, navigation is always correct) + Human-like understanding (explanations that actually make sense).</p>","tags":["meta","architecture","guide"]},{"location":"workflow/#3-the-build-pipeline-mkdocs","title":"3. The Build Pipeline (MkDocs)","text":"<p>Once the Markdown files are generated in <code>docs_site/</code>, we use MkDocs with the Material theme to build the static site.</p>","tags":["meta","architecture","guide"]},{"location":"workflow/#configuration-mkdocsyml","title":"Configuration (<code>mkdocs.yml</code>)","text":"<p>We use a feature-rich configuration to create a \"Premium\" feel:</p> <ul> <li>Navigation: <code>awesome-pages</code> plugin automatically builds the sidebar from the folder structure.</li> <li>Admonitions: <code>!!! info</code> blocks for architectural alerts.</li> <li>Mermaid: Verified support for rendering sequence diagrams.</li> <li>Hooks: A custom <code>hooks/hide_drafts.py</code> script runs during the build to exclude any file marked with <code>draft: true</code> in its frontmatter.</li> </ul>","tags":["meta","architecture","guide"]},{"location":"workflow/#4-safety-logic-stale-documentation-detection","title":"4. Safety Logic: Stale Documentation Detection","text":"<p>A key fear with automated docs is that the code changes (e.g., v1.1) but the human-written/AI-generated explanations (written for v1.0) remain, becoming misleading.</p> <p>We implemented a Version Integrity Check to solve this:</p> <ol> <li>Code Versioning: We enforce a <code>Version: X.X.X</code> tag in the header of every YAML package file.</li> <li>Comparison: When the update script runs, it compares the Code Version against the Documentation Version in the Markdown frontmatter.</li> <li>Warning Injection: If a mismatch is detected (e.g., Code is v1.2, Docs are v1.1), the system does not overwrite the manual explanations. Instead, it injects a warning into every text section:     &gt; \u26a0\ufe0f Update Required: Analysis for v1.1. Code is v1.2.</li> </ol> <p>This ensures that a user reading the docs knows immediately that the explanation might be slightly out of date, prompting a new AI analysis cycle.</p>","tags":["meta","architecture","guide"]},{"location":"workflow/#5-maintenance-workflow","title":"5. Maintenance Workflow","text":"<p>We divide the documentation into two distinct zones:</p>","tags":["meta","architecture","guide"]},{"location":"workflow/#zone-a-manual-documentation-guides-manuals","title":"Zone A: Manual Documentation (Guides &amp; Manuals)","text":"<ul> <li>Locations: <code>/docs/network/</code>, <code>/docs/articles/</code>, root <code>/docs/</code></li> <li>Workflow:<ol> <li>User creates <code>.md</code> files manually.</li> <li>User writes content (guides, SOPs, articles), while AI can be used to generate summaries and assist with content.</li> <li>No automation touches these files.</li> </ol> </li> </ul>","tags":["meta","architecture","guide"]},{"location":"workflow/#zone-b-automated-documentation-smart-home-specs","title":"Zone B: Automated Documentation (Smart Home Specs)","text":"<ul> <li>Locations: <code>/docs/smart-home/packages/</code>, <code>/docs/smart-home/dashboards/</code></li> <li>Workflow:<ol> <li>NEVER create files manually here.</li> <li>Run <code>python ag_v2_update.py</code>. The scripts will generate the files/indexes.</li> <li>AI Injection: The AI then fills in the content slots (<code>&lt;!-- START_SUMMARY --&gt;</code>) inside these generated files.</li> <li>User can review and edit the generated content.</li> </ol> </li> </ul>","tags":["meta","architecture","guide"]},{"location":"workflow/#updating-configuration-automated","title":"Updating Configuration (Automated)","text":"<ol> <li>Make changes to your Home Assistant YAML or Dashboards.</li> <li>Run the update tool:     <pre><code>python ag_v2_update.py\n</code></pre></li> <li>The scripts will regenerate the relevant docs.</li> <li>Git Commit &amp; Push:     <pre><code>cd docs_site\ngit add .\ngit commit -m \"Update configuration specs\"\ngit push\n</code></pre></li> <li>GitHub Actions detects the push and publishes the site to <code>www.evishome.com</code>.</li> </ol>","tags":["meta","architecture","guide"]},{"location":"workflow/architecture/","title":"Documentation System Architecture","text":"","tags":["meta","architecture","manual"]},{"location":"workflow/architecture/#documentation-system-architecture","title":"Documentation System Architecture","text":"<p>Philosophy: \"Everything as Code\" Status: Self-Validating &amp; Modular Version: 2.1 (Clarified Manual Steps)</p>","tags":["meta","architecture","manual"]},{"location":"workflow/architecture/#1-the-core-concept","title":"1. The Core Concept","text":"<p>Unlike traditional wikis where documentation is written manually and eventually goes stale, EvisHomeLab uses an Agentic Documentation System approach.</p> <p>The documentation is not just text; it is the output of an Orchestration Engine. We treat documentation updates exactly like software deployments: Source -&gt; Build -&gt; Deploy.</p>","tags":["meta","architecture","manual"]},{"location":"workflow/architecture/#the-modular-package-architecture","title":"The \"Modular Package\" Architecture","text":"<p>To prevent data loss and ensure maintainability, we use a standard Python package structure (<code>.ag_scripts</code>).</p> <pre><code>graph TD\n    subgraph Core Logic [.ag_scripts]\n        Common[common/]\n        Dash[dashboard_manager/]\n        Pkg[package_manager/]\n        Orch[orchestrator/]\n        Agent[agent/]\n    end\n\n    subgraph Shims [Root Interfaces]\n        V2_Dash[ag_v2_dashboard.py]\n        V2_Pkg[ag_v2_package.py]\n        V2_Upd[ag_v2_update.py]\n    end\n\n    subgraph Output [Documentation Site]\n        MD_Dash[docs/.../dashboards/*.md]\n        MD_Pkg[docs/.../packages/*.md]\n    end\n\n    V2_Dash --&gt; Dash\n    V2_Pkg --&gt; Pkg\n    V2_Upd --&gt; Orch\n\n    Orch --&gt; Dash &amp; Pkg\n    Dash --&gt;|Reads|.storage/lovelace\n    Pkg --&gt;|Reads|packages/*.yaml\n\n    Dash --&gt;|Generates| MD_Dash\n    Pkg --&gt;|Generates| MD_Pkg\n\n    Common -.-&gt; Dash &amp; Pkg &amp; Orch</code></pre>","tags":["meta","architecture","manual"]},{"location":"workflow/architecture/#2-the-toolchain-v2","title":"2. The Toolchain (V2)","text":"","tags":["meta","architecture","manual"]},{"location":"workflow/architecture/#a-the-directory-structure","title":"A. The Directory Structure","text":"<p>The system is organized to keep logic (<code>.ag_scripts</code>) separate from content (<code>packages/</code>, <code>docs/</code>).</p> <pre><code>/config\n\u251c\u2500\u2500 .ag_scripts/            # [NEW] The Brain (Python Logic)\n\u2502   \u251c\u2500\u2500 common/             # Shared Utils &amp; Privacy Map\n\u2502   \u251c\u2500\u2500 dashboard_manager/  # Dashboard Logic\n\u2502   \u251c\u2500\u2500 package_manager/    # Package Logic\n\u2502   \u2514\u2500\u2500 orchestrator/       # Update Logic\n\u251c\u2500\u2500 ag_v2_dashboard.py      # Shim Script\n\u251c\u2500\u2500 ag_v2_package.py        # Shim Script\n\u251c\u2500\u2500 ag_v2_update.py         # Shim Script\n\u251c\u2500\u2500 packages/               # Source: YAML Packages\n\u251c\u2500\u2500 .storage/               # Source: JSON Dashboards (Hidden)\n\u2514\u2500\u2500 docs_site/              # Output: The Documentation Web Site\n    \u251c\u2500\u2500 docs/\n    \u2514\u2500\u2500 mkdocs.yml\n</code></pre>","tags":["meta","architecture","manual"]},{"location":"workflow/architecture/#b-the-orchestrator-ag_v2_updatepy","title":"B. The Orchestrator (<code>ag_v2_update.py</code>)","text":"<p>The master controller. * Function: Calls the specialized modules to update the entire system. * Architecture: Just a shim that calls <code>.ag_scripts.orchestrator.update_all</code>.</p>","tags":["meta","architecture","manual"]},{"location":"workflow/architecture/#b-dashboard-manager-ag_v2_dashboardpy","title":"B. Dashboard Manager (<code>ag_v2_dashboard.py</code>)","text":"<ul> <li>Source: <code>.ag_scripts/dashboard_manager/</code></li> <li>Input: <code>.storage/lovelace</code> (Main) &amp; <code>.storage/lovelace_dashboards</code>.</li> <li>Output: <code>docs/smart-home/dashboards/[slug]/[view].md</code>.</li> <li>Features:<ul> <li>Preservation: Keeps manually written summaries.</li> <li>Linking: Auto-links packages.</li> <li>Privacy: Redacts names via <code>common/privacy.py</code>.</li> </ul> </li> </ul>","tags":["meta","architecture","manual"]},{"location":"workflow/architecture/#c-package-manager-ag_v2_packagepy","title":"C. Package Manager (<code>ag_v2_package.py</code>)","text":"<ul> <li>Source: <code>.ag_scripts/package_manager/</code></li> <li>Input: <code>packages/*.yaml</code>.</li> <li>Output: <code>docs/smart-home/packages/*.md</code>.</li> <li>Features:<ul> <li>Stale Detection: Warns if documentation version &lt; code version.</li> <li>Injection: Fills slots (<code>&lt;!-- START_SUMMARY --&gt;</code>) with content.</li> </ul> </li> </ul>","tags":["meta","architecture","manual"]},{"location":"workflow/architecture/#d-ai-agent-helper-ag_v2_agentpy","title":"D. AI Agent Helper (<code>ag_v2_agent.py</code>)","text":"<ul> <li>Function: Generates prompts for the IDE AI to write documentation.</li> <li>Context: Reads YAML and MD to give the AI full context.</li> </ul>","tags":["meta","architecture","manual"]},{"location":"workflow/architecture/#e-the-directives-layer-ai_contextmd","title":"E. The Directives Layer (<code>AI_CONTEXT.md</code>)","text":"<ul> <li>Role: The \"Brain\" or \"Constitution\" for the AI Agent.</li> <li>Location: <code>z:\\AI_CONTEXT.md</code> (Root) and <code>z:\\docs_site\\AI_CONTEXT.md</code> (Replica).</li> <li>Purpose: To bridge the gap between deterministic scripts and stochastic AI. While scripts handle the structure, this file tells the AI how to write the content (tone, rules, privacy mapping). It is the single source of truth for the Agent's behavior.</li> </ul>","tags":["meta","architecture","manual"]},{"location":"workflow/architecture/#3-the-workflow-how-we-work","title":"3. The Workflow (How we work)","text":"<p>We edit the Python Modules in <code>.ag_scripts/</code>.</p> Goal Action Update Logic Edit <code>.ag_scripts/[module]/*.py</code> Update Privacy Edit <code>.ag_scripts/common/privacy.py</code> Update Dashboards <code>python ag_v2_dashboard.py</code> Update Packages <code>python ag_v2_package.py --all</code> Full Update <code>python ag_v2_update.py</code>","tags":["meta","architecture","manual"]},{"location":"workflow/architecture/#4-safety-features","title":"4. Safety Features","text":"<ol> <li>Modular Isolation: Logic is separated into modules (Python Packages) rather than monolithic scripts, preventing side-effects.</li> <li>Git-Backed: We rely on Git for versioning and backups.</li> <li>Preservation: The Dashboard Manager specifically reads existing Markdown to preserve manual summaries before regenerating the structure.</li> </ol>","tags":["meta","architecture","manual"]},{"location":"workflow/architecture/#5-how-to-use-quick-start","title":"5. How to Use (Quick Start)","text":"<p>Here is how you actually run the tools in your daily workflow.</p>","tags":["meta","architecture","manual"]},{"location":"workflow/architecture/#scenario-1-i-just-updated-a-package","title":"Scenario 1: I just updated a package","text":"<p>You changed <code>packages/car.yaml</code> and want to see the docs update. </p><pre><code>python ag_v2_package.py car\n</code></pre> *   What it does: Reads <code>car.yaml</code>, updates <code>docs/smart-home/packages/car.md</code>.<p></p>","tags":["meta","architecture","manual"]},{"location":"workflow/architecture/#scenario-2-i-added-a-new-view-to-my-dashboard","title":"Scenario 2: I added a new view to my dashboard","text":"<p>You edited the dashboard in the UI. Now you want the docs to match. </p><pre><code>python ag_v2_dashboard.py\n</code></pre> *   What it does: Scans your Lovelace config, anonymizes names, and rebuilds the dashboard docs.<p></p>","tags":["meta","architecture","manual"]},{"location":"workflow/architecture/#scenario-3-i-want-the-ai-to-analyze-my-code","title":"Scenario 3: I want the AI to analyze my code","text":"<p>You want the AI (in VS Code) to write a summary for you. </p><pre><code>python ag_v2_agent.py car\n</code></pre> *   What it does: Generates a \"Prompt\" that you can copy-paste to your AI Assistant to get a perfect analysis.<p></p>","tags":["meta","architecture","manual"]},{"location":"workflow/architecture/#scenario-4-i-want-to-update-everything","title":"Scenario 4: I want to update EVERYTHING","text":"<p>You are done for the day and want to sync up. </p><pre><code>python ag_v2_update.py\n</code></pre> *   What it does: Runs all of the above in sequence.<p></p>","tags":["meta","architecture","manual"]},{"location":"workflow/setup_guide/","title":"Setup guide","text":""},{"location":"workflow/setup_guide/#setup-guide","title":"Setup Guide","text":"<p>Version: 8.1 (Modularized)</p> <p>Philosophy: Agentic CMDB (Configuration Management Database)</p> <p>Strategy: \"Detached Docs\" (Private Config -&gt; Public Documentation)</p>"},{"location":"workflow/setup_guide/#1-executive-summary","title":"1. Executive Summary","text":"<p>This project automates the documentation of a Home Assistant Smart Home and Home Lab. Instead of writing documentation manually, we use an AI Agent (Google Antigravity) to scan the live configuration files and generate a static website (MkDocs).</p> <p>For daily operations, workflows, and tool references, please see: \ud83d\udcc4 Documentation Operations Manual</p>"},{"location":"workflow/setup_guide/#part-a-one-time-initialization-the-genesis","title":"PART A: One-Time Initialization (The Genesis)","text":"<p>\u26a0\ufe0f STOP: Only perform these steps if setting up from scratch.</p>"},{"location":"workflow/setup_guide/#1-initialize-local-safety-root","title":"1. Initialize Local Safety (Root)","text":"<ul> <li>Git: Initialize <code>/config</code> with <code>.gitignore</code> (secrets, logs, dbs).</li> <li>Permissions: <code>git config --global --add safe.directory '*'</code></li> <li>First Commit: \"Initial Home Assistant Backup\".</li> </ul>"},{"location":"workflow/setup_guide/#2-establish-agent-rules","title":"2. Establish Agent Rules","text":"<p>Create <code>.antigravity/rules.md</code>: * NEVER edit <code>.storage</code> manually. * Consult <code>AI_CONTEXT.md</code> before writing.</p>"},{"location":"workflow/setup_guide/#3-bootstrap-helper-tools","title":"3. Bootstrap Helper Tools","text":"<ul> <li>Ensure <code>.ag_scripts/</code> exists (Git Pull).</li> <li>Run <code>python ag_v2_update.py</code> to verify the system works.</li> </ul>"},{"location":"workflow/setup_guide/#4-scaffold-documentation-site","title":"4. Scaffold Documentation Site","text":"<ul> <li>Use Agent to create <code>docs_site/</code> with MkDocs Material theme.</li> <li>Ensure <code>docs/CNAME</code> exists (<code>www.evishome.com</code>).</li> <li>Initialize Git in <code>docs_site/</code> and push to GitHub (<code>gh-pages</code>).</li> </ul>"},{"location":"workflow/setup_guide/#part-b-workstation-setup-adding-laptops","title":"PART B: Workstation Setup (Adding Laptops)","text":"<p>\u2705 START HERE: If the system is already running and you are on a new computer.</p>"},{"location":"workflow/setup_guide/#1-install-tools","title":"1. Install Tools","text":"<ul> <li>Git (Windows/Mac)</li> <li>Antigravity IDE</li> <li>Python (Check \"Add to PATH\")</li> </ul>"},{"location":"workflow/setup_guide/#2-connect-configure","title":"2. Connect &amp; Configure","text":"<ul> <li>Mount <code>\\\\homeassistant.local\\config</code>.</li> <li>Open Folder in Antigravity.</li> <li>Unhide Files: Settings &gt; <code>files.exclude</code> &gt; Remove <code>**/.*</code>.</li> <li>Trust Git: Terminal &gt; <code>git config --global --add safe.directory '*'</code>.</li> </ul> <p>End of Setup Guide. Proceed to Documentation Operations.</p>"},{"location":"workflow/tools/","title":"Tools Reference","text":"","tags":["manual","operations","reference"]},{"location":"workflow/tools/#tools-reference","title":"Tools Reference","text":"<p>Version: 2.0 (Modularized) Philosophy: Agentic CMDB Reference: Setup Guide works hand-in-hand with this operations manual.</p>","tags":["manual","operations","reference"]},{"location":"workflow/tools/#1-core-concepts-standards","title":"1. Core Concepts &amp; Standards","text":"","tags":["manual","operations","reference"]},{"location":"workflow/tools/#visual-assets-standard","title":"Visual Assets Standard","text":"<p>Images must be sorted into subfolders to keep the repo clean. * Dashboards: <code>docs/assets/images/dashboards/dashboard_[slug]_[view].png</code> * Packages: <code>docs/assets/images/packages/[name].png</code> * Brand: <code>docs/assets/images/brand/</code></p>","tags":["manual","operations","reference"]},{"location":"workflow/tools/#locking-files-prevent-overwrite","title":"Locking Files (Prevent Overwrite)","text":"<p>To protect a manually written page from the Agent: * Add <code>auto_update: false</code> to the YAML frontmatter at the top of the Markdown file.</p>","tags":["manual","operations","reference"]},{"location":"workflow/tools/#tagging-strategy","title":"Tagging Strategy","text":"<p>Use YAML frontmatter to categorize pages for the Tag Cloud. * Standard Tags: <code>package</code>, <code>dashboard</code>, <code>network</code>, <code>automated</code>, <code>manual</code>.</p>","tags":["manual","operations","reference"]},{"location":"workflow/tools/#2-daily-operations-the-workflow","title":"2. Daily Operations (The Workflow)","text":"","tags":["manual","operations","reference"]},{"location":"workflow/tools/#the-full-maintenance-cycle-recommended","title":"The Full Maintenance Cycle (Recommended)","text":"<p>Run these commands in order to keep everything synced.</p> <ol> <li>Commit Config (Local Repo A): <pre><code>cd /; git add .; git commit -m \"WIP: Config updates\"\n</code></pre></li> <li>Update Code (Git Pull): <pre><code>git pull\n</code></pre></li> <li>Regenerate Docs (The V2 Shim): <pre><code>cd /; python .ag_scripts/orchestrator/update_all.py\n</code></pre></li> <li>Publish Docs (Public Repo B): <pre><code>cd docs_site; git add .; git commit -m \"Routine update\"; git push\n</code></pre></li> </ol>","tags":["manual","operations","reference"]},{"location":"workflow/tools/#the-ai-architect-workflow","title":"The AI Architect Workflow","text":"<p>Start new chats with: \"I am resuming EvisHomeLab. Read:</p> <ul> <li><code>docs_site/docs/system_manual/architecture.md</code></li> <li><code>docs_site/docs/system_manual/tools.md</code></li> <li><code>docs_site/AI_CONTEXT.md</code>. Adopt the persona.\"</li> <li><code>analyze all ag_* related folders</code> to understand the system structure.</li> <li><code>analyze all ag_*.py files</code> to understand the system tools and logic.</li> <li><code>analyze /docs_site</code> to understand the website structure and content.</li> </ul>","tags":["manual","operations","reference"]},{"location":"workflow/tools/#the-agent-prompts","title":"The Agent Prompts","text":"<p>Task: Standardize Package Headers (Source Code Management)</p> <p>\"Scan <code>packages/</code>. Check headers. If missing/legacy, prepend:</p> <p></p><pre><code># ------------------------------------------------------------------------------\n# Package: [Filename]\n# Version: 1.0.0\n# Description: [Summary]\n# Dependencies: [Entities used]\n# ------------------------------------------------------------------------------\n</code></pre> \"<p></p> <p>Task: Update Package Boilerplate (Automation) Use this prompt first to ensure the documentation structure is correct and versioned.</p> <p>\"Run <code>python .ag_scripts/package_manager/main.py [package_name]</code>.\"</p> <p>Task: Deep Package Analysis (Intelligence Injection) Use this prompt AFTER running the Python script to fill the intelligent content slots.</p> <p>\"I am working on the package: [PACKAGE_NAME].</p> <p>Task:</p> <ol> <li>Locate Files: Find the source YAML in <code>packages/</code> and the documentation Markdown in <code>docs_site/docs/smart-home/packages/</code> matching this name.</li> <li>Guard Check: If the Markdown contains <code>auto_update: false</code>, ABORT.</li> <li>Smart Analysis:</li> <li>Executive Summary: Technical overview for admins.</li> <li>Process Description: Non-technical explanation for users (How it works).</li> <li>Integration Dependencies: List only external integrations (e.g., UniFi, MQTT, Yale). Exclude standard Home Assistant components (Scripts, Input Helpers, Logbook).</li> <li>Architecture: Generate a <code>mermaid</code> sequence diagram. CRITICAL: Write a specific narrative paragraph explaining the logic flow shown in the diagram.</li> <li>Update Documentation File:</li> <li>Target: Locate the specific HTML comment markers (slots).</li> <li>Action: Replace the content between the markers.<ul> <li><code>&lt;!-- START_SUMMARY --&gt;</code> ... <code>&lt;!-- END_SUMMARY --&gt;</code></li> <li><code>&lt;!-- START_DETAILED --&gt;</code> ... <code>&lt;!-- END_DETAILED --&gt;</code></li> <li><code>&lt;!-- START_DEPENDENCIES --&gt;</code> ... <code>&lt;!-- END_DEPENDENCIES --&gt;</code></li> <li><code>&lt;!-- START_MERMAID_DESC --&gt;</code> ... <code>&lt;!-- END_MERMAID_DESC --&gt;</code></li> <li><code>&lt;!-- START_MERMAID --&gt;</code> ... <code>&lt;!-- END_MERMAID --&gt;</code></li> </ul> </li> <li>Dashboard Links: Scan <code>.storage/lovelace_dashboards</code> and embed cards into <code>&lt;!-- START_DASHBOARD --&gt;</code>.\"</li> </ol> <p>Task: Analyze Dashboard View (Intelligence Injection) Use this to populate the empty summaries in your generated dashboard docs.</p> <p>\"Analyze the dashboard view: [VIEW_PATH] (e.g. <code>dashboards/main/car.md</code>).</p> <ol> <li>Read the Markdown file to see the embedded YAML configuration.</li> <li>Analyze: Understand what devices and controls are present (e.g., 'Thermostat control', 'Camera feed').</li> <li>Write Short Description: Create a 1-2 sentence very brief description for the Index Page (e.g. \"Main control interface for living room lights and AC.\").</li> <li>Inject: Replace content between <code>&lt;!-- START_DESCRIPTION --&gt;</code> and <code>&lt;!-- END_DESCRIPTION --&gt;</code>.</li> <li>Write Detailed Summary: Create a paragraph explaining the view in detail.</li> <li>Inject: Replace content between <code>&lt;!-- START_SUMMARY --&gt;</code> and <code>&lt;!-- END_SUMMARY --&gt;</code>.</li> </ol> <p>Task: Update Architecture (Structure &amp; Overview)</p> <p>\"Update <code>docs_site/docs/smart-home/structure.md</code> AND <code>docs_site/docs/index.md</code>. 1. Structure: Re-scan root. Update file tree. 2. Overview: Update 'High Level Architecture' with new integrations.\"</p> <p>Task: Web Design &amp; Image Management</p> <p>\"Scan <code>assets/images/</code>. Update Markdown files to replace placeholder text with actual image links. If asking for CSS changes, edit <code>assets/css/custom.css</code>.\"</p> <p>Task: Generate All Package Documentation</p> <p>\"Deep scan <code>packages/</code>. Create Markdown for all files with: Frontmatter tags, Summary, Architecture Diagram, Redacted Code, Dashboard connections, and Visuals.\"</p>","tags":["manual","operations","reference"]},{"location":"workflow/tools/#3-tool-reference","title":"3. Tool Reference","text":"","tags":["manual","operations","reference"]},{"location":"workflow/tools/#ag_scriptsorchestratorupdate_allpy","title":"<code>.ag_scripts/orchestrator/update_all.py</code>","text":"<p>The Master Orchestrator. Coordinates the update of all documentation components (Packages, Dashboards, Structure, Indices). *   Command: <code>python .ag_scripts/orchestrator/update_all.py [optional_package_name]</code></p>","tags":["manual","operations","reference"]},{"location":"workflow/tools/#ag_scriptsdashboard_managermainpy","title":"<code>.ag_scripts/dashboard_manager/main.py</code>","text":"<p>The Dashboard Engine. Reads <code>.storage/lovelace_dashboards</code>, performs name redaction (Jukka-&gt;Evis), and generates dashboard documentation. *   Command: <code>python .ag_scripts/dashboard_manager/main.py [optional_dashboard_slug]</code></p>","tags":["manual","operations","reference"]},{"location":"workflow/tools/#ag_scriptspackage_managermainpy","title":"<code>.ag_scripts/package_manager/main.py</code>","text":"<p>The Package Engine. Reads specific package YAML files, extracts metadata, and ensures the markdown skeleton exists. *   Command: <code>python .ag_scripts/package_manager/main.py [package_name]</code></p>","tags":["manual","operations","reference"]},{"location":"workflow/tools/#structure-index-generators","title":"Structure &amp; Index Generators","text":"<p>New tools to keep the site structure automated. *   Structure: <code>.ag_scripts/structure_manager/generate_structure.py</code> (Maintains <code>structure.md</code>) *   Automations: <code>.ag_scripts/structure_manager/generate_automations_doc.py</code> (Maintains <code>automations.md</code> for UI logic) *   Package Index: <code>.ag_scripts/package_manager/generate_index.py</code> (Maintains <code>packages/index.md</code>)</p>","tags":["manual","operations","reference"]},{"location":"workflow/tools/#4-troubleshooting","title":"4. Troubleshooting","text":"<ul> <li>Red Squiggles in <code>mkdocs.yml</code>: False positive, ignore.</li> <li>Unsafe Repo Error: Run <code>git config --global --add safe.directory '*'</code>.</li> <li>404 Error: Check GitHub Pages settings -&gt; Branch must be <code>gh-pages</code>, Folder <code>/</code>.</li> </ul>","tags":["manual","operations","reference"]}]}